This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2024-11-26T02:54:45.527Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

For more information about Repomix, visit: https://github.com/yamadashy/repomix

================================================================
Repository Structure
================================================================
.env.example
.gitignore
breakdown.txt
clean-start.bat
clear-cache.bat
DEPLOYMENT.md
eslint.config.js
index.html
LAUNCH.md
netlify.toml
next-env.d.ts
next.config.mjs
package.json
postcss.config.js
public/assets/logo-dark.svg
public/assets/logo-light.svg
public/sw.js
public/sw.js.map
public/workbox-e43f5367.js
public/workbox-e43f5367.js.map
README.md
restart-dev.bat
scripts/create_tables.sql
SETUP.md
src/App.tsx
src/components/Admin/AddGuildModal.tsx
src/components/Admin/GuildAdmin.tsx
src/components/Admin/GuildImageUpload.tsx
src/components/Admin/index.tsx
src/components/Admin/QuestAdmin.tsx
src/components/Admin/QuestForm.tsx
src/components/Admin/QuestList.tsx
src/components/Admin/RaidAdmin.tsx
src/components/Admin/RaidBossForm.tsx
src/components/Admin/RaidBossList.tsx
src/components/Admin/SubmissionsAdmin.tsx
src/components/AdminPanel/index.tsx
src/components/AudioControls.tsx
src/components/Avatar.tsx
src/components/Button.tsx
src/components/common/SectionContainer.tsx
src/components/ConnectPrompt.tsx
src/components/ContentBox.tsx
src/components/Dashboard.tsx
src/components/Dashboard/index.tsx
src/components/Dashboard/NFTProfileButton.tsx
src/components/ErrorBoundary.tsx
src/components/FloatingControls.tsx
src/components/Footer.tsx
src/components/Gallery.tsx
src/components/Gallery/Gallery.tsx
src/components/Game/GameCanvas.tsx
src/components/Game/GameUI.tsx
src/components/Game/index.tsx
src/components/Game/useGameState.ts
src/components/GlassContainer.tsx
src/components/GlassPanel.tsx
src/components/Guild/Archetypes.tsx
src/components/Guild/GuildJoinModal.tsx
src/components/Guild/GuildList.tsx
src/components/Guild/GuildManagement.tsx
src/components/Guild/index.tsx
src/components/Guild/JoinRequestModal.tsx
src/components/Guild/MyGuild.tsx
src/components/Header.tsx
src/components/HexagonBorder.tsx
src/components/HomePage/CallToActionSection.tsx
src/components/HomePage/CommunitySection.tsx
src/components/HomePage/FAQSection.tsx
src/components/HomePage/FeaturesSection.tsx
src/components/HomePage/GuildSection.tsx
src/components/HomePage/HeroSection.tsx
src/components/HomePage/HomePage.tsx
src/components/HomePage/index.ts
src/components/HomePage/index.tsx
src/components/HomePage/NFTBuilderSection.tsx
src/components/HomePage/QuestSection.tsx
src/components/HomePage/RaidBossesSection.tsx
src/components/HomePage/TestimonialsSection.tsx
src/components/InfoPage/CommunitySection.tsx
src/components/InfoPage/FeaturesSection.tsx
src/components/InfoPage/GuildSection.tsx
src/components/InfoPage/HeroSection.tsx
src/components/InfoPage/Info.tsx
src/components/InfoPage/RoadmapSection.tsx
src/components/InfoPage/SecuritySection.tsx
src/components/InfoPage/TokenomicsSection.tsx
src/components/LevelDisplay.tsx
src/components/LoadingScreen.tsx
src/components/Logo.tsx
src/components/Marketplace/index.tsx
src/components/Navigation.tsx
src/components/Navigation/index.tsx
src/components/Navigation/Menu.tsx
src/components/Navigation/Navigation.tsx
src/components/Navigation/navigationItems.ts
src/components/NFTBuilder/index.ts
src/components/NFTBuilder/index.tsx
src/components/NFTBuilder/layers.ts
src/components/NFTBuilder/LayerSelector.tsx
src/components/NFTBuilder/NFTBuilder.tsx
src/components/NFTBuilder/NFTPreview.tsx
src/components/NFTBuilder/types.ts
src/components/NFTBuilder/useLayerPreloader.ts
src/components/NFTBuilder/utils.ts
src/components/NFTCard.tsx
src/components/NFTGrid.tsx
src/components/ProfilePicture.tsx
src/components/ProtectedRoute.tsx
src/components/Raid/CompletedRaids.tsx
src/components/Raid/index.tsx
src/components/Raid/Leaderboard.tsx
src/components/Raid/QuestList.tsx
src/components/Raid/QuestSubmissionModal.tsx
src/components/Raid/RaidBoss.tsx
src/components/Raid/RaidBossCard.tsx
src/components/Raid/RaidBossDetails.tsx
src/components/Raid/RaidBossDetailsModal.tsx
src/components/Raid/RaidBossShareModal.tsx
src/components/Raid/RaidQuestList.tsx
src/components/Raid/UserProfile.tsx
src/components/RaidLeaderboards/ArchetypeLeaderboards.tsx
src/components/RaidLeaderboards/GuildLeaderboards.tsx
src/components/RaidLeaderboards/GuildMemberModal.tsx
src/components/RaidLeaderboards/GuildMembersModal.tsx
src/components/RaidLeaderboards/index.tsx
src/components/RaidLeaderboards/PlayerLeaderboards.tsx
src/components/RaidLeaderboards/ProfileModal.tsx
src/components/RaidLeaderboards/RaidLeaderboards.tsx
src/components/RaidLeaderboards/TimeRangeStats.tsx
src/components/RaidProfile/GuildQuestions.tsx
src/components/RaidProfile/GuildSelector.tsx
src/components/RaidProfile/index.tsx
src/components/RaidProfile/PandaPack.tsx
src/components/RaidProfile/ProfilePage.tsx
src/components/RaidProfile/ProfileUpload.tsx
src/components/RaidProfile/UsernameManager.tsx
src/components/ScrollToTop.tsx
src/components/SectionWrapper.tsx
src/components/Settings.tsx
src/components/StateProvider.tsx
src/components/ThemeToggle.tsx
src/components/ui/Section.tsx
src/components/ui/skeleton.tsx
src/components/ui/tabs.tsx
src/components/VolumeControl.tsx
src/components/WalletConnect.tsx
src/components/WalletContextProvider.tsx
src/components/Welcome.tsx
src/components/XPProgress.tsx
src/config/brand.ts
src/config/cache.ts
src/config/constants.ts
src/config/database.ts
src/config/firebase.ts
src/config/index.ts
src/config/monitoring.ts
src/config/relayer.ts
src/config/rpc.ts
src/config/scale.ts
src/config/security.ts
src/contexts/AudioContext.tsx
src/contexts/AuthContext.tsx
src/contexts/index.ts
src/contexts/ThemeContext.tsx
src/data/guildQuestions.ts
src/data/questPool.ts
src/hooks/index.ts
src/hooks/useQuests.ts
src/hooks/useRaid.ts
src/hooks/useScrollEffect.ts
src/hooks/useStateSync.ts
src/index.css
src/lib/supabase.ts
src/lib/utils.ts
src/main.tsx
src/schemas/guild.ts
src/schemas/index.ts
src/schemas/leaderboard.ts
src/schemas/quest.ts
src/schemas/raid.ts
src/schemas/settings.ts
src/schemas/user.ts
src/scripts/migrateToSupabase.ts
src/scripts/runMigration.ts
src/services/compression.ts
src/services/crypto.ts
src/services/database/BatchProcessor.ts
src/services/database/CacheManager.ts
src/services/database/DatabaseService.ts
src/services/database/GuildService.ts
src/services/database/QueryBuilder.ts
src/services/database/QuestService.ts
src/services/database/UserService.ts
src/services/db/guildDB.ts
src/services/db/index.ts
src/services/db/leaderboardDB.ts
src/services/db/questDB.ts
src/services/db/raidDB.ts
src/services/db/userDB.ts
src/services/firebase/auth.ts
src/services/firebase/db.ts
src/services/firebase/index.ts
src/services/guildService.ts
src/services/index.ts
src/services/playerService.ts
src/services/questPoolService.ts
src/services/questService.ts
src/services/raidService.ts
src/services/relayer.ts
src/services/relayer/compression.ts
src/services/relayer/index.ts
src/services/relayer/queue.ts
src/services/relayer/rateLimit.ts
src/services/relayer/TransactionRelayer.ts
src/services/StateManager.ts
src/services/submissionService.ts
src/services/supabaseAuth.ts
src/services/supabaseClient.ts
src/services/supabaseService.ts
src/services/twitterService.ts
src/services/userService.ts
src/styles/base.css
src/styles/wallet.css
src/types/brand.ts
src/types/database.ts
src/types/guild.ts
src/types/index.ts
src/types/nft.ts
src/types/player.ts
src/types/quest.ts
src/types/raid.ts
src/types/submission.ts
src/types/supabase.ts
src/types/twitter.ts
src/utils/address.ts
src/utils/api.ts
src/utils/cache.ts
src/utils/cn.ts
src/utils/env.ts
src/utils/errorBoundary.ts
src/utils/imageCompression.ts
src/utils/imageCompressor.ts
src/utils/imageProcessor.ts
src/utils/index.ts
src/utils/levelCalculator.ts
src/utils/performance.ts
src/vite-env.d.ts
supabase/.gitignore
supabase/functions/get-nonce/index.ts
supabase/migrations/20240000000001_base_schema.sql
supabase/migrations/20240000000002_submission_review.sql
supabase/migrations/20240000000003_create_submissions.sql
supabase/migrations/20240000000004_add_admin_role.sql
tailwind.config.cjs
tailwind.config.mjs
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vercel.json
vite.config.ts

================================================================
Repository Files
================================================================

================
File: .env.example
================
# Firebase Configuration
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_auth_domain
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_storage_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id

# Helius Configuration
VITE_HELIUS_API_KEY=your_helius_api_key

================
File: .gitignore
================
node_modules
dist
dist-ssr
*.local
.env
.env.*
!.env.example

# Vercel
.vercel
.turbo

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

================
File: breakdown.txt
================
# RaidRally - NFT Gaming Platform
Last Updated: 2024

## 1. Project Overview
RaidRally is a web3 gaming platform built on the Solana blockchain, combining NFT integration, social gaming features, and raid-based gameplay mechanics. The platform features a modern, responsive design with both light and dark themes.

## 2. Core Components

### Navigation System
- Location: /src/components/Navigation/
- Key Files:
  * index.tsx: Main navigation component with desktop/mobile views
  * MobileMenu.tsx: Slide-out mobile menu with haptic feedback
  * MobileNav.tsx: Bottom navigation bar for mobile
  * navigationItems.ts: Centralized route configuration

### Authentication System
- Wallet-based authentication using Solana
- Guest mode support
- Role-based access control (Admin/User)
- Admin wallet: "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs"

### Core Features
1. NFT System
   - NFT Builder interface
   - Collection viewing and management
   - Integration with Solana NFT standards

2. Raid System
   - Quest management
   - Raid boss battles
   - XP and rewards system
   - Leaderboards

3. Guild System
   - Guild creation and management
   - Member management
   - Guild statistics and rankings

4. Social Features
   - Community sections
   - Player profiles
   - Social links integration

## 3. Technical Stack

### Frontend
- React 18.3.1 with TypeScript
- Vite for build tooling
- Tailwind CSS for styling
- React Router for navigation

### Blockchain Integration
- @solana/wallet-adapter-base: ^0.9.23
- @solana/wallet-adapter-phantom: ^0.9.24
- @solana/wallet-adapter-react: ^0.15.35
- @solana/web3.js: ^1.91.1

### Backend Services
- Firebase
  * Firestore for data storage
  * Firebase Storage for assets
  * Firebase Authentication

### State Management
- React Context API for:
  * Wallet state
  * Authentication state
  * Theme preferences
  * Audio settings

## 4. Key Features

### Authentication & Authorization
- Phantom wallet integration
- Guest mode access
- Role-based routing:
  * Public routes (Home, Info, NFT Builder, Leaderboards)
  * Protected routes (Raid, Guild, Profile, Settings)
  * Admin routes (Admin Panel)

### Navigation Features
- Responsive design with desktop/mobile views
- Bottom navigation bar for mobile
- Slide-out menu with animations
- Haptic feedback support
- Dark/light theme support
- Safe area insets for modern devices

### Gaming Features
1. Quest System
   - Quest creation (admin)
   - Quest completion tracking
   - XP rewards
   - Time-based expiration

2. Raid System
   - Raid boss management
   - Player participation tracking
   - Reward distribution
   - Leaderboard rankings

3. Guild System
   - Guild creation
   - Member management
   - Guild statistics
   - Guild rankings

## 5. UI/UX Features

### Theme System
- Dark/light mode support
- System preference detection
- Persistent theme preferences
- Custom color schemes
- Dynamic theme switching

### Mobile Optimization
- Bottom navigation for easy thumb access
- Slide-out menu with backdrop
- Touch-friendly hit areas
- Haptic feedback
- Safe area considerations
- Responsive images

### Animations
- Menu transitions
- Page transitions
- Loading states
- Interactive feedback
- Smooth scrolling

## 6. Development Infrastructure

### Build System
- Vite for development and production builds
- TypeScript configuration
- ESLint for code quality
- PostCSS for CSS processing

### Deployment Options
- Firebase Hosting
- Vercel deployment
- Netlify support

### Development Tools
- Hot module replacement
- TypeScript type checking
- ESLint code quality checks
- Tailwind CSS utilities

## 7. File Structure

### Key Directories
- /src/components/: React components
- /src/contexts/: React context providers
- /src/services/: Backend service integrations
- /src/utils/: Utility functions
- /src/types/: TypeScript type definitions
- /public/: Static assets

### Component Organization
- Feature-based directory structure
- Shared components in common directories
- Context-specific components in feature directories

## 8. Security Measures

### Authentication
- Wallet signature verification
- Role-based access control
- Protected route guards
- Admin wallet validation

### Data Protection
- Firebase security rules
- Environment variable management
- Secure state management
- API key protection

## 9. Performance Considerations

### Optimization Techniques
- Code splitting
- Lazy loading
- Image optimization
- Caching strategies
- Bundle size optimization

### Mobile Performance
- Touch event optimization
- Animation performance
- Asset loading strategies
- Network request management

## 10. Future Improvements

### Planned Features
- Enhanced animations
- Keyboard navigation
- Advanced accessibility
- Additional role permissions
- Extended mobile features
- Advanced guild features

### Technical Debt
- Component refactoring
- Test coverage
- Performance optimization
- Documentation updates
- Code organization

This breakdown represents the current state of the RaidRally platform, a sophisticated web3 gaming application that combines blockchain technology with modern web development practices.

================
File: clean-start.bat
================
@echo off
echo Cleaning up...
rd /s /q "node_modules\.vite" 2>nul
rd /s /q ".next" 2>nul
rd /s /q "build" 2>nul

echo Installing dependencies...
npm install

echo Starting development server...
npm run dev

================
File: clear-cache.bat
================
@echo off
echo Clearing Vite cache...
rmdir /s /q "node_modules/.vite"
echo Cache cleared!
echo.
echo Please restart your development server with:
echo npm run dev

================
File: DEPLOYMENT.md
================
# Pan Da Pan Deployment Guide

## System Requirements

- Node.js 18.0.0 or higher
- 4+ CPU cores recommended
- 8GB+ RAM recommended
- SSD storage recommended

## Infrastructure Setup

### Frontend Hosting (Netlify)

```bash
# Build settings
Build command: npm run build
Publish directory: dist
Node version: 18.x
```

Environment variables:
```
VITE_APP_TITLE=Pan Da Pan
VITE_APP_DESCRIPTION=The ultimate NFT gaming experience on Solana
VITE_SOLANA_RPC_URL=your_rpc_url
```

### RPC Configuration

For optimal performance, use a dedicated Solana RPC with:
- Load balancing
- Rate limiting: 100 req/sec per IP
- WebSocket connections enabled
- Cache layer enabled

Recommended providers:
- Helius
- QuickNode
- Triton

### Caching Strategy

1. Browser-level:
   - NFT metadata: 5 minutes
   - User profiles: 1 minute
   - Leaderboards: 30 seconds

2. CDN-level:
   - Static assets: 1 year
   - API responses: 5 minutes
   - Images: 1 week

### Rate Limiting

- Global: 1000 requests per minute per IP
- Authentication: 30 requests per minute per IP
- NFT operations: 100 requests per minute per wallet
- Quest submissions: 10 per minute per wallet

## Performance Optimizations

1. Image Optimization:
   - Max size: 800x800px
   - Format: WebP with JPEG fallback
   - Quality: 80%
   - Progressive loading enabled

2. Bundle Optimization:
   - Code splitting by route
   - Lazy loading for non-critical components
   - Tree shaking enabled
   - Module federation for shared dependencies

3. Database Sharding:
   - Shard by guild ID
   - Partition leaderboards by time range
   - Index frequently queried fields

## Monitoring

1. Performance Metrics:
   - Page load time: < 2s target
   - Time to interactive: < 3s target
   - First contentful paint: < 1s target

2. Error Tracking:
   - Log all Solana transaction errors
   - Monitor failed quest submissions
   - Track wallet connection issues

3. Usage Metrics:
   - Daily active users
   - Quest completion rate
   - Guild participation rate

## Security

1. Smart Contract:
   - Rate limiting on chain interactions
   - Proof of stake for quest submissions
   - Multi-sig for admin operations

2. Frontend:
   - CSP headers enabled
   - CORS properly configured
   - XSS protection enabled

3. API:
   - JWT authentication
   - Request signing
   - Input validation

## Scaling Considerations

1. Horizontal Scaling:
   - Stateless architecture
   - Load balanced across regions
   - Auto-scaling enabled

2. Database Scaling:
   - Read replicas for leaderboards
   - Write sharding for user data
   - Caching layer for hot data

3. Content Delivery:
   - Multi-region CDN
   - Edge caching
   - Dynamic asset optimization

## Maintenance

1. Deployment:
   - Zero-downtime updates
   - Automated rollbacks
   - Blue-green deployment

2. Backup:
   - Hourly state snapshots
   - Daily full backups
   - Multi-region replication

3. Updates:
   - Scheduled maintenance windows
   - Gradual feature rollouts
   - A/B testing capability

================
File: eslint.config.js
================
import js from '@eslint/js';
import globals from 'globals';
import reactHooks from 'eslint-plugin-react-hooks';
import reactRefresh from 'eslint-plugin-react-refresh';
import tseslint from 'typescript-eslint';

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
    },
  }
);

================
File: index.html
================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#E8825F" />
    <title>Pan Da Pan - NFT Portfolio Dashboard</title>
    <!-- Preload critical assets -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Archivo+Black&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

================
File: LAUNCH.md
================
# Pan Da Pan Launch Guide

## Prerequisites

- Node.js 18.0.0 or higher
- npm 7.0.0 or higher

## Quick Start

1. Install dependencies:
```bash
npm install
```

2. Create a `.env` file in the root directory with the following variables:
```env
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_auth_domain
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_storage_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
VITE_HELIUS_API_KEY=your_helius_api_key
```

3. Start the development server:
```bash
npm run dev
```

## Available Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run preview` - Preview production build
- `npm run lint` - Run ESLint
- `npm run test` - Run tests

## Development Mode

The development server will start at `http://localhost:5173`. The page will automatically reload if you make changes to the code.

## Production Build

To create a production build:

1. Run the build command:
```bash
npm run build
```

2. The built files will be in the `dist` directory

3. To preview the production build:
```bash
npm run preview
```

================
File: netlify.toml
================
[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "18"
  NPM_FLAGS = "--no-audit --no-fund"

# Production context
[context.production]
  command = "npm run build"

# Deploy Preview context
[context.deploy-preview]
  command = "npm run build"

# Branch Deploy context
[context.branch-deploy]
  command = "npm run build"

# Asset optimization
[build.processing]
  skip_processing = false
[build.processing.css]
  bundle = true
  minify = true
[build.processing.js]
  bundle = true
  minify = true
[build.processing.html]
  pretty_urls = true
[build.processing.images]
  compress = true

# Headers for security and caching
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "interest-cohort=()"
    Content-Security-Policy = "default-src 'self' https: data: blob: 'unsafe-inline' 'unsafe-eval'"

# Cache control for static assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Redirects
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Plugin configuration
[[plugins]]
  package = "@netlify/plugin-lighthouse"

[[plugins]]
  package = "netlify-plugin-cache"
  [plugins.inputs]
    paths = [
      "dist",
      "node_modules/.cache"
    ]

================
File: next-env.d.ts
================
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.

================
File: next.config.mjs
================
import withPWA from 'next-pwa';

const nextConfig = withPWA({
  dest: 'public',
  register: true,
  skipWaiting: true
})({
  reactStrictMode: true,
  webpack: (config) => {
    config.resolve.fallback = {
      ...config.resolve.fallback,
      fs: false,
      net: false,
      tls: false,
      crypto: false,
    };
    return config;
  },
  images: {
    domains: [
      'raw.githubusercontent.com',
      'arweave.net',
      'www.arweave.net',
      'ipfs.io',
      'cloudinary.com',
    ],
  },
});

export default nextConfig;

================
File: package.json
================
{
  "name": "pandapan",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview",
    "emulators": "firebase emulators:start"
  },
  "dependencies": {
    "@chakra-ui/icons": "^2.2.4",
    "@chakra-ui/react": "^3.2.0",
    "@emotion/react": "^11.13.5",
    "@emotion/styled": "^11.13.5",
    "@radix-ui/react-tabs": "^1.1.1",
    "@solana/wallet-adapter-base": "^0.9.23",
    "@solana/wallet-adapter-phantom": "^0.9.24",
    "@solana/wallet-adapter-react": "^0.15.35",
    "@solana/wallet-adapter-react-ui": "^0.9.34",
    "@solana/wallet-adapter-solflare": "^0.6.28",
    "@solana/wallet-adapter-wallets": "^0.19.25",
    "@solana/web3.js": "^1.91.1",
    "@supabase/supabase-js": "^2.46.1",
    "@types/crypto-js": "^4.2.2",
    "@types/react-helmet": "^6.1.11",
    "@types/react-icons": "^2.2.7",
    "axios": "^1.6.7",
    "base64-arraybuffer": "^1.0.2",
    "browser-image-compression": "^2.0.2",
    "bs58": "^5.0.0",
    "buffer": "^6.0.3",
    "clsx": "^2.1.1",
    "crypto-js": "^4.2.0",
    "firebase": "^10.14.1",
    "framer-motion": "^11.11.17",
    "lucide-react": "^0.344.0",
    "lz-string": "^1.5.0",
    "merge-images": "^2.0.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-helmet": "^6.1.0",
    "react-router-dom": "^6.22.3",
    "snappy": "^7.2.2",
    "supabase-cli": "^0.0.21",
    "tailwind-merge": "^2.5.4",
    "tweetnacl": "^1.0.3"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.1",
    "@tailwindcss/aspect-ratio": "^0.4.2",
    "@tailwindcss/forms": "^0.5.9",
    "@tailwindcss/typography": "^0.5.15",
    "@types/merge-images": "^1.2.4",
    "@types/react": "^18.3.5",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.1",
    "assert": "^2.1.0",
    "autoprefixer": "^10.4.18",
    "crypto-browserify": "^3.12.1",
    "eslint": "^9.9.1",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.11",
    "firebase-tools": "^13.4.1",
    "globals": "^15.9.0",
    "https-browserify": "^1.0.0",
    "os-browserify": "^0.3.0",
    "postcss": "^8.4.35",
    "stream-browserify": "^3.0.0",
    "stream-http": "^3.2.0",
    "tailwind-scrollbar": "^3.1.0",
    "tailwindcss": "^3.4.1",
    "tailwindcss-animate": "^1.0.7",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.3.0",
    "url": "^0.11.4",
    "vite": "^5.4.2"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}

================
File: postcss.config.js
================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

================
File: public/assets/logo-dark.svg
================
<?xml version="1.0" encoding="UTF-8"?>
<svg width="120" height="40" viewBox="0 0 120 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M10 8h20v24H10z" fill="#FF9ECD"/>
  <text x="40" y="26" fill="#FFFFFF" font-family="'Press Start 2P'" font-size="16">KIBALZ</text>
</svg>

================
File: public/assets/logo-light.svg
================
<?xml version="1.0" encoding="UTF-8"?>
<svg width="120" height="40" viewBox="0 0 120 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M10 8h20v24H10z" fill="#FF9ECD"/>
  <text x="40" y="26" fill="#1A1B23" font-family="'Press Start 2P'" font-size="16">KIBALZ</text>
</svg>

================
File: public/sw.js
================
/**
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *     http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// If the loader is already loaded, just stop.
if (!self.define) {
  let registry = {};

  // Used for `eval` and `importScripts` where we can't get script URL by other means.
  // In both cases, it's safe to use a global var because those functions are synchronous.
  let nextDefineUri;

  const singleRequire = (uri, parentUri) => {
    uri = new URL(uri + ".js", parentUri).href;
    return registry[uri] || (
      
        new Promise(resolve => {
          if ("document" in self) {
            const script = document.createElement("script");
            script.src = uri;
            script.onload = resolve;
            document.head.appendChild(script);
          } else {
            nextDefineUri = uri;
            importScripts(uri);
            resolve();
          }
        })
      
      .then(() => {
        let promise = registry[uri];
        if (!promise) {
          throw new Error(`Module ${uri} didn’t register its module`);
        }
        return promise;
      })
    );
  };

  self.define = (depsNames, factory) => {
    const uri = nextDefineUri || ("document" in self ? document.currentScript.src : "") || location.href;
    if (registry[uri]) {
      // Module is already loading or loaded.
      return;
    }
    let exports = {};
    const require = depUri => singleRequire(depUri, uri);
    const specialDeps = {
      module: { uri },
      exports,
      require
    };
    registry[uri] = Promise.all(depsNames.map(
      depName => specialDeps[depName] || require(depName)
    )).then(deps => {
      factory(...deps);
      return exports;
    });
  };
}
define(['./workbox-e43f5367'], (function (workbox) { 'use strict';

  importScripts();
  self.skipWaiting();
  workbox.clientsClaim();
  workbox.registerRoute("/", new workbox.NetworkFirst({
    "cacheName": "start-url",
    plugins: [{
      cacheWillUpdate: async ({
        request,
        response,
        event,
        state
      }) => {
        if (response && response.type === 'opaqueredirect') {
          return new Response(response.body, {
            status: 200,
            statusText: 'OK',
            headers: response.headers
          });
        }
        return response;
      }
    }]
  }), 'GET');
  workbox.registerRoute(/.*/i, new workbox.NetworkOnly({
    "cacheName": "dev",
    plugins: []
  }), 'GET');

}));
//# sourceMappingURL=sw.js.map

================
File: public/sw.js.map
================
{"version":3,"file":"sw.js","sources":["../../../AppData/Local/Temp/5be72f1ee0959a5840e8876722040284/sw.js"],"sourcesContent":["import {registerRoute as workbox_routing_registerRoute} from 'C:/Users/austi/Desktop/Website/RaidRallyNew/node_modules/workbox-routing/registerRoute.mjs';\nimport {NetworkFirst as workbox_strategies_NetworkFirst} from 'C:/Users/austi/Desktop/Website/RaidRallyNew/node_modules/workbox-strategies/NetworkFirst.mjs';\nimport {NetworkOnly as workbox_strategies_NetworkOnly} from 'C:/Users/austi/Desktop/Website/RaidRallyNew/node_modules/workbox-strategies/NetworkOnly.mjs';\nimport {clientsClaim as workbox_core_clientsClaim} from 'C:/Users/austi/Desktop/Website/RaidRallyNew/node_modules/workbox-core/clientsClaim.mjs';/**\n * Welcome to your Workbox-powered service worker!\n *\n * You'll need to register this file in your web app.\n * See https://goo.gl/nhQhGp\n *\n * The rest of the code is auto-generated. Please don't update this file\n * directly; instead, make changes to your Workbox build configuration\n * and re-run your build process.\n * See https://goo.gl/2aRDsh\n */\n\n\nimportScripts(\n  \n);\n\n\n\n\n\n\n\nself.skipWaiting();\n\nworkbox_core_clientsClaim();\n\n\n\nworkbox_routing_registerRoute(\"/\", new workbox_strategies_NetworkFirst({ \"cacheName\":\"start-url\", plugins: [{ cacheWillUpdate: async ({ request, response, event, state }) => { if (response && response.type === 'opaqueredirect') { return new Response(response.body, { status: 200, statusText: 'OK', headers: response.headers }) } return response } }] }), 'GET');\nworkbox_routing_registerRoute(/.*/i, new workbox_strategies_NetworkOnly({ \"cacheName\":\"dev\", plugins: [] }), 'GET');\n\n\n\n\n"],"names":["importScripts","self","skipWaiting","workbox_core_clientsClaim","workbox_routing_registerRoute","workbox_strategies_NetworkFirst","plugins","cacheWillUpdate","request","response","event","state","type","Response","body","status","statusText","headers","workbox_strategies_NetworkOnly"],"mappings":"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"}

================
File: public/workbox-e43f5367.js
================
define(['exports'], (function (exports) { 'use strict';

    // @ts-ignore
    try {
      self['workbox:core:6.5.4'] && _();
    } catch (e) {}

    /*
      Copyright 2019 Google LLC
      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const logger = (() => {
      // Don't overwrite this value if it's already set.
      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923
      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {
        self.__WB_DISABLE_DEV_LOGS = false;
      }
      let inGroup = false;
      const methodToColorMap = {
        debug: `#7f8c8d`,
        log: `#2ecc71`,
        warn: `#f39c12`,
        error: `#c0392b`,
        groupCollapsed: `#3498db`,
        groupEnd: null // No colored prefix on groupEnd
      };
      const print = function (method, args) {
        if (self.__WB_DISABLE_DEV_LOGS) {
          return;
        }
        if (method === 'groupCollapsed') {
          // Safari doesn't print all console.groupCollapsed() arguments:
          // https://bugs.webkit.org/show_bug.cgi?id=182754
          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {
            console[method](...args);
            return;
          }
        }
        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];
        // When in a group, the workbox prefix is not displayed.
        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];
        console[method](...logPrefix, ...args);
        if (method === 'groupCollapsed') {
          inGroup = true;
        }
        if (method === 'groupEnd') {
          inGroup = false;
        }
      };
      // eslint-disable-next-line @typescript-eslint/ban-types
      const api = {};
      const loggerMethods = Object.keys(methodToColorMap);
      for (const key of loggerMethods) {
        const method = key;
        api[method] = (...args) => {
          print(method, args);
        };
      }
      return api;
    })();

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const messages$1 = {
      'invalid-value': ({
        paramName,
        validValueDescription,
        value
      }) => {
        if (!paramName || !validValueDescription) {
          throw new Error(`Unexpected input to 'invalid-value' error.`);
        }
        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;
      },
      'not-an-array': ({
        moduleName,
        className,
        funcName,
        paramName
      }) => {
        if (!moduleName || !className || !funcName || !paramName) {
          throw new Error(`Unexpected input to 'not-an-array' error.`);
        }
        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;
      },
      'incorrect-type': ({
        expectedType,
        paramName,
        moduleName,
        className,
        funcName
      }) => {
        if (!expectedType || !paramName || !moduleName || !funcName) {
          throw new Error(`Unexpected input to 'incorrect-type' error.`);
        }
        const classNameStr = className ? `${className}.` : '';
        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;
      },
      'incorrect-class': ({
        expectedClassName,
        paramName,
        moduleName,
        className,
        funcName,
        isReturnValueProblem
      }) => {
        if (!expectedClassName || !moduleName || !funcName) {
          throw new Error(`Unexpected input to 'incorrect-class' error.`);
        }
        const classNameStr = className ? `${className}.` : '';
        if (isReturnValueProblem) {
          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;
        }
        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;
      },
      'missing-a-method': ({
        expectedMethod,
        paramName,
        moduleName,
        className,
        funcName
      }) => {
        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {
          throw new Error(`Unexpected input to 'missing-a-method' error.`);
        }
        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;
      },
      'add-to-cache-list-unexpected-type': ({
        entry
      }) => {
        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;
      },
      'add-to-cache-list-conflicting-entries': ({
        firstEntry,
        secondEntry
      }) => {
        if (!firstEntry || !secondEntry) {
          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);
        }
        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;
      },
      'plugin-error-request-will-fetch': ({
        thrownErrorMessage
      }) => {
        if (!thrownErrorMessage) {
          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);
        }
        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;
      },
      'invalid-cache-name': ({
        cacheNameId,
        value
      }) => {
        if (!cacheNameId) {
          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);
        }
        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;
      },
      'unregister-route-but-not-found-with-method': ({
        method
      }) => {
        if (!method) {
          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);
        }
        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;
      },
      'unregister-route-route-not-registered': () => {
        return `The route you're trying to unregister was not previously ` + `registered.`;
      },
      'queue-replay-failed': ({
        name
      }) => {
        return `Replaying the background sync queue '${name}' failed.`;
      },
      'duplicate-queue-name': ({
        name
      }) => {
        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;
      },
      'expired-test-without-max-age': ({
        methodName,
        paramName
      }) => {
        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;
      },
      'unsupported-route-type': ({
        moduleName,
        className,
        funcName,
        paramName
      }) => {
        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;
      },
      'not-array-of-class': ({
        value,
        expectedClass,
        moduleName,
        className,
        funcName,
        paramName
      }) => {
        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;
      },
      'max-entries-or-age-required': ({
        moduleName,
        className,
        funcName
      }) => {
        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;
      },
      'statuses-or-headers-required': ({
        moduleName,
        className,
        funcName
      }) => {
        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;
      },
      'invalid-string': ({
        moduleName,
        funcName,
        paramName
      }) => {
        if (!paramName || !moduleName || !funcName) {
          throw new Error(`Unexpected input to 'invalid-string' error.`);
        }
        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;
      },
      'channel-name-required': () => {
        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;
      },
      'invalid-responses-are-same-args': () => {
        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;
      },
      'expire-custom-caches-only': () => {
        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;
      },
      'unit-must-be-bytes': ({
        normalizedRangeHeader
      }) => {
        if (!normalizedRangeHeader) {
          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);
        }
        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was "${normalizedRangeHeader}"`;
      },
      'single-range-only': ({
        normalizedRangeHeader
      }) => {
        if (!normalizedRangeHeader) {
          throw new Error(`Unexpected input to 'single-range-only' error.`);
        }
        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `"${normalizedRangeHeader}"`;
      },
      'invalid-range-values': ({
        normalizedRangeHeader
      }) => {
        if (!normalizedRangeHeader) {
          throw new Error(`Unexpected input to 'invalid-range-values' error.`);
        }
        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `"${normalizedRangeHeader}"`;
      },
      'no-range-header': () => {
        return `No Range header was found in the Request provided.`;
      },
      'range-not-satisfiable': ({
        size,
        start,
        end
      }) => {
        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;
      },
      'attempt-to-cache-non-get-request': ({
        url,
        method
      }) => {
        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;
      },
      'cache-put-with-no-response': ({
        url
      }) => {
        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;
      },
      'no-response': ({
        url,
        error
      }) => {
        let message = `The strategy could not generate a response for '${url}'.`;
        if (error) {
          message += ` The underlying error is ${error}.`;
        }
        return message;
      },
      'bad-precaching-response': ({
        url,
        status
      }) => {
        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);
      },
      'non-precached-url': ({
        url
      }) => {
        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;
      },
      'add-to-cache-list-conflicting-integrities': ({
        url
      }) => {
        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;
      },
      'missing-precache-entry': ({
        cacheName,
        url
      }) => {
        return `Unable to find a precached response in ${cacheName} for ${url}.`;
      },
      'cross-origin-copy-response': ({
        origin
      }) => {
        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;
      },
      'opaque-streams-source': ({
        type
      }) => {
        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;
        if (type === 'opaqueredirect') {
          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;
        }
        return `${message} Please ensure your sources are CORS-enabled.`;
      }
    };

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const generatorFunction = (code, details = {}) => {
      const message = messages$1[code];
      if (!message) {
        throw new Error(`Unable to find message for code '${code}'.`);
      }
      return message(details);
    };
    const messageGenerator = generatorFunction;

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * Workbox errors should be thrown with this class.
     * This allows use to ensure the type easily in tests,
     * helps developers identify errors from workbox
     * easily and allows use to optimise error
     * messages correctly.
     *
     * @private
     */
    class WorkboxError extends Error {
      /**
       *
       * @param {string} errorCode The error code that
       * identifies this particular error.
       * @param {Object=} details Any relevant arguments
       * that will help developers identify issues should
       * be added as a key on the context object.
       */
      constructor(errorCode, details) {
        const message = messageGenerator(errorCode, details);
        super(message);
        this.name = errorCode;
        this.details = details;
      }
    }

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /*
     * This method throws if the supplied value is not an array.
     * The destructed values are required to produce a meaningful error for users.
     * The destructed and restructured object is so it's clear what is
     * needed.
     */
    const isArray = (value, details) => {
      if (!Array.isArray(value)) {
        throw new WorkboxError('not-an-array', details);
      }
    };
    const hasMethod = (object, expectedMethod, details) => {
      const type = typeof object[expectedMethod];
      if (type !== 'function') {
        details['expectedMethod'] = expectedMethod;
        throw new WorkboxError('missing-a-method', details);
      }
    };
    const isType = (object, expectedType, details) => {
      if (typeof object !== expectedType) {
        details['expectedType'] = expectedType;
        throw new WorkboxError('incorrect-type', details);
      }
    };
    const isInstance = (object,
    // Need the general type to do the check later.
    // eslint-disable-next-line @typescript-eslint/ban-types
    expectedClass, details) => {
      if (!(object instanceof expectedClass)) {
        details['expectedClassName'] = expectedClass.name;
        throw new WorkboxError('incorrect-class', details);
      }
    };
    const isOneOf = (value, validValues, details) => {
      if (!validValues.includes(value)) {
        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;
        throw new WorkboxError('invalid-value', details);
      }
    };
    const isArrayOfClass = (value,
    // Need general type to do check later.
    expectedClass,
    // eslint-disable-line
    details) => {
      const error = new WorkboxError('not-array-of-class', details);
      if (!Array.isArray(value)) {
        throw error;
      }
      for (const item of value) {
        if (!(item instanceof expectedClass)) {
          throw error;
        }
      }
    };
    const finalAssertExports = {
      hasMethod,
      isArray,
      isInstance,
      isOneOf,
      isType,
      isArrayOfClass
    };

    // @ts-ignore
    try {
      self['workbox:routing:6.5.4'] && _();
    } catch (e) {}

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * The default HTTP method, 'GET', used when there's no specific method
     * configured for a route.
     *
     * @type {string}
     *
     * @private
     */
    const defaultMethod = 'GET';
    /**
     * The list of valid HTTP methods associated with requests that could be routed.
     *
     * @type {Array<string>}
     *
     * @private
     */
    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * @param {function()|Object} handler Either a function, or an object with a
     * 'handle' method.
     * @return {Object} An object with a handle method.
     *
     * @private
     */
    const normalizeHandler = handler => {
      if (handler && typeof handler === 'object') {
        {
          finalAssertExports.hasMethod(handler, 'handle', {
            moduleName: 'workbox-routing',
            className: 'Route',
            funcName: 'constructor',
            paramName: 'handler'
          });
        }
        return handler;
      } else {
        {
          finalAssertExports.isType(handler, 'function', {
            moduleName: 'workbox-routing',
            className: 'Route',
            funcName: 'constructor',
            paramName: 'handler'
          });
        }
        return {
          handle: handler
        };
      }
    };

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * A `Route` consists of a pair of callback functions, "match" and "handler".
     * The "match" callback determine if a route should be used to "handle" a
     * request by returning a non-falsy value if it can. The "handler" callback
     * is called when there is a match and should return a Promise that resolves
     * to a `Response`.
     *
     * @memberof workbox-routing
     */
    class Route {
      /**
       * Constructor for Route class.
       *
       * @param {workbox-routing~matchCallback} match
       * A callback function that determines whether the route matches a given
       * `fetch` event by returning a non-falsy value.
       * @param {workbox-routing~handlerCallback} handler A callback
       * function that returns a Promise resolving to a Response.
       * @param {string} [method='GET'] The HTTP method to match the Route
       * against.
       */
      constructor(match, handler, method = defaultMethod) {
        {
          finalAssertExports.isType(match, 'function', {
            moduleName: 'workbox-routing',
            className: 'Route',
            funcName: 'constructor',
            paramName: 'match'
          });
          if (method) {
            finalAssertExports.isOneOf(method, validMethods, {
              paramName: 'method'
            });
          }
        }
        // These values are referenced directly by Router so cannot be
        // altered by minificaton.
        this.handler = normalizeHandler(handler);
        this.match = match;
        this.method = method;
      }
      /**
       *
       * @param {workbox-routing-handlerCallback} handler A callback
       * function that returns a Promise resolving to a Response
       */
      setCatchHandler(handler) {
        this.catchHandler = normalizeHandler(handler);
      }
    }

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * RegExpRoute makes it easy to create a regular expression based
     * {@link workbox-routing.Route}.
     *
     * For same-origin requests the RegExp only needs to match part of the URL. For
     * requests against third-party servers, you must define a RegExp that matches
     * the start of the URL.
     *
     * @memberof workbox-routing
     * @extends workbox-routing.Route
     */
    class RegExpRoute extends Route {
      /**
       * If the regular expression contains
       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},
       * the captured values will be passed to the
       * {@link workbox-routing~handlerCallback} `params`
       * argument.
       *
       * @param {RegExp} regExp The regular expression to match against URLs.
       * @param {workbox-routing~handlerCallback} handler A callback
       * function that returns a Promise resulting in a Response.
       * @param {string} [method='GET'] The HTTP method to match the Route
       * against.
       */
      constructor(regExp, handler, method) {
        {
          finalAssertExports.isInstance(regExp, RegExp, {
            moduleName: 'workbox-routing',
            className: 'RegExpRoute',
            funcName: 'constructor',
            paramName: 'pattern'
          });
        }
        const match = ({
          url
        }) => {
          const result = regExp.exec(url.href);
          // Return immediately if there's no match.
          if (!result) {
            return;
          }
          // Require that the match start at the first character in the URL string
          // if it's a cross-origin request.
          // See https://github.com/GoogleChrome/workbox/issues/281 for the context
          // behind this behavior.
          if (url.origin !== location.origin && result.index !== 0) {
            {
              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);
            }
            return;
          }
          // If the route matches, but there aren't any capture groups defined, then
          // this will return [], which is truthy and therefore sufficient to
          // indicate a match.
          // If there are capture groups, then it will return their values.
          return result.slice(1);
        };
        super(match, handler, method);
      }
    }

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const getFriendlyURL = url => {
      const urlObj = new URL(String(url), location.href);
      // See https://github.com/GoogleChrome/workbox/issues/2323
      // We want to include everything, except for the origin if it's same-origin.
      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');
    };

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * The Router can be used to process a `FetchEvent` using one or more
     * {@link workbox-routing.Route}, responding with a `Response` if
     * a matching route exists.
     *
     * If no route matches a given a request, the Router will use a "default"
     * handler if one is defined.
     *
     * Should the matching Route throw an error, the Router will use a "catch"
     * handler if one is defined to gracefully deal with issues and respond with a
     * Request.
     *
     * If a request matches multiple routes, the **earliest** registered route will
     * be used to respond to the request.
     *
     * @memberof workbox-routing
     */
    class Router {
      /**
       * Initializes a new Router.
       */
      constructor() {
        this._routes = new Map();
        this._defaultHandlerMap = new Map();
      }
      /**
       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP
       * method name ('GET', etc.) to an array of all the corresponding `Route`
       * instances that are registered.
       */
      get routes() {
        return this._routes;
      }
      /**
       * Adds a fetch event listener to respond to events when a route matches
       * the event's request.
       */
      addFetchListener() {
        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705
        self.addEventListener('fetch', event => {
          const {
            request
          } = event;
          const responsePromise = this.handleRequest({
            request,
            event
          });
          if (responsePromise) {
            event.respondWith(responsePromise);
          }
        });
      }
      /**
       * Adds a message event listener for URLs to cache from the window.
       * This is useful to cache resources loaded on the page prior to when the
       * service worker started controlling it.
       *
       * The format of the message data sent from the window should be as follows.
       * Where the `urlsToCache` array may consist of URL strings or an array of
       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).
       *
       * ```
       * {
       *   type: 'CACHE_URLS',
       *   payload: {
       *     urlsToCache: [
       *       './script1.js',
       *       './script2.js',
       *       ['./script3.js', {mode: 'no-cors'}],
       *     ],
       *   },
       * }
       * ```
       */
      addCacheListener() {
        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705
        self.addEventListener('message', event => {
          // event.data is type 'any'
          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
          if (event.data && event.data.type === 'CACHE_URLS') {
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            const {
              payload
            } = event.data;
            {
              logger.debug(`Caching URLs from the window`, payload.urlsToCache);
            }
            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {
              if (typeof entry === 'string') {
                entry = [entry];
              }
              const request = new Request(...entry);
              return this.handleRequest({
                request,
                event
              });
              // TODO(philipwalton): TypeScript errors without this typecast for
              // some reason (probably a bug). The real type here should work but
              // doesn't: `Array<Promise<Response> | undefined>`.
            })); // TypeScript
            event.waitUntil(requestPromises);
            // If a MessageChannel was used, reply to the message on success.
            if (event.ports && event.ports[0]) {
              void requestPromises.then(() => event.ports[0].postMessage(true));
            }
          }
        });
      }
      /**
       * Apply the routing rules to a FetchEvent object to get a Response from an
       * appropriate Route's handler.
       *
       * @param {Object} options
       * @param {Request} options.request The request to handle.
       * @param {ExtendableEvent} options.event The event that triggered the
       *     request.
       * @return {Promise<Response>|undefined} A promise is returned if a
       *     registered route can handle the request. If there is no matching
       *     route and there's no `defaultHandler`, `undefined` is returned.
       */
      handleRequest({
        request,
        event
      }) {
        {
          finalAssertExports.isInstance(request, Request, {
            moduleName: 'workbox-routing',
            className: 'Router',
            funcName: 'handleRequest',
            paramName: 'options.request'
          });
        }
        const url = new URL(request.url, location.href);
        if (!url.protocol.startsWith('http')) {
          {
            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);
          }
          return;
        }
        const sameOrigin = url.origin === location.origin;
        const {
          params,
          route
        } = this.findMatchingRoute({
          event,
          request,
          sameOrigin,
          url
        });
        let handler = route && route.handler;
        const debugMessages = [];
        {
          if (handler) {
            debugMessages.push([`Found a route to handle this request:`, route]);
            if (params) {
              debugMessages.push([`Passing the following params to the route's handler:`, params]);
            }
          }
        }
        // If we don't have a handler because there was no matching route, then
        // fall back to defaultHandler if that's defined.
        const method = request.method;
        if (!handler && this._defaultHandlerMap.has(method)) {
          {
            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);
          }
          handler = this._defaultHandlerMap.get(method);
        }
        if (!handler) {
          {
            // No handler so Workbox will do nothing. If logs is set of debug
            // i.e. verbose, we should print out this information.
            logger.debug(`No route found for: ${getFriendlyURL(url)}`);
          }
          return;
        }
        {
          // We have a handler, meaning Workbox is going to handle the route.
          // print the routing details to the console.
          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);
          debugMessages.forEach(msg => {
            if (Array.isArray(msg)) {
              logger.log(...msg);
            } else {
              logger.log(msg);
            }
          });
          logger.groupEnd();
        }
        // Wrap in try and catch in case the handle method throws a synchronous
        // error. It should still callback to the catch handler.
        let responsePromise;
        try {
          responsePromise = handler.handle({
            url,
            request,
            event,
            params
          });
        } catch (err) {
          responsePromise = Promise.reject(err);
        }
        // Get route's catch handler, if it exists
        const catchHandler = route && route.catchHandler;
        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {
          responsePromise = responsePromise.catch(async err => {
            // If there's a route catch handler, process that first
            if (catchHandler) {
              {
                // Still include URL here as it will be async from the console group
                // and may not make sense without the URL
                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);
                logger.error(`Error thrown by:`, route);
                logger.error(err);
                logger.groupEnd();
              }
              try {
                return await catchHandler.handle({
                  url,
                  request,
                  event,
                  params
                });
              } catch (catchErr) {
                if (catchErr instanceof Error) {
                  err = catchErr;
                }
              }
            }
            if (this._catchHandler) {
              {
                // Still include URL here as it will be async from the console group
                // and may not make sense without the URL
                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);
                logger.error(`Error thrown by:`, route);
                logger.error(err);
                logger.groupEnd();
              }
              return this._catchHandler.handle({
                url,
                request,
                event
              });
            }
            throw err;
          });
        }
        return responsePromise;
      }
      /**
       * Checks a request and URL (and optionally an event) against the list of
       * registered routes, and if there's a match, returns the corresponding
       * route along with any params generated by the match.
       *
       * @param {Object} options
       * @param {URL} options.url
       * @param {boolean} options.sameOrigin The result of comparing `url.origin`
       *     against the current origin.
       * @param {Request} options.request The request to match.
       * @param {Event} options.event The corresponding event.
       * @return {Object} An object with `route` and `params` properties.
       *     They are populated if a matching route was found or `undefined`
       *     otherwise.
       */
      findMatchingRoute({
        url,
        sameOrigin,
        request,
        event
      }) {
        const routes = this._routes.get(request.method) || [];
        for (const route of routes) {
          let params;
          // route.match returns type any, not possible to change right now.
          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
          const matchResult = route.match({
            url,
            sameOrigin,
            request,
            event
          });
          if (matchResult) {
            {
              // Warn developers that using an async matchCallback is almost always
              // not the right thing to do.
              if (matchResult instanceof Promise) {
                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `following route to use a synchronous matchCallback function:`, route);
              }
            }
            // See https://github.com/GoogleChrome/workbox/issues/2079
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            params = matchResult;
            if (Array.isArray(params) && params.length === 0) {
              // Instead of passing an empty array in as params, use undefined.
              params = undefined;
            } else if (matchResult.constructor === Object &&
            // eslint-disable-line
            Object.keys(matchResult).length === 0) {
              // Instead of passing an empty object in as params, use undefined.
              params = undefined;
            } else if (typeof matchResult === 'boolean') {
              // For the boolean value true (rather than just something truth-y),
              // don't set params.
              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353
              params = undefined;
            }
            // Return early if have a match.
            return {
              route,
              params
            };
          }
        }
        // If no match was found above, return and empty object.
        return {};
      }
      /**
       * Define a default `handler` that's called when no routes explicitly
       * match the incoming request.
       *
       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.
       *
       * Without a default handler, unmatched requests will go against the
       * network as if there were no service worker present.
       *
       * @param {workbox-routing~handlerCallback} handler A callback
       * function that returns a Promise resulting in a Response.
       * @param {string} [method='GET'] The HTTP method to associate with this
       * default handler. Each method has its own default.
       */
      setDefaultHandler(handler, method = defaultMethod) {
        this._defaultHandlerMap.set(method, normalizeHandler(handler));
      }
      /**
       * If a Route throws an error while handling a request, this `handler`
       * will be called and given a chance to provide a response.
       *
       * @param {workbox-routing~handlerCallback} handler A callback
       * function that returns a Promise resulting in a Response.
       */
      setCatchHandler(handler) {
        this._catchHandler = normalizeHandler(handler);
      }
      /**
       * Registers a route with the router.
       *
       * @param {workbox-routing.Route} route The route to register.
       */
      registerRoute(route) {
        {
          finalAssertExports.isType(route, 'object', {
            moduleName: 'workbox-routing',
            className: 'Router',
            funcName: 'registerRoute',
            paramName: 'route'
          });
          finalAssertExports.hasMethod(route, 'match', {
            moduleName: 'workbox-routing',
            className: 'Router',
            funcName: 'registerRoute',
            paramName: 'route'
          });
          finalAssertExports.isType(route.handler, 'object', {
            moduleName: 'workbox-routing',
            className: 'Router',
            funcName: 'registerRoute',
            paramName: 'route'
          });
          finalAssertExports.hasMethod(route.handler, 'handle', {
            moduleName: 'workbox-routing',
            className: 'Router',
            funcName: 'registerRoute',
            paramName: 'route.handler'
          });
          finalAssertExports.isType(route.method, 'string', {
            moduleName: 'workbox-routing',
            className: 'Router',
            funcName: 'registerRoute',
            paramName: 'route.method'
          });
        }
        if (!this._routes.has(route.method)) {
          this._routes.set(route.method, []);
        }
        // Give precedence to all of the earlier routes by adding this additional
        // route to the end of the array.
        this._routes.get(route.method).push(route);
      }
      /**
       * Unregisters a route with the router.
       *
       * @param {workbox-routing.Route} route The route to unregister.
       */
      unregisterRoute(route) {
        if (!this._routes.has(route.method)) {
          throw new WorkboxError('unregister-route-but-not-found-with-method', {
            method: route.method
          });
        }
        const routeIndex = this._routes.get(route.method).indexOf(route);
        if (routeIndex > -1) {
          this._routes.get(route.method).splice(routeIndex, 1);
        } else {
          throw new WorkboxError('unregister-route-route-not-registered');
        }
      }
    }

    /*
      Copyright 2019 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    let defaultRouter;
    /**
     * Creates a new, singleton Router instance if one does not exist. If one
     * does already exist, that instance is returned.
     *
     * @private
     * @return {Router}
     */
    const getOrCreateDefaultRouter = () => {
      if (!defaultRouter) {
        defaultRouter = new Router();
        // The helpers that use the default Router assume these listeners exist.
        defaultRouter.addFetchListener();
        defaultRouter.addCacheListener();
      }
      return defaultRouter;
    };

    /*
      Copyright 2019 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * Easily register a RegExp, string, or function with a caching
     * strategy to a singleton Router instance.
     *
     * This method will generate a Route for you if needed and
     * call {@link workbox-routing.Router#registerRoute}.
     *
     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture
     * If the capture param is a `Route`, all other arguments will be ignored.
     * @param {workbox-routing~handlerCallback} [handler] A callback
     * function that returns a Promise resulting in a Response. This parameter
     * is required if `capture` is not a `Route` object.
     * @param {string} [method='GET'] The HTTP method to match the Route
     * against.
     * @return {workbox-routing.Route} The generated `Route`.
     *
     * @memberof workbox-routing
     */
    function registerRoute(capture, handler, method) {
      let route;
      if (typeof capture === 'string') {
        const captureUrl = new URL(capture, location.href);
        {
          if (!(capture.startsWith('/') || capture.startsWith('http'))) {
            throw new WorkboxError('invalid-string', {
              moduleName: 'workbox-routing',
              funcName: 'registerRoute',
              paramName: 'capture'
            });
          }
          // We want to check if Express-style wildcards are in the pathname only.
          // TODO: Remove this log message in v4.
          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;
          // See https://github.com/pillarjs/path-to-regexp#parameters
          const wildcards = '[*:?+]';
          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {
            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);
          }
        }
        const matchCallback = ({
          url
        }) => {
          {
            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {
              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);
            }
          }
          return url.href === captureUrl.href;
        };
        // If `capture` is a string then `handler` and `method` must be present.
        route = new Route(matchCallback, handler, method);
      } else if (capture instanceof RegExp) {
        // If `capture` is a `RegExp` then `handler` and `method` must be present.
        route = new RegExpRoute(capture, handler, method);
      } else if (typeof capture === 'function') {
        // If `capture` is a function then `handler` and `method` must be present.
        route = new Route(capture, handler, method);
      } else if (capture instanceof Route) {
        route = capture;
      } else {
        throw new WorkboxError('unsupported-route-type', {
          moduleName: 'workbox-routing',
          funcName: 'registerRoute',
          paramName: 'capture'
        });
      }
      const defaultRouter = getOrCreateDefaultRouter();
      defaultRouter.registerRoute(route);
      return route;
    }

    // @ts-ignore
    try {
      self['workbox:strategies:6.5.4'] && _();
    } catch (e) {}

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const cacheOkAndOpaquePlugin = {
      /**
       * Returns a valid response (to allow caching) if the status is 200 (OK) or
       * 0 (opaque).
       *
       * @param {Object} options
       * @param {Response} options.response
       * @return {Response|null}
       *
       * @private
       */
      cacheWillUpdate: async ({
        response
      }) => {
        if (response.status === 200 || response.status === 0) {
          return response;
        }
        return null;
      }
    };

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const _cacheNameDetails = {
      googleAnalytics: 'googleAnalytics',
      precache: 'precache-v2',
      prefix: 'workbox',
      runtime: 'runtime',
      suffix: typeof registration !== 'undefined' ? registration.scope : ''
    };
    const _createCacheName = cacheName => {
      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');
    };
    const eachCacheNameDetail = fn => {
      for (const key of Object.keys(_cacheNameDetails)) {
        fn(key);
      }
    };
    const cacheNames = {
      updateDetails: details => {
        eachCacheNameDetail(key => {
          if (typeof details[key] === 'string') {
            _cacheNameDetails[key] = details[key];
          }
        });
      },
      getGoogleAnalyticsName: userCacheName => {
        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);
      },
      getPrecacheName: userCacheName => {
        return userCacheName || _createCacheName(_cacheNameDetails.precache);
      },
      getPrefix: () => {
        return _cacheNameDetails.prefix;
      },
      getRuntimeName: userCacheName => {
        return userCacheName || _createCacheName(_cacheNameDetails.runtime);
      },
      getSuffix: () => {
        return _cacheNameDetails.suffix;
      }
    };

    /*
      Copyright 2020 Google LLC
      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    function stripParams(fullURL, ignoreParams) {
      const strippedURL = new URL(fullURL);
      for (const param of ignoreParams) {
        strippedURL.searchParams.delete(param);
      }
      return strippedURL.href;
    }
    /**
     * Matches an item in the cache, ignoring specific URL params. This is similar
     * to the `ignoreSearch` option, but it allows you to ignore just specific
     * params (while continuing to match on the others).
     *
     * @private
     * @param {Cache} cache
     * @param {Request} request
     * @param {Object} matchOptions
     * @param {Array<string>} ignoreParams
     * @return {Promise<Response|undefined>}
     */
    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {
      const strippedRequestURL = stripParams(request.url, ignoreParams);
      // If the request doesn't include any ignored params, match as normal.
      if (request.url === strippedRequestURL) {
        return cache.match(request, matchOptions);
      }
      // Otherwise, match by comparing keys
      const keysOptions = Object.assign(Object.assign({}, matchOptions), {
        ignoreSearch: true
      });
      const cacheKeys = await cache.keys(request, keysOptions);
      for (const cacheKey of cacheKeys) {
        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);
        if (strippedRequestURL === strippedCacheKeyURL) {
          return cache.match(cacheKey, matchOptions);
        }
      }
      return;
    }

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * The Deferred class composes Promises in a way that allows for them to be
     * resolved or rejected from outside the constructor. In most cases promises
     * should be used directly, but Deferreds can be necessary when the logic to
     * resolve a promise must be separate.
     *
     * @private
     */
    class Deferred {
      /**
       * Creates a promise and exposes its resolve and reject functions as methods.
       */
      constructor() {
        this.promise = new Promise((resolve, reject) => {
          this.resolve = resolve;
          this.reject = reject;
        });
      }
    }

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    // Callbacks to be executed whenever there's a quota error.
    // Can't change Function type right now.
    // eslint-disable-next-line @typescript-eslint/ban-types
    const quotaErrorCallbacks = new Set();

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * Runs all of the callback functions, one at a time sequentially, in the order
     * in which they were registered.
     *
     * @memberof workbox-core
     * @private
     */
    async function executeQuotaErrorCallbacks() {
      {
        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);
      }
      for (const callback of quotaErrorCallbacks) {
        await callback();
        {
          logger.log(callback, 'is complete.');
        }
      }
      {
        logger.log('Finished running callbacks.');
      }
    }

    /*
      Copyright 2019 Google LLC
      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * Returns a promise that resolves and the passed number of milliseconds.
     * This utility is an async/await-friendly version of `setTimeout`.
     *
     * @param {number} ms
     * @return {Promise}
     * @private
     */
    function timeout(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    /*
      Copyright 2020 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    function toRequest(input) {
      return typeof input === 'string' ? new Request(input) : input;
    }
    /**
     * A class created every time a Strategy instance instance calls
     * {@link workbox-strategies.Strategy~handle} or
     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and
     * cache actions around plugin callbacks and keeps track of when the strategy
     * is "done" (i.e. all added `event.waitUntil()` promises have resolved).
     *
     * @memberof workbox-strategies
     */
    class StrategyHandler {
      /**
       * Creates a new instance associated with the passed strategy and event
       * that's handling the request.
       *
       * The constructor also initializes the state that will be passed to each of
       * the plugins handling this request.
       *
       * @param {workbox-strategies.Strategy} strategy
       * @param {Object} options
       * @param {Request|string} options.request A request to run this strategy for.
       * @param {ExtendableEvent} options.event The event associated with the
       *     request.
       * @param {URL} [options.url]
       * @param {*} [options.params] The return value from the
       *     {@link workbox-routing~matchCallback} (if applicable).
       */
      constructor(strategy, options) {
        this._cacheKeys = {};
        /**
         * The request the strategy is performing (passed to the strategy's
         * `handle()` or `handleAll()` method).
         * @name request
         * @instance
         * @type {Request}
         * @memberof workbox-strategies.StrategyHandler
         */
        /**
         * The event associated with this request.
         * @name event
         * @instance
         * @type {ExtendableEvent}
         * @memberof workbox-strategies.StrategyHandler
         */
        /**
         * A `URL` instance of `request.url` (if passed to the strategy's
         * `handle()` or `handleAll()` method).
         * Note: the `url` param will be present if the strategy was invoked
         * from a workbox `Route` object.
         * @name url
         * @instance
         * @type {URL|undefined}
         * @memberof workbox-strategies.StrategyHandler
         */
        /**
         * A `param` value (if passed to the strategy's
         * `handle()` or `handleAll()` method).
         * Note: the `param` param will be present if the strategy was invoked
         * from a workbox `Route` object and the
         * {@link workbox-routing~matchCallback} returned
         * a truthy value (it will be that value).
         * @name params
         * @instance
         * @type {*|undefined}
         * @memberof workbox-strategies.StrategyHandler
         */
        {
          finalAssertExports.isInstance(options.event, ExtendableEvent, {
            moduleName: 'workbox-strategies',
            className: 'StrategyHandler',
            funcName: 'constructor',
            paramName: 'options.event'
          });
        }
        Object.assign(this, options);
        this.event = options.event;
        this._strategy = strategy;
        this._handlerDeferred = new Deferred();
        this._extendLifetimePromises = [];
        // Copy the plugins list (since it's mutable on the strategy),
        // so any mutations don't affect this handler instance.
        this._plugins = [...strategy.plugins];
        this._pluginStateMap = new Map();
        for (const plugin of this._plugins) {
          this._pluginStateMap.set(plugin, {});
        }
        this.event.waitUntil(this._handlerDeferred.promise);
      }
      /**
       * Fetches a given request (and invokes any applicable plugin callback
       * methods) using the `fetchOptions` (for non-navigation requests) and
       * `plugins` defined on the `Strategy` object.
       *
       * The following plugin lifecycle methods are invoked when using this method:
       * - `requestWillFetch()`
       * - `fetchDidSucceed()`
       * - `fetchDidFail()`
       *
       * @param {Request|string} input The URL or request to fetch.
       * @return {Promise<Response>}
       */
      async fetch(input) {
        const {
          event
        } = this;
        let request = toRequest(input);
        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {
          const possiblePreloadResponse = await event.preloadResponse;
          if (possiblePreloadResponse) {
            {
              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);
            }
            return possiblePreloadResponse;
          }
        }
        // If there is a fetchDidFail plugin, we need to save a clone of the
        // original request before it's either modified by a requestWillFetch
        // plugin or before the original request's body is consumed via fetch().
        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;
        try {
          for (const cb of this.iterateCallbacks('requestWillFetch')) {
            request = await cb({
              request: request.clone(),
              event
            });
          }
        } catch (err) {
          if (err instanceof Error) {
            throw new WorkboxError('plugin-error-request-will-fetch', {
              thrownErrorMessage: err.message
            });
          }
        }
        // The request can be altered by plugins with `requestWillFetch` making
        // the original request (most likely from a `fetch` event) different
        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.
        const pluginFilteredRequest = request.clone();
        try {
          let fetchResponse;
          // See https://github.com/GoogleChrome/workbox/issues/1796
          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);
          if ("development" !== 'production') {
            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);
          }
          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {
            fetchResponse = await callback({
              event,
              request: pluginFilteredRequest,
              response: fetchResponse
            });
          }
          return fetchResponse;
        } catch (error) {
          {
            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);
          }
          // `originalRequest` will only exist if a `fetchDidFail` callback
          // is being used (see above).
          if (originalRequest) {
            await this.runCallbacks('fetchDidFail', {
              error: error,
              event,
              originalRequest: originalRequest.clone(),
              request: pluginFilteredRequest.clone()
            });
          }
          throw error;
        }
      }
      /**
       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on
       * the response generated by `this.fetch()`.
       *
       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,
       * so you do not have to manually call `waitUntil()` on the event.
       *
       * @param {Request|string} input The request or URL to fetch and cache.
       * @return {Promise<Response>}
       */
      async fetchAndCachePut(input) {
        const response = await this.fetch(input);
        const responseClone = response.clone();
        void this.waitUntil(this.cachePut(input, responseClone));
        return response;
      }
      /**
       * Matches a request from the cache (and invokes any applicable plugin
       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`
       * defined on the strategy object.
       *
       * The following plugin lifecycle methods are invoked when using this method:
       * - cacheKeyWillByUsed()
       * - cachedResponseWillByUsed()
       *
       * @param {Request|string} key The Request or URL to use as the cache key.
       * @return {Promise<Response|undefined>} A matching response, if found.
       */
      async cacheMatch(key) {
        const request = toRequest(key);
        let cachedResponse;
        const {
          cacheName,
          matchOptions
        } = this._strategy;
        const effectiveRequest = await this.getCacheKey(request, 'read');
        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {
          cacheName
        });
        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);
        {
          if (cachedResponse) {
            logger.debug(`Found a cached response in '${cacheName}'.`);
          } else {
            logger.debug(`No cached response found in '${cacheName}'.`);
          }
        }
        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {
          cachedResponse = (await callback({
            cacheName,
            matchOptions,
            cachedResponse,
            request: effectiveRequest,
            event: this.event
          })) || undefined;
        }
        return cachedResponse;
      }
      /**
       * Puts a request/response pair in the cache (and invokes any applicable
       * plugin callback methods) using the `cacheName` and `plugins` defined on
       * the strategy object.
       *
       * The following plugin lifecycle methods are invoked when using this method:
       * - cacheKeyWillByUsed()
       * - cacheWillUpdate()
       * - cacheDidUpdate()
       *
       * @param {Request|string} key The request or URL to use as the cache key.
       * @param {Response} response The response to cache.
       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response
       * not be cached, and `true` otherwise.
       */
      async cachePut(key, response) {
        const request = toRequest(key);
        // Run in the next task to avoid blocking other cache reads.
        // https://github.com/w3c/ServiceWorker/issues/1397
        await timeout(0);
        const effectiveRequest = await this.getCacheKey(request, 'write');
        {
          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {
            throw new WorkboxError('attempt-to-cache-non-get-request', {
              url: getFriendlyURL(effectiveRequest.url),
              method: effectiveRequest.method
            });
          }
          // See https://github.com/GoogleChrome/workbox/issues/2818
          const vary = response.headers.get('Vary');
          if (vary) {
            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);
          }
        }
        if (!response) {
          {
            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);
          }
          throw new WorkboxError('cache-put-with-no-response', {
            url: getFriendlyURL(effectiveRequest.url)
          });
        }
        const responseToCache = await this._ensureResponseSafeToCache(response);
        if (!responseToCache) {
          {
            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);
          }
          return false;
        }
        const {
          cacheName,
          matchOptions
        } = this._strategy;
        const cache = await self.caches.open(cacheName);
        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');
        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(
        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching
        // feature. Consider into ways to only add this behavior if using
        // precaching.
        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;
        {
          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);
        }
        try {
          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);
        } catch (error) {
          if (error instanceof Error) {
            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError
            if (error.name === 'QuotaExceededError') {
              await executeQuotaErrorCallbacks();
            }
            throw error;
          }
        }
        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {
          await callback({
            cacheName,
            oldResponse,
            newResponse: responseToCache.clone(),
            request: effectiveRequest,
            event: this.event
          });
        }
        return true;
      }
      /**
       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and
       * executes any of those callbacks found in sequence. The final `Request`
       * object returned by the last plugin is treated as the cache key for cache
       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have
       * been registered, the passed request is returned unmodified
       *
       * @param {Request} request
       * @param {string} mode
       * @return {Promise<Request>}
       */
      async getCacheKey(request, mode) {
        const key = `${request.url} | ${mode}`;
        if (!this._cacheKeys[key]) {
          let effectiveRequest = request;
          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {
            effectiveRequest = toRequest(await callback({
              mode,
              request: effectiveRequest,
              event: this.event,
              // params has a type any can't change right now.
              params: this.params // eslint-disable-line
            }));
          }
          this._cacheKeys[key] = effectiveRequest;
        }
        return this._cacheKeys[key];
      }
      /**
       * Returns true if the strategy has at least one plugin with the given
       * callback.
       *
       * @param {string} name The name of the callback to check for.
       * @return {boolean}
       */
      hasCallback(name) {
        for (const plugin of this._strategy.plugins) {
          if (name in plugin) {
            return true;
          }
        }
        return false;
      }
      /**
       * Runs all plugin callbacks matching the given name, in order, passing the
       * given param object (merged ith the current plugin state) as the only
       * argument.
       *
       * Note: since this method runs all plugins, it's not suitable for cases
       * where the return value of a callback needs to be applied prior to calling
       * the next callback. See
       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}
       * below for how to handle that case.
       *
       * @param {string} name The name of the callback to run within each plugin.
       * @param {Object} param The object to pass as the first (and only) param
       *     when executing each callback. This object will be merged with the
       *     current plugin state prior to callback execution.
       */
      async runCallbacks(name, param) {
        for (const callback of this.iterateCallbacks(name)) {
          // TODO(philipwalton): not sure why `any` is needed. It seems like
          // this should work with `as WorkboxPluginCallbackParam[C]`.
          await callback(param);
        }
      }
      /**
       * Accepts a callback and returns an iterable of matching plugin callbacks,
       * where each callback is wrapped with the current handler state (i.e. when
       * you call each callback, whatever object parameter you pass it will
       * be merged with the plugin's current state).
       *
       * @param {string} name The name fo the callback to run
       * @return {Array<Function>}
       */
      *iterateCallbacks(name) {
        for (const plugin of this._strategy.plugins) {
          if (typeof plugin[name] === 'function') {
            const state = this._pluginStateMap.get(plugin);
            const statefulCallback = param => {
              const statefulParam = Object.assign(Object.assign({}, param), {
                state
              });
              // TODO(philipwalton): not sure why `any` is needed. It seems like
              // this should work with `as WorkboxPluginCallbackParam[C]`.
              return plugin[name](statefulParam);
            };
            yield statefulCallback;
          }
        }
      }
      /**
       * Adds a promise to the
       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}
       * of the event event associated with the request being handled (usually a
       * `FetchEvent`).
       *
       * Note: you can await
       * {@link workbox-strategies.StrategyHandler~doneWaiting}
       * to know when all added promises have settled.
       *
       * @param {Promise} promise A promise to add to the extend lifetime promises
       *     of the event that triggered the request.
       */
      waitUntil(promise) {
        this._extendLifetimePromises.push(promise);
        return promise;
      }
      /**
       * Returns a promise that resolves once all promises passed to
       * {@link workbox-strategies.StrategyHandler~waitUntil}
       * have settled.
       *
       * Note: any work done after `doneWaiting()` settles should be manually
       * passed to an event's `waitUntil()` method (not this handler's
       * `waitUntil()` method), otherwise the service worker thread my be killed
       * prior to your work completing.
       */
      async doneWaiting() {
        let promise;
        while (promise = this._extendLifetimePromises.shift()) {
          await promise;
        }
      }
      /**
       * Stops running the strategy and immediately resolves any pending
       * `waitUntil()` promises.
       */
      destroy() {
        this._handlerDeferred.resolve(null);
      }
      /**
       * This method will call cacheWillUpdate on the available plugins (or use
       * status === 200) to determine if the Response is safe and valid to cache.
       *
       * @param {Request} options.request
       * @param {Response} options.response
       * @return {Promise<Response|undefined>}
       *
       * @private
       */
      async _ensureResponseSafeToCache(response) {
        let responseToCache = response;
        let pluginsUsed = false;
        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {
          responseToCache = (await callback({
            request: this.request,
            response: responseToCache,
            event: this.event
          })) || undefined;
          pluginsUsed = true;
          if (!responseToCache) {
            break;
          }
        }
        if (!pluginsUsed) {
          if (responseToCache && responseToCache.status !== 200) {
            responseToCache = undefined;
          }
          {
            if (responseToCache) {
              if (responseToCache.status !== 200) {
                if (responseToCache.status === 0) {
                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);
                } else {
                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);
                }
              }
            }
          }
        }
        return responseToCache;
      }
    }

    /*
      Copyright 2020 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * An abstract base class that all other strategy classes must extend from:
     *
     * @memberof workbox-strategies
     */
    class Strategy {
      /**
       * Creates a new instance of the strategy and sets all documented option
       * properties as public instance properties.
       *
       * Note: if a custom strategy class extends the base Strategy class and does
       * not need more than these properties, it does not need to define its own
       * constructor.
       *
       * @param {Object} [options]
       * @param {string} [options.cacheName] Cache name to store and retrieve
       * requests. Defaults to the cache names provided by
       * {@link workbox-core.cacheNames}.
       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}
       * to use in conjunction with this caching strategy.
       * @param {Object} [options.fetchOptions] Values passed along to the
       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)
       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)
       * `fetch()` requests made by this strategy.
       * @param {Object} [options.matchOptions] The
       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}
       * for any `cache.match()` or `cache.put()` calls made by this strategy.
       */
      constructor(options = {}) {
        /**
         * Cache name to store and retrieve
         * requests. Defaults to the cache names provided by
         * {@link workbox-core.cacheNames}.
         *
         * @type {string}
         */
        this.cacheName = cacheNames.getRuntimeName(options.cacheName);
        /**
         * The list
         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}
         * used by this strategy.
         *
         * @type {Array<Object>}
         */
        this.plugins = options.plugins || [];
        /**
         * Values passed along to the
         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}
         * of all fetch() requests made by this strategy.
         *
         * @type {Object}
         */
        this.fetchOptions = options.fetchOptions;
        /**
         * The
         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}
         * for any `cache.match()` or `cache.put()` calls made by this strategy.
         *
         * @type {Object}
         */
        this.matchOptions = options.matchOptions;
      }
      /**
       * Perform a request strategy and returns a `Promise` that will resolve with
       * a `Response`, invoking all relevant plugin callbacks.
       *
       * When a strategy instance is registered with a Workbox
       * {@link workbox-routing.Route}, this method is automatically
       * called when the route matches.
       *
       * Alternatively, this method can be used in a standalone `FetchEvent`
       * listener by passing it to `event.respondWith()`.
       *
       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the
       *     properties listed below.
       * @param {Request|string} options.request A request to run this strategy for.
       * @param {ExtendableEvent} options.event The event associated with the
       *     request.
       * @param {URL} [options.url]
       * @param {*} [options.params]
       */
      handle(options) {
        const [responseDone] = this.handleAll(options);
        return responseDone;
      }
      /**
       * Similar to {@link workbox-strategies.Strategy~handle}, but
       * instead of just returning a `Promise` that resolves to a `Response` it
       * it will return an tuple of `[response, done]` promises, where the former
       * (`response`) is equivalent to what `handle()` returns, and the latter is a
       * Promise that will resolve once any promises that were added to
       * `event.waitUntil()` as part of performing the strategy have completed.
       *
       * You can await the `done` promise to ensure any extra work performed by
       * the strategy (usually caching responses) completes successfully.
       *
       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the
       *     properties listed below.
       * @param {Request|string} options.request A request to run this strategy for.
       * @param {ExtendableEvent} options.event The event associated with the
       *     request.
       * @param {URL} [options.url]
       * @param {*} [options.params]
       * @return {Array<Promise>} A tuple of [response, done]
       *     promises that can be used to determine when the response resolves as
       *     well as when the handler has completed all its work.
       */
      handleAll(options) {
        // Allow for flexible options to be passed.
        if (options instanceof FetchEvent) {
          options = {
            event: options,
            request: options.request
          };
        }
        const event = options.event;
        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;
        const params = 'params' in options ? options.params : undefined;
        const handler = new StrategyHandler(this, {
          event,
          request,
          params
        });
        const responseDone = this._getResponse(handler, request, event);
        const handlerDone = this._awaitComplete(responseDone, handler, request, event);
        // Return an array of promises, suitable for use with Promise.all().
        return [responseDone, handlerDone];
      }
      async _getResponse(handler, request, event) {
        await handler.runCallbacks('handlerWillStart', {
          event,
          request
        });
        let response = undefined;
        try {
          response = await this._handle(request, handler);
          // The "official" Strategy subclasses all throw this error automatically,
          // but in case a third-party Strategy doesn't, ensure that we have a
          // consistent failure when there's no response or an error response.
          if (!response || response.type === 'error') {
            throw new WorkboxError('no-response', {
              url: request.url
            });
          }
        } catch (error) {
          if (error instanceof Error) {
            for (const callback of handler.iterateCallbacks('handlerDidError')) {
              response = await callback({
                error,
                event,
                request
              });
              if (response) {
                break;
              }
            }
          }
          if (!response) {
            throw error;
          } else {
            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);
          }
        }
        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {
          response = await callback({
            event,
            request,
            response
          });
        }
        return response;
      }
      async _awaitComplete(responseDone, handler, request, event) {
        let response;
        let error;
        try {
          response = await responseDone;
        } catch (error) {
          // Ignore errors, as response errors should be caught via the `response`
          // promise above. The `done` promise will only throw for errors in
          // promises passed to `handler.waitUntil()`.
        }
        try {
          await handler.runCallbacks('handlerDidRespond', {
            event,
            request,
            response
          });
          await handler.doneWaiting();
        } catch (waitUntilError) {
          if (waitUntilError instanceof Error) {
            error = waitUntilError;
          }
        }
        await handler.runCallbacks('handlerDidComplete', {
          event,
          request,
          response,
          error: error
        });
        handler.destroy();
        if (error) {
          throw error;
        }
      }
    }
    /**
     * Classes extending the `Strategy` based class should implement this method,
     * and leverage the {@link workbox-strategies.StrategyHandler}
     * arg to perform all fetching and cache logic, which will ensure all relevant
     * cache, cache options, fetch options and plugins are used (per the current
     * strategy instance).
     *
     * @name _handle
     * @instance
     * @abstract
     * @function
     * @param {Request} request
     * @param {workbox-strategies.StrategyHandler} handler
     * @return {Promise<Response>}
     *
     * @memberof workbox-strategies.Strategy
     */

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    const messages = {
      strategyStart: (strategyName, request) => `Using ${strategyName} to respond to '${getFriendlyURL(request.url)}'`,
      printFinalResponse: response => {
        if (response) {
          logger.groupCollapsed(`View the final response here.`);
          logger.log(response || '[No response returned]');
          logger.groupEnd();
        }
      }
    };

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * An implementation of a
     * [network first](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#network-first-falling-back-to-cache)
     * request strategy.
     *
     * By default, this strategy will cache responses with a 200 status code as
     * well as [opaque responses](https://developer.chrome.com/docs/workbox/caching-resources-during-runtime/#opaque-responses).
     * Opaque responses are are cross-origin requests where the response doesn't
     * support [CORS](https://enable-cors.org/).
     *
     * If the network request fails, and there is no cache match, this will throw
     * a `WorkboxError` exception.
     *
     * @extends workbox-strategies.Strategy
     * @memberof workbox-strategies
     */
    class NetworkFirst extends Strategy {
      /**
       * @param {Object} [options]
       * @param {string} [options.cacheName] Cache name to store and retrieve
       * requests. Defaults to cache names provided by
       * {@link workbox-core.cacheNames}.
       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}
       * to use in conjunction with this caching strategy.
       * @param {Object} [options.fetchOptions] Values passed along to the
       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)
       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)
       * `fetch()` requests made by this strategy.
       * @param {Object} [options.matchOptions] [`CacheQueryOptions`](https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions)
       * @param {number} [options.networkTimeoutSeconds] If set, any network requests
       * that fail to respond within the timeout will fallback to the cache.
       *
       * This option can be used to combat
       * "[lie-fi]{@link https://developers.google.com/web/fundamentals/performance/poor-connectivity/#lie-fi}"
       * scenarios.
       */
      constructor(options = {}) {
        super(options);
        // If this instance contains no plugins with a 'cacheWillUpdate' callback,
        // prepend the `cacheOkAndOpaquePlugin` plugin to the plugins list.
        if (!this.plugins.some(p => 'cacheWillUpdate' in p)) {
          this.plugins.unshift(cacheOkAndOpaquePlugin);
        }
        this._networkTimeoutSeconds = options.networkTimeoutSeconds || 0;
        {
          if (this._networkTimeoutSeconds) {
            finalAssertExports.isType(this._networkTimeoutSeconds, 'number', {
              moduleName: 'workbox-strategies',
              className: this.constructor.name,
              funcName: 'constructor',
              paramName: 'networkTimeoutSeconds'
            });
          }
        }
      }
      /**
       * @private
       * @param {Request|string} request A request to run this strategy for.
       * @param {workbox-strategies.StrategyHandler} handler The event that
       *     triggered the request.
       * @return {Promise<Response>}
       */
      async _handle(request, handler) {
        const logs = [];
        {
          finalAssertExports.isInstance(request, Request, {
            moduleName: 'workbox-strategies',
            className: this.constructor.name,
            funcName: 'handle',
            paramName: 'makeRequest'
          });
        }
        const promises = [];
        let timeoutId;
        if (this._networkTimeoutSeconds) {
          const {
            id,
            promise
          } = this._getTimeoutPromise({
            request,
            logs,
            handler
          });
          timeoutId = id;
          promises.push(promise);
        }
        const networkPromise = this._getNetworkPromise({
          timeoutId,
          request,
          logs,
          handler
        });
        promises.push(networkPromise);
        const response = await handler.waitUntil((async () => {
          // Promise.race() will resolve as soon as the first promise resolves.
          return (await handler.waitUntil(Promise.race(promises))) || (
          // If Promise.race() resolved with null, it might be due to a network
          // timeout + a cache miss. If that were to happen, we'd rather wait until
          // the networkPromise resolves instead of returning null.
          // Note that it's fine to await an already-resolved promise, so we don't
          // have to check to see if it's still "in flight".
          await networkPromise);
        })());
        {
          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));
          for (const log of logs) {
            logger.log(log);
          }
          messages.printFinalResponse(response);
          logger.groupEnd();
        }
        if (!response) {
          throw new WorkboxError('no-response', {
            url: request.url
          });
        }
        return response;
      }
      /**
       * @param {Object} options
       * @param {Request} options.request
       * @param {Array} options.logs A reference to the logs array
       * @param {Event} options.event
       * @return {Promise<Response>}
       *
       * @private
       */
      _getTimeoutPromise({
        request,
        logs,
        handler
      }) {
        let timeoutId;
        const timeoutPromise = new Promise(resolve => {
          const onNetworkTimeout = async () => {
            {
              logs.push(`Timing out the network response at ` + `${this._networkTimeoutSeconds} seconds.`);
            }
            resolve(await handler.cacheMatch(request));
          };
          timeoutId = setTimeout(onNetworkTimeout, this._networkTimeoutSeconds * 1000);
        });
        return {
          promise: timeoutPromise,
          id: timeoutId
        };
      }
      /**
       * @param {Object} options
       * @param {number|undefined} options.timeoutId
       * @param {Request} options.request
       * @param {Array} options.logs A reference to the logs Array.
       * @param {Event} options.event
       * @return {Promise<Response>}
       *
       * @private
       */
      async _getNetworkPromise({
        timeoutId,
        request,
        logs,
        handler
      }) {
        let error;
        let response;
        try {
          response = await handler.fetchAndCachePut(request);
        } catch (fetchError) {
          if (fetchError instanceof Error) {
            error = fetchError;
          }
        }
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
        {
          if (response) {
            logs.push(`Got response from network.`);
          } else {
            logs.push(`Unable to get a response from the network. Will respond ` + `with a cached response.`);
          }
        }
        if (error || !response) {
          response = await handler.cacheMatch(request);
          {
            if (response) {
              logs.push(`Found a cached response in the '${this.cacheName}'` + ` cache.`);
            } else {
              logs.push(`No response found in the '${this.cacheName}' cache.`);
            }
          }
        }
        return response;
      }
    }

    /*
      Copyright 2018 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * An implementation of a
     * [network-only](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#network-only)
     * request strategy.
     *
     * This class is useful if you want to take advantage of any
     * [Workbox plugins](https://developer.chrome.com/docs/workbox/using-plugins/).
     *
     * If the network request fails, this will throw a `WorkboxError` exception.
     *
     * @extends workbox-strategies.Strategy
     * @memberof workbox-strategies
     */
    class NetworkOnly extends Strategy {
      /**
       * @param {Object} [options]
       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}
       * to use in conjunction with this caching strategy.
       * @param {Object} [options.fetchOptions] Values passed along to the
       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)
       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)
       * `fetch()` requests made by this strategy.
       * @param {number} [options.networkTimeoutSeconds] If set, any network requests
       * that fail to respond within the timeout will result in a network error.
       */
      constructor(options = {}) {
        super(options);
        this._networkTimeoutSeconds = options.networkTimeoutSeconds || 0;
      }
      /**
       * @private
       * @param {Request|string} request A request to run this strategy for.
       * @param {workbox-strategies.StrategyHandler} handler The event that
       *     triggered the request.
       * @return {Promise<Response>}
       */
      async _handle(request, handler) {
        {
          finalAssertExports.isInstance(request, Request, {
            moduleName: 'workbox-strategies',
            className: this.constructor.name,
            funcName: '_handle',
            paramName: 'request'
          });
        }
        let error = undefined;
        let response;
        try {
          const promises = [handler.fetch(request)];
          if (this._networkTimeoutSeconds) {
            const timeoutPromise = timeout(this._networkTimeoutSeconds * 1000);
            promises.push(timeoutPromise);
          }
          response = await Promise.race(promises);
          if (!response) {
            throw new Error(`Timed out the network response after ` + `${this._networkTimeoutSeconds} seconds.`);
          }
        } catch (err) {
          if (err instanceof Error) {
            error = err;
          }
        }
        {
          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));
          if (response) {
            logger.log(`Got response from network.`);
          } else {
            logger.log(`Unable to get a response from the network.`);
          }
          messages.printFinalResponse(response);
          logger.groupEnd();
        }
        if (!response) {
          throw new WorkboxError('no-response', {
            url: request.url,
            error
          });
        }
        return response;
      }
    }

    /*
      Copyright 2019 Google LLC

      Use of this source code is governed by an MIT-style
      license that can be found in the LICENSE file or at
      https://opensource.org/licenses/MIT.
    */
    /**
     * Claim any currently available clients once the service worker
     * becomes active. This is normally used in conjunction with `skipWaiting()`.
     *
     * @memberof workbox-core
     */
    function clientsClaim() {
      self.addEventListener('activate', () => self.clients.claim());
    }

    exports.NetworkFirst = NetworkFirst;
    exports.NetworkOnly = NetworkOnly;
    exports.clientsClaim = clientsClaim;
    exports.registerRoute = registerRoute;

}));
//# sourceMappingURL=workbox-e43f5367.js.map

================
File: public/workbox-e43f5367.js.map
================
{"version":3,"file":"workbox-e43f5367.js","sources":["node_modules/workbox-core/_version.js","node_modules/workbox-core/_private/logger.js","node_modules/workbox-core/models/messages/messages.js","node_modules/workbox-core/models/messages/messageGenerator.js","node_modules/workbox-core/_private/WorkboxError.js","node_modules/workbox-core/_private/assert.js","node_modules/workbox-routing/_version.js","node_modules/workbox-routing/utils/constants.js","node_modules/workbox-routing/utils/normalizeHandler.js","node_modules/workbox-routing/Route.js","node_modules/workbox-routing/RegExpRoute.js","node_modules/workbox-core/_private/getFriendlyURL.js","node_modules/workbox-routing/Router.js","node_modules/workbox-routing/utils/getOrCreateDefaultRouter.js","node_modules/workbox-routing/registerRoute.js","node_modules/workbox-strategies/_version.js","node_modules/workbox-strategies/plugins/cacheOkAndOpaquePlugin.js","node_modules/workbox-core/_private/cacheNames.js","node_modules/workbox-core/_private/cacheMatchIgnoreParams.js","node_modules/workbox-core/_private/Deferred.js","node_modules/workbox-core/models/quotaErrorCallbacks.js","node_modules/workbox-core/_private/executeQuotaErrorCallbacks.js","node_modules/workbox-core/_private/timeout.js","node_modules/workbox-strategies/StrategyHandler.js","node_modules/workbox-strategies/Strategy.js","node_modules/workbox-strategies/utils/messages.js","node_modules/workbox-strategies/NetworkFirst.js","node_modules/workbox-strategies/NetworkOnly.js","node_modules/workbox-core/clientsClaim.js"],"sourcesContent":["\"use strict\";\n// @ts-ignore\ntry {\n    self['workbox:core:6.5.4'] && _();\n}\ncatch (e) { }\n","/*\n  Copyright 2019 Google LLC\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\nconst logger = (process.env.NODE_ENV === 'production'\n    ? null\n    : (() => {\n        // Don't overwrite this value if it's already set.\n        // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\n        if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\n            self.__WB_DISABLE_DEV_LOGS = false;\n        }\n        let inGroup = false;\n        const methodToColorMap = {\n            debug: `#7f8c8d`,\n            log: `#2ecc71`,\n            warn: `#f39c12`,\n            error: `#c0392b`,\n            groupCollapsed: `#3498db`,\n            groupEnd: null, // No colored prefix on groupEnd\n        };\n        const print = function (method, args) {\n            if (self.__WB_DISABLE_DEV_LOGS) {\n                return;\n            }\n            if (method === 'groupCollapsed') {\n                // Safari doesn't print all console.groupCollapsed() arguments:\n                // https://bugs.webkit.org/show_bug.cgi?id=182754\n                if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\n                    console[method](...args);\n                    return;\n                }\n            }\n            const styles = [\n                `background: ${methodToColorMap[method]}`,\n                `border-radius: 0.5em`,\n                `color: white`,\n                `font-weight: bold`,\n                `padding: 2px 0.5em`,\n            ];\n            // When in a group, the workbox prefix is not displayed.\n            const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\n            console[method](...logPrefix, ...args);\n            if (method === 'groupCollapsed') {\n                inGroup = true;\n            }\n            if (method === 'groupEnd') {\n                inGroup = false;\n            }\n        };\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        const api = {};\n        const loggerMethods = Object.keys(methodToColorMap);\n        for (const key of loggerMethods) {\n            const method = key;\n            api[method] = (...args) => {\n                print(method, args);\n            };\n        }\n        return api;\n    })());\nexport { logger };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../../_version.js';\nexport const messages = {\n    'invalid-value': ({ paramName, validValueDescription, value }) => {\n        if (!paramName || !validValueDescription) {\n            throw new Error(`Unexpected input to 'invalid-value' error.`);\n        }\n        return (`The '${paramName}' parameter was given a value with an ` +\n            `unexpected value. ${validValueDescription} Received a value of ` +\n            `${JSON.stringify(value)}.`);\n    },\n    'not-an-array': ({ moduleName, className, funcName, paramName }) => {\n        if (!moduleName || !className || !funcName || !paramName) {\n            throw new Error(`Unexpected input to 'not-an-array' error.`);\n        }\n        return (`The parameter '${paramName}' passed into ` +\n            `'${moduleName}.${className}.${funcName}()' must be an array.`);\n    },\n    'incorrect-type': ({ expectedType, paramName, moduleName, className, funcName, }) => {\n        if (!expectedType || !paramName || !moduleName || !funcName) {\n            throw new Error(`Unexpected input to 'incorrect-type' error.`);\n        }\n        const classNameStr = className ? `${className}.` : '';\n        return (`The parameter '${paramName}' passed into ` +\n            `'${moduleName}.${classNameStr}` +\n            `${funcName}()' must be of type ${expectedType}.`);\n    },\n    'incorrect-class': ({ expectedClassName, paramName, moduleName, className, funcName, isReturnValueProblem, }) => {\n        if (!expectedClassName || !moduleName || !funcName) {\n            throw new Error(`Unexpected input to 'incorrect-class' error.`);\n        }\n        const classNameStr = className ? `${className}.` : '';\n        if (isReturnValueProblem) {\n            return (`The return value from ` +\n                `'${moduleName}.${classNameStr}${funcName}()' ` +\n                `must be an instance of class ${expectedClassName}.`);\n        }\n        return (`The parameter '${paramName}' passed into ` +\n            `'${moduleName}.${classNameStr}${funcName}()' ` +\n            `must be an instance of class ${expectedClassName}.`);\n    },\n    'missing-a-method': ({ expectedMethod, paramName, moduleName, className, funcName, }) => {\n        if (!expectedMethod ||\n            !paramName ||\n            !moduleName ||\n            !className ||\n            !funcName) {\n            throw new Error(`Unexpected input to 'missing-a-method' error.`);\n        }\n        return (`${moduleName}.${className}.${funcName}() expected the ` +\n            `'${paramName}' parameter to expose a '${expectedMethod}' method.`);\n    },\n    'add-to-cache-list-unexpected-type': ({ entry }) => {\n        return (`An unexpected entry was passed to ` +\n            `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` +\n            `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` +\n            `strings with one or more characters, objects with a url property or ` +\n            `Request objects.`);\n    },\n    'add-to-cache-list-conflicting-entries': ({ firstEntry, secondEntry }) => {\n        if (!firstEntry || !secondEntry) {\n            throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\n        }\n        return (`Two of the entries passed to ` +\n            `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` +\n            `${firstEntry} but different revision details. Workbox is ` +\n            `unable to cache and version the asset correctly. Please remove one ` +\n            `of the entries.`);\n    },\n    'plugin-error-request-will-fetch': ({ thrownErrorMessage }) => {\n        if (!thrownErrorMessage) {\n            throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\n        }\n        return (`An error was thrown by a plugins 'requestWillFetch()' method. ` +\n            `The thrown error message was: '${thrownErrorMessage}'.`);\n    },\n    'invalid-cache-name': ({ cacheNameId, value }) => {\n        if (!cacheNameId) {\n            throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\n        }\n        return (`You must provide a name containing at least one character for ` +\n            `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` +\n            `'${JSON.stringify(value)}'`);\n    },\n    'unregister-route-but-not-found-with-method': ({ method }) => {\n        if (!method) {\n            throw new Error(`Unexpected input to ` +\n                `'unregister-route-but-not-found-with-method' error.`);\n        }\n        return (`The route you're trying to unregister was not  previously ` +\n            `registered for the method type '${method}'.`);\n    },\n    'unregister-route-route-not-registered': () => {\n        return (`The route you're trying to unregister was not previously ` +\n            `registered.`);\n    },\n    'queue-replay-failed': ({ name }) => {\n        return `Replaying the background sync queue '${name}' failed.`;\n    },\n    'duplicate-queue-name': ({ name }) => {\n        return (`The Queue name '${name}' is already being used. ` +\n            `All instances of backgroundSync.Queue must be given unique names.`);\n    },\n    'expired-test-without-max-age': ({ methodName, paramName }) => {\n        return (`The '${methodName}()' method can only be used when the ` +\n            `'${paramName}' is used in the constructor.`);\n    },\n    'unsupported-route-type': ({ moduleName, className, funcName, paramName }) => {\n        return (`The supplied '${paramName}' parameter was an unsupported type. ` +\n            `Please check the docs for ${moduleName}.${className}.${funcName} for ` +\n            `valid input types.`);\n    },\n    'not-array-of-class': ({ value, expectedClass, moduleName, className, funcName, paramName, }) => {\n        return (`The supplied '${paramName}' parameter must be an array of ` +\n            `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` +\n            `Please check the call to ${moduleName}.${className}.${funcName}() ` +\n            `to fix the issue.`);\n    },\n    'max-entries-or-age-required': ({ moduleName, className, funcName }) => {\n        return (`You must define either config.maxEntries or config.maxAgeSeconds` +\n            `in ${moduleName}.${className}.${funcName}`);\n    },\n    'statuses-or-headers-required': ({ moduleName, className, funcName }) => {\n        return (`You must define either config.statuses or config.headers` +\n            `in ${moduleName}.${className}.${funcName}`);\n    },\n    'invalid-string': ({ moduleName, funcName, paramName }) => {\n        if (!paramName || !moduleName || !funcName) {\n            throw new Error(`Unexpected input to 'invalid-string' error.`);\n        }\n        return (`When using strings, the '${paramName}' parameter must start with ` +\n            `'http' (for cross-origin matches) or '/' (for same-origin matches). ` +\n            `Please see the docs for ${moduleName}.${funcName}() for ` +\n            `more info.`);\n    },\n    'channel-name-required': () => {\n        return (`You must provide a channelName to construct a ` +\n            `BroadcastCacheUpdate instance.`);\n    },\n    'invalid-responses-are-same-args': () => {\n        return (`The arguments passed into responsesAreSame() appear to be ` +\n            `invalid. Please ensure valid Responses are used.`);\n    },\n    'expire-custom-caches-only': () => {\n        return (`You must provide a 'cacheName' property when using the ` +\n            `expiration plugin with a runtime caching strategy.`);\n    },\n    'unit-must-be-bytes': ({ normalizedRangeHeader }) => {\n        if (!normalizedRangeHeader) {\n            throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\n        }\n        return (`The 'unit' portion of the Range header must be set to 'bytes'. ` +\n            `The Range header provided was \"${normalizedRangeHeader}\"`);\n    },\n    'single-range-only': ({ normalizedRangeHeader }) => {\n        if (!normalizedRangeHeader) {\n            throw new Error(`Unexpected input to 'single-range-only' error.`);\n        }\n        return (`Multiple ranges are not supported. Please use a  single start ` +\n            `value, and optional end value. The Range header provided was ` +\n            `\"${normalizedRangeHeader}\"`);\n    },\n    'invalid-range-values': ({ normalizedRangeHeader }) => {\n        if (!normalizedRangeHeader) {\n            throw new Error(`Unexpected input to 'invalid-range-values' error.`);\n        }\n        return (`The Range header is missing both start and end values. At least ` +\n            `one of those values is needed. The Range header provided was ` +\n            `\"${normalizedRangeHeader}\"`);\n    },\n    'no-range-header': () => {\n        return `No Range header was found in the Request provided.`;\n    },\n    'range-not-satisfiable': ({ size, start, end }) => {\n        return (`The start (${start}) and end (${end}) values in the Range are ` +\n            `not satisfiable by the cached response, which is ${size} bytes.`);\n    },\n    'attempt-to-cache-non-get-request': ({ url, method }) => {\n        return (`Unable to cache '${url}' because it is a '${method}' request and ` +\n            `only 'GET' requests can be cached.`);\n    },\n    'cache-put-with-no-response': ({ url }) => {\n        return (`There was an attempt to cache '${url}' but the response was not ` +\n            `defined.`);\n    },\n    'no-response': ({ url, error }) => {\n        let message = `The strategy could not generate a response for '${url}'.`;\n        if (error) {\n            message += ` The underlying error is ${error}.`;\n        }\n        return message;\n    },\n    'bad-precaching-response': ({ url, status }) => {\n        return (`The precaching request for '${url}' failed` +\n            (status ? ` with an HTTP status of ${status}.` : `.`));\n    },\n    'non-precached-url': ({ url }) => {\n        return (`createHandlerBoundToURL('${url}') was called, but that URL is ` +\n            `not precached. Please pass in a URL that is precached instead.`);\n    },\n    'add-to-cache-list-conflicting-integrities': ({ url }) => {\n        return (`Two of the entries passed to ` +\n            `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` +\n            `${url} with different integrity values. Please remove one of them.`);\n    },\n    'missing-precache-entry': ({ cacheName, url }) => {\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\n    },\n    'cross-origin-copy-response': ({ origin }) => {\n        return (`workbox-core.copyResponse() can only be used with same-origin ` +\n            `responses. It was passed a response with origin ${origin}.`);\n    },\n    'opaque-streams-source': ({ type }) => {\n        const message = `One of the workbox-streams sources resulted in an ` +\n            `'${type}' response.`;\n        if (type === 'opaqueredirect') {\n            return (`${message} Please do not use a navigation request that results ` +\n                `in a redirect as a source.`);\n        }\n        return `${message} Please ensure your sources are CORS-enabled.`;\n    },\n};\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { messages } from './messages.js';\nimport '../../_version.js';\nconst fallback = (code, ...args) => {\n    let msg = code;\n    if (args.length > 0) {\n        msg += ` :: ${JSON.stringify(args)}`;\n    }\n    return msg;\n};\nconst generatorFunction = (code, details = {}) => {\n    const message = messages[code];\n    if (!message) {\n        throw new Error(`Unable to find message for code '${code}'.`);\n    }\n    return message(details);\n};\nexport const messageGenerator = process.env.NODE_ENV === 'production' ? fallback : generatorFunction;\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { messageGenerator } from '../models/messages/messageGenerator.js';\nimport '../_version.js';\n/**\n * Workbox errors should be thrown with this class.\n * This allows use to ensure the type easily in tests,\n * helps developers identify errors from workbox\n * easily and allows use to optimise error\n * messages correctly.\n *\n * @private\n */\nclass WorkboxError extends Error {\n    /**\n     *\n     * @param {string} errorCode The error code that\n     * identifies this particular error.\n     * @param {Object=} details Any relevant arguments\n     * that will help developers identify issues should\n     * be added as a key on the context object.\n     */\n    constructor(errorCode, details) {\n        const message = messageGenerator(errorCode, details);\n        super(message);\n        this.name = errorCode;\n        this.details = details;\n    }\n}\nexport { WorkboxError };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { WorkboxError } from '../_private/WorkboxError.js';\nimport '../_version.js';\n/*\n * This method throws if the supplied value is not an array.\n * The destructed values are required to produce a meaningful error for users.\n * The destructed and restructured object is so it's clear what is\n * needed.\n */\nconst isArray = (value, details) => {\n    if (!Array.isArray(value)) {\n        throw new WorkboxError('not-an-array', details);\n    }\n};\nconst hasMethod = (object, expectedMethod, details) => {\n    const type = typeof object[expectedMethod];\n    if (type !== 'function') {\n        details['expectedMethod'] = expectedMethod;\n        throw new WorkboxError('missing-a-method', details);\n    }\n};\nconst isType = (object, expectedType, details) => {\n    if (typeof object !== expectedType) {\n        details['expectedType'] = expectedType;\n        throw new WorkboxError('incorrect-type', details);\n    }\n};\nconst isInstance = (object, \n// Need the general type to do the check later.\n// eslint-disable-next-line @typescript-eslint/ban-types\nexpectedClass, details) => {\n    if (!(object instanceof expectedClass)) {\n        details['expectedClassName'] = expectedClass.name;\n        throw new WorkboxError('incorrect-class', details);\n    }\n};\nconst isOneOf = (value, validValues, details) => {\n    if (!validValues.includes(value)) {\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\n        throw new WorkboxError('invalid-value', details);\n    }\n};\nconst isArrayOfClass = (value, \n// Need general type to do check later.\nexpectedClass, // eslint-disable-line\ndetails) => {\n    const error = new WorkboxError('not-array-of-class', details);\n    if (!Array.isArray(value)) {\n        throw error;\n    }\n    for (const item of value) {\n        if (!(item instanceof expectedClass)) {\n            throw error;\n        }\n    }\n};\nconst finalAssertExports = process.env.NODE_ENV === 'production'\n    ? null\n    : {\n        hasMethod,\n        isArray,\n        isInstance,\n        isOneOf,\n        isType,\n        isArrayOfClass,\n    };\nexport { finalAssertExports as assert };\n","\"use strict\";\n// @ts-ignore\ntry {\n    self['workbox:routing:6.5.4'] && _();\n}\ncatch (e) { }\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\n/**\n * The default HTTP method, 'GET', used when there's no specific method\n * configured for a route.\n *\n * @type {string}\n *\n * @private\n */\nexport const defaultMethod = 'GET';\n/**\n * The list of valid HTTP methods associated with requests that could be routed.\n *\n * @type {Array<string>}\n *\n * @private\n */\nexport const validMethods = [\n    'DELETE',\n    'GET',\n    'HEAD',\n    'PATCH',\n    'POST',\n    'PUT',\n];\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport '../_version.js';\n/**\n * @param {function()|Object} handler Either a function, or an object with a\n * 'handle' method.\n * @return {Object} An object with a handle method.\n *\n * @private\n */\nexport const normalizeHandler = (handler) => {\n    if (handler && typeof handler === 'object') {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.hasMethod(handler, 'handle', {\n                moduleName: 'workbox-routing',\n                className: 'Route',\n                funcName: 'constructor',\n                paramName: 'handler',\n            });\n        }\n        return handler;\n    }\n    else {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isType(handler, 'function', {\n                moduleName: 'workbox-routing',\n                className: 'Route',\n                funcName: 'constructor',\n                paramName: 'handler',\n            });\n        }\n        return { handle: handler };\n    }\n};\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport { defaultMethod, validMethods } from './utils/constants.js';\nimport { normalizeHandler } from './utils/normalizeHandler.js';\nimport './_version.js';\n/**\n * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\n * The \"match\" callback determine if a route should be used to \"handle\" a\n * request by returning a non-falsy value if it can. The \"handler\" callback\n * is called when there is a match and should return a Promise that resolves\n * to a `Response`.\n *\n * @memberof workbox-routing\n */\nclass Route {\n    /**\n     * Constructor for Route class.\n     *\n     * @param {workbox-routing~matchCallback} match\n     * A callback function that determines whether the route matches a given\n     * `fetch` event by returning a non-falsy value.\n     * @param {workbox-routing~handlerCallback} handler A callback\n     * function that returns a Promise resolving to a Response.\n     * @param {string} [method='GET'] The HTTP method to match the Route\n     * against.\n     */\n    constructor(match, handler, method = defaultMethod) {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isType(match, 'function', {\n                moduleName: 'workbox-routing',\n                className: 'Route',\n                funcName: 'constructor',\n                paramName: 'match',\n            });\n            if (method) {\n                assert.isOneOf(method, validMethods, { paramName: 'method' });\n            }\n        }\n        // These values are referenced directly by Router so cannot be\n        // altered by minificaton.\n        this.handler = normalizeHandler(handler);\n        this.match = match;\n        this.method = method;\n    }\n    /**\n     *\n     * @param {workbox-routing-handlerCallback} handler A callback\n     * function that returns a Promise resolving to a Response\n     */\n    setCatchHandler(handler) {\n        this.catchHandler = normalizeHandler(handler);\n    }\n}\nexport { Route };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { Route } from './Route.js';\nimport './_version.js';\n/**\n * RegExpRoute makes it easy to create a regular expression based\n * {@link workbox-routing.Route}.\n *\n * For same-origin requests the RegExp only needs to match part of the URL. For\n * requests against third-party servers, you must define a RegExp that matches\n * the start of the URL.\n *\n * @memberof workbox-routing\n * @extends workbox-routing.Route\n */\nclass RegExpRoute extends Route {\n    /**\n     * If the regular expression contains\n     * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\n     * the captured values will be passed to the\n     * {@link workbox-routing~handlerCallback} `params`\n     * argument.\n     *\n     * @param {RegExp} regExp The regular expression to match against URLs.\n     * @param {workbox-routing~handlerCallback} handler A callback\n     * function that returns a Promise resulting in a Response.\n     * @param {string} [method='GET'] The HTTP method to match the Route\n     * against.\n     */\n    constructor(regExp, handler, method) {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isInstance(regExp, RegExp, {\n                moduleName: 'workbox-routing',\n                className: 'RegExpRoute',\n                funcName: 'constructor',\n                paramName: 'pattern',\n            });\n        }\n        const match = ({ url }) => {\n            const result = regExp.exec(url.href);\n            // Return immediately if there's no match.\n            if (!result) {\n                return;\n            }\n            // Require that the match start at the first character in the URL string\n            // if it's a cross-origin request.\n            // See https://github.com/GoogleChrome/workbox/issues/281 for the context\n            // behind this behavior.\n            if (url.origin !== location.origin && result.index !== 0) {\n                if (process.env.NODE_ENV !== 'production') {\n                    logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` +\n                        `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` +\n                        `handle cross-origin requests if they match the entire URL.`);\n                }\n                return;\n            }\n            // If the route matches, but there aren't any capture groups defined, then\n            // this will return [], which is truthy and therefore sufficient to\n            // indicate a match.\n            // If there are capture groups, then it will return their values.\n            return result.slice(1);\n        };\n        super(match, handler, method);\n    }\n}\nexport { RegExpRoute };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\nconst getFriendlyURL = (url) => {\n    const urlObj = new URL(String(url), location.href);\n    // See https://github.com/GoogleChrome/workbox/issues/2323\n    // We want to include everything, except for the origin if it's same-origin.\n    return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\n};\nexport { getFriendlyURL };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport { getFriendlyURL } from 'workbox-core/_private/getFriendlyURL.js';\nimport { defaultMethod } from './utils/constants.js';\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { normalizeHandler } from './utils/normalizeHandler.js';\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\nimport './_version.js';\n/**\n * The Router can be used to process a `FetchEvent` using one or more\n * {@link workbox-routing.Route}, responding with a `Response` if\n * a matching route exists.\n *\n * If no route matches a given a request, the Router will use a \"default\"\n * handler if one is defined.\n *\n * Should the matching Route throw an error, the Router will use a \"catch\"\n * handler if one is defined to gracefully deal with issues and respond with a\n * Request.\n *\n * If a request matches multiple routes, the **earliest** registered route will\n * be used to respond to the request.\n *\n * @memberof workbox-routing\n */\nclass Router {\n    /**\n     * Initializes a new Router.\n     */\n    constructor() {\n        this._routes = new Map();\n        this._defaultHandlerMap = new Map();\n    }\n    /**\n     * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\n     * method name ('GET', etc.) to an array of all the corresponding `Route`\n     * instances that are registered.\n     */\n    get routes() {\n        return this._routes;\n    }\n    /**\n     * Adds a fetch event listener to respond to events when a route matches\n     * the event's request.\n     */\n    addFetchListener() {\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n        self.addEventListener('fetch', ((event) => {\n            const { request } = event;\n            const responsePromise = this.handleRequest({ request, event });\n            if (responsePromise) {\n                event.respondWith(responsePromise);\n            }\n        }));\n    }\n    /**\n     * Adds a message event listener for URLs to cache from the window.\n     * This is useful to cache resources loaded on the page prior to when the\n     * service worker started controlling it.\n     *\n     * The format of the message data sent from the window should be as follows.\n     * Where the `urlsToCache` array may consist of URL strings or an array of\n     * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\n     *\n     * ```\n     * {\n     *   type: 'CACHE_URLS',\n     *   payload: {\n     *     urlsToCache: [\n     *       './script1.js',\n     *       './script2.js',\n     *       ['./script3.js', {mode: 'no-cors'}],\n     *     ],\n     *   },\n     * }\n     * ```\n     */\n    addCacheListener() {\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n        self.addEventListener('message', ((event) => {\n            // event.data is type 'any'\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            if (event.data && event.data.type === 'CACHE_URLS') {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                const { payload } = event.data;\n                if (process.env.NODE_ENV !== 'production') {\n                    logger.debug(`Caching URLs from the window`, payload.urlsToCache);\n                }\n                const requestPromises = Promise.all(payload.urlsToCache.map((entry) => {\n                    if (typeof entry === 'string') {\n                        entry = [entry];\n                    }\n                    const request = new Request(...entry);\n                    return this.handleRequest({ request, event });\n                    // TODO(philipwalton): TypeScript errors without this typecast for\n                    // some reason (probably a bug). The real type here should work but\n                    // doesn't: `Array<Promise<Response> | undefined>`.\n                })); // TypeScript\n                event.waitUntil(requestPromises);\n                // If a MessageChannel was used, reply to the message on success.\n                if (event.ports && event.ports[0]) {\n                    void requestPromises.then(() => event.ports[0].postMessage(true));\n                }\n            }\n        }));\n    }\n    /**\n     * Apply the routing rules to a FetchEvent object to get a Response from an\n     * appropriate Route's handler.\n     *\n     * @param {Object} options\n     * @param {Request} options.request The request to handle.\n     * @param {ExtendableEvent} options.event The event that triggered the\n     *     request.\n     * @return {Promise<Response>|undefined} A promise is returned if a\n     *     registered route can handle the request. If there is no matching\n     *     route and there's no `defaultHandler`, `undefined` is returned.\n     */\n    handleRequest({ request, event, }) {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isInstance(request, Request, {\n                moduleName: 'workbox-routing',\n                className: 'Router',\n                funcName: 'handleRequest',\n                paramName: 'options.request',\n            });\n        }\n        const url = new URL(request.url, location.href);\n        if (!url.protocol.startsWith('http')) {\n            if (process.env.NODE_ENV !== 'production') {\n                logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\n            }\n            return;\n        }\n        const sameOrigin = url.origin === location.origin;\n        const { params, route } = this.findMatchingRoute({\n            event,\n            request,\n            sameOrigin,\n            url,\n        });\n        let handler = route && route.handler;\n        const debugMessages = [];\n        if (process.env.NODE_ENV !== 'production') {\n            if (handler) {\n                debugMessages.push([`Found a route to handle this request:`, route]);\n                if (params) {\n                    debugMessages.push([\n                        `Passing the following params to the route's handler:`,\n                        params,\n                    ]);\n                }\n            }\n        }\n        // If we don't have a handler because there was no matching route, then\n        // fall back to defaultHandler if that's defined.\n        const method = request.method;\n        if (!handler && this._defaultHandlerMap.has(method)) {\n            if (process.env.NODE_ENV !== 'production') {\n                debugMessages.push(`Failed to find a matching route. Falling ` +\n                    `back to the default handler for ${method}.`);\n            }\n            handler = this._defaultHandlerMap.get(method);\n        }\n        if (!handler) {\n            if (process.env.NODE_ENV !== 'production') {\n                // No handler so Workbox will do nothing. If logs is set of debug\n                // i.e. verbose, we should print out this information.\n                logger.debug(`No route found for: ${getFriendlyURL(url)}`);\n            }\n            return;\n        }\n        if (process.env.NODE_ENV !== 'production') {\n            // We have a handler, meaning Workbox is going to handle the route.\n            // print the routing details to the console.\n            logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\n            debugMessages.forEach((msg) => {\n                if (Array.isArray(msg)) {\n                    logger.log(...msg);\n                }\n                else {\n                    logger.log(msg);\n                }\n            });\n            logger.groupEnd();\n        }\n        // Wrap in try and catch in case the handle method throws a synchronous\n        // error. It should still callback to the catch handler.\n        let responsePromise;\n        try {\n            responsePromise = handler.handle({ url, request, event, params });\n        }\n        catch (err) {\n            responsePromise = Promise.reject(err);\n        }\n        // Get route's catch handler, if it exists\n        const catchHandler = route && route.catchHandler;\n        if (responsePromise instanceof Promise &&\n            (this._catchHandler || catchHandler)) {\n            responsePromise = responsePromise.catch(async (err) => {\n                // If there's a route catch handler, process that first\n                if (catchHandler) {\n                    if (process.env.NODE_ENV !== 'production') {\n                        // Still include URL here as it will be async from the console group\n                        // and may not make sense without the URL\n                        logger.groupCollapsed(`Error thrown when responding to: ` +\n                            ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\n                        logger.error(`Error thrown by:`, route);\n                        logger.error(err);\n                        logger.groupEnd();\n                    }\n                    try {\n                        return await catchHandler.handle({ url, request, event, params });\n                    }\n                    catch (catchErr) {\n                        if (catchErr instanceof Error) {\n                            err = catchErr;\n                        }\n                    }\n                }\n                if (this._catchHandler) {\n                    if (process.env.NODE_ENV !== 'production') {\n                        // Still include URL here as it will be async from the console group\n                        // and may not make sense without the URL\n                        logger.groupCollapsed(`Error thrown when responding to: ` +\n                            ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\n                        logger.error(`Error thrown by:`, route);\n                        logger.error(err);\n                        logger.groupEnd();\n                    }\n                    return this._catchHandler.handle({ url, request, event });\n                }\n                throw err;\n            });\n        }\n        return responsePromise;\n    }\n    /**\n     * Checks a request and URL (and optionally an event) against the list of\n     * registered routes, and if there's a match, returns the corresponding\n     * route along with any params generated by the match.\n     *\n     * @param {Object} options\n     * @param {URL} options.url\n     * @param {boolean} options.sameOrigin The result of comparing `url.origin`\n     *     against the current origin.\n     * @param {Request} options.request The request to match.\n     * @param {Event} options.event The corresponding event.\n     * @return {Object} An object with `route` and `params` properties.\n     *     They are populated if a matching route was found or `undefined`\n     *     otherwise.\n     */\n    findMatchingRoute({ url, sameOrigin, request, event, }) {\n        const routes = this._routes.get(request.method) || [];\n        for (const route of routes) {\n            let params;\n            // route.match returns type any, not possible to change right now.\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            const matchResult = route.match({ url, sameOrigin, request, event });\n            if (matchResult) {\n                if (process.env.NODE_ENV !== 'production') {\n                    // Warn developers that using an async matchCallback is almost always\n                    // not the right thing to do.\n                    if (matchResult instanceof Promise) {\n                        logger.warn(`While routing ${getFriendlyURL(url)}, an async ` +\n                            `matchCallback function was used. Please convert the ` +\n                            `following route to use a synchronous matchCallback function:`, route);\n                    }\n                }\n                // See https://github.com/GoogleChrome/workbox/issues/2079\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                params = matchResult;\n                if (Array.isArray(params) && params.length === 0) {\n                    // Instead of passing an empty array in as params, use undefined.\n                    params = undefined;\n                }\n                else if (matchResult.constructor === Object && // eslint-disable-line\n                    Object.keys(matchResult).length === 0) {\n                    // Instead of passing an empty object in as params, use undefined.\n                    params = undefined;\n                }\n                else if (typeof matchResult === 'boolean') {\n                    // For the boolean value true (rather than just something truth-y),\n                    // don't set params.\n                    // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\n                    params = undefined;\n                }\n                // Return early if have a match.\n                return { route, params };\n            }\n        }\n        // If no match was found above, return and empty object.\n        return {};\n    }\n    /**\n     * Define a default `handler` that's called when no routes explicitly\n     * match the incoming request.\n     *\n     * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\n     *\n     * Without a default handler, unmatched requests will go against the\n     * network as if there were no service worker present.\n     *\n     * @param {workbox-routing~handlerCallback} handler A callback\n     * function that returns a Promise resulting in a Response.\n     * @param {string} [method='GET'] The HTTP method to associate with this\n     * default handler. Each method has its own default.\n     */\n    setDefaultHandler(handler, method = defaultMethod) {\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\n    }\n    /**\n     * If a Route throws an error while handling a request, this `handler`\n     * will be called and given a chance to provide a response.\n     *\n     * @param {workbox-routing~handlerCallback} handler A callback\n     * function that returns a Promise resulting in a Response.\n     */\n    setCatchHandler(handler) {\n        this._catchHandler = normalizeHandler(handler);\n    }\n    /**\n     * Registers a route with the router.\n     *\n     * @param {workbox-routing.Route} route The route to register.\n     */\n    registerRoute(route) {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isType(route, 'object', {\n                moduleName: 'workbox-routing',\n                className: 'Router',\n                funcName: 'registerRoute',\n                paramName: 'route',\n            });\n            assert.hasMethod(route, 'match', {\n                moduleName: 'workbox-routing',\n                className: 'Router',\n                funcName: 'registerRoute',\n                paramName: 'route',\n            });\n            assert.isType(route.handler, 'object', {\n                moduleName: 'workbox-routing',\n                className: 'Router',\n                funcName: 'registerRoute',\n                paramName: 'route',\n            });\n            assert.hasMethod(route.handler, 'handle', {\n                moduleName: 'workbox-routing',\n                className: 'Router',\n                funcName: 'registerRoute',\n                paramName: 'route.handler',\n            });\n            assert.isType(route.method, 'string', {\n                moduleName: 'workbox-routing',\n                className: 'Router',\n                funcName: 'registerRoute',\n                paramName: 'route.method',\n            });\n        }\n        if (!this._routes.has(route.method)) {\n            this._routes.set(route.method, []);\n        }\n        // Give precedence to all of the earlier routes by adding this additional\n        // route to the end of the array.\n        this._routes.get(route.method).push(route);\n    }\n    /**\n     * Unregisters a route with the router.\n     *\n     * @param {workbox-routing.Route} route The route to unregister.\n     */\n    unregisterRoute(route) {\n        if (!this._routes.has(route.method)) {\n            throw new WorkboxError('unregister-route-but-not-found-with-method', {\n                method: route.method,\n            });\n        }\n        const routeIndex = this._routes.get(route.method).indexOf(route);\n        if (routeIndex > -1) {\n            this._routes.get(route.method).splice(routeIndex, 1);\n        }\n        else {\n            throw new WorkboxError('unregister-route-route-not-registered');\n        }\n    }\n}\nexport { Router };\n","/*\n  Copyright 2019 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { Router } from '../Router.js';\nimport '../_version.js';\nlet defaultRouter;\n/**\n * Creates a new, singleton Router instance if one does not exist. If one\n * does already exist, that instance is returned.\n *\n * @private\n * @return {Router}\n */\nexport const getOrCreateDefaultRouter = () => {\n    if (!defaultRouter) {\n        defaultRouter = new Router();\n        // The helpers that use the default Router assume these listeners exist.\n        defaultRouter.addFetchListener();\n        defaultRouter.addCacheListener();\n    }\n    return defaultRouter;\n};\n","/*\n  Copyright 2019 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\nimport { Route } from './Route.js';\nimport { RegExpRoute } from './RegExpRoute.js';\nimport { getOrCreateDefaultRouter } from './utils/getOrCreateDefaultRouter.js';\nimport './_version.js';\n/**\n * Easily register a RegExp, string, or function with a caching\n * strategy to a singleton Router instance.\n *\n * This method will generate a Route for you if needed and\n * call {@link workbox-routing.Router#registerRoute}.\n *\n * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\n * If the capture param is a `Route`, all other arguments will be ignored.\n * @param {workbox-routing~handlerCallback} [handler] A callback\n * function that returns a Promise resulting in a Response. This parameter\n * is required if `capture` is not a `Route` object.\n * @param {string} [method='GET'] The HTTP method to match the Route\n * against.\n * @return {workbox-routing.Route} The generated `Route`.\n *\n * @memberof workbox-routing\n */\nfunction registerRoute(capture, handler, method) {\n    let route;\n    if (typeof capture === 'string') {\n        const captureUrl = new URL(capture, location.href);\n        if (process.env.NODE_ENV !== 'production') {\n            if (!(capture.startsWith('/') || capture.startsWith('http'))) {\n                throw new WorkboxError('invalid-string', {\n                    moduleName: 'workbox-routing',\n                    funcName: 'registerRoute',\n                    paramName: 'capture',\n                });\n            }\n            // We want to check if Express-style wildcards are in the pathname only.\n            // TODO: Remove this log message in v4.\n            const valueToCheck = capture.startsWith('http')\n                ? captureUrl.pathname\n                : capture;\n            // See https://github.com/pillarjs/path-to-regexp#parameters\n            const wildcards = '[*:?+]';\n            if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\n                logger.debug(`The '$capture' parameter contains an Express-style wildcard ` +\n                    `character (${wildcards}). Strings are now always interpreted as ` +\n                    `exact matches; use a RegExp for partial or wildcard matches.`);\n            }\n        }\n        const matchCallback = ({ url }) => {\n            if (process.env.NODE_ENV !== 'production') {\n                if (url.pathname === captureUrl.pathname &&\n                    url.origin !== captureUrl.origin) {\n                    logger.debug(`${capture} only partially matches the cross-origin URL ` +\n                        `${url.toString()}. This route will only handle cross-origin requests ` +\n                        `if they match the entire URL.`);\n                }\n            }\n            return url.href === captureUrl.href;\n        };\n        // If `capture` is a string then `handler` and `method` must be present.\n        route = new Route(matchCallback, handler, method);\n    }\n    else if (capture instanceof RegExp) {\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\n        route = new RegExpRoute(capture, handler, method);\n    }\n    else if (typeof capture === 'function') {\n        // If `capture` is a function then `handler` and `method` must be present.\n        route = new Route(capture, handler, method);\n    }\n    else if (capture instanceof Route) {\n        route = capture;\n    }\n    else {\n        throw new WorkboxError('unsupported-route-type', {\n            moduleName: 'workbox-routing',\n            funcName: 'registerRoute',\n            paramName: 'capture',\n        });\n    }\n    const defaultRouter = getOrCreateDefaultRouter();\n    defaultRouter.registerRoute(route);\n    return route;\n}\nexport { registerRoute };\n","\"use strict\";\n// @ts-ignore\ntry {\n    self['workbox:strategies:6.5.4'] && _();\n}\ncatch (e) { }\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\nexport const cacheOkAndOpaquePlugin = {\n    /**\n     * Returns a valid response (to allow caching) if the status is 200 (OK) or\n     * 0 (opaque).\n     *\n     * @param {Object} options\n     * @param {Response} options.response\n     * @return {Response|null}\n     *\n     * @private\n     */\n    cacheWillUpdate: async ({ response }) => {\n        if (response.status === 200 || response.status === 0) {\n            return response;\n        }\n        return null;\n    },\n};\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\nconst _cacheNameDetails = {\n    googleAnalytics: 'googleAnalytics',\n    precache: 'precache-v2',\n    prefix: 'workbox',\n    runtime: 'runtime',\n    suffix: typeof registration !== 'undefined' ? registration.scope : '',\n};\nconst _createCacheName = (cacheName) => {\n    return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix]\n        .filter((value) => value && value.length > 0)\n        .join('-');\n};\nconst eachCacheNameDetail = (fn) => {\n    for (const key of Object.keys(_cacheNameDetails)) {\n        fn(key);\n    }\n};\nexport const cacheNames = {\n    updateDetails: (details) => {\n        eachCacheNameDetail((key) => {\n            if (typeof details[key] === 'string') {\n                _cacheNameDetails[key] = details[key];\n            }\n        });\n    },\n    getGoogleAnalyticsName: (userCacheName) => {\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\n    },\n    getPrecacheName: (userCacheName) => {\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\n    },\n    getPrefix: () => {\n        return _cacheNameDetails.prefix;\n    },\n    getRuntimeName: (userCacheName) => {\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\n    },\n    getSuffix: () => {\n        return _cacheNameDetails.suffix;\n    },\n};\n","/*\n  Copyright 2020 Google LLC\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\nfunction stripParams(fullURL, ignoreParams) {\n    const strippedURL = new URL(fullURL);\n    for (const param of ignoreParams) {\n        strippedURL.searchParams.delete(param);\n    }\n    return strippedURL.href;\n}\n/**\n * Matches an item in the cache, ignoring specific URL params. This is similar\n * to the `ignoreSearch` option, but it allows you to ignore just specific\n * params (while continuing to match on the others).\n *\n * @private\n * @param {Cache} cache\n * @param {Request} request\n * @param {Object} matchOptions\n * @param {Array<string>} ignoreParams\n * @return {Promise<Response|undefined>}\n */\nasync function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\n    const strippedRequestURL = stripParams(request.url, ignoreParams);\n    // If the request doesn't include any ignored params, match as normal.\n    if (request.url === strippedRequestURL) {\n        return cache.match(request, matchOptions);\n    }\n    // Otherwise, match by comparing keys\n    const keysOptions = Object.assign(Object.assign({}, matchOptions), { ignoreSearch: true });\n    const cacheKeys = await cache.keys(request, keysOptions);\n    for (const cacheKey of cacheKeys) {\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\n        if (strippedRequestURL === strippedCacheKeyURL) {\n            return cache.match(cacheKey, matchOptions);\n        }\n    }\n    return;\n}\nexport { cacheMatchIgnoreParams };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\n/**\n * The Deferred class composes Promises in a way that allows for them to be\n * resolved or rejected from outside the constructor. In most cases promises\n * should be used directly, but Deferreds can be necessary when the logic to\n * resolve a promise must be separate.\n *\n * @private\n */\nclass Deferred {\n    /**\n     * Creates a promise and exposes its resolve and reject functions as methods.\n     */\n    constructor() {\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n}\nexport { Deferred };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\n// Callbacks to be executed whenever there's a quota error.\n// Can't change Function type right now.\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst quotaErrorCallbacks = new Set();\nexport { quotaErrorCallbacks };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { logger } from '../_private/logger.js';\nimport { quotaErrorCallbacks } from '../models/quotaErrorCallbacks.js';\nimport '../_version.js';\n/**\n * Runs all of the callback functions, one at a time sequentially, in the order\n * in which they were registered.\n *\n * @memberof workbox-core\n * @private\n */\nasync function executeQuotaErrorCallbacks() {\n    if (process.env.NODE_ENV !== 'production') {\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` +\n            `callbacks to clean up caches.`);\n    }\n    for (const callback of quotaErrorCallbacks) {\n        await callback();\n        if (process.env.NODE_ENV !== 'production') {\n            logger.log(callback, 'is complete.');\n        }\n    }\n    if (process.env.NODE_ENV !== 'production') {\n        logger.log('Finished running callbacks.');\n    }\n}\nexport { executeQuotaErrorCallbacks };\n","/*\n  Copyright 2019 Google LLC\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport '../_version.js';\n/**\n * Returns a promise that resolves and the passed number of milliseconds.\n * This utility is an async/await-friendly version of `setTimeout`.\n *\n * @param {number} ms\n * @return {Promise}\n * @private\n */\nexport function timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","/*\n  Copyright 2020 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport { cacheMatchIgnoreParams } from 'workbox-core/_private/cacheMatchIgnoreParams.js';\nimport { Deferred } from 'workbox-core/_private/Deferred.js';\nimport { executeQuotaErrorCallbacks } from 'workbox-core/_private/executeQuotaErrorCallbacks.js';\nimport { getFriendlyURL } from 'workbox-core/_private/getFriendlyURL.js';\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { timeout } from 'workbox-core/_private/timeout.js';\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\nimport './_version.js';\nfunction toRequest(input) {\n    return typeof input === 'string' ? new Request(input) : input;\n}\n/**\n * A class created every time a Strategy instance instance calls\n * {@link workbox-strategies.Strategy~handle} or\n * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\n * cache actions around plugin callbacks and keeps track of when the strategy\n * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\n *\n * @memberof workbox-strategies\n */\nclass StrategyHandler {\n    /**\n     * Creates a new instance associated with the passed strategy and event\n     * that's handling the request.\n     *\n     * The constructor also initializes the state that will be passed to each of\n     * the plugins handling this request.\n     *\n     * @param {workbox-strategies.Strategy} strategy\n     * @param {Object} options\n     * @param {Request|string} options.request A request to run this strategy for.\n     * @param {ExtendableEvent} options.event The event associated with the\n     *     request.\n     * @param {URL} [options.url]\n     * @param {*} [options.params] The return value from the\n     *     {@link workbox-routing~matchCallback} (if applicable).\n     */\n    constructor(strategy, options) {\n        this._cacheKeys = {};\n        /**\n         * The request the strategy is performing (passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * @name request\n         * @instance\n         * @type {Request}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * The event associated with this request.\n         * @name event\n         * @instance\n         * @type {ExtendableEvent}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * A `URL` instance of `request.url` (if passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * Note: the `url` param will be present if the strategy was invoked\n         * from a workbox `Route` object.\n         * @name url\n         * @instance\n         * @type {URL|undefined}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * A `param` value (if passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * Note: the `param` param will be present if the strategy was invoked\n         * from a workbox `Route` object and the\n         * {@link workbox-routing~matchCallback} returned\n         * a truthy value (it will be that value).\n         * @name params\n         * @instance\n         * @type {*|undefined}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isInstance(options.event, ExtendableEvent, {\n                moduleName: 'workbox-strategies',\n                className: 'StrategyHandler',\n                funcName: 'constructor',\n                paramName: 'options.event',\n            });\n        }\n        Object.assign(this, options);\n        this.event = options.event;\n        this._strategy = strategy;\n        this._handlerDeferred = new Deferred();\n        this._extendLifetimePromises = [];\n        // Copy the plugins list (since it's mutable on the strategy),\n        // so any mutations don't affect this handler instance.\n        this._plugins = [...strategy.plugins];\n        this._pluginStateMap = new Map();\n        for (const plugin of this._plugins) {\n            this._pluginStateMap.set(plugin, {});\n        }\n        this.event.waitUntil(this._handlerDeferred.promise);\n    }\n    /**\n     * Fetches a given request (and invokes any applicable plugin callback\n     * methods) using the `fetchOptions` (for non-navigation requests) and\n     * `plugins` defined on the `Strategy` object.\n     *\n     * The following plugin lifecycle methods are invoked when using this method:\n     * - `requestWillFetch()`\n     * - `fetchDidSucceed()`\n     * - `fetchDidFail()`\n     *\n     * @param {Request|string} input The URL or request to fetch.\n     * @return {Promise<Response>}\n     */\n    async fetch(input) {\n        const { event } = this;\n        let request = toRequest(input);\n        if (request.mode === 'navigate' &&\n            event instanceof FetchEvent &&\n            event.preloadResponse) {\n            const possiblePreloadResponse = (await event.preloadResponse);\n            if (possiblePreloadResponse) {\n                if (process.env.NODE_ENV !== 'production') {\n                    logger.log(`Using a preloaded navigation response for ` +\n                        `'${getFriendlyURL(request.url)}'`);\n                }\n                return possiblePreloadResponse;\n            }\n        }\n        // If there is a fetchDidFail plugin, we need to save a clone of the\n        // original request before it's either modified by a requestWillFetch\n        // plugin or before the original request's body is consumed via fetch().\n        const originalRequest = this.hasCallback('fetchDidFail')\n            ? request.clone()\n            : null;\n        try {\n            for (const cb of this.iterateCallbacks('requestWillFetch')) {\n                request = await cb({ request: request.clone(), event });\n            }\n        }\n        catch (err) {\n            if (err instanceof Error) {\n                throw new WorkboxError('plugin-error-request-will-fetch', {\n                    thrownErrorMessage: err.message,\n                });\n            }\n        }\n        // The request can be altered by plugins with `requestWillFetch` making\n        // the original request (most likely from a `fetch` event) different\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\n        const pluginFilteredRequest = request.clone();\n        try {\n            let fetchResponse;\n            // See https://github.com/GoogleChrome/workbox/issues/1796\n            fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\n            if (process.env.NODE_ENV !== 'production') {\n                logger.debug(`Network request for ` +\n                    `'${getFriendlyURL(request.url)}' returned a response with ` +\n                    `status '${fetchResponse.status}'.`);\n            }\n            for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\n                fetchResponse = await callback({\n                    event,\n                    request: pluginFilteredRequest,\n                    response: fetchResponse,\n                });\n            }\n            return fetchResponse;\n        }\n        catch (error) {\n            if (process.env.NODE_ENV !== 'production') {\n                logger.log(`Network request for ` +\n                    `'${getFriendlyURL(request.url)}' threw an error.`, error);\n            }\n            // `originalRequest` will only exist if a `fetchDidFail` callback\n            // is being used (see above).\n            if (originalRequest) {\n                await this.runCallbacks('fetchDidFail', {\n                    error: error,\n                    event,\n                    originalRequest: originalRequest.clone(),\n                    request: pluginFilteredRequest.clone(),\n                });\n            }\n            throw error;\n        }\n    }\n    /**\n     * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\n     * the response generated by `this.fetch()`.\n     *\n     * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\n     * so you do not have to manually call `waitUntil()` on the event.\n     *\n     * @param {Request|string} input The request or URL to fetch and cache.\n     * @return {Promise<Response>}\n     */\n    async fetchAndCachePut(input) {\n        const response = await this.fetch(input);\n        const responseClone = response.clone();\n        void this.waitUntil(this.cachePut(input, responseClone));\n        return response;\n    }\n    /**\n     * Matches a request from the cache (and invokes any applicable plugin\n     * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\n     * defined on the strategy object.\n     *\n     * The following plugin lifecycle methods are invoked when using this method:\n     * - cacheKeyWillByUsed()\n     * - cachedResponseWillByUsed()\n     *\n     * @param {Request|string} key The Request or URL to use as the cache key.\n     * @return {Promise<Response|undefined>} A matching response, if found.\n     */\n    async cacheMatch(key) {\n        const request = toRequest(key);\n        let cachedResponse;\n        const { cacheName, matchOptions } = this._strategy;\n        const effectiveRequest = await this.getCacheKey(request, 'read');\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), { cacheName });\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\n        if (process.env.NODE_ENV !== 'production') {\n            if (cachedResponse) {\n                logger.debug(`Found a cached response in '${cacheName}'.`);\n            }\n            else {\n                logger.debug(`No cached response found in '${cacheName}'.`);\n            }\n        }\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\n            cachedResponse =\n                (await callback({\n                    cacheName,\n                    matchOptions,\n                    cachedResponse,\n                    request: effectiveRequest,\n                    event: this.event,\n                })) || undefined;\n        }\n        return cachedResponse;\n    }\n    /**\n     * Puts a request/response pair in the cache (and invokes any applicable\n     * plugin callback methods) using the `cacheName` and `plugins` defined on\n     * the strategy object.\n     *\n     * The following plugin lifecycle methods are invoked when using this method:\n     * - cacheKeyWillByUsed()\n     * - cacheWillUpdate()\n     * - cacheDidUpdate()\n     *\n     * @param {Request|string} key The request or URL to use as the cache key.\n     * @param {Response} response The response to cache.\n     * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\n     * not be cached, and `true` otherwise.\n     */\n    async cachePut(key, response) {\n        const request = toRequest(key);\n        // Run in the next task to avoid blocking other cache reads.\n        // https://github.com/w3c/ServiceWorker/issues/1397\n        await timeout(0);\n        const effectiveRequest = await this.getCacheKey(request, 'write');\n        if (process.env.NODE_ENV !== 'production') {\n            if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\n                throw new WorkboxError('attempt-to-cache-non-get-request', {\n                    url: getFriendlyURL(effectiveRequest.url),\n                    method: effectiveRequest.method,\n                });\n            }\n            // See https://github.com/GoogleChrome/workbox/issues/2818\n            const vary = response.headers.get('Vary');\n            if (vary) {\n                logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` +\n                    `has a 'Vary: ${vary}' header. ` +\n                    `Consider setting the {ignoreVary: true} option on your strategy ` +\n                    `to ensure cache matching and deletion works as expected.`);\n            }\n        }\n        if (!response) {\n            if (process.env.NODE_ENV !== 'production') {\n                logger.error(`Cannot cache non-existent response for ` +\n                    `'${getFriendlyURL(effectiveRequest.url)}'.`);\n            }\n            throw new WorkboxError('cache-put-with-no-response', {\n                url: getFriendlyURL(effectiveRequest.url),\n            });\n        }\n        const responseToCache = await this._ensureResponseSafeToCache(response);\n        if (!responseToCache) {\n            if (process.env.NODE_ENV !== 'production') {\n                logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` +\n                    `will not be cached.`, responseToCache);\n            }\n            return false;\n        }\n        const { cacheName, matchOptions } = this._strategy;\n        const cache = await self.caches.open(cacheName);\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\n        const oldResponse = hasCacheUpdateCallback\n            ? await cacheMatchIgnoreParams(\n            // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\n            // feature. Consider into ways to only add this behavior if using\n            // precaching.\n            cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions)\n            : null;\n        if (process.env.NODE_ENV !== 'production') {\n            logger.debug(`Updating the '${cacheName}' cache with a new Response ` +\n                `for ${getFriendlyURL(effectiveRequest.url)}.`);\n        }\n        try {\n            await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\n        }\n        catch (error) {\n            if (error instanceof Error) {\n                // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\n                if (error.name === 'QuotaExceededError') {\n                    await executeQuotaErrorCallbacks();\n                }\n                throw error;\n            }\n        }\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\n            await callback({\n                cacheName,\n                oldResponse,\n                newResponse: responseToCache.clone(),\n                request: effectiveRequest,\n                event: this.event,\n            });\n        }\n        return true;\n    }\n    /**\n     * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\n     * executes any of those callbacks found in sequence. The final `Request`\n     * object returned by the last plugin is treated as the cache key for cache\n     * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\n     * been registered, the passed request is returned unmodified\n     *\n     * @param {Request} request\n     * @param {string} mode\n     * @return {Promise<Request>}\n     */\n    async getCacheKey(request, mode) {\n        const key = `${request.url} | ${mode}`;\n        if (!this._cacheKeys[key]) {\n            let effectiveRequest = request;\n            for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\n                effectiveRequest = toRequest(await callback({\n                    mode,\n                    request: effectiveRequest,\n                    event: this.event,\n                    // params has a type any can't change right now.\n                    params: this.params, // eslint-disable-line\n                }));\n            }\n            this._cacheKeys[key] = effectiveRequest;\n        }\n        return this._cacheKeys[key];\n    }\n    /**\n     * Returns true if the strategy has at least one plugin with the given\n     * callback.\n     *\n     * @param {string} name The name of the callback to check for.\n     * @return {boolean}\n     */\n    hasCallback(name) {\n        for (const plugin of this._strategy.plugins) {\n            if (name in plugin) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Runs all plugin callbacks matching the given name, in order, passing the\n     * given param object (merged ith the current plugin state) as the only\n     * argument.\n     *\n     * Note: since this method runs all plugins, it's not suitable for cases\n     * where the return value of a callback needs to be applied prior to calling\n     * the next callback. See\n     * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\n     * below for how to handle that case.\n     *\n     * @param {string} name The name of the callback to run within each plugin.\n     * @param {Object} param The object to pass as the first (and only) param\n     *     when executing each callback. This object will be merged with the\n     *     current plugin state prior to callback execution.\n     */\n    async runCallbacks(name, param) {\n        for (const callback of this.iterateCallbacks(name)) {\n            // TODO(philipwalton): not sure why `any` is needed. It seems like\n            // this should work with `as WorkboxPluginCallbackParam[C]`.\n            await callback(param);\n        }\n    }\n    /**\n     * Accepts a callback and returns an iterable of matching plugin callbacks,\n     * where each callback is wrapped with the current handler state (i.e. when\n     * you call each callback, whatever object parameter you pass it will\n     * be merged with the plugin's current state).\n     *\n     * @param {string} name The name fo the callback to run\n     * @return {Array<Function>}\n     */\n    *iterateCallbacks(name) {\n        for (const plugin of this._strategy.plugins) {\n            if (typeof plugin[name] === 'function') {\n                const state = this._pluginStateMap.get(plugin);\n                const statefulCallback = (param) => {\n                    const statefulParam = Object.assign(Object.assign({}, param), { state });\n                    // TODO(philipwalton): not sure why `any` is needed. It seems like\n                    // this should work with `as WorkboxPluginCallbackParam[C]`.\n                    return plugin[name](statefulParam);\n                };\n                yield statefulCallback;\n            }\n        }\n    }\n    /**\n     * Adds a promise to the\n     * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\n     * of the event event associated with the request being handled (usually a\n     * `FetchEvent`).\n     *\n     * Note: you can await\n     * {@link workbox-strategies.StrategyHandler~doneWaiting}\n     * to know when all added promises have settled.\n     *\n     * @param {Promise} promise A promise to add to the extend lifetime promises\n     *     of the event that triggered the request.\n     */\n    waitUntil(promise) {\n        this._extendLifetimePromises.push(promise);\n        return promise;\n    }\n    /**\n     * Returns a promise that resolves once all promises passed to\n     * {@link workbox-strategies.StrategyHandler~waitUntil}\n     * have settled.\n     *\n     * Note: any work done after `doneWaiting()` settles should be manually\n     * passed to an event's `waitUntil()` method (not this handler's\n     * `waitUntil()` method), otherwise the service worker thread my be killed\n     * prior to your work completing.\n     */\n    async doneWaiting() {\n        let promise;\n        while ((promise = this._extendLifetimePromises.shift())) {\n            await promise;\n        }\n    }\n    /**\n     * Stops running the strategy and immediately resolves any pending\n     * `waitUntil()` promises.\n     */\n    destroy() {\n        this._handlerDeferred.resolve(null);\n    }\n    /**\n     * This method will call cacheWillUpdate on the available plugins (or use\n     * status === 200) to determine if the Response is safe and valid to cache.\n     *\n     * @param {Request} options.request\n     * @param {Response} options.response\n     * @return {Promise<Response|undefined>}\n     *\n     * @private\n     */\n    async _ensureResponseSafeToCache(response) {\n        let responseToCache = response;\n        let pluginsUsed = false;\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\n            responseToCache =\n                (await callback({\n                    request: this.request,\n                    response: responseToCache,\n                    event: this.event,\n                })) || undefined;\n            pluginsUsed = true;\n            if (!responseToCache) {\n                break;\n            }\n        }\n        if (!pluginsUsed) {\n            if (responseToCache && responseToCache.status !== 200) {\n                responseToCache = undefined;\n            }\n            if (process.env.NODE_ENV !== 'production') {\n                if (responseToCache) {\n                    if (responseToCache.status !== 200) {\n                        if (responseToCache.status === 0) {\n                            logger.warn(`The response for '${this.request.url}' ` +\n                                `is an opaque response. The caching strategy that you're ` +\n                                `using will not cache opaque responses by default.`);\n                        }\n                        else {\n                            logger.debug(`The response for '${this.request.url}' ` +\n                                `returned a status code of '${response.status}' and won't ` +\n                                `be cached as a result.`);\n                        }\n                    }\n                }\n            }\n        }\n        return responseToCache;\n    }\n}\nexport { StrategyHandler };\n","/*\n  Copyright 2020 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { cacheNames } from 'workbox-core/_private/cacheNames.js';\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { getFriendlyURL } from 'workbox-core/_private/getFriendlyURL.js';\nimport { StrategyHandler } from './StrategyHandler.js';\nimport './_version.js';\n/**\n * An abstract base class that all other strategy classes must extend from:\n *\n * @memberof workbox-strategies\n */\nclass Strategy {\n    /**\n     * Creates a new instance of the strategy and sets all documented option\n     * properties as public instance properties.\n     *\n     * Note: if a custom strategy class extends the base Strategy class and does\n     * not need more than these properties, it does not need to define its own\n     * constructor.\n     *\n     * @param {Object} [options]\n     * @param {string} [options.cacheName] Cache name to store and retrieve\n     * requests. Defaults to the cache names provided by\n     * {@link workbox-core.cacheNames}.\n     * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n     * to use in conjunction with this caching strategy.\n     * @param {Object} [options.fetchOptions] Values passed along to the\n     * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\n     * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\n     * `fetch()` requests made by this strategy.\n     * @param {Object} [options.matchOptions] The\n     * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\n     * for any `cache.match()` or `cache.put()` calls made by this strategy.\n     */\n    constructor(options = {}) {\n        /**\n         * Cache name to store and retrieve\n         * requests. Defaults to the cache names provided by\n         * {@link workbox-core.cacheNames}.\n         *\n         * @type {string}\n         */\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\n        /**\n         * The list\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n         * used by this strategy.\n         *\n         * @type {Array<Object>}\n         */\n        this.plugins = options.plugins || [];\n        /**\n         * Values passed along to the\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\n         * of all fetch() requests made by this strategy.\n         *\n         * @type {Object}\n         */\n        this.fetchOptions = options.fetchOptions;\n        /**\n         * The\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\n         *\n         * @type {Object}\n         */\n        this.matchOptions = options.matchOptions;\n    }\n    /**\n     * Perform a request strategy and returns a `Promise` that will resolve with\n     * a `Response`, invoking all relevant plugin callbacks.\n     *\n     * When a strategy instance is registered with a Workbox\n     * {@link workbox-routing.Route}, this method is automatically\n     * called when the route matches.\n     *\n     * Alternatively, this method can be used in a standalone `FetchEvent`\n     * listener by passing it to `event.respondWith()`.\n     *\n     * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\n     *     properties listed below.\n     * @param {Request|string} options.request A request to run this strategy for.\n     * @param {ExtendableEvent} options.event The event associated with the\n     *     request.\n     * @param {URL} [options.url]\n     * @param {*} [options.params]\n     */\n    handle(options) {\n        const [responseDone] = this.handleAll(options);\n        return responseDone;\n    }\n    /**\n     * Similar to {@link workbox-strategies.Strategy~handle}, but\n     * instead of just returning a `Promise` that resolves to a `Response` it\n     * it will return an tuple of `[response, done]` promises, where the former\n     * (`response`) is equivalent to what `handle()` returns, and the latter is a\n     * Promise that will resolve once any promises that were added to\n     * `event.waitUntil()` as part of performing the strategy have completed.\n     *\n     * You can await the `done` promise to ensure any extra work performed by\n     * the strategy (usually caching responses) completes successfully.\n     *\n     * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\n     *     properties listed below.\n     * @param {Request|string} options.request A request to run this strategy for.\n     * @param {ExtendableEvent} options.event The event associated with the\n     *     request.\n     * @param {URL} [options.url]\n     * @param {*} [options.params]\n     * @return {Array<Promise>} A tuple of [response, done]\n     *     promises that can be used to determine when the response resolves as\n     *     well as when the handler has completed all its work.\n     */\n    handleAll(options) {\n        // Allow for flexible options to be passed.\n        if (options instanceof FetchEvent) {\n            options = {\n                event: options,\n                request: options.request,\n            };\n        }\n        const event = options.event;\n        const request = typeof options.request === 'string'\n            ? new Request(options.request)\n            : options.request;\n        const params = 'params' in options ? options.params : undefined;\n        const handler = new StrategyHandler(this, { event, request, params });\n        const responseDone = this._getResponse(handler, request, event);\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\n        // Return an array of promises, suitable for use with Promise.all().\n        return [responseDone, handlerDone];\n    }\n    async _getResponse(handler, request, event) {\n        await handler.runCallbacks('handlerWillStart', { event, request });\n        let response = undefined;\n        try {\n            response = await this._handle(request, handler);\n            // The \"official\" Strategy subclasses all throw this error automatically,\n            // but in case a third-party Strategy doesn't, ensure that we have a\n            // consistent failure when there's no response or an error response.\n            if (!response || response.type === 'error') {\n                throw new WorkboxError('no-response', { url: request.url });\n            }\n        }\n        catch (error) {\n            if (error instanceof Error) {\n                for (const callback of handler.iterateCallbacks('handlerDidError')) {\n                    response = await callback({ error, event, request });\n                    if (response) {\n                        break;\n                    }\n                }\n            }\n            if (!response) {\n                throw error;\n            }\n            else if (process.env.NODE_ENV !== 'production') {\n                logger.log(`While responding to '${getFriendlyURL(request.url)}', ` +\n                    `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` +\n                    `a handlerDidError plugin.`);\n            }\n        }\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\n            response = await callback({ event, request, response });\n        }\n        return response;\n    }\n    async _awaitComplete(responseDone, handler, request, event) {\n        let response;\n        let error;\n        try {\n            response = await responseDone;\n        }\n        catch (error) {\n            // Ignore errors, as response errors should be caught via the `response`\n            // promise above. The `done` promise will only throw for errors in\n            // promises passed to `handler.waitUntil()`.\n        }\n        try {\n            await handler.runCallbacks('handlerDidRespond', {\n                event,\n                request,\n                response,\n            });\n            await handler.doneWaiting();\n        }\n        catch (waitUntilError) {\n            if (waitUntilError instanceof Error) {\n                error = waitUntilError;\n            }\n        }\n        await handler.runCallbacks('handlerDidComplete', {\n            event,\n            request,\n            response,\n            error: error,\n        });\n        handler.destroy();\n        if (error) {\n            throw error;\n        }\n    }\n}\nexport { Strategy };\n/**\n * Classes extending the `Strategy` based class should implement this method,\n * and leverage the {@link workbox-strategies.StrategyHandler}\n * arg to perform all fetching and cache logic, which will ensure all relevant\n * cache, cache options, fetch options and plugins are used (per the current\n * strategy instance).\n *\n * @name _handle\n * @instance\n * @abstract\n * @function\n * @param {Request} request\n * @param {workbox-strategies.StrategyHandler} handler\n * @return {Promise<Response>}\n *\n * @memberof workbox-strategies.Strategy\n */\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { getFriendlyURL } from 'workbox-core/_private/getFriendlyURL.js';\nimport '../_version.js';\nexport const messages = {\n    strategyStart: (strategyName, request) => `Using ${strategyName} to respond to '${getFriendlyURL(request.url)}'`,\n    printFinalResponse: (response) => {\n        if (response) {\n            logger.groupCollapsed(`View the final response here.`);\n            logger.log(response || '[No response returned]');\n            logger.groupEnd();\n        }\n    },\n};\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\nimport { cacheOkAndOpaquePlugin } from './plugins/cacheOkAndOpaquePlugin.js';\nimport { Strategy } from './Strategy.js';\nimport { messages } from './utils/messages.js';\nimport './_version.js';\n/**\n * An implementation of a\n * [network first](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#network-first-falling-back-to-cache)\n * request strategy.\n *\n * By default, this strategy will cache responses with a 200 status code as\n * well as [opaque responses](https://developer.chrome.com/docs/workbox/caching-resources-during-runtime/#opaque-responses).\n * Opaque responses are are cross-origin requests where the response doesn't\n * support [CORS](https://enable-cors.org/).\n *\n * If the network request fails, and there is no cache match, this will throw\n * a `WorkboxError` exception.\n *\n * @extends workbox-strategies.Strategy\n * @memberof workbox-strategies\n */\nclass NetworkFirst extends Strategy {\n    /**\n     * @param {Object} [options]\n     * @param {string} [options.cacheName] Cache name to store and retrieve\n     * requests. Defaults to cache names provided by\n     * {@link workbox-core.cacheNames}.\n     * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n     * to use in conjunction with this caching strategy.\n     * @param {Object} [options.fetchOptions] Values passed along to the\n     * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\n     * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\n     * `fetch()` requests made by this strategy.\n     * @param {Object} [options.matchOptions] [`CacheQueryOptions`](https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions)\n     * @param {number} [options.networkTimeoutSeconds] If set, any network requests\n     * that fail to respond within the timeout will fallback to the cache.\n     *\n     * This option can be used to combat\n     * \"[lie-fi]{@link https://developers.google.com/web/fundamentals/performance/poor-connectivity/#lie-fi}\"\n     * scenarios.\n     */\n    constructor(options = {}) {\n        super(options);\n        // If this instance contains no plugins with a 'cacheWillUpdate' callback,\n        // prepend the `cacheOkAndOpaquePlugin` plugin to the plugins list.\n        if (!this.plugins.some((p) => 'cacheWillUpdate' in p)) {\n            this.plugins.unshift(cacheOkAndOpaquePlugin);\n        }\n        this._networkTimeoutSeconds = options.networkTimeoutSeconds || 0;\n        if (process.env.NODE_ENV !== 'production') {\n            if (this._networkTimeoutSeconds) {\n                assert.isType(this._networkTimeoutSeconds, 'number', {\n                    moduleName: 'workbox-strategies',\n                    className: this.constructor.name,\n                    funcName: 'constructor',\n                    paramName: 'networkTimeoutSeconds',\n                });\n            }\n        }\n    }\n    /**\n     * @private\n     * @param {Request|string} request A request to run this strategy for.\n     * @param {workbox-strategies.StrategyHandler} handler The event that\n     *     triggered the request.\n     * @return {Promise<Response>}\n     */\n    async _handle(request, handler) {\n        const logs = [];\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isInstance(request, Request, {\n                moduleName: 'workbox-strategies',\n                className: this.constructor.name,\n                funcName: 'handle',\n                paramName: 'makeRequest',\n            });\n        }\n        const promises = [];\n        let timeoutId;\n        if (this._networkTimeoutSeconds) {\n            const { id, promise } = this._getTimeoutPromise({ request, logs, handler });\n            timeoutId = id;\n            promises.push(promise);\n        }\n        const networkPromise = this._getNetworkPromise({\n            timeoutId,\n            request,\n            logs,\n            handler,\n        });\n        promises.push(networkPromise);\n        const response = await handler.waitUntil((async () => {\n            // Promise.race() will resolve as soon as the first promise resolves.\n            return ((await handler.waitUntil(Promise.race(promises))) ||\n                // If Promise.race() resolved with null, it might be due to a network\n                // timeout + a cache miss. If that were to happen, we'd rather wait until\n                // the networkPromise resolves instead of returning null.\n                // Note that it's fine to await an already-resolved promise, so we don't\n                // have to check to see if it's still \"in flight\".\n                (await networkPromise));\n        })());\n        if (process.env.NODE_ENV !== 'production') {\n            logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\n            for (const log of logs) {\n                logger.log(log);\n            }\n            messages.printFinalResponse(response);\n            logger.groupEnd();\n        }\n        if (!response) {\n            throw new WorkboxError('no-response', { url: request.url });\n        }\n        return response;\n    }\n    /**\n     * @param {Object} options\n     * @param {Request} options.request\n     * @param {Array} options.logs A reference to the logs array\n     * @param {Event} options.event\n     * @return {Promise<Response>}\n     *\n     * @private\n     */\n    _getTimeoutPromise({ request, logs, handler, }) {\n        let timeoutId;\n        const timeoutPromise = new Promise((resolve) => {\n            const onNetworkTimeout = async () => {\n                if (process.env.NODE_ENV !== 'production') {\n                    logs.push(`Timing out the network response at ` +\n                        `${this._networkTimeoutSeconds} seconds.`);\n                }\n                resolve(await handler.cacheMatch(request));\n            };\n            timeoutId = setTimeout(onNetworkTimeout, this._networkTimeoutSeconds * 1000);\n        });\n        return {\n            promise: timeoutPromise,\n            id: timeoutId,\n        };\n    }\n    /**\n     * @param {Object} options\n     * @param {number|undefined} options.timeoutId\n     * @param {Request} options.request\n     * @param {Array} options.logs A reference to the logs Array.\n     * @param {Event} options.event\n     * @return {Promise<Response>}\n     *\n     * @private\n     */\n    async _getNetworkPromise({ timeoutId, request, logs, handler, }) {\n        let error;\n        let response;\n        try {\n            response = await handler.fetchAndCachePut(request);\n        }\n        catch (fetchError) {\n            if (fetchError instanceof Error) {\n                error = fetchError;\n            }\n        }\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n        }\n        if (process.env.NODE_ENV !== 'production') {\n            if (response) {\n                logs.push(`Got response from network.`);\n            }\n            else {\n                logs.push(`Unable to get a response from the network. Will respond ` +\n                    `with a cached response.`);\n            }\n        }\n        if (error || !response) {\n            response = await handler.cacheMatch(request);\n            if (process.env.NODE_ENV !== 'production') {\n                if (response) {\n                    logs.push(`Found a cached response in the '${this.cacheName}'` + ` cache.`);\n                }\n                else {\n                    logs.push(`No response found in the '${this.cacheName}' cache.`);\n                }\n            }\n        }\n        return response;\n    }\n}\nexport { NetworkFirst };\n","/*\n  Copyright 2018 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport { assert } from 'workbox-core/_private/assert.js';\nimport { logger } from 'workbox-core/_private/logger.js';\nimport { timeout } from 'workbox-core/_private/timeout.js';\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\nimport { Strategy } from './Strategy.js';\nimport { messages } from './utils/messages.js';\nimport './_version.js';\n/**\n * An implementation of a\n * [network-only](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#network-only)\n * request strategy.\n *\n * This class is useful if you want to take advantage of any\n * [Workbox plugins](https://developer.chrome.com/docs/workbox/using-plugins/).\n *\n * If the network request fails, this will throw a `WorkboxError` exception.\n *\n * @extends workbox-strategies.Strategy\n * @memberof workbox-strategies\n */\nclass NetworkOnly extends Strategy {\n    /**\n     * @param {Object} [options]\n     * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n     * to use in conjunction with this caching strategy.\n     * @param {Object} [options.fetchOptions] Values passed along to the\n     * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\n     * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\n     * `fetch()` requests made by this strategy.\n     * @param {number} [options.networkTimeoutSeconds] If set, any network requests\n     * that fail to respond within the timeout will result in a network error.\n     */\n    constructor(options = {}) {\n        super(options);\n        this._networkTimeoutSeconds = options.networkTimeoutSeconds || 0;\n    }\n    /**\n     * @private\n     * @param {Request|string} request A request to run this strategy for.\n     * @param {workbox-strategies.StrategyHandler} handler The event that\n     *     triggered the request.\n     * @return {Promise<Response>}\n     */\n    async _handle(request, handler) {\n        if (process.env.NODE_ENV !== 'production') {\n            assert.isInstance(request, Request, {\n                moduleName: 'workbox-strategies',\n                className: this.constructor.name,\n                funcName: '_handle',\n                paramName: 'request',\n            });\n        }\n        let error = undefined;\n        let response;\n        try {\n            const promises = [\n                handler.fetch(request),\n            ];\n            if (this._networkTimeoutSeconds) {\n                const timeoutPromise = timeout(this._networkTimeoutSeconds * 1000);\n                promises.push(timeoutPromise);\n            }\n            response = await Promise.race(promises);\n            if (!response) {\n                throw new Error(`Timed out the network response after ` +\n                    `${this._networkTimeoutSeconds} seconds.`);\n            }\n        }\n        catch (err) {\n            if (err instanceof Error) {\n                error = err;\n            }\n        }\n        if (process.env.NODE_ENV !== 'production') {\n            logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\n            if (response) {\n                logger.log(`Got response from network.`);\n            }\n            else {\n                logger.log(`Unable to get a response from the network.`);\n            }\n            messages.printFinalResponse(response);\n            logger.groupEnd();\n        }\n        if (!response) {\n            throw new WorkboxError('no-response', { url: request.url, error });\n        }\n        return response;\n    }\n}\nexport { NetworkOnly };\n","/*\n  Copyright 2019 Google LLC\n\n  Use of this source code is governed by an MIT-style\n  license that can be found in the LICENSE file or at\n  https://opensource.org/licenses/MIT.\n*/\nimport './_version.js';\n/**\n * Claim any currently available clients once the service worker\n * becomes active. This is normally used in conjunction with `skipWaiting()`.\n *\n * @memberof workbox-core\n */\nfunction clientsClaim() {\n    self.addEventListener('activate', () => self.clients.claim());\n}\nexport { clientsClaim };\n"],"names":["self","_","e","logger","globalThis","__WB_DISABLE_DEV_LOGS","inGroup","methodToColorMap","debug","log","warn","error","groupCollapsed","groupEnd","print","method","args","test","navigator","userAgent","console","styles","logPrefix","join","api","loggerMethods","Object","keys","key","messages","invalid-value","paramName","validValueDescription","value","Error","JSON","stringify","not-an-array","moduleName","className","funcName","incorrect-type","expectedType","classNameStr","incorrect-class","expectedClassName","isReturnValueProblem","missing-a-method","expectedMethod","add-to-cache-list-unexpected-type","entry","add-to-cache-list-conflicting-entries","firstEntry","secondEntry","plugin-error-request-will-fetch","thrownErrorMessage","invalid-cache-name","cacheNameId","unregister-route-but-not-found-with-method","unregister-route-route-not-registered","queue-replay-failed","name","duplicate-queue-name","expired-test-without-max-age","methodName","unsupported-route-type","not-array-of-class","expectedClass","max-entries-or-age-required","statuses-or-headers-required","invalid-string","channel-name-required","invalid-responses-are-same-args","expire-custom-caches-only","unit-must-be-bytes","normalizedRangeHeader","single-range-only","invalid-range-values","no-range-header","range-not-satisfiable","size","start","end","attempt-to-cache-non-get-request","url","cache-put-with-no-response","no-response","message","bad-precaching-response","status","non-precached-url","add-to-cache-list-conflicting-integrities","missing-precache-entry","cacheName","cross-origin-copy-response","origin","opaque-streams-source","type","generatorFunction","code","details","messageGenerator","WorkboxError","constructor","errorCode","isArray","Array","hasMethod","object","isType","isInstance","isOneOf","validValues","includes","isArrayOfClass","item","finalAssertExports","defaultMethod","validMethods","normalizeHandler","handler","assert","handle","Route","match","setCatchHandler","catchHandler","RegExpRoute","regExp","RegExp","result","exec","href","location","index","toString","slice","getFriendlyURL","urlObj","URL","String","replace","Router","_routes","Map","_defaultHandlerMap","routes","addFetchListener","addEventListener","event","request","responsePromise","handleRequest","respondWith","addCacheListener","data","payload","urlsToCache","requestPromises","Promise","all","map","Request","waitUntil","ports","then","postMessage","protocol","startsWith","sameOrigin","params","route","findMatchingRoute","debugMessages","push","has","get","forEach","msg","err","reject","_catchHandler","catch","catchErr","matchResult","length","undefined","setDefaultHandler","set","registerRoute","unregisterRoute","routeIndex","indexOf","splice","defaultRouter","getOrCreateDefaultRouter","capture","captureUrl","valueToCheck","pathname","wildcards","matchCallback","cacheOkAndOpaquePlugin","cacheWillUpdate","response","_cacheNameDetails","googleAnalytics","precache","prefix","runtime","suffix","registration","scope","_createCacheName","filter","eachCacheNameDetail","fn","cacheNames","updateDetails","getGoogleAnalyticsName","userCacheName","getPrecacheName","getPrefix","getRuntimeName","getSuffix","stripParams","fullURL","ignoreParams","strippedURL","param","searchParams","delete","cacheMatchIgnoreParams","cache","matchOptions","strippedRequestURL","keysOptions","assign","ignoreSearch","cacheKeys","cacheKey","strippedCacheKeyURL","Deferred","promise","resolve","quotaErrorCallbacks","Set","executeQuotaErrorCallbacks","callback","timeout","ms","setTimeout","toRequest","input","StrategyHandler","strategy","options","_cacheKeys","ExtendableEvent","_strategy","_handlerDeferred","_extendLifetimePromises","_plugins","plugins","_pluginStateMap","plugin","fetch","mode","FetchEvent","preloadResponse","possiblePreloadResponse","originalRequest","hasCallback","clone","cb","iterateCallbacks","pluginFilteredRequest","fetchResponse","fetchOptions","runCallbacks","fetchAndCachePut","responseClone","cachePut","cacheMatch","cachedResponse","effectiveRequest","getCacheKey","multiMatchOptions","caches","vary","headers","responseToCache","_ensureResponseSafeToCache","open","hasCacheUpdateCallback","oldResponse","put","newResponse","state","statefulCallback","statefulParam","doneWaiting","shift","destroy","pluginsUsed","Strategy","responseDone","handleAll","_getResponse","handlerDone","_awaitComplete","_handle","waitUntilError","strategyStart","strategyName","printFinalResponse","NetworkFirst","some","p","unshift","_networkTimeoutSeconds","networkTimeoutSeconds","logs","promises","timeoutId","id","_getTimeoutPromise","networkPromise","_getNetworkPromise","race","timeoutPromise","onNetworkTimeout","fetchError","clearTimeout","NetworkOnly","clientsClaim","clients","claim"],"mappings":"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"}

================
File: README.md
================
# Pan Da Pan - NFT Gaming Platform

Next generation frontend tooling with Vite. It's fast!

## Quick Start

1. Clone the repository
2. Install dependencies:
```bash
npm install
```
3. Start development server:
```bash
npm run dev
```

## Firebase Setup

### 1. Install Firebase CLI
```bash
npm install -g firebase-tools
```

### 2. Login to Firebase
```bash
firebase login
```

### 3. Initialize Firebase Project
```bash
firebase init
```

Select the following options:
- Firestore
- Hosting
- Storage (optional)
- Emulators (recommended for local development)

### 4. Configure Firebase

Create a `.env` file in the root directory:
```env
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_auth_domain
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_storage_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
```

### 5. Deploy to Firebase

Build the project:
```bash
npm run build
```

Deploy to Firebase:
```bash
firebase deploy
```

To deploy only specific features:
```bash
# Deploy only hosting
firebase deploy --only hosting

# Deploy only firestore rules
firebase deploy --only firestore:rules

# Deploy only storage rules
firebase deploy --only storage
```

## Development

### Local Development with Emulators

1. Start Firebase emulators:
```bash
firebase emulators:start
```

2. Start development server:
```bash
npm run dev
```

### Testing

Run tests:
```bash
npm run test
```

### Linting

Run ESLint:
```bash
npm run lint
```

## Project Structure

```
src/
├── components/     # React components
├── config/        # Configuration files
├── contexts/      # React contexts
├── hooks/         # Custom React hooks
├── services/      # Service layer
├── types/         # TypeScript types
└── utils/         # Utility functions
```

## Database Schema

### Firestore Collections

1. Users Collection:
```typescript
interface User {
  wallet: string;            // Primary key
  username: string | null;
  experience: number;
  level: number;
  questsCompleted: number;
  raidBossesDefeated: number;
  lastQuestCompletionTime: number;
  guild: string | null;
  archetype: string | null;
  inventory: string[];
  sessionKey?: string;
}
```

2. Quests Collection:
```typescript
interface Quest {
  id: string;
  type: 'daily' | 'weekly' | 'monthly';
  description: string;
  xpReward: number;
  dateCreated: number;
  dateExpires: number;
  status: 'available' | 'completed' | 'expired';
  completedBy: string[];
}
```

3. Guilds Collection:
```typescript
interface Guild {
  id: string;
  name: string;
  description: string;
  members: string[];
  leaders: string[];
  totalXp: number;
  dateCreated: number;
  archetype: string;
}
```

## Security Rules

Update Firestore security rules in `firestore.rules`:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // User profiles
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth.uid == userId;
    }
    
    // Quests
    match /quests/{questId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Guilds
    match /guilds/{guildId} {
      allow read: if true;
      allow write: if request.auth != null 
        && (resource == null 
            || resource.data.leaders.hasAny([request.auth.uid]));
    }
  }
}
```

## Environment Variables

Required environment variables:

```env
# Firebase
VITE_FIREBASE_API_KEY=
VITE_FIREBASE_AUTH_DOMAIN=
VITE_FIREBASE_PROJECT_ID=
VITE_FIREBASE_STORAGE_BUCKET=
VITE_FIREBASE_MESSAGING_SENDER_ID=
VITE_FIREBASE_APP_ID=

# Solana
VITE_SOLANA_RPC_URL=
VITE_SOLANA_NETWORK=

# Helius (Transaction Relayer)
VITE_HELIUS_API_KEY=
```

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the LICENSE file for details

================
File: restart-dev.bat
================
@echo off
echo Stopping any running Vite processes...
taskkill /F /IM node.exe /FI "WINDOWTITLE eq vite"
timeout /t 2 /nobreak > nul

echo Clearing Vite cache...
rd /s /q "node_modules/.vite" 2>nul

echo Starting development server...
npm run dev

================
File: scripts/create_tables.sql
================
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create users table
CREATE TABLE IF NOT EXISTS users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    wallet_address TEXT UNIQUE NOT NULL,
    username TEXT UNIQUE,
    level INTEGER DEFAULT 1,
    experience INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Create raids table
CREATE TABLE IF NOT EXISTS raids (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    description TEXT,
    min_level INTEGER DEFAULT 1,
    max_players INTEGER NOT NULL,
    rewards JSONB,
    status TEXT DEFAULT 'active',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Create raid_participants table
CREATE TABLE IF NOT EXISTS raid_participants (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    raid_id UUID REFERENCES raids(id) ON DELETE CASCADE,
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    is_creator BOOLEAN DEFAULT FALSE,
    joined_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(raid_id, user_id)
);

-- Create items table
CREATE TABLE IF NOT EXISTS items (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    description TEXT,
    type TEXT NOT NULL,
    rarity TEXT NOT NULL,
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Create user_items table (inventory)
CREATE TABLE IF NOT EXISTS user_items (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    item_id UUID REFERENCES items(id) ON DELETE CASCADE,
    quantity INTEGER DEFAULT 1,
    acquired_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, item_id)
);

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_users_wallet_address ON users(wallet_address);
CREATE INDEX IF NOT EXISTS idx_raids_status ON raids(status);
CREATE INDEX IF NOT EXISTS idx_raid_participants_raid_id ON raid_participants(raid_id);
CREATE INDEX IF NOT EXISTS idx_raid_participants_user_id ON raid_participants(user_id);
CREATE INDEX IF NOT EXISTS idx_user_items_user_id ON user_items(user_id);
CREATE INDEX IF NOT EXISTS idx_user_items_item_id ON user_items(item_id);

-- Create updated_at trigger function
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- Create triggers for updated_at
CREATE TRIGGER update_users_updated_at
    BEFORE UPDATE ON users
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_raids_updated_at
    BEFORE UPDATE ON raids
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- Add Row Level Security (RLS) policies
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE raids ENABLE ROW LEVEL SECURITY;
ALTER TABLE raid_participants ENABLE ROW LEVEL SECURITY;
ALTER TABLE items ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_items ENABLE ROW LEVEL SECURITY;

-- Users policies
CREATE POLICY users_select ON users
    FOR SELECT
    USING (true);

CREATE POLICY users_insert ON users
    FOR INSERT
    WITH CHECK (auth.uid()::text = wallet_address);

CREATE POLICY users_update ON users
    FOR UPDATE
    USING (auth.uid()::text = wallet_address)
    WITH CHECK (auth.uid()::text = wallet_address);

-- Raids policies
CREATE POLICY raids_select ON raids
    FOR SELECT
    USING (true);

CREATE POLICY raids_insert ON raids
    FOR INSERT
    WITH CHECK (EXISTS (
        SELECT 1 FROM users
        WHERE wallet_address = auth.uid()::text
        AND level >= min_level
    ));

CREATE POLICY raids_update ON raids
    FOR UPDATE
    USING (EXISTS (
        SELECT 1 FROM raid_participants
        WHERE raid_id = raids.id
        AND user_id = (SELECT id FROM users WHERE wallet_address = auth.uid()::text)
        AND is_creator = true
    ));

-- Raid participants policies
CREATE POLICY raid_participants_select ON raid_participants
    FOR SELECT
    USING (true);

CREATE POLICY raid_participants_insert ON raid_participants
    FOR INSERT
    WITH CHECK (
        EXISTS (
            SELECT 1 FROM users
            WHERE wallet_address = auth.uid()::text
            AND id = user_id
        )
    );

-- Items policies
CREATE POLICY items_select ON items
    FOR SELECT
    USING (true);

CREATE POLICY items_insert ON items
    FOR INSERT
    WITH CHECK (
        EXISTS (
            SELECT 1 FROM users
            WHERE wallet_address = auth.uid()::text
            AND level >= 10  -- Require level 10 to create items
        )
    );

-- User items policies
CREATE POLICY user_items_select ON user_items
    FOR SELECT
    USING (
        user_id IN (
            SELECT id FROM users
            WHERE wallet_address = auth.uid()::text
        )
    );

CREATE POLICY user_items_insert ON user_items
    FOR INSERT
    WITH CHECK (
        user_id IN (
            SELECT id FROM users
            WHERE wallet_address = auth.uid()::text
        )
    );

CREATE POLICY user_items_update ON user_items
    FOR UPDATE
    USING (
        user_id IN (
            SELECT id FROM users
            WHERE wallet_address = auth.uid()::text
        )
    );

================
File: SETUP.md
================
# Pan Da Pan Setup Guide

## Quick Start

1. Clone the repository
2. Install dependencies: `npm install`
3. Configure environment variables (see below)
4. Start development server: `npm run dev`

## Environment Setup

Create a `.env` file in the root directory:

```env
# Firebase Configuration
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_auth_domain
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_storage_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
VITE_FIREBASE_MEASUREMENT_ID=your_measurement_id

# Solana Configuration
VITE_SOLANA_RPC_URL=your_rpc_url
VITE_SOLANA_NETWORK=mainnet-beta

# Helius Configuration (Transaction Relayer)
VITE_HELIUS_API_KEY=your_helius_api_key
```

## Firebase Setup

### 1. Create Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Click "Add Project"
3. Follow the setup wizard
4. Enable Google Analytics (optional)

### 2. Configure Authentication

1. In Firebase Console, go to Authentication
2. Click "Get Started"
3. Enable the following providers:
   - Anonymous (for guest access)
   - Custom Authentication (for wallet sign-in)

### 3. Set Up Firestore Database

1. Go to Firestore Database
2. Click "Create Database"
3. Choose production or test mode
4. Select a location

### 4. Create Collections

Set up the following collections with their respective schemas:

#### Users Collection
```typescript
interface User {
  wallet: string;            // Primary key
  username: string | null;   // Optional username
  handle: string | null;     // Social media handle
  profilePicture: string | null;
  experience: number;
  dateJoined: number;
  questsCompleted: number;
  raidBossesDefeated: number;
  lastQuestCompletionTime: number;
  showWallet: boolean;
  guild: string | null;      // Guild ID
  archetype: string | null;  // Player archetype
  discordHandle: string | null;
  sessionKey?: string;       // For guest accounts
}
```

#### Quests Collection
```typescript
interface Quest {
  id: string;
  type: 'daily' | 'weekly' | 'monthly' | 'raid-boss';
  title: string;
  description: string;
  xpReward: number;
  dateCreated: Timestamp;
  dateAvailable: Timestamp;
  dateExpires: Timestamp;
  status: 'available' | 'completed' | 'expired';
  completedBy: string[];
  isAutomatic?: boolean;
  imageUrl?: string;
  questUrl?: string;
}
```

#### Guilds Collection
```typescript
interface Guild {
  id: string;
  name: string;
  description: string;
  imageUrl?: string;
  members: string[];
  leaders: string[];
  totalXp: number;
  dateCreated: Timestamp;
  archetype: GuildArchetype;
  isCore: boolean;
  bank?: {
    address: string;
    balance: number;
    weeklyReward: number;
    lastRewardDate: Timestamp;
  };
}
```

#### Raids Collection
```typescript
interface Raid {
  id: string;
  boss: {
    id: string;
    name: string;
    level: number;
    health: number;
    maxHealth: number;
    defense: number;
    imageUrl: string;
    description: string;
    quests: RaidQuest[];
    rewards: {
      xp: number;
      bonusXp: number;
    };
  };
  participants: RaidParticipant[];
  startTime: Timestamp;
  endTime: Timestamp;
  status: 'preparing' | 'active' | 'completed' | 'failed';
  questCompletions: number;
}
```

### 5. Set Up Firestore Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    function isAdmin() {
      return isAuthenticated() && exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }

    // User profiles
    match /users/{userId} {
      allow read: if true;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId) || isAdmin();
      allow delete: if isAdmin();
    }

    // Quests
    match /quests/{questId} {
      allow read: if true;
      allow create, update, delete: if isAdmin();

      match /submissions/{submissionId} {
        allow read: if true;
        allow create: if isAuthenticated();
        allow update, delete: if isAdmin();
      }
    }

    // Guilds
    match /guilds/{guildId} {
      allow read: if true;
      allow create: if isAuthenticated();
      allow update: if request.auth.uid in resource.data.leaders || isAdmin();
      allow delete: if isAdmin();
    }

    // Raids
    match /raids/{raidId} {
      allow read: if true;
      allow create: if isAdmin();
      allow update: if isAuthenticated();
      allow delete: if isAdmin();
    }
  }
}
```

### 6. Create Indexes

Create the following composite indexes:

1. Users collection:
   - Fields: guild (Ascending) + experience (Descending)
   - Query scope: Collection

2. Quests collection:
   - Fields: type (Ascending) + status (Ascending) + dateExpires (Ascending)
   - Query scope: Collection

3. Raids collection:
   - Fields: status (Ascending) + startTime (Descending)
   - Query scope: Collection

4. Guilds collection:
   - Fields: isCore (Ascending) + totalXp (Descending)
   - Query scope: Collection

## Development Mode

The development server will start at `http://localhost:5173`. The page will automatically reload if you make changes to the code.

## Production Build

To create a production build:

1. Run the build command:
```bash
npm run build
```

2. The built files will be in the `dist` directory

3. To preview the production build:
```bash
npm run preview

================
File: src/App.tsx
================
import { FC, useEffect } from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { WalletContextProvider } from './components/WalletContextProvider';
import { AudioProvider } from './contexts/AudioContext';
import { ThemeProvider } from './contexts/ThemeContext';
import { AuthProvider } from './contexts/AuthContext';
import { ErrorBoundary } from './components/ErrorBoundary';
import { ScrollToTop } from './components/ScrollToTop';
import { Header } from './components/Header';
import { Footer } from './components/Footer';
import { FloatingControls } from './components/FloatingControls';
import { useScrollEffect } from './hooks/useScrollEffect';
import { checkEnvVariables } from './utils/env';

// Route components
import { HomePage } from './components/HomePage/HomePage';
import { Gallery } from './components/Gallery';
import { Info } from './components/InfoPage/Info';
import { Settings } from './components/Settings';
import { Raid } from './components/Raid';
import { NFTBuilder } from './components/NFTBuilder';
import { AdminPanel } from './components/Admin';
import { RaidLeaderboards } from './components/RaidLeaderboards';
import { Guild } from './components/Guild';
import { RaidProfile } from './components/RaidProfile';
import { Marketplace } from './components/Marketplace';

import '@solana/wallet-adapter-react-ui/styles.css';

const AppContent: FC = () => {
  const { getParallaxStyle } = useScrollEffect();

  return (
    <div className="min-h-screen bg-gradient-to-b from-sand-50 to-sand-100 dark:from-background-900 dark:to-background-950">
      
      {/* Background Effects */}
      <div className="fixed inset-0 pointer-events-none">
        {/* Grid Pattern */}
        <div className="absolute inset-0 opacity-30 dark:opacity-30
          [background-image:linear-gradient(rgba(249,115,22,0.3)_1px,transparent_1px),linear-gradient(to_right,rgba(249,115,22,0.3)_1px,transparent_1px)]
          dark:[background-image:linear-gradient(rgba(249,115,22,0.5)_1px,transparent_1px),linear-gradient(to_right,rgba(249,115,22,0.5)_1px,transparent_1px)]
          [background-size:50px_50px]
          [filter:drop-shadow(0_0_10px_rgba(249,115,22,0.2))]
          dark:[filter:drop-shadow(0_0_15px_rgba(249,115,22,0.3))]"
          style={getParallaxStyle(0.02)}>
        </div>
      </div>

      {/* App Container */}
      <div className="relative flex flex-col min-h-screen pt-[var(--header-height)] bg-white/30 dark:bg-black/30">
        <Header />
        <ScrollToTop />
        
        {/* Main Content Container */}
        <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-7xl">
          {/* Content box with glass effect */}
          <div className="glass-panel rounded-3xl overflow-hidden bg-white/15 dark:bg-black/15 backdrop-blur-sm 
               border border-primary-500/30 dark:border-primary-500/20
               shadow-[0_0_15px_rgba(249,115,22,0.1)] dark:shadow-[0_0_20px_rgba(249,115,22,0.15)]">
            <div className="section-background" />
            <div className="p-6 sm:p-8 relative z-10">
              <Routes>
                <Route path="/" element={<HomePage />} />
                <Route path="/gallery" element={<Gallery />} />
                <Route path="/info" element={<Info />} />
                <Route path="/settings" element={<Settings />} />
                <Route path="/raid" element={<Raid />} />
                <Route path="/nft-builder" element={<NFTBuilder />} />
                <Route path="/admin" element={<AdminPanel />} />
                <Route path="/leaderboards" element={<RaidLeaderboards />} />
                <Route path="/guild" element={<Guild />} />
                <Route path="/profile" element={<RaidProfile />} />
                <Route path="/marketplace" element={<Marketplace />} />
                <Route path="*" element={<Navigate to="/" replace />} />
              </Routes>
            </div>
          </div>
        </main>

        <Footer />
        <FloatingControls />
      </div>
    </div>
  );
};

export const App: FC = () => {
  useEffect(() => {
    // Check environment variables on app startup
    const envVars = checkEnvVariables();
    
    // Log environment status
    console.log('Environment Status:', {
      supabase: envVars.SUPABASE_URL && envVars.SUPABASE_KEY ? 'configured' : 'missing',
      solana: envVars.SOLANA_RPC && envVars.SOLANA_NETWORK ? 'configured' : 'missing',
      helius: envVars.HELIUS_API_KEY ? 'configured' : 'missing'
    });
  }, []);

  return (
    <ErrorBoundary>
      <WalletContextProvider>
        <AuthProvider>
          <ThemeProvider>
            <AudioProvider>
              <AppContent />
            </AudioProvider>
          </ThemeProvider>
        </AuthProvider>
      </WalletContextProvider>
    </ErrorBoundary>
  );
};

================
File: src/components/Admin/AddGuildModal.tsx
================
import { FC, useState, useRef } from 'react';
import { X, Upload } from 'lucide-react';
import { GuildArchetype } from '../../types/guild';
import { compressImage } from '../../utils/imageCompressor';

interface AddGuildModalProps {
  onClose: () => void;
  onSubmit: (formData: {
    name: string;
    description: string;
    imageUrl?: string;
    archetype: GuildArchetype;
  }) => void;
}

export const AddGuildModal: FC<AddGuildModalProps> = ({ onClose, onSubmit }) => {
  const [name, setName] = useState('');
  const [description, setDescription] = useState('');
  const [archetype, setArchetype] = useState<GuildArchetype>('Adventurer');
  const [imageUrl, setImageUrl] = useState<string>();
  const [error, setError] = useState('');
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleImageUpload = async (file: File) => {
    if (!file) return;

    try {
      const compressedImage = await compressImage(file);
      setImageUrl(compressedImage);
    } catch (error) {
      console.error('Error uploading image:', error);
      setError('Failed to upload image');
    }
  };

  const handleSubmit = () => {
    if (!name.trim()) {
      setError('Name is required');
      return;
    }

    if (!description.trim()) {
      setError('Description is required');
      return;
    }

    onSubmit({
      name: name.trim(),
      description: description.trim(),
      imageUrl,
      archetype
    });
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={onClose}
      />
      <div className="relative bg-[#1A1B23] rounded-xl border border-primary-main/20 p-6 max-w-md w-full">
        <div className="flex justify-between items-center mb-6">
          <h3 className="text-xl font-bold text-white">Create New Guild</h3>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-neutral-lightGray mb-2">
              Guild Name
            </label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
              placeholder="Enter guild name"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-neutral-lightGray mb-2">
              Description
            </label>
            <textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
              placeholder="Enter guild description"
              rows={3}
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-neutral-lightGray mb-2">
              Archetype
            </label>
            <select
              value={archetype}
              onChange={(e) => setArchetype(e.target.value as GuildArchetype)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
            >
              <option value="Adventurer">Adventurer</option>
              <option value="Finance">Finance</option>
              <option value="Philanthropist">Philanthropist</option>
              <option value="PartyAnimal">Party Animal</option>
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium text-neutral-lightGray mb-2">
              Guild Image
            </label>
            <div className="border-2 border-dashed border-primary-main/20 rounded-lg p-4">
              {imageUrl ? (
                <div className="space-y-4">
                  <img
                    src={imageUrl}
                    alt="Guild preview"
                    className="w-full h-48 object-cover rounded-lg"
                  />
                  <button
                    onClick={() => setImageUrl(undefined)}
                    className="text-red-400 hover:text-red-300 transition-colors text-sm"
                  >
                    Remove Image
                  </button>
                </div>
              ) : (
                <label className="cursor-pointer flex flex-col items-center">
                  <Upload className="w-8 h-8 text-primary-main mb-2" />
                  <span className="text-sm text-neutral-lightGray">
                    Click to upload or drag and drop
                  </span>
                  <input
                    ref={fileInputRef}
                    type="file"
                    className="hidden"
                    accept="image/*"
                    onChange={(e) => {
                      const file = e.target.files?.[0];
                      if (file) handleImageUpload(file);
                    }}
                  />
                </label>
              )}
            </div>
          </div>

          {error && (
            <p className="text-red-400 text-sm">{error}</p>
          )}

          <div className="flex justify-end gap-4 pt-4">
            <button
              onClick={onClose}
              className="px-4 py-2 text-neutral-lightGray hover:text-white transition-colors"
            >
              Cancel
            </button>
            <button
              onClick={handleSubmit}
              className="px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
            >
              Create Guild
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/Admin/GuildAdmin.tsx
================
import { FC, useState, useRef } from 'react';
import { Edit2, Save, X, Upload, Plus, Trash2, UserPlus } from 'lucide-react';
import { Guild, GuildArchetype } from '../../types/guild';
import { guildService } from '../../services/guildService';
import { useWallet } from '@solana/wallet-adapter-react';

const ADMIN_WALLET = "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

interface NewGuildForm {
  name: string;
  description: string;
  imageUrl?: string;
  archetype: GuildArchetype;
}

export const GuildAdmin: FC = () => {
  const { publicKey } = useWallet();
  const [editingGuildId, setEditingGuildId] = useState<string | null>(null);
  const [editForm, setEditForm] = useState<Partial<Guild>>({});
  const [showAddGuildModal, setShowAddGuildModal] = useState(false);
  const [newGuildForm, setNewGuildForm] = useState<NewGuildForm>({
    name: '',
    description: '',
    archetype: 'Adventurer'
  });
  const [showAddLeaderModal, setShowAddLeaderModal] = useState(false);
  const [selectedGuildId, setSelectedGuildId] = useState<string | null>(null);
  const [leaderWallet, setLeaderWallet] = useState('');
  const [successMessage, setSuccessMessage] = useState('');
  const [error, setError] = useState('');
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Check if current user is admin
  if (!publicKey || publicKey.toString() !== ADMIN_WALLET) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-white mb-4">Access Denied</h2>
          <p className="text-neutral-lightGray">
            Only the project admin can access guild administration.
          </p>
        </div>
      </div>
    );
  }

  const guilds = guildService.getCommunityGuilds() || [];

  const handleEdit = (guild: Guild) => {
    setEditingGuildId(guild.id);
    setEditForm(guild);
  };

  const handleSave = () => {
    if (!editingGuildId || !editForm) return;

    guildService.updateGuild(editingGuildId, editForm);
    setEditingGuildId(null);
    setEditForm({});
    showSuccessMessage('Guild updated successfully!');
  };

  const handleDelete = (guildId: string) => {
    if (confirm('Are you sure you want to delete this guild?')) {
      guildService.updateGuild(guildId, { isDeleted: true });
      showSuccessMessage('Guild deleted successfully!');
    }
  };

  const handleAddLeader = () => {
    if (!selectedGuildId || !leaderWallet) return;

    const guild = guildService.getGuildById(selectedGuildId);
    if (guild) {
      const updatedLeaders = [...(guild.leaders || []), leaderWallet];
      const success = guildService.updateGuild(selectedGuildId, { leaders: updatedLeaders });
      
      if (success) {
        showSuccessMessage('Guild leader added successfully!');
        setShowAddLeaderModal(false);
        setSelectedGuildId(null);
        setLeaderWallet('');
      } else {
        setError('Failed to add guild leader');
      }
    }
  };

  const handleImageUpload = async (file: File) => {
    if (!file) return;

    try {
      const reader = new FileReader();
      reader.onloadend = () => {
        const imageData = reader.result as string;
        if (editingGuildId) {
          setEditForm(prev => ({ ...prev, imageUrl: imageData }));
        } else {
          setNewGuildForm(prev => ({ ...prev, imageUrl: imageData }));
        }
      };
      reader.readAsDataURL(file);
    } catch (error) {
      console.error('Error uploading guild image:', error);
      setError('Failed to upload image');
    }
  };

  const handleAddGuild = () => {
    if (!newGuildForm.name || !newGuildForm.description) {
      setError('Name and description are required');
      return;
    }

    const newGuild = guildService.createGuild({
      name: newGuildForm.name,
      description: newGuildForm.description,
      imageUrl: newGuildForm.imageUrl,
      archetype: newGuildForm.archetype,
      leaders: [],
      isCore: false
    });

    if (newGuild) {
      setShowAddGuildModal(false);
      setNewGuildForm({
        name: '',
        description: '',
        archetype: 'Adventurer'
      });
      showSuccessMessage('Guild created successfully!');
    }
  };

  const showSuccessMessage = (message: string) => {
    setSuccessMessage(message);
    setTimeout(() => setSuccessMessage(''), 3000);
  };

  return (
    <div className="space-y-8">
      <div className="flex items-center justify-between">
        <h2 className="text-2xl font-bold text-white">Guild Administration</h2>
        <button
          onClick={() => setShowAddGuildModal(true)}
          className="flex items-center gap-2 px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
        >
          <Plus className="w-4 h-4" />
          Add New Guild
        </button>
      </div>

      <div className="grid grid-cols-1 gap-6">
        {guilds.map(guild => (
          <div
            key={guild.id}
            className="bg-black/40 backdrop-blur-sm rounded-xl p-6 border border-primary-main/20"
          >
            {editingGuildId === guild.id ? (
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                    Guild Name
                  </label>
                  <input
                    type="text"
                    value={editForm.name || ''}
                    onChange={e => setEditForm({ ...editForm, name: e.target.value })}
                    className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                    Description
                  </label>
                  <textarea
                    value={editForm.description || ''}
                    onChange={e => setEditForm({ ...editForm, description: e.target.value })}
                    className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
                    rows={3}
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                    Archetype
                  </label>
                  <select
                    value={editForm.archetype || 'Adventurer'}
                    onChange={e => setEditForm({ ...editForm, archetype: e.target.value as GuildArchetype })}
                    className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
                  >
                    <option value="Adventurer">Adventurer</option>
                    <option value="Finance">Finance</option>
                    <option value="Philanthropist">Philanthropist</option>
                    <option value="PartyAnimal">Party Animal</option>
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                    Guild Image
                  </label>
                  <div className="flex items-start gap-4">
                    <div className="w-24 h-24 rounded-lg overflow-hidden bg-black/40">
                      {editForm.imageUrl ? (
                        <img
                          src={editForm.imageUrl}
                          alt={editForm.name}
                          className="w-full h-full object-cover"
                        />
                      ) : (
                        <div className="w-full h-full flex items-center justify-center">
                          <Upload className="w-8 h-8 text-neutral-lightGray" />
                        </div>
                      )}
                    </div>
                    <input
                      ref={fileInputRef}
                      type="file"
                      accept="image/*"
                      className="hidden"
                      onChange={(e) => {
                        const file = e.target.files?.[0];
                        if (file) handleImageUpload(file);
                      }}
                    />
                    <button
                      onClick={() => fileInputRef.current?.click()}
                      className="px-4 py-2 bg-primary-main/20 text-primary-main rounded-lg hover:bg-primary-main/30 transition-colors"
                    >
                      Upload Image
                    </button>
                  </div>
                </div>

                <div className="flex justify-end gap-2">
                  <button
                    onClick={() => setEditingGuildId(null)}
                    className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
                  >
                    <X className="w-5 h-5" />
                  </button>
                  <button
                    onClick={handleSave}
                    className="p-2 text-primary-main hover:text-primary-main/80 transition-colors rounded-lg hover:bg-primary-main/10"
                  >
                    <Save className="w-5 h-5" />
                  </button>
                </div>
              </div>
            ) : (
              <div>
                <div className="flex justify-between items-start mb-4">
                  <div className="flex items-center gap-4">
                    <div className="w-12 h-12 rounded-lg overflow-hidden">
                      <img
                        src={guild.imageUrl}
                        alt={guild.name}
                        className="w-full h-full object-cover"
                      />
                    </div>
                    <div>
                      <h3 className="text-lg font-semibold text-white">{guild.name}</h3>
                      <p className="text-sm text-neutral-lightGray">
                        {guild.members?.length || 0} members
                      </p>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => {
                        setSelectedGuildId(guild.id);
                        setShowAddLeaderModal(true);
                      }}
                      className="p-2 text-primary-main hover:text-primary-main/80 transition-colors rounded-lg hover:bg-primary-main/10"
                      title="Add guild leader"
                    >
                      <UserPlus className="w-5 h-5" />
                    </button>
                    <button
                      onClick={() => handleEdit(guild)}
                      className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
                      title="Edit guild"
                    >
                      <Edit2 className="w-5 h-5" />
                    </button>
                    <button
                      onClick={() => handleDelete(guild.id)}
                      className="p-2 text-red-400 hover:text-red-300 transition-colors rounded-lg hover:bg-red-400/5"
                      title="Delete guild"
                    >
                      <Trash2 className="w-5 h-5" />
                    </button>
                  </div>
                </div>

                <p className="text-neutral-lightGray mb-4">
                  {guild.description}
                </p>

                {guild.leaders && guild.leaders.length > 0 && (
                  <div className="text-sm text-neutral-lightGray">
                    Leaders: {guild.leaders.map(leader => 
                      leader.slice(0, 4) + '...' + leader.slice(-4)
                    ).join(', ')}
                  </div>
                )}
              </div>
            )}
          </div>
        ))}
      </div>

      {/* Add Guild Modal */}
      {showAddGuildModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div 
            className="absolute inset-0 bg-black/80 backdrop-blur-sm"
            onClick={() => setShowAddGuildModal(false)}
          />
          <div className="relative bg-[#1A1B23] rounded-xl border border-primary-main/20 p-6 max-w-md w-full">
            <h3 className="text-xl font-bold text-white mb-4">Create New Guild</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                  Guild Name
                </label>
                <input
                  type="text"
                  value={newGuildForm.name}
                  onChange={(e) => setNewGuildForm({ ...newGuildForm, name: e.target.value })}
                  className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
                  placeholder="Enter guild name"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                  Description
                </label>
                <textarea
                  value={newGuildForm.description}
                  onChange={(e) => setNewGuildForm({ ...newGuildForm, description: e.target.value })}
                  className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
                  placeholder="Enter guild description"
                  rows={3}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                  Archetype
                </label>
                <select
                  value={newGuildForm.archetype}
                  onChange={(e) => setNewGuildForm({ ...newGuildForm, archetype: e.target.value as GuildArchetype })}
                  className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
                >
                  <option value="Adventurer">Adventurer</option>
                  <option value="Finance">Finance</option>
                  <option value="Philanthropist">Philanthropist</option>
                  <option value="PartyAnimal">Party Animal</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                  Guild Image
                </label>
                <div className="flex items-center gap-4">
                  <div className="w-24 h-24 rounded-lg overflow-hidden bg-black/40">
                    {newGuildForm.imageUrl ? (
                      <img
                        src={newGuildForm.imageUrl}
                        alt="New guild"
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <div className="w-full h-full flex items-center justify-center">
                        <Upload className="w-8 h-8 text-neutral-lightGray" />
                      </div>
                    )}
                  </div>
                  <input
                    type="file"
                    accept="image/*"
                    className="hidden"
                    onChange={(e) => {
                      const file = e.target.files?.[0];
                      if (file) handleImageUpload(file);
                    }}
                  />
                  <button
                    onClick={() => fileInputRef.current?.click()}
                    className="px-4 py-2 bg-primary-main/20 text-primary-main rounded-lg hover:bg-primary-main/30 transition-colors"
                  >
                    Upload Image
                  </button>
                </div>
              </div>

              {error && (
                <p className="text-red-400 text-sm">{error}</p>
              )}

              <div className="flex justify-end gap-4">
                <button
                  onClick={() => setShowAddGuildModal(false)}
                  className="px-4 py-2 text-neutral-lightGray hover:text-white transition-colors"
                >
                  Cancel
                </button>
                <button
                  onClick={handleAddGuild}
                  className="px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
                >
                  Create Guild
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Add Leader Modal */}
      {showAddLeaderModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div 
            className="absolute inset-0 bg-black/80 backdrop-blur-sm"
            onClick={() => setShowAddLeaderModal(false)}
          />
          <div className="relative bg-[#1A1B23] rounded-xl border border-primary-main/20 p-6 max-w-md w-full">
            <h3 className="text-xl font-bold text-white mb-4">Add Guild Leader</h3>
            <div className="space-y-4">
              <input
                type="text"
                value={leaderWallet}
                onChange={(e) => setLeaderWallet(e.target.value)}
                placeholder="Enter wallet address"
                className="w-full px-4 py-2 bg-black/40 border border-primary-main/20 rounded-lg text-white"
              />
              <div className="flex justify-end gap-2">
                <button
                  onClick={() => setShowAddLeaderModal(false)}
                  className="px-4 py-2 text-neutral-lightGray hover:text-white transition-colors"
                >
                  Cancel
                </button>
                <button
                  onClick={handleAddLeader}
                  className="px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
                >
                  Add Leader
                </button>
              </div>
            </div>
            {error && (
              <p className="mt-4 text-red-400 text-sm">{error}</p>
            )}
          </div>
        </div>
      )}

      {/* Success Message */}
      {successMessage && (
        <div className="fixed bottom-4 right-4 px-6 py-3 bg-green-500 text-white rounded-lg shadow-lg animate-fade-in">
          {successMessage}
        </div>
      )}
    </div>
  );
};

================
File: src/components/Admin/GuildImageUpload.tsx
================
import { FC, useRef } from 'react';
import { Upload } from 'lucide-react';
import { compressImage } from '../../utils/imageCompressor';

interface GuildImageUploadProps {
  currentImage?: string;
  onImageUpload: (imageData: string) => void;
}

export const GuildImageUpload: FC<GuildImageUploadProps> = ({ currentImage, onImageUpload }) => {
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleImageUpload = async (file: File) => {
    if (!file) return;

    try {
      const compressedImage = await compressImage(file);
      onImageUpload(compressedImage);
    } catch (error) {
      console.error('Error uploading image:', error);
    }
  };

  return (
    <div>
      <label className="block text-sm font-medium text-neutral-lightGray mb-2">
        Guild Image
      </label>
      <div className="flex items-center gap-4">
        <div className="w-24 h-24 rounded-lg overflow-hidden bg-black/40">
          {currentImage ? (
            <img
              src={currentImage}
              alt="Guild"
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full flex items-center justify-center">
              <Upload className="w-8 h-8 text-neutral-lightGray" />
            </div>
          )}
        </div>
        <input
          ref={fileInputRef}
          type="file"
          accept="image/*"
          className="hidden"
          onChange={(e) => {
            const file = e.target.files?.[0];
            if (file) handleImageUpload(file);
          }}
        />
        <button
          onClick={() => fileInputRef.current?.click()}
          className="px-4 py-2 bg-primary-main/20 text-primary-main rounded-lg hover:bg-primary-main/30 transition-colors"
        >
          Upload Image
        </button>
      </div>
    </div>
  );
}

================
File: src/components/Admin/index.tsx
================
import { FC, useState } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { QuestAdmin } from './QuestAdmin';
import { RaidAdmin } from './RaidAdmin';
import { GuildAdmin } from './GuildAdmin';
import { ScrollText, Sword, ClipboardList, Users } from 'lucide-react';
import { Link } from 'react-router-dom';

const ADMIN_WALLET = "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

type AdminTab = 'quests' | 'raids' | 'guilds';

interface AdminTabButtonProps {
  icon: typeof ScrollText;
  label: string;
  isActive: boolean;
  onClick: () => void;
}

const AdminTabButton: FC<AdminTabButtonProps> = ({ icon: Icon, label, isActive, onClick }) => (
  <button
    onClick={onClick}
    className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors ${
      isActive
        ? 'bg-primary-main text-white shadow-glow'
        : 'bg-primary-main/20 text-text-light-secondary dark:text-neutral-lightGray hover:bg-primary-main/30 hover:text-primary-main'
    }`}
  >
    <Icon className="w-5 h-5" />
    <span className="whitespace-nowrap">{label}</span>
  </button>
);

export const AdminPanel: FC = () => {
  const { publicKey } = useWallet();
  const [activeTab, setActiveTab] = useState<AdminTab>('quests');
  
  if (!publicKey || publicKey.toString() !== ADMIN_WALLET) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <h2 className="text-2xl font-title text-text-light-primary dark:text-white mb-4">Access Denied</h2>
          <p className="text-text-light-secondary dark:text-text-dark-secondary">
            You don't have permission to access this area.
          </p>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-6xl mx-auto space-y-8 px-4">
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <h1 className="text-2xl font-title text-text-light-primary dark:text-white">Admin Panel</h1>
        
        <div className="flex flex-wrap gap-2 w-full sm:w-auto">
          <Link
            to="/admin/subs"
            className="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-primary-main/20 text-text-light-secondary dark:text-neutral-lightGray hover:bg-primary-main/30 hover:text-primary-main transition-colors"
          >
            <ClipboardList className="w-5 h-5" />
            <span className="whitespace-nowrap">Submissions</span>
          </Link>

          <AdminTabButton
            icon={ScrollText}
            label="Quest Administration"
            isActive={activeTab === 'quests'}
            onClick={() => setActiveTab('quests')}
          />

          <AdminTabButton
            icon={Sword}
            label="Raid Administration"
            isActive={activeTab === 'raids'}
            onClick={() => setActiveTab('raids')}
          />

          <AdminTabButton
            icon={Users}
            label="Guild Administration"
            isActive={activeTab === 'guilds'}
            onClick={() => setActiveTab('guilds')}
          />
        </div>
      </div>

      <div className="gradient-box p-6">
        {activeTab === 'quests' && <QuestAdmin />}
        {activeTab === 'raids' && <RaidAdmin />}
        {activeTab === 'guilds' && <GuildAdmin />}
      </div>
    </div>
  );
};

================
File: src/components/Admin/QuestAdmin.tsx
================
import { FC, useState } from 'react';
import { Plus, Edit2 } from 'lucide-react';
import { QuestForm } from './QuestForm';
import { QuestList } from './QuestList';

export const QuestAdmin: FC = () => {
  const [activeView, setActiveView] = useState<'create' | 'edit'>('create');

  return (
    <div className="space-y-8">
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <h2 className="text-2xl font-bold text-white">Quest Administration</h2>
        <div className="flex flex-wrap gap-2 w-full sm:w-auto">
          <button
            onClick={() => setActiveView('create')}
            className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all ${
              activeView === 'create'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            <Plus className="w-4 h-4" />
            Add New Quest
          </button>
          <button
            onClick={() => setActiveView('edit')}
            className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all ${
              activeView === 'edit'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            <Edit2 className="w-4 h-4" />
            Edit Quests
          </button>
        </div>
      </div>

      <div className="gradient-box p-6">
        {activeView === 'create' ? (
          <QuestForm onSubmit={() => setActiveView('edit')} />
        ) : (
          <QuestList />
        )}
      </div>
    </div>
  );
};

================
File: src/components/Admin/QuestForm.tsx
================
import { FC, useState, useRef } from 'react';
import { Calendar, Clock, Trophy, Upload, X } from 'lucide-react';
import { Quest } from '../../types/quest';
import { questService } from '../../services/questService';

interface QuestFormProps {
  quest?: Quest;
  onSubmit?: (quest: Quest) => void;
  isEditing?: boolean;
}

export const QuestForm: FC<QuestFormProps> = ({ quest, onSubmit, isEditing }) => {
  const [type, setType] = useState<'daily' | 'weekly' | 'monthly'>(quest?.type || 'daily');
  const [description, setDescription] = useState(quest?.description || '');
  const [xpReward, setXpReward] = useState(quest?.xpReward.toString() || '100');
  const [error, setError] = useState('');
  const [imageUrl, setImageUrl] = useState(quest?.imageUrl || '');
  const [imagePreview, setImagePreview] = useState<string | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onloadend = () => {
      setImagePreview(reader.result as string);
    };
    reader.readAsDataURL(file);
  };

  const removeImage = () => {
    setImagePreview(null);
    setImageUrl('');
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const handleSubmit = () => {
    if (!description.trim()) {
      setError('Description is required');
      return;
    }

    if (!xpReward || isNaN(Number(xpReward)) || Number(xpReward) <= 0) {
      setError('Valid XP reward is required');
      return;
    }

    const questData = {
      id: quest?.id || '',
      type,
      description: description.trim(),
      xpReward: Number(xpReward),
      imageUrl: imagePreview || imageUrl || undefined,
      dateCreated: quest?.dateCreated || Date.now(),
      dateAvailable: Date.now(),
      dateExpires: Date.now() + (
        type === 'daily' ? 24 * 60 * 60 * 1000 :
        type === 'weekly' ? 7 * 24 * 60 * 60 * 1000 :
        30 * 24 * 60 * 60 * 1000
      ),
      status: 'available',
      completedBy: quest?.completedBy || []
    };

    if (isEditing && onSubmit) {
      onSubmit(questData as Quest);
    } else {
      const newQuest = questService.createQuest(questData);
      if (onSubmit) {
        onSubmit(newQuest);
      }
    }

    // Reset form if not editing
    if (!isEditing) {
      setDescription('');
      setXpReward('100');
      setError('');
      removeImage();
    }
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
      {/* Image Upload Section */}
      <div className="space-y-4">
        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Quest Image (Optional)
          </label>
          <div className="border-2 border-dashed border-primary-pink/20 rounded-lg p-4">
            {imagePreview || imageUrl ? (
              <div className="space-y-4">
                <img
                  src={imagePreview || imageUrl}
                  alt="Quest preview"
                  className="w-full h-48 object-cover rounded-lg"
                />
                <button
                  onClick={removeImage}
                  className="flex items-center gap-2 px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors"
                >
                  <X className="w-4 h-4" />
                  Remove Image
                </button>
              </div>
            ) : (
              <label className="cursor-pointer flex flex-col items-center">
                <Upload className="w-8 h-8 text-primary-pink mb-2" />
                <span className="text-sm text-gray-400">
                  Click to upload or drag and drop
                </span>
                <input
                  ref={fileInputRef}
                  type="file"
                  className="hidden"
                  accept="image/*"
                  onChange={handleImageUpload}
                />
              </label>
            )}
          </div>
        </div>
      </div>

      {/* Quest Details Section */}
      <div className="space-y-6">
        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Quest Type
          </label>
          <div className="flex gap-2">
            <button
              onClick={() => setType('daily')}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                type === 'daily'
                  ? 'bg-primary-pink text-white'
                  : 'text-gray-400 hover:bg-primary-pink/10 hover:text-primary-pink'
              }`}
            >
              <Clock className="w-4 h-4" />
              Daily
            </button>
            <button
              onClick={() => setType('weekly')}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                type === 'weekly'
                  ? 'bg-primary-pink text-white'
                  : 'text-gray-400 hover:bg-primary-pink/10 hover:text-primary-pink'
              }`}
            >
              <Calendar className="w-4 h-4" />
              Weekly
            </button>
            <button
              onClick={() => setType('monthly')}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                type === 'monthly'
                  ? 'bg-primary-pink text-white'
                  : 'text-gray-400 hover:bg-primary-pink/10 hover:text-primary-pink'
              }`}
            >
              <Trophy className="w-4 h-4" />
              Monthly
            </button>
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Description
          </label>
          <textarea
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40 min-h-[100px]"
            placeholder="Enter quest description..."
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            XP Reward
          </label>
          <input
            type="number"
            value={xpReward}
            onChange={(e) => setXpReward(e.target.value)}
            className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
            placeholder="Enter XP reward..."
          />
        </div>

        {error && (
          <p className="text-red-400 text-sm">{error}</p>
        )}

        <button
          onClick={handleSubmit}
          className="w-full px-4 py-2 bg-primary-pink text-white rounded-lg hover:bg-primary-pink/90 transition-colors"
        >
          {isEditing ? 'Update Quest' : 'Create Quest'}
        </button>
      </div>
    </div>
  );
};

================
File: src/components/Admin/QuestList.tsx
================
import { FC, useState, useEffect } from 'react';
import { Edit2, Trash2, Image as ImageIcon } from 'lucide-react';
import { Quest } from '../../types/quest';
import { QuestForm } from './QuestForm';
import { questService } from '../../services/questService';

export const QuestList: FC = () => {
  const [quests, setQuests] = useState<Quest[]>([]);
  const [editingQuest, setEditingQuest] = useState<Quest | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadQuests();
  }, []);

  const loadQuests = async () => {
    try {
      setLoading(true);
      setError(null);
      const fetchedQuests = await questService.getQuests();
      setQuests(Array.isArray(fetchedQuests) ? fetchedQuests : []);
    } catch (err) {
      setError('Failed to load quests. Please try again later.');
      console.error('Error loading quests:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (questId: string) => {
    try {
      if (await questService.deleteQuest(questId)) {
        await loadQuests();
      }
    } catch (err) {
      console.error('Error deleting quest:', err);
    }
  };

  const handleUpdateQuest = async (quest: Quest) => {
    try {
      if (await questService.updateQuest(quest.id, quest)) {
        await loadQuests();
        setEditingQuest(null);
      }
    } catch (err) {
      console.error('Error updating quest:', err);
    }
  };

  if (editingQuest) {
    return (
      <div>
        <button
          onClick={() => setEditingQuest(null)}
          className="text-neutral-lightGray hover:text-white mb-4 flex items-center gap-2"
        >
          ← Back to Quest List
        </button>
        <QuestForm 
          quest={editingQuest} 
          onSubmit={handleUpdateQuest}
          isEditing={true}
        />
      </div>
    );
  }

  if (loading) {
    return <div className="text-center py-4">Loading quests...</div>;
  }

  if (error) {
    return (
      <div className="text-red-500 bg-red-500/10 border border-red-500/20 rounded-lg p-4 mb-4">
        {error}
        <button 
          onClick={loadQuests}
          className="ml-4 text-sm underline hover:no-underline"
        >
          Try Again
        </button>
      </div>
    );
  }

  if (!quests.length) {
    return <div className="text-center py-4">No quests found.</div>;
  }

  return (
    <div className="space-y-4">
      {quests.map(quest => (
        <div
          key={quest.id}
          className="bg-black/40 rounded-lg overflow-hidden border border-primary-pink/20"
        >
          <div className="flex">
            {/* Quest Image */}
            <div className="w-48 h-32 bg-neutral-charcoal/40 flex-shrink-0">
              {quest.imageUrl ? (
                <img
                  src={quest.imageUrl}
                  alt={quest.description}
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center">
                  <ImageIcon className="w-8 h-8 text-neutral-lightGray/40" />
                </div>
              )}
            </div>

            {/* Quest Details */}
            <div className="flex-grow p-4">
              <div className="flex justify-between items-start">
                <div>
                  <h3 className="text-lg font-semibold text-white">{quest.title}</h3>
                  <p className="text-sm text-neutral-lightGray mt-1">{quest.description}</p>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => setEditingQuest(quest)}
                    className="p-2 text-neutral-lightGray hover:text-white transition-colors"
                  >
                    <Edit2 className="w-4 h-4" />
                  </button>
                  <button
                    onClick={() => handleDelete(quest.id)}
                    className="p-2 text-neutral-lightGray hover:text-red-500 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </div>
              <div className="mt-2 flex gap-4 text-sm">
                <span className="text-neutral-lightGray">Type: {quest.type}</span>
                <span className="text-neutral-lightGray">XP: {quest.xpReward}</span>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
};

================
File: src/components/Admin/RaidAdmin.tsx
================
import { FC, useState } from 'react';
import { Plus, Edit2 } from 'lucide-react';
import { RaidBossForm } from './RaidBossForm';
import { RaidBossList } from './RaidBossList';

export const RaidAdmin: FC = () => {
  const [activeView, setActiveView] = useState<'create' | 'edit'>('create');

  return (
    <div className="space-y-8">
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <h2 className="text-2xl font-bold text-white">Raid Boss Administration</h2>
        <div className="flex flex-wrap gap-2 w-full sm:w-auto">
          <button
            onClick={() => setActiveView('create')}
            className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all ${
              activeView === 'create'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            <Plus className="w-4 h-4" />
            Create Raid Boss
          </button>
          <button
            onClick={() => setActiveView('edit')}
            className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all ${
              activeView === 'edit'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            <Edit2 className="w-4 h-4" />
            Edit Raid Bosses
          </button>
        </div>
      </div>

      <div className="gradient-box p-6">
        {activeView === 'create' ? (
          <RaidBossForm onComplete={() => setActiveView('edit')} />
        ) : (
          <RaidBossList />
        )}
      </div>
    </div>
  );
};

================
File: src/components/Admin/RaidBossForm.tsx
================
import { FC, useState, useRef } from 'react';
import { Upload, X, Twitter, Plus, Trash2 } from 'lucide-react';
import { RaidState } from '../../types/raid';
import { raidService } from '../../services/raidService';

interface RaidQuest {
  description: string;
  xpReward: number;
}

interface RaidBossFormProps {
  raid?: RaidState;
  onComplete?: () => void;
}

export const RaidBossForm: FC<RaidBossFormProps> = ({ raid, onComplete }) => {
  const [name, setName] = useState(raid?.boss.name || '');
  const [description, setDescription] = useState(raid?.boss.description || '');
  const [twitterHandle, setTwitterHandle] = useState(raid?.boss.twitterHandle || '');
  const [baseHp, setBaseHp] = useState('1000');
  const [defense, setDefense] = useState(raid?.boss.defense?.toString() || '');
  const [xpReward, setXpReward] = useState(raid?.boss.rewards.xp.toString() || '1000');
  const [bonusXp, setBonusXp] = useState(raid?.boss.rewards.bonusXp?.toString() || '500');
  const [imagePreview, setImagePreview] = useState<string | null>(raid?.boss.imageUrl || null);
  const [quests, setQuests] = useState<RaidQuest[]>(raid?.boss.quests || []);
  const [error, setError] = useState('');
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onloadend = () => {
      setImagePreview(reader.result as string);
    };
    reader.readAsDataURL(file);
  };

  const removeImage = () => {
    setImagePreview(null);
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const addQuest = () => {
    setQuests([...quests, { description: '', xpReward: 100 }]);
  };

  const removeQuest = (index: number) => {
    setQuests(quests.filter((_, i) => i !== index));
  };

  const updateQuest = (index: number, field: keyof RaidQuest, value: string | number) => {
    const updatedQuests = [...quests];
    updatedQuests[index] = {
      ...updatedQuests[index],
      [field]: value
    };
    setQuests(updatedQuests);
  };

  const handleSubmit = () => {
    // Validation
    if (!name.trim()) {
      setError('Name is required');
      return;
    }

    if (!description.trim()) {
      setError('Description is required');
      return;
    }

    if (!baseHp || isNaN(Number(baseHp)) || Number(baseHp) <= 0) {
      setError('Valid base HP value is required');
      return;
    }

    if (defense && (isNaN(Number(defense)) || Number(defense) < 0)) {
      setError('Defense value must be a positive number');
      return;
    }

    if (!xpReward || isNaN(Number(xpReward)) || Number(xpReward) <= 0) {
      setError('Valid XP reward is required');
      return;
    }

    if (quests.length === 0) {
      setError('At least one quest is required');
      return;
    }

    if (quests.some(q => !q.description.trim())) {
      setError('All quests must have a description');
      return;
    }

    // Create raid boss
    const raidBossData = {
      name: name.trim(),
      description: description.trim(),
      twitterHandle: twitterHandle.trim(),
      baseHp: Number(baseHp),
      defense: defense ? Number(defense) : 0,
      imageUrl: imagePreview || undefined,
      quests: quests.map((quest, index) => ({
        id: `${Date.now()}-${index}`,
        description: quest.description.trim(),
        xpReward: quest.xpReward,
        completedBy: []
      })),
      rewards: {
        xp: Number(xpReward),
        bonusXp: Number(bonusXp)
      }
    };

    try {
      if (raid) {
        raidService.updateRaidBoss(raid.id, raidBossData);
      } else {
        raidService.createRaidBoss(raidBossData);
      }
      
      if (onComplete) {
        onComplete();
      }
    } catch (err) {
      setError('Failed to save raid boss');
    }
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
      {/* Left Column - Image Upload and Quests */}
      <div className="space-y-6">
        {/* Image Upload */}
        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Raid Boss Image <span className="text-neutral-lightGray">(Optional)</span>
          </label>
          <div className="border-2 border-dashed border-primary-pink/20 rounded-lg p-4">
            {imagePreview ? (
              <div className="space-y-4">
                <img
                  src={imagePreview}
                  alt="Raid boss preview"
                  className="w-full h-48 object-cover rounded-lg"
                />
                <button
                  onClick={removeImage}
                  className="flex items-center gap-2 px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors"
                >
                  <X className="w-4 h-4" />
                  Remove Image
                </button>
              </div>
            ) : (
              <label className="cursor-pointer flex flex-col items-center">
                <Upload className="w-8 h-8 text-primary-pink mb-2" />
                <span className="text-sm text-gray-400">
                  Click to upload or drag and drop
                </span>
                <input
                  ref={fileInputRef}
                  type="file"
                  className="hidden"
                  accept="image/*"
                  onChange={handleImageUpload}
                />
              </label>
            )}
          </div>
        </div>

        {/* Quests Section */}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <label className="text-sm font-medium text-gray-200">
              Raid Boss Quests <span className="text-red-400">*</span>
            </label>
            <button
              onClick={addQuest}
              className="flex items-center gap-2 px-3 py-1 bg-primary-pink/20 text-primary-pink rounded-lg hover:bg-primary-pink/30 transition-colors"
            >
              <Plus className="w-4 h-4" />
              Add Quest
            </button>
          </div>

          <div className="space-y-4">
            {quests.map((quest, index) => (
              <div key={index} className="bg-black/40 rounded-lg p-4 border border-primary-pink/20">
                <div className="flex justify-between items-start mb-4">
                  <h4 className="text-white font-medium">Quest #{index + 1}</h4>
                  <button
                    onClick={() => removeQuest(index)}
                    className="p-1 text-red-400 hover:text-red-300 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm text-gray-300 mb-1">Description</label>
                    <textarea
                      value={quest.description}
                      onChange={(e) => updateQuest(index, 'description', e.target.value)}
                      className="w-full px-3 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
                      placeholder="Enter quest description..."
                      rows={2}
                    />
                  </div>

                  <div>
                    <label className="block text-sm text-gray-300 mb-1">XP Reward</label>
                    <input
                      type="number"
                      value={quest.xpReward}
                      onChange={(e) => updateQuest(index, 'xpReward', Number(e.target.value))}
                      className="w-full px-3 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
                      placeholder="Enter XP reward..."
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Right Column - Raid Boss Details */}
      <div className="space-y-6">
        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Name <span className="text-red-400">*</span>
          </label>
          <input
            type="text"
            value={name}
            onChange={(e) => setName(e.target.value)}
            className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
            placeholder="Enter raid boss name..."
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Description <span className="text-red-400">*</span>
          </label>
          <textarea
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40 min-h-[100px]"
            placeholder="Enter raid boss description..."
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-200 mb-2">
            Twitter Handle <span className="text-neutral-lightGray">(Optional)</span>
          </label>
          <div className="relative">
            <input
              type="text"
              value={twitterHandle}
              onChange={(e) => setTwitterHandle(e.target.value)}
              className="w-full px-4 py-2 pl-10 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
              placeholder="@username"
            />
            <Twitter className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
          </div>
        </div>

        {/* Stats */}
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-200 mb-2">
              Base HP <span className="text-red-400">*</span>
            </label>
            <input
              type="number"
              value={baseHp}
              onChange={(e) => setBaseHp(e.target.value)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
              placeholder="Enter base HP..."
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-200 mb-2">
              Defense <span className="text-neutral-lightGray">(Optional)</span>
              <span className="block text-xs text-neutral-lightGray">+10 HP per point</span>
            </label>
            <input
              type="number"
              value={defense}
              onChange={(e) => setDefense(e.target.value)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
              placeholder="Enter defense value..."
            />
          </div>
        </div>

        {/* XP Rewards */}
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-200 mb-2">
              Base XP Reward <span className="text-red-400">*</span>
            </label>
            <input
              type="number"
              value={xpReward}
              onChange={(e) => setXpReward(e.target.value)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
              placeholder="Enter XP reward..."
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-200 mb-2">
              Completion Bonus XP <span className="text-red-400">*</span>
            </label>
            <input
              type="number"
              value={bonusXp}
              onChange={(e) => setBonusXp(e.target.value)}
              className="w-full px-4 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-pink/40"
              placeholder="Enter bonus XP..."
              required
            />
          </div>
        </div>

        {error && (
          <p className="text-red-400 text-sm">{error}</p>
        )}

        <div className="text-xs text-neutral-lightGray mb-4">
          <span className="text-red-400">*</span> Required fields
        </div>

        <button
          onClick={handleSubmit}
          className="w-full px-4 py-2 bg-primary-pink text-white rounded-lg hover:bg-primary-pink/90 transition-colors"
        >
          {raid ? 'Update Raid Boss' : 'Create Raid Boss'}
        </button>
      </div>
    </div>
  );
};

================
File: src/components/Admin/RaidBossList.tsx
================
import { FC, useState, useEffect } from 'react';
import { Edit2, Trash2, Image as ImageIcon, Shield, Star, Users } from 'lucide-react';
import { RaidState } from '../../types/raid';
import { raidService } from '../../services/raidService';
import { RaidBossForm } from './RaidBossForm';

export const RaidBossList: FC = () => {
  const [raids, setRaids] = useState<RaidState[]>([]);
  const [editingRaid, setEditingRaid] = useState<RaidState | null>(null);

  useEffect(() => {
    // Load all raids when component mounts
    setRaids(raidService.getAllRaids());
  }, []);

  const handleDelete = (raidId: string) => {
    if (raidService.deleteRaid(raidId)) {
      setRaids(raidService.getAllRaids());
    }
  };

  if (editingRaid) {
    return (
      <div>
        <button
          onClick={() => setEditingRaid(null)}
          className="text-neutral-lightGray hover:text-white mb-4 flex items-center gap-2"
        >
          ← Back to Raid Boss List
        </button>
        <RaidBossForm 
          raid={editingRaid} 
          onComplete={() => {
            setEditingRaid(null);
            setRaids(raidService.getAllRaids());
          }}
        />
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {raids.map((raid) => {
        if (!raid || !raid.boss) return null;
        
        return (
          <div
            key={raid.id}
            className="bg-black/40 rounded-lg overflow-hidden border border-primary-pink/20"
          >
            <div className="flex flex-col md:flex-row">
              {/* Raid Boss Image */}
              <div className="w-full md:w-64 h-48 bg-neutral-charcoal/40 flex-shrink-0">
                {raid.boss.imageUrl ? (
                  <img
                    src={raid.boss.imageUrl}
                    alt={raid.boss.name}
                    className="w-full h-full object-cover"
                  />
                ) : (
                  <div className="w-full h-full flex items-center justify-center text-neutral-lightGray">
                    <ImageIcon className="w-12 h-12" />
                  </div>
                )}
              </div>

              {/* Raid Boss Details */}
              <div className="flex-1 p-6">
                <div className="flex flex-col md:flex-row justify-between items-start gap-4">
                  <div className="space-y-4 w-full">
                    <div>
                      <h3 className="text-xl font-bold text-white mb-2 break-words">{raid.boss.name}</h3>
                      <p className="text-neutral-lightGray break-words">{raid.boss.description}</p>
                    </div>

                    {/* Stats */}
                    <div className="flex flex-wrap items-center gap-4">
                      <div className="flex items-center gap-2">
                        <Shield className="w-4 h-4 text-primary-teal" />
                        <span className="text-neutral-lightGray">
                          Defense: {raid.boss.defense}
                        </span>
                      </div>
                      <div className="flex items-center gap-2">
                        <Star className="w-4 h-4 text-primary-pink" />
                        <span className="text-neutral-lightGray">
                          XP: {raid.boss.rewards.xp.toLocaleString()}
                        </span>
                      </div>
                      <div className="flex items-center gap-2">
                        <Users className="w-4 h-4 text-primary-pink" />
                        <span className="text-neutral-lightGray">
                          Participants: {raid.participants.length}
                        </span>
                      </div>
                    </div>

                    {/* Quest List */}
                    <div>
                      <h4 className="text-white font-medium mb-2">Quests:</h4>
                      <ul className="space-y-2">
                        {raid.boss.quests.map((quest, index) => (
                          <li key={quest.id} className="text-neutral-lightGray text-sm">
                            {index + 1}. {quest.description} ({quest.xpReward} XP)
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>

                  {/* Actions */}
                  <div className="flex gap-2">
                    {raid.status !== 'completed' && (
                      <button
                        onClick={() => setEditingRaid(raid)}
                        className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
                        title="Edit raid boss"
                      >
                        <Edit2 className="w-4 h-4" />
                      </button>
                    )}
                    <button
                      onClick={() => handleDelete(raid.id)}
                      className="p-2 text-red-400 hover:text-red-300 transition-colors rounded-lg hover:bg-red-400/5"
                      title="Delete raid boss"
                    >
                      <Trash2 className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      })}

      {raids.length === 0 && (
        <div className="text-center py-8 text-neutral-lightGray">
          No raid bosses found
        </div>
      )}
    </div>
  );
};

================
File: src/components/Admin/SubmissionsAdmin.tsx
================
import { FC, useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, Image as ImageIcon, ExternalLink, Trash2, ArrowLeft } from 'lucide-react';
import { submissionService } from '../../services/submissionService';
import { playerService } from '../../services/playerService';
import { QuestSubmissionRecord } from '../../types/submission';
import { Link } from 'react-router-dom';

export const SubmissionsAdmin: FC = () => {
  const [currentPage, setCurrentPage] = useState(1);
  const [submissionData, setSubmissionData] = useState(submissionService.getSubmissionPage(1));
  const [selectedImage, setSelectedImage] = useState<string | null>(null);

  useEffect(() => {
    setSubmissionData(submissionService.getSubmissionPage(currentPage));
  }, [currentPage]);

  const handleDelete = (id: string) => {
    if (submissionService.deleteSubmission(id)) {
      setSubmissionData(submissionService.getSubmissionPage(currentPage));
    }
  };

  const handlePreviousPage = () => {
    if (currentPage > 1) {
      setCurrentPage(prev => prev - 1);
    }
  };

  const handleNextPage = () => {
    if (currentPage < submissionData.totalPages) {
      setCurrentPage(prev => prev + 1);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <Link
          to="/admin"
          className="flex items-center gap-2 text-neutral-lightGray hover:text-white transition-colors"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Admin Panel
        </Link>
        <h1 className="text-2xl font-bold text-white">Quest Submissions</h1>
      </div>

      {/* Table */}
      <div className="bg-black/40 backdrop-blur-sm rounded-xl border border-primary-pink/20 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-black/40 border-b border-primary-pink/20">
                <th className="px-6 py-4 text-left text-sm font-semibold text-white">Date</th>
                <th className="px-6 py-4 text-left text-sm font-semibold text-white">User</th>
                <th className="px-6 py-4 text-left text-sm font-semibold text-white">Type</th>
                <th className="px-6 py-4 text-left text-sm font-semibold text-white">Screenshot</th>
                <th className="px-6 py-4 text-left text-sm font-semibold text-white">URL</th>
                <th className="px-6 py-4 text-right text-sm font-semibold text-white">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-primary-pink/10">
              {submissionData.submissions.map((submission) => {
                const player = playerService.getPlayer(submission.wallet);
                return (
                  <tr 
                    key={submission.id}
                    className="hover:bg-primary-pink/5 transition-colors"
                  >
                    <td className="px-6 py-4 text-sm text-neutral-lightGray whitespace-nowrap">
                      {new Date(submission.dateSubmitted).toLocaleString()}
                    </td>
                    <td className="px-6 py-4 text-sm text-white">
                      {player?.username || player?.handle || 
                        `${submission.wallet.slice(0, 4)}...${submission.wallet.slice(-4)}`}
                    </td>
                    <td className="px-6 py-4 text-sm">
                      <span className={`px-2 py-1 rounded-lg text-xs font-medium ${
                        submission.questType === 'raid' 
                          ? 'bg-primary-pink/20 text-primary-pink'
                          : 'bg-primary-teal/20 text-primary-teal'
                      }`}>
                        {submission.questType === 'raid' ? 'Raid Quest' : 'Daily Quest'}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      {submission.screenshot ? (
                        <button
                          onClick={() => setSelectedImage(submission.screenshot!)}
                          className="p-2 bg-primary-pink/10 text-primary-pink rounded-lg hover:bg-primary-pink/20 transition-colors"
                        >
                          <ImageIcon className="w-4 h-4" />
                        </button>
                      ) : (
                        <span className="text-neutral-lightGray text-sm">No image</span>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <a
                        href={submission.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex items-center gap-2 text-primary-pink hover:text-primary-pink/80 transition-colors"
                      >
                        <span className="text-sm truncate max-w-[200px]">
                          {submission.url}
                        </span>
                        <ExternalLink className="w-4 h-4 flex-shrink-0" />
                      </a>
                    </td>
                    <td className="px-6 py-4 text-right">
                      <button
                        onClick={() => handleDelete(submission.id)}
                        className="p-2 text-red-400 hover:text-red-300 transition-colors rounded-lg hover:bg-red-400/5"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>

        {submissionData.submissions.length === 0 && (
          <div className="text-center py-8 text-neutral-lightGray">
            No submissions found
          </div>
        )}
      </div>

      {/* Pagination */}
      {submissionData.totalPages > 1 && (
        <div className="flex items-center justify-between px-4">
          <div className="text-sm text-neutral-lightGray">
            Showing {((currentPage - 1) * 10) + 1} to {Math.min(currentPage * 10, submissionData.totalSubmissions)} of {submissionData.totalSubmissions} submissions
          </div>
          <div className="flex items-center gap-2">
            <button
              onClick={handlePreviousPage}
              disabled={currentPage === 1}
              className="p-2 rounded-lg bg-primary-pink/10 text-primary-pink hover:bg-primary-pink/20 transition-colors disabled:opacity-50"
            >
              <ChevronLeft className="w-4 h-4" />
            </button>
            <span className="text-white">
              Page {currentPage} of {submissionData.totalPages}
            </span>
            <button
              onClick={handleNextPage}
              disabled={currentPage === submissionData.totalPages}
              className="p-2 rounded-lg bg-primary-pink/10 text-primary-pink hover:bg-primary-pink/20 transition-colors disabled:opacity-50"
            >
              <ChevronRight className="w-4 h-4" />
            </button>
          </div>
        </div>
      )}

      {/* Image Preview Modal */}
      {selectedImage && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div 
            className="absolute inset-0 bg-neutral-charcoal/90 backdrop-blur-md"
            onClick={() => setSelectedImage(null)}
          />
          <div className="relative max-w-2xl w-full aspect-video">
            <img
              src={selectedImage}
              alt="Submission screenshot"
              className="w-full h-full object-contain rounded-lg"
            />
          </div>
        </div>
      )}
    </div>
  );
};

================
File: src/components/AdminPanel/index.tsx
================
import { FC, useState } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { QuestAdmin } from '../Admin/QuestAdmin';
import { RaidAdmin } from '../Admin/RaidAdmin';
import { Sword, ScrollText } from 'lucide-react';

const ADMIN_WALLET = "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

export const AdminPanel: FC = () => {
  const { publicKey } = useWallet();
  const [activeTab, setActiveTab] = useState<'quests' | 'raids'>('quests');
  
  if (!publicKey || publicKey.toString() !== ADMIN_WALLET) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-white mb-4">Access Denied</h2>
          <p className="text-neutral-lightGray">
            You don't have permission to access this area.
          </p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <h1 className="text-2xl font-bold text-white">Admin Panel</h1>
        
        <div className="flex flex-wrap gap-2 w-full sm:w-auto">
          <button
            onClick={() => setActiveTab('quests')}
            className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors ${
              activeTab === 'quests'
                ? 'bg-primary-pink text-white'
                : 'text-neutral-lightGray hover:bg-primary-pink/10 hover:text-primary-pink'
            }`}
          >
            <ScrollText className="w-5 h-5" />
            <span className="whitespace-nowrap">Quest Administration</span>
          </button>
          <button
            onClick={() => setActiveTab('raids')}
            className={`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors ${
              activeTab === 'raids'
                ? 'bg-primary-pink text-white'
                : 'text-neutral-lightGray hover:bg-primary-pink/10 hover:text-primary-pink'
            }`}
          >
            <Sword className="w-5 h-5" />
            <span className="whitespace-nowrap">Raid Administration</span>
          </button>
        </div>
      </div>

      {activeTab === 'quests' ? <QuestAdmin /> : <RaidAdmin />}
    </div>
  );
};

================
File: src/components/AudioControls.tsx
================
// This file can be safely deleted as its functionality is now part of FloatingControls

================
File: src/components/Avatar.tsx
================
import { FC, useState } from 'react';
import { User } from 'lucide-react';
import { playerService } from '../services/playerService';

interface AvatarProps {
  wallet: string;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  showBorder?: boolean;
  onClick?: () => void;
}

export const Avatar: FC<AvatarProps> = ({ 
  wallet, 
  size = 'md',
  showBorder = true,
  onClick 
}) => {
  const [imageError, setImageError] = useState(false);
  const player = playerService.getPlayer(wallet);
  const profilePic = player?.profilePicture;

  const sizeClasses = {
    xs: 'w-6 h-6',
    sm: 'w-8 h-8',
    md: 'w-12 h-12',
    lg: 'w-16 h-16',
    xl: 'w-24 h-24'
  };

  const borderClasses = showBorder 
    ? 'border-2 border-primary-main/20 hover:border-primary-main/40 transition-colors' 
    : '';

  const handleError = () => {
    setImageError(true);
  };

  return (
    <div 
      className={`
        ${sizeClasses[size]} 
        ${borderClasses}
        rounded-full overflow-hidden bg-primary-main/10
        ${onClick ? 'cursor-pointer hover:scale-105 transition-transform' : ''}
      `}
      onClick={onClick}
      role={onClick ? 'button' : undefined}
    >
      {profilePic && !imageError ? (
        <img
          src={profilePic}
          alt="Profile"
          className="w-full h-full object-cover"
          onError={handleError}
        />
      ) : (
        <div className="w-full h-full flex items-center justify-center">
          <User className={`${
            size === 'xs' || size === 'sm' ? 'w-3 h-3' :
            size === 'md' ? 'w-5 h-5' :
            'w-8 h-8'
          } text-primary-main/60`} />
        </div>
      )}
    </div>
  );
};

================
File: src/components/Button.tsx
================
import { FC, ButtonHTMLAttributes } from 'react';
import { cn } from '../utils/cn';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg' | 'xl';
}

export const Button: FC<ButtonProps> = ({
  children,
  className,
  variant = 'primary',
  size = 'md',
  ...props
}) => {
  const baseStyles = "relative inline-flex items-center justify-center font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";
  
  const variants = {
    primary: "bg-primary-500 hover:bg-primary-600 text-white focus:ring-primary-500",
    secondary: "bg-sand-700 hover:bg-sand-800 text-white focus:ring-sand-500",
    outline: "border-2 border-primary-500 text-primary-500 hover:bg-primary-500 hover:text-white focus:ring-primary-500",
    ghost: "text-primary-500 hover:bg-primary-500/10 focus:ring-primary-500"
  };

  const sizes = {
    sm: "px-3 py-1.5 text-sm rounded-lg",
    md: "px-4 py-2 text-base rounded-lg",
    lg: "px-6 py-3 text-lg rounded-xl",
    xl: "px-8 py-4 text-xl rounded-xl"
  };

  return (
    <button
      className={cn(
        baseStyles,
        variants[variant],
        sizes[size],
        className
      )}
      {...props}
    >
      {children}
    </button>
  );
};

================
File: src/components/common/SectionContainer.tsx
================
import React from 'react';

interface SectionContainerProps {
  children: React.ReactNode;
  className?: string;
  variant?: 'default' | 'gradient' | 'highlight';
}

export const SectionContainer: React.FC<SectionContainerProps> = ({ 
  children, 
  className = '',
  variant = 'default'
}) => {
  const baseStyles = "relative rounded-xl overflow-hidden transition-all duration-300";
  const variantStyles = {
    default: "bg-card-light-background/90 dark:bg-[#1E1523]/90",
    gradient: "bg-gradient-to-b from-primary-main/5 via-primary-light/10 to-primary-main/5 dark:from-[#1A1523]/80 dark:via-[#1E1523]/80 dark:to-[#251B2E]/80",
    highlight: "bg-primary-main/10 dark:bg-[#1E1523]/80"
  };
  
  const containerStyles = `${baseStyles} ${variantStyles[variant]} ${className}`;

  return (
    <div className="p-4 sm:p-6 md:p-8">
      <div className={containerStyles}>
        {/* Glow Effect */}
        <div className="absolute inset-0 bg-gradient-to-b from-primary-main/5 to-transparent dark:from-[#1A1523]/50 dark:to-transparent opacity-50" />
        
        {/* Border */}
        <div className="absolute inset-0 border border-card-light-border dark:border-card-dark-border/50 rounded-xl" />
        
        {/* Content */}
        <div className="relative z-10 
                      [&>div>h2]:text-text-light-primary 
                      [&>div>h2]:dark:bg-gradient-to-r 
                      [&>div>h2]:dark:from-primary-main 
                      [&>div>h2]:dark:to-primary-light 
                      [&>div>h2]:dark:bg-clip-text 
                      [&>div>h2]:dark:text-transparent">
          {children}
        </div>
      </div>
    </div>
  );
};

================
File: src/components/ConnectPrompt.tsx
================
import { FC } from 'react';
import { Wallet } from 'lucide-react';
import { WalletConnect as WalletConnectComponent } from './WalletConnect';
import { GlassPanel } from './GlassPanel';
import { useAuth } from '../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';

export const ConnectPrompt: FC = () => {
  const { signInAsGuest } = useAuth();
  const navigate = useNavigate();

  const handleGuestLogin = async () => {
    const success = await signInAsGuest();
    if (success) {
      navigate('/');
    }
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-[60vh] text-center">
      <GlassPanel className="max-w-md mx-auto p-8">
        <div className="w-16 h-16 bg-primary-main/10 rounded-full flex items-center justify-center mb-6 mx-auto">
          <Wallet className="w-8 h-8 text-primary-main" />
        </div>
        <h2 className="text-3xl font-bold text-white mb-4">
          Connect to Play
        </h2>
        <p className="text-text-light-secondary dark:text-text-dark-secondary mb-8">
          Connect your wallet to access exclusive features and start your raiding adventure!
        </p>
        <div className="space-y-4">
          <WalletConnectComponent />
          <div className="relative">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t border-primary-main/20"></div>
            </div>
            <div className="relative flex justify-center text-sm">
              <span className="px-2 bg-background-dark text-text-dark-secondary">or</span>
            </div>
          </div>
          <button
            onClick={handleGuestLogin}
            className="w-full px-4 py-2 bg-primary-main/20 text-primary-main rounded-lg hover:bg-primary-main/30 transition-colors"
          >
            Continue as Guest
          </button>
        </div>
      </GlassPanel>
    </div>
  );
};

================
File: src/components/ContentBox.tsx
================
import { FC, ReactNode } from 'react';

interface ContentBoxProps {
  children: ReactNode;
  className?: string;
  title?: string;
  subtitle?: string;
}

export const ContentBox: FC<ContentBoxProps> = ({ 
  children, 
  title,
  subtitle,
  className = '' 
}) => {
  return (
    <div className={`
      bg-white/30 dark:bg-black/30 
      backdrop-blur-sm 
      rounded-xl p-6 
      border border-white/10
      ${className}
    `}>
      {title && (
        <div className="mb-4">
          <h2 className="text-2xl font-title text-primary-main dark:text-orange-500">
            {title}
          </h2>
          {subtitle && (
            <p className="mt-1 text-text-light-secondary dark:text-white/90">
              {subtitle}
            </p>
          )}
        </div>
      )}
      {children}
    </div>
  );
};

================
File: src/components/Dashboard.tsx
================
import { FC } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { NFTGrid } from './NFTGrid';
import { ConnectPrompt } from './ConnectPrompt';
import { ContentBox } from './ContentBox';

export const Dashboard: FC = () => {
  const { connected } = useWallet();

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="space-y-8">
      <ContentBox title="My NFT Dashboard">
        <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
          View and manage your NFT collection
        </p>
        
        <NFTGrid 
          showWalletOnly={true}
          initialDisplayCount={4}
          showSearch={false}
        />
      </ContentBox>
    </div>
  );
};

================
File: src/components/Dashboard/index.tsx
================
import { FC, useState } from 'react';
import { Users, X, Star, Crown } from 'lucide-react';
import { GuildQuestions } from './GuildQuestions';
import { Guild } from '../../types/guild';
import { playerService } from '../../services/playerService';
import { guildService } from '../../services/guildService';

interface GuildInfoModalProps {
  guild: Guild;
  onClose: () => void;
}

const GuildInfoModal: FC<GuildInfoModalProps> = ({ guild, onClose }) => {
  const members = guildService.getGuildMembers(guild.id);
  
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-neutral-charcoal/90 backdrop-blur-md"
        onClick={onClose}
      />
      <div className="relative w-full max-w-2xl bg-[#1A1B23] rounded-xl border border-primary-pink/20 shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b border-primary-pink/20">
          <div className="flex items-center gap-4">
            <div className="w-16 h-16 rounded-lg overflow-hidden border border-primary-pink/20">
              <img
                src={guild.imageUrl}
                alt={guild.name}
                className="w-full h-full object-cover"
              />
            </div>
            <div>
              <h3 className="text-xl font-bold text-white">{guild.name}</h3>
              <p className="text-sm text-neutral-lightGray">
                {members.length} Members
              </p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="p-6 space-y-6">
          <p className="text-neutral-lightGray">{guild.description}</p>

          <div>
            <h4 className="text-lg font-semibold text-white mb-4">Top Members</h4>
            <div className="space-y-3 max-h-[300px] overflow-y-auto custom-scrollbar">
              {members.slice(0, 5).map((member, index) => (
                <div
                  key={member.wallet}
                  className="flex items-center gap-4 p-4 bg-black/40 rounded-lg border border-primary-pink/20"
                >
                  <div className="w-8 h-8 rounded-full overflow-hidden border border-primary-pink/20">
                    {member.profilePicture ? (
                      <img
                        src={member.profilePicture}
                        alt={member.username || 'Member'}
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <img
                        src="/assets/defaultpfp.png"
                        alt="Default Profile"
                        className="w-full h-full object-cover"
                      />
                    )}
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-white font-medium truncate">
                      {member.username || `${member.wallet.slice(0, 4)}...${member.wallet.slice(-4)}`}
                    </p>
                  </div>
                  <div className="flex items-center gap-2">
                    <Star className="w-4 h-4 text-primary-pink" />
                    <span className="text-primary-pink">
                      {member.experience.toLocaleString()} XP
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

interface GuildSelectorProps {
  wallet: string;
}

export const GuildSelector: FC<GuildSelectorProps> = ({ wallet }) => {
  const [showQuestionnaire, setShowQuestionnaire] = useState(false);
  const [showGuildInfo, setShowGuildInfo] = useState(false);
  const player = playerService.getPlayer(wallet);
  const guild = player?.guild ? guildService.getGuildById(player.guild) : null;

  const handleGuildAssigned = (assignedGuild: Guild) => {
    playerService.setGuild(wallet, assignedGuild.id);
    setShowQuestionnaire(false);
  };

  return (
    <div className="feature-box text-center">
      <div className="flex items-center justify-center gap-3 mb-6">
        <Users className="w-5 h-5 text-primary-pink" />
        <h2 className="text-xl font-bold text-text-light-primary dark:text-white">Panda Pack</h2>
      </div>

      <div>
        {guild ? (
          <button
            onClick={() => setShowGuildInfo(true)}
            className="w-full flex flex-col items-center gap-4 hover:bg-primary-pink/5 p-4 rounded-xl transition-colors"
          >
            <div className="w-24 h-24 rounded-lg overflow-hidden border border-primary-pink/20">
              <img
                src={guild.imageUrl}
                alt={guild.name}
                className="w-full h-full object-cover"
              />
            </div>
            <div className="text-center">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="flex items-center gap-1.5 px-3 py-1 bg-primary-pink/10 rounded-full">
                  <Crown className="w-4 h-4 text-primary-pink" />
                  <span className="text-sm text-primary-pink font-medium">
                    Guild Member #{guildService.getGuildMembers(guild.id).findIndex(m => m.wallet === wallet) + 1} of {guildService.getGuildMembers(guild.id).length}
                  </span>
                </div>
              </div>
              <h3 className="text-lg font-semibold text-text-light-primary dark:text-white mb-1">
                {guild.name}
              </h3>
              <p className="text-sm text-text-light-secondary dark:text-neutral-lightGray">
                {guild.description}
              </p>
            </div>
          </button>
        ) : (
          <div className="text-center">
            <div className="flex items-center justify-center gap-2 mb-2">
              {playerRank && (
                <div className="flex items-center gap-1.5 px-3 py-1 bg-primary-pink/10 rounded-full">
                  <Crown className="w-4 h-4 text-primary-pink" />
                  <span className="text-sm text-primary-pink font-medium">
                    Rank #{playerRank.rank} of {playerRank.totalMembers}
                  </span>
                </div>
              )}
            </div>
            <p className="text-text-light-secondary dark:text-neutral-lightGray mb-4">
              Join a Panda Pack to unlock exclusive rewards and community features
            </p>
            <button
              onClick={() => setShowQuestionnaire(true)}
              className="px-6 py-3 bg-primary-pink text-white rounded-lg hover:bg-primary-pink/90 transition-colors shadow-lg shadow-primary-pink/20"
            >
              Choose Your Panda Pack
            </button>
          </div>
        )}
      </div>

      {showQuestionnaire && !guild && (
        <GuildQuestions
          onComplete={handleGuildAssigned}
          onClose={() => setShowQuestionnaire(false)}
        />
      )}
      
      {showGuildInfo && guild && (
        <GuildInfoModal
          guild={guild}
          onClose={() => setShowGuildInfo(false)}
        />
      )}
    </div>
  );
};</content>

================
File: src/components/Dashboard/NFTProfileButton.tsx
================
import { FC, useState } from 'react';
import { NFTMetadata } from '../../types/nft';
import { playerService } from '../../services/playerService';
import { useWallet } from '@solana/wallet-adapter-react';

interface NFTProfileButtonProps {
  nft: NFTMetadata;
}

export const NFTProfileButton: FC<NFTProfileButtonProps> = ({ nft }) => {
  const { publicKey } = useWallet();
  const [showSuccess, setShowSuccess] = useState(false);

  const handleSetProfilePicture = () => {
    if (!publicKey) return;

    const success = playerService.setProfilePicture(publicKey.toString(), nft.image);
    if (success) {
      setShowSuccess(true);
    }
  };

  return (
    <>
      <button
        onClick={handleSetProfilePicture}
        className="absolute bottom-2 left-2 z-10 px-3 py-1.5 rounded-lg backdrop-blur-sm transition-colors bg-black/60 text-primary-pink hover:bg-primary-pink/20 text-sm font-medium"
      >
        Use as PDA PFP
      </button>

      {/* Success Modal */}
      {showSuccess && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div 
            className="absolute inset-0 bg-neutral-charcoal/90 backdrop-blur-md"
            onClick={() => setShowSuccess(false)}
          />
          <div className="relative bg-[#1A1B23] rounded-xl border border-primary-pink/20 p-6 text-center">
            <h3 className="text-xl font-bold text-white mb-4">
              Profile Picture Updated
            </h3>
            <button
              onClick={() => setShowSuccess(false)}
              className="px-6 py-2 bg-primary-pink text-white rounded-lg hover:bg-primary-pink/90 transition-colors"
            >
              Okay, Thanks!
            </button>
          </div>
        </div>
      )}
    </>
  );
};

================
File: src/components/ErrorBoundary.tsx
================
import { Component, ErrorInfo, ReactNode } from 'react';

interface Props {
  children: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false,
    error: null
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Uncaught error:', error, errorInfo);
  }

  public render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center bg-gradient-radial from-primary-main/5 via-primary-main/10 to-transparent">
          <div className="gradient-box p-8 max-w-md mx-auto text-center">
            <h2 className="text-2xl font-bold text-text-light-primary dark:text-white mb-4">Something went wrong</h2>
            <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
              We apologize for the inconvenience. Please try refreshing the page.
            </p>
            <button
              onClick={() => window.location.reload()}
              className="px-6 py-2 bg-primary-main hover:bg-primary-main/90 text-white rounded-lg transition-colors shadow-glow"
            >
              Refresh Page
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

================
File: src/components/FloatingControls.tsx
================
import { FC, useState, useEffect } from 'react';
import { Play, Pause, Sun, Moon, Volume2, VolumeX } from 'lucide-react';
import { useAudio } from '../contexts/AudioContext';
import { useTheme } from '../contexts/ThemeContext';
import { GlassPanel } from './GlassPanel';

export const FloatingControls: FC = () => {
  const { isPlaying, togglePlay, volume, setVolume } = useAudio();
  const { theme, toggleTheme } = useTheme();
  const [isVisible, setIsVisible] = useState(true);
  const [lastScrollY, setLastScrollY] = useState(0);
  const [showVolume, setShowVolume] = useState(false);

  const handleScrollClick = () => {
    const viewportHeight = window.innerHeight;
    const currentScroll = window.scrollY;
    const nextSection = Math.ceil((currentScroll + 10) / viewportHeight) * viewportHeight;
    
    window.scrollTo({
      top: nextSection,
      behavior: 'smooth'
    });
  };

  useEffect(() => {
    let ticking = false;
    let timeout: NodeJS.Timeout;

    const handleScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const currentScrollY = window.scrollY;
          setIsVisible(currentScrollY <= 0 || currentScrollY < lastScrollY);
          setLastScrollY(currentScrollY);
          ticking = false;
        });

        ticking = true;
      }

      clearTimeout(timeout);
      timeout = setTimeout(() => {
        setIsVisible(true);
      }, 1000);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });

    return () => {
      window.removeEventListener('scroll', handleScroll);
      clearTimeout(timeout);
    };
  }, [lastScrollY]);

  const sharedClasses = `fixed bottom-8 z-[100] transition-transform duration-300 ${
    isVisible ? 'translate-y-0 opacity-100' : 'translate-y-4 opacity-0'
  }`;

  const buttonClasses = "w-10 h-10 flex items-center justify-center hover:scale-105 transition-transform cursor-pointer";
  const iconClasses = "w-5 h-5 text-primary-main dark:text-orange-500";

  return (
    <>
      {/* Theme Toggle - Bottom Left */}
      <div className={`${sharedClasses} left-4`}>
        <GlassPanel
          className={buttonClasses}
          onClick={toggleTheme}
        >
          {theme === 'dark' ? (
            <Sun className={iconClasses} />
          ) : (
            <Moon className={iconClasses} />
          )}
        </GlassPanel>
      </div>

      {/* Scroll Indicator - Center */}
      <div className={`${sharedClasses} left-1/2 -translate-x-1/2`}>
        <GlassPanel 
          className={buttonClasses}
          onClick={handleScrollClick}
        >
          <svg 
            className="w-5 h-5 text-primary-main dark:text-orange-500 animate-slowBounce"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M19 14l-7 7m0 0l-7-7m7 7V3"
            />
          </svg>
        </GlassPanel>
      </div>

      {/* Audio Control - Bottom Right */}
      <div 
        className={`${sharedClasses} right-4`}
        onMouseEnter={() => setShowVolume(true)}
        onMouseLeave={() => setShowVolume(false)}
      >
        <GlassPanel className="flex items-center">
          {/* Volume Slider */}
          <div className={`
            overflow-hidden transition-all duration-300 flex items-center gap-2 px-2
            ${showVolume ? 'w-32 opacity-100' : 'w-0 opacity-0'}
          `}>
            {volume > 0 ? (
              <Volume2 className={iconClasses} />
            ) : (
              <VolumeX className={iconClasses} />
            )}
            <input
              type="range"
              min="0"
              max="1"
              step="0.01"
              value={volume}
              onChange={(e) => setVolume(parseFloat(e.target.value))}
              className="w-16 h-1 bg-primary-main/30 rounded-lg appearance-none cursor-pointer 
                [&::-webkit-slider-thumb]:appearance-none 
                [&::-webkit-slider-thumb]:w-3
                [&::-webkit-slider-thumb]:h-3
                [&::-webkit-slider-thumb]:rounded-full 
                [&::-webkit-slider-thumb]:bg-primary-main
                dark:[&::-webkit-slider-thumb]:bg-orange-500
                [&::-webkit-slider-thumb]:hover:bg-primary-main/80
                dark:[&::-webkit-slider-thumb]:hover:bg-orange-500/80
                [&::-webkit-slider-thumb]:transition-colors
                [&::-webkit-slider-thumb]:shadow-lg
                [&::-webkit-slider-thumb]:shadow-primary-main/20"
            />
          </div>
          
          {/* Play/Pause Button */}
          <button 
            onClick={togglePlay}
            className={buttonClasses}
          >
            {isPlaying ? (
              <Pause className={iconClasses} />
            ) : (
              <Play className={iconClasses} />
            )}
          </button>
        </GlassPanel>
      </div>
    </>
  );
}

================
File: src/components/Footer.tsx
================
import { FC } from 'react';
import { Link, useLocation } from 'react-router-dom';
import { Twitter, MessageCircle, Github, ExternalLink } from 'lucide-react';
import { SOCIAL_LINKS } from '../config/constants';
import { useTheme } from '../contexts/ThemeContext';
import { useWallet } from '@solana/wallet-adapter-react';
import { motion } from 'framer-motion';

export const Footer: FC = () => {
  const { theme } = useTheme();
  const { connected, publicKey } = useWallet();
  const location = useLocation();
  const currentYear = new Date().getFullYear();
  const isAdmin = publicKey?.toString() === "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

  const quickLinks = [
    { label: 'Home', path: '/' },
    { label: 'NFT Builder', path: '/nft-builder' },
    { label: 'Leaderboards', path: '/leaderboards' },
    { label: 'Info', path: '/info' },
  ];

  const communityLinks = [
    { label: 'Raid', path: '/raid' },
    { label: 'Guild', path: '/guild' },
    { label: 'Profile', path: '/profile' },
    { label: 'Marketplace', path: '/marketplace' },
  ];

  const resourceLinks = [
    { label: 'Documentation', href: SOCIAL_LINKS.docs },
    { label: 'GitHub', href: SOCIAL_LINKS.github },
    { label: 'Discord', href: SOCIAL_LINKS.discord },
    { label: 'Twitter', href: SOCIAL_LINKS.twitter },
  ];

  const isActive = (path: string) => {
    if (path === '/' && location.pathname === '/') return true;
    return path !== '/' && location.pathname.startsWith(path);
  };

  const FooterSection: FC<{
    title: string;
    links: Array<{ label: string; path?: string; href?: string }>;
  }> = ({ title, links }) => (
    <div className="flex flex-col gap-4">
      <h3 className="font-semibold text-sand-800 dark:text-sand-200">{title}</h3>
      <ul className="flex flex-col gap-2">
        {links.map((link) => (
          <li key={link.label}>
            {link.path ? (
              <Link
                to={link.path}
                className={`flex items-center gap-2 text-sm transition-colors duration-200
                  ${isActive(link.path)
                    ? 'text-primary-500 font-medium'
                    : 'text-sand-600 hover:text-primary-500 dark:text-sand-400 dark:hover:text-primary-400'
                  }`}
              >
                {link.label}
              </Link>
            ) : (
              <a
                href={link.href}
                target="_blank"
                rel="noopener noreferrer"
                className="flex items-center gap-2 text-sm text-sand-600 hover:text-primary-500 dark:text-sand-400 dark:hover:text-primary-400 transition-colors duration-200"
              >
                {link.label}
                <ExternalLink className="w-3 h-3" />
              </a>
            )}
          </li>
        ))}
      </ul>
    </div>
  );

  return (
    <footer className="relative mt-auto border-t border-sand-200/50 dark:border-white/5">
      <div className="absolute inset-0 bg-sand-100/80 dark:bg-background-900/80 backdrop-blur-sm" />
      
      <div className="relative container mx-auto px-4 py-12">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12">
          {/* Brand Section */}
          <motion.div 
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="flex flex-col gap-4"
          >
            <div className="flex items-center gap-2">
              <div className="text-2xl font-bold tracking-wider text-sand-900 dark:text-sand-100">
                Pan <span className="text-primary-500">Da Pan</span>
              </div>
            </div>
            <p className="text-sm text-sand-600 dark:text-sand-400">
              Join the next generation of NFT gaming. Raid, collect, and earn together.
            </p>
          </motion.div>

          {/* Quick Links */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
          >
            <FooterSection title="Quick Links" links={quickLinks} />
          </motion.div>

          {/* Community Links */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            <FooterSection title="Community" links={communityLinks} />
          </motion.div>

          {/* Resources */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
          >
            <FooterSection title="Resources" links={resourceLinks} />
          </motion.div>
        </div>

        {/* Bottom Bar */}
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.4 }}
          className="flex flex-col md:flex-row justify-between items-center gap-4 mt-12 pt-8 border-t border-sand-200/50 dark:border-white/5"
        >
          <div className="text-sm text-sand-600 dark:text-sand-400">
            {currentYear} Pan Da Pan. All rights reserved.
          </div>
          
          {/* Social Links */}
          <div className="flex items-center gap-4">
            <a
              href={SOCIAL_LINKS.twitter}
              target="_blank"
              rel="noopener noreferrer"
              className="p-2 rounded-xl hover:bg-primary-500/10 text-sand-600 hover:text-primary-500 dark:text-sand-400 dark:hover:text-primary-400 transition-all duration-300"
              aria-label="Twitter"
            >
              <Twitter className="w-5 h-5" />
            </a>
            <a
              href={SOCIAL_LINKS.discord}
              target="_blank"
              rel="noopener noreferrer"
              className="p-2 rounded-xl hover:bg-primary-500/10 text-sand-600 hover:text-primary-500 dark:text-sand-400 dark:hover:text-primary-400 transition-all duration-300"
              aria-label="Discord"
            >
              <MessageCircle className="w-5 h-5" />
            </a>
            <a
              href={SOCIAL_LINKS.github}
              target="_blank"
              rel="noopener noreferrer"
              className="p-2 rounded-xl hover:bg-primary-500/10 text-sand-600 hover:text-primary-500 dark:text-sand-400 dark:hover:text-primary-400 transition-all duration-300"
              aria-label="GitHub"
            >
              <Github className="w-5 h-5" />
            </a>
          </div>
        </motion.div>
      </div>
    </footer>
  );
};

================
File: src/components/Gallery.tsx
================
import { FC } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { NFTGrid } from './NFTGrid';
import { ConnectPrompt } from './ConnectPrompt';
import { ContentBox } from './ContentBox';

export const Gallery: FC = () => {
  const { connected } = useWallet();

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="page-container">
      <div className="page-content">
        <ContentBox title="NFT Gallery">
          <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
            Browse the complete collection gallery
          </p>

          <NFTGrid 
            showWalletOnly={false}
            initialDisplayCount={8}
            showSearch={true}
          />
        </ContentBox>
      </div>
    </div>
  );
};

================
File: src/components/Gallery/Gallery.tsx
================
<content>import { FC } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { NFTGrid } from '../NFTGrid';
import { ConnectPrompt } from '../ConnectPrompt';
import { ContentBox } from '../ContentBox';

export const Gallery: FC = () => {
  const { connected } = useWallet();

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="space-y-8">
      <div className="text-center mb-12">
        <h1 className="text-4xl font-title text-text-light-primary dark:text-white mb-2">
          NFT Gallery
        </h1>
        <p className="text-text-light-secondary dark:text-text-dark-secondary">
          Browse and manage your NFT collection
        </p>
      </div>

      <ContentBox>
        <NFTGrid 
          showWalletOnly={false}
          initialDisplayCount={8}
          showSearch={true}
        />
      </ContentBox>
    </div>
  );
};</content>

================
File: src/components/Game/GameCanvas.tsx
================
import { FC, useEffect, useRef } from 'react';
import { GameState } from './useGameState';

interface GameCanvasProps {
  gameState: GameState;
}

export const GameCanvas: FC<GameCanvasProps> = ({ gameState }) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const tunnelOffset = useRef(0);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const drawTunnel = () => {
      const tunnelSpeed = 2;
      tunnelOffset.current = (tunnelOffset.current + tunnelSpeed) % 50;
      
      // Draw moving tunnel pattern
      ctx.strokeStyle = '#4c1d95';
      ctx.lineWidth = 2;
      
      for (let i = -50; i < canvas.width + 50; i += 50) {
        const x = i - tunnelOffset.current;
        
        // Top tunnel
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x + 25, 50);
        ctx.stroke();
        
        // Bottom tunnel
        ctx.beginPath();
        ctx.moveTo(x, canvas.height);
        ctx.lineTo(x + 25, canvas.height - 50);
        ctx.stroke();
      }
    };

    const render = () => {
      // Clear canvas
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw moving tunnel effect
      if (gameState.isPlaying) {
        drawTunnel();
      }

      // Draw pipes with gradient
      gameState.pipes.forEach(pipe => {
        // Top pipe gradient
        const topGradient = ctx.createLinearGradient(
          pipe.x, 0,
          pipe.x + pipe.width, 0
        );
        topGradient.addColorStop(0, '#4c1d95');
        topGradient.addColorStop(1, '#7e22ce');
        
        // Bottom pipe gradient
        const bottomGradient = ctx.createLinearGradient(
          pipe.x, canvas.height,
          pipe.x + pipe.width, canvas.height - pipe.bottomHeight
        );
        bottomGradient.addColorStop(0, '#4c1d95');
        bottomGradient.addColorStop(1, '#7e22ce');

        // Draw pipes with gradients
        ctx.fillStyle = topGradient;
        ctx.fillRect(pipe.x, 0, pipe.width, pipe.topHeight);
        
        ctx.fillStyle = bottomGradient;
        ctx.fillRect(
          pipe.x,
          canvas.height - pipe.bottomHeight,
          pipe.width,
          pipe.bottomHeight
        );

        // Add pipe highlights
        ctx.strokeStyle = '#9333ea';
        ctx.lineWidth = 2;
        ctx.strokeRect(pipe.x, 0, pipe.width, pipe.topHeight);
        ctx.strokeRect(
          pipe.x,
          canvas.height - pipe.bottomHeight,
          pipe.width,
          pipe.bottomHeight
        );
      });

      // Draw bird with gradient
      const birdGradient = ctx.createRadialGradient(
        gameState.bird.x + gameState.bird.width / 2,
        gameState.bird.y + gameState.bird.height / 2,
        0,
        gameState.bird.x + gameState.bird.width / 2,
        gameState.bird.y + gameState.bird.height / 2,
        gameState.bird.width
      );
      birdGradient.addColorStop(0, '#9333ea');
      birdGradient.addColorStop(1, '#7e22ce');
      
      ctx.fillStyle = birdGradient;
      ctx.beginPath();
      ctx.arc(
        gameState.bird.x + gameState.bird.width / 2,
        gameState.bird.y + gameState.bird.height / 2,
        gameState.bird.width / 2,
        0,
        Math.PI * 2
      );
      ctx.fill();

      // Draw score with glow effect
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 24px monospace';
      ctx.textAlign = 'center';
      ctx.shadowColor = '#9333ea';
      ctx.shadowBlur = 10;
      ctx.fillText(
        gameState.score.toString(),
        canvas.width / 2,
        50
      );
      ctx.shadowBlur = 0;
    };

    const animate = () => {
      render();
      requestAnimationFrame(animate);
    };

    animate();
  }, [gameState]);

  return (
    <canvas
      ref={canvasRef}
      className="w-full h-full"
      width={800}
      height={600}
      onClick={gameState.handleClick}
    />
  );
};

================
File: src/components/Game/GameUI.tsx
================
import { FC } from 'react';
import { GameState } from './useGameState';
import { Play, Pause, RotateCcw } from 'lucide-react';

interface GameUIProps {
  gameState: GameState;
}

export const GameUI: FC<GameUIProps> = ({ gameState }) => {
  if (!gameState.isGameOver && gameState.isPlaying) {
    return null;
  }

  return (
    <div className="absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm">
      <div className="text-center">
        {gameState.isGameOver ? (
          <>
            <h3 className="text-2xl font-bold text-white mb-2">Game Over!</h3>
            <p className="text-purple-300 mb-6">Score: {gameState.score}</p>
            <button
              onClick={gameState.resetGame}
              className="flex items-center gap-2 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors"
            >
              <RotateCcw className="w-4 h-4" />
              Play Again
            </button>
          </>
        ) : (
          <>
            <h3 className="text-2xl font-bold text-white mb-6">Flappy Pepe</h3>
            <button
              onClick={gameState.startGame}
              className="flex items-center gap-2 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors"
            >
              <Play className="w-4 h-4" />
              Start Game
            </button>
          </>
        )}
      </div>
    </div>
  );
};

================
File: src/components/Game/index.tsx
================
import { FC, useEffect, useRef, useState } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { GameCanvas } from './GameCanvas';
import { GameUI } from './GameUI';
import { useGameState } from './useGameState';
import { Trophy } from 'lucide-react';

export const Game: FC = () => {
  const { publicKey } = useWallet();
  const gameState = useGameState(publicKey?.toString());
  const [showLeaderboard, setShowLeaderboard] = useState(false);

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h2 className="text-xl font-semibold text-white">Flappy Pepe</h2>
        <button
          onClick={() => setShowLeaderboard(!showLeaderboard)}
          className="flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors bg-purple-900/20 text-purple-300 hover:bg-purple-900/40"
        >
          <Trophy className="w-4 h-4" />
          Leaderboard
        </button>
      </div>

      <div className="relative aspect-[4/3] max-w-2xl mx-auto bg-black/40 rounded-lg overflow-hidden border border-purple-700/30">
        <GameCanvas gameState={gameState} />
        <GameUI gameState={gameState} />
      </div>

      {showLeaderboard && (
        <div className="bg-black/40 backdrop-blur-sm rounded-lg border border-purple-700/30 p-6">
          <h3 className="text-lg font-semibold text-white mb-4">Top Scores</h3>
          <div className="space-y-2">
            {gameState.leaderboard.map((entry, index) => (
              <div
                key={index}
                className="flex items-center justify-between p-3 bg-purple-900/20 rounded-lg"
              >
                <div className="flex items-center gap-3">
                  <span className="text-purple-400 font-mono">#{index + 1}</span>
                  <span className="text-white font-medium truncate">
                    {entry.wallet.slice(0, 4)}...{entry.wallet.slice(-4)}
                  </span>
                </div>
                <span className="text-purple-300 font-mono">{entry.score}</span>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

================
File: src/components/Game/useGameState.ts
================
import { useState, useEffect, useCallback } from 'react';

interface Bird {
  x: number;
  y: number;
  velocity: number;
  width: number;
  height: number;
}

interface Pipe {
  x: number;
  width: number;
  topHeight: number;
  bottomHeight: number;
}

interface LeaderboardEntry {
  wallet: string;
  score: number;
}

export interface GameState {
  bird: Bird;
  pipes: Pipe[];
  score: number;
  isPlaying: boolean;
  isGameOver: boolean;
  leaderboard: LeaderboardEntry[];
  handleClick: () => void;
  startGame: () => void;
  resetGame: () => void;
}

const GRAVITY = 0.5;
const FLAP_VELOCITY = -8;
const PIPE_SPEED = 3;
const PIPE_SPAWN_INTERVAL = 2000;
const GAP_SIZE = 150;

export const useGameState = (wallet?: string): GameState => {
  const [bird, setBird] = useState<Bird>({
    x: 100,
    y: 300,
    velocity: 0,
    width: 30,
    height: 30,
  });

  const [pipes, setPipes] = useState<Pipe[]>([]);
  const [score, setScore] = useState(0);
  const [isPlaying, setIsPlaying] = useState(false);
  const [isGameOver, setIsGameOver] = useState(false);
  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);

  const createPipe = useCallback(() => {
    const minHeight = 50;
    const maxHeight = 400;
    const topHeight = Math.random() * (maxHeight - minHeight) + minHeight;

    return {
      x: 800,
      width: 50,
      topHeight,
      bottomHeight: 600 - topHeight - GAP_SIZE,
    };
  }, []);

  const resetGame = useCallback(() => {
    setBird({
      x: 100,
      y: 300,
      velocity: 0,
      width: 30,
      height: 30,
    });
    setPipes([]);
    setScore(0);
    setIsPlaying(false);
    setIsGameOver(false);
  }, []);

  const startGame = useCallback(() => {
    resetGame();
    setIsPlaying(true);
  }, [resetGame]);

  const handleClick = useCallback(() => {
    if (!isGameOver && isPlaying) {
      setBird(prev => ({
        ...prev,
        velocity: FLAP_VELOCITY,
      }));
    }
  }, [isGameOver, isPlaying]);

  useEffect(() => {
    if (!isPlaying || isGameOver) return;

    const gameLoop = setInterval(() => {
      setBird(prev => ({
        ...prev,
        y: prev.y + prev.velocity,
        velocity: prev.velocity + GRAVITY,
      }));

      setPipes(prev => {
        const newPipes = prev
          .map(pipe => ({
            ...pipe,
            x: pipe.x - PIPE_SPEED,
          }))
          .filter(pipe => pipe.x + pipe.width > 0);

        // Check for collisions
        const birdRect = {
          left: bird.x,
          right: bird.x + bird.width,
          top: bird.y,
          bottom: bird.y + bird.height,
        };

        const collision = newPipes.some(pipe => {
          const hitTop = birdRect.right > pipe.x &&
            birdRect.left < pipe.x + pipe.width &&
            birdRect.top < pipe.topHeight;

          const hitBottom = birdRect.right > pipe.x &&
            birdRect.left < pipe.x + pipe.width &&
            birdRect.bottom > 600 - pipe.bottomHeight;

          return hitTop || hitBottom;
        });

        if (collision || bird.y < 0 || bird.y + bird.height > 600) {
          setIsGameOver(true);
          if (wallet) {
            setLeaderboard(prev => {
              const newEntry = { wallet, score };
              const newLeaderboard = [...prev, newEntry]
                .sort((a, b) => b.score - a.score)
                .slice(0, 10);
              return newLeaderboard;
            });
          }
        }

        // Update score
        newPipes.forEach(pipe => {
          if (pipe.x + PIPE_SPEED >= bird.x && pipe.x < bird.x) {
            setScore(prev => prev + 1);
          }
        });

        return newPipes;
      });
    }, 1000 / 60);

    const spawnPipes = setInterval(() => {
      setPipes(prev => [...prev, createPipe()]);
    }, PIPE_SPAWN_INTERVAL);

    return () => {
      clearInterval(gameLoop);
      clearInterval(spawnPipes);
    };
  }, [isPlaying, isGameOver, bird.x, bird.y, bird.width, bird.height, createPipe, score, wallet]);

  return {
    bird,
    pipes,
    score,
    isPlaying,
    isGameOver,
    leaderboard,
    handleClick,
    startGame,
    resetGame,
  };
};

================
File: src/components/GlassContainer.tsx
================
import { FC, ReactNode } from 'react';

interface GlassContainerProps {
  children: ReactNode;
  className?: string;
}

export const GlassContainer: FC<GlassContainerProps> = ({ children, className = '' }) => {
  return (
    <div className={`relative p-8 rounded-xl border border-primary-main/20 bg-background-light/60 dark:bg-background-dark/60 backdrop-blur-xl shadow-lg ${className}`}>
      {/* Gradient overlay */}
      <div className="absolute inset-0 bg-gradient-radial from-primary-main/5 via-primary-main/10 to-transparent rounded-xl pointer-events-none" />
      
      {/* Content */}
      <div className="relative z-10">
        {children}
      </div>
    </div>
  );
};

================
File: src/components/GlassPanel.tsx
================
import { FC, ReactNode } from 'react';

interface GlassPanelProps {
  children: ReactNode;
  className?: string;
  onClick?: () => void;
}

export const GlassPanel: FC<GlassPanelProps> = ({ children, className = '', onClick }) => {
  return (
    <div 
      onClick={onClick}
      className={`
        bg-white/20 dark:bg-black/20 
        backdrop-blur-md 
        rounded-xl 
        border border-white/10 dark:border-white/5
        shadow-lg shadow-black/5
        hover:shadow-xl hover:shadow-black/10
        transition-all duration-300
        ${className}
      `}
    >
      {children}
    </div>
  );
};

================
File: src/components/Guild/Archetypes.tsx
================
import { FC, useState, useEffect } from 'react';
import { Trophy, Users, Star, Coins, Mountain, Heart, PartyPopper } from 'lucide-react';
import { guildService } from '../../services/guildService';
import { playerService } from '../../services/playerService';
import { CORE_GUILDS } from '../../types/guild';
import { calculateLevel } from '../../utils/levelCalculator';
import { supabase } from '../../lib/supabase';

export const Archetypes: FC = () => {
  const [archetypeStats, setArchetypeStats] = useState(CORE_GUILDS.map(guild => ({
    ...guild,
    memberCount: 0,
    totalXp: 0,
    averageLevel: 0
  })));
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadStats = async () => {
      try {
        setLoading(true);
        
        // Get all players from supabase
        const { data: players, error } = await supabase
          .from('players')
          .select('*')
          .not('archetype', 'is', null);

        if (error) throw error;

        // Calculate stats for each archetype
        const stats = CORE_GUILDS.map(guild => {
          // Get players with this archetype
          const archetypePlayers = players.filter(player => 
            player.archetype === guild.archetype
          );

          const totalXp = archetypePlayers.reduce((sum, player) => sum + (player.experience || 0), 0);
          const averageLevel = archetypePlayers.length > 0
            ? Math.floor(
                archetypePlayers.reduce((sum, player) => {
                  const { level } = calculateLevel(player.experience || 0);
                  return sum + level;
                }, 0) / archetypePlayers.length
              )
            : 0;

          return {
            ...guild,
            memberCount: archetypePlayers.length,
            totalXp,
            averageLevel
          };
        }).sort((a, b) => b.totalXp - a.totalXp);

        setArchetypeStats(stats);
      } catch (error) {
        console.error('Failed to load archetype stats:', error);
      } finally {
        setLoading(false);
      }
    };

    loadStats();
    const interval = setInterval(loadStats, 30000); // Refresh every 30 seconds

    return () => clearInterval(interval);
  }, []);

  const getArchetypeIcon = (archetype: string) => {
    switch (archetype) {
      case 'Finance':
        return <Coins className="w-6 h-6 text-yellow-400" />;
      case 'Adventurer':
        return <Mountain className="w-6 h-6 text-green-400" />;
      case 'Philanthropist':
        return <Heart className="w-6 h-6 text-red-400" />;
      case 'PartyAnimal':
        return <PartyPopper className="w-6 h-6 text-purple-400" />;
      default:
        return <Trophy className="w-6 h-6 text-primary-main" />;
    }
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-[200px]">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-main"></div>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {archetypeStats.map((archetype, index) => (
        <div
          key={archetype.id}
          className="bg-gradient-radial from-primary-main/5 via-primary-main/10 to-transparent backdrop-blur-sm rounded-xl p-6 border border-primary-main/20"
        >
          <div className="flex items-center gap-6">
            {/* Rank */}
            <div className="w-12 h-12 rounded-full bg-primary-main/10 flex items-center justify-center">
              <Trophy className={`w-6 h-6 ${
                index === 0 ? 'text-yellow-400' :
                index === 1 ? 'text-gray-400' :
                index === 2 ? 'text-amber-700' :
                'text-primary-main'
              }`} />
            </div>

            {/* Archetype Icon */}
            <div className="w-16 h-16 rounded-lg overflow-hidden border border-primary-main/20 flex items-center justify-center bg-black/40">
              {getArchetypeIcon(archetype.archetype)}
            </div>

            {/* Archetype Info */}
            <div className="flex-grow min-w-0">
              <h3 className="text-lg font-medium text-white mb-2">{archetype.name}</h3>
              <div className="flex items-center gap-6">
                <div className="flex items-center gap-2">
                  <Users className="w-4 h-4 text-primary-main" />
                  <span className="text-white">{archetype.memberCount} Members</span>
                </div>
                <div className="flex items-center gap-2">
                  <Star className="w-4 h-4 text-primary-main" />
                  <span className="text-white">{archetype.totalXp.toLocaleString()} XP</span>
                </div>
                {archetype.averageLevel > 0 && (
                  <div className="text-white">
                    Avg Level: {archetype.averageLevel}
                  </div>
                )}
              </div>
            </div>

            {/* Rank Display */}
            <div className="text-2xl font-bold text-primary-main">
              #{index + 1}
            </div>
          </div>
        </div>
      ))}
    </div>
  );
};

================
File: src/components/Guild/GuildJoinModal.tsx
================
import { FC, useState } from 'react';
import { X } from 'lucide-react';
import { useWallet } from '@solana/wallet-adapter-react';
import { guildService } from '../../services/guildService';
import { Guild } from '../../types/guild';

interface GuildJoinModalProps {
  guild: Guild;
  onClose: () => void;
  onSubmitted: () => void;
}

export const GuildJoinModal: FC<GuildJoinModalProps> = ({ guild, onClose, onSubmitted }) => {
  const { publicKey } = useWallet();
  const [message, setMessage] = useState('');
  const [error, setError] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async () => {
    if (!publicKey) return;
    if (!message.trim()) {
      setError('Please enter a message');
      return;
    }

    setIsSubmitting(true);
    try {
      const success = await guildService.submitMembershipRequest(
        guild.id,
        publicKey.toString(),
        message.trim()
      );
      
      if (success) {
        onSubmitted();
      } else {
        setError('Failed to submit request. Please try again.');
      }
    } catch (err) {
      setError('Failed to submit request. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={onClose}
      />
      <div className="relative w-full max-w-md bg-[#1A1B23] rounded-xl border border-primary-main/20 shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b border-primary-main/20">
          <h3 className="text-xl font-bold text-white">Join {guild.name}</h3>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="p-6 space-y-4">
          <div>
            <label className="block text-sm font-medium text-neutral-lightGray mb-2">
              Message to Guild Leaders
            </label>
            <textarea
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              placeholder="Tell us why you want to join this guild..."
              className="w-full px-4 py-3 bg-black/40 border border-primary-main/20 rounded-lg text-white placeholder-neutral-lightGray focus:outline-none focus:border-primary-main/40 min-h-[100px]"
            />
          </div>

          {error && (
            <p className="text-red-400 text-sm">{error}</p>
          )}

          <button
            onClick={handleSubmit}
            disabled={isSubmitting}
            className="w-full px-4 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors disabled:opacity-50"
          >
            {isSubmitting ? 'Submitting...' : 'Submit Request'}
          </button>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/Guild/GuildList.tsx
================
import { FC, useState, useEffect } from 'react';
import { Shield, Star, Users, TrendingUp, Search } from 'lucide-react';
import { guildService } from '../../services/guildService';
import { playerService } from '../../services/playerService';
import { Guild } from '../../types/guild';
import { GuildJoinModal } from './GuildJoinModal';
import { useWallet } from '@solana/wallet-adapter-react';
import { useNavigate } from 'react-router-dom';

type SortOption = 'xp' | 'members' | 'activity';

export const GuildList: FC = () => {
  const { publicKey } = useWallet();
  const navigate = useNavigate();
  const [guilds, setGuilds] = useState<Guild[]>([]);
  const [selectedGuild, setSelectedGuild] = useState<Guild | null>(null);
  const [loading, setLoading] = useState(true);
  const [showSuccess, setShowSuccess] = useState(false);
  const [sortBy, setSortBy] = useState<SortOption>('xp');
  const [searchQuery, setSearchQuery] = useState('');
  const [playerGuildId, setPlayerGuildId] = useState<string | null>(null);

  useEffect(() => {
    const loadGuilds = async () => {
      try {
        const communityGuilds = guildService.getCommunityGuilds();
        setGuilds(communityGuilds);
        
        // Get player's current guild
        if (publicKey) {
          const player = await playerService.getPlayer(publicKey.toString());
          setPlayerGuildId(player?.guild || null);
        }
      } catch (error) {
        console.error('Failed to load guilds:', error);
      } finally {
        setLoading(false);
      }
    };

    loadGuilds();
    guildService.addListener(loadGuilds);
    playerService.addEventListener(loadGuilds);

    return () => {
      guildService.removeListener(loadGuilds);
      playerService.removeEventListener(loadGuilds);
    };
  }, [publicKey]);

  const handleRequestSubmitted = () => {
    setSelectedGuild(null);
    setShowSuccess(true);
    setTimeout(() => setShowSuccess(false), 3000);
  };

  const handleMyGuildClick = () => {
    navigate('/guild?tab=my-guild');
  };

  const sortGuilds = (guilds: Guild[]) => {
    const filteredGuilds = guilds.filter(guild =>
      guild.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      guild.description.toLowerCase().includes(searchQuery.toLowerCase())
    );

    return filteredGuilds.sort((a, b) => {
      switch (sortBy) {
        case 'xp':
          return b.totalXp - a.totalXp;
        case 'members':
          return (b.members?.length || 0) - (a.members?.length || 0);
        case 'activity':
          return b.totalXp - a.totalXp;
        default:
          return 0;
      }
    });
  };

  const sortedGuilds = sortGuilds(guilds);

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-[200px]">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-main"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Guild Features Section */}
      <div className="bg-black/30 p-6 rounded-xl border border-primary-main/20 mb-8">
        <h2 className="text-2xl font-bold mb-4 text-primary-main">Guild Community Hub</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="flex items-center space-x-3">
            <Users className="text-primary-main" />
            <div>
              <h3 className="font-semibold">Guild Chat & Team Coordination</h3>
              <p className="text-sm text-neutral-lightGray">Real-time communication and team planning</p>
            </div>
          </div>
          <div className="flex items-center space-x-3">
            <TrendingUp className="text-primary-main" />
            <div>
              <h3 className="font-semibold">Guild Rankings & Raids</h3>
              <p className="text-sm text-neutral-lightGray">Compete in rankings and join epic raids</p>
            </div>
          </div>
          <div className="flex items-center space-x-3">
            <Shield className="text-primary-main" />
            <div>
              <h3 className="font-semibold">Guild Treasury & Rewards</h3>
              <p className="text-sm text-neutral-lightGray">Shared resources and team achievements</p>
            </div>
          </div>
        </div>
      </div>

      {/* Search and Sort Controls */}
      <div className="flex flex-col sm:flex-row gap-4">
        <div className="relative flex-1">
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            placeholder="Search guilds..."
            className="w-full px-4 py-2 pl-10 bg-black/40 border border-primary-main/20 rounded-lg text-white placeholder-neutral-lightGray focus:outline-none focus:border-primary-main/40"
          />
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-neutral-lightGray" />
        </div>

        <div className="flex gap-2">
          <button
            onClick={() => setSortBy('xp')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              sortBy === 'xp'
                ? 'bg-primary-main text-white'
                : 'bg-primary-main/20 text-neutral-lightGray hover:bg-primary-main/30'
            }`}
          >
            Total XP
          </button>
          <button
            onClick={() => setSortBy('members')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              sortBy === 'members'
                ? 'bg-primary-main text-white'
                : 'bg-primary-main/20 text-neutral-lightGray hover:bg-primary-main/30'
            }`}
          >
            Members
          </button>
          <button
            onClick={() => setSortBy('activity')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              sortBy === 'activity'
                ? 'bg-primary-main text-white'
                : 'bg-primary-main/20 text-neutral-lightGray hover:bg-primary-main/30'
            }`}
          >
            Activity
          </button>
        </div>
      </div>

      {/* Guild Grid */}
      <div>
        <h2 className="text-xl font-semibold mb-4">Example Guilds</h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          {sortedGuilds.map((guild) => (
            <div
              key={guild.id}
              onClick={() => setSelectedGuild(guild)}
              className="bg-black/40 border border-primary-main/20 rounded-lg p-4 cursor-pointer hover:border-primary-main/40 transition-all duration-200 transform hover:scale-[1.02] max-w-[280px]"
            >
              <div className="flex items-center gap-6">
                {/* Guild Image */}
                <div className="w-16 h-16 rounded-lg overflow-hidden border border-primary-main/20">
                  {guild.imageUrl ? (
                    <img
                      src={guild.imageUrl}
                      alt={guild.name}
                      className="w-full h-full object-cover"
                    />
                  ) : (
                    <div className="w-full h-full bg-primary-main/10 flex items-center justify-center">
                      <Shield className="w-8 h-8 text-primary-main" />
                    </div>
                  )}
                </div>

                {/* Guild Info */}
                <div className="flex-grow min-w-0">
                  <h3 className="text-lg font-medium text-white mb-2">{guild.name}</h3>
                  <p className="text-base text-text-light-secondary dark:text-text-dark-secondary leading-relaxed line-clamp-2">
                    {guild.description}
                  </p>
                </div>

                {/* Stats */}
                <div className="flex items-center gap-6">
                  <div className="flex items-center gap-2">
                    <Users className="w-4 h-4 text-primary-main" />
                    <span className="text-white">{guild.members?.length || 0} Members</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Star className="w-4 h-4 text-primary-main" />
                    <span className="text-white">{guild.totalXp.toLocaleString()} XP</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <TrendingUp className="w-4 h-4 text-primary-main" />
                    <span className="text-white">Level {Math.floor(guild.totalXp / 1000)}</span>
                  </div>
                </div>

                {/* Join/My Guild Button */}
                {guild.id === playerGuildId ? (
                  <button
                    onClick={handleMyGuildClick}
                    className="px-6 py-2 bg-primary-main/20 text-primary-main rounded-lg hover:bg-primary-main/30 transition-colors shadow-glow whitespace-nowrap"
                  >
                    My Guild
                  </button>
                ) : !playerGuildId && (
                  <button
                    onClick={() => setSelectedGuild(guild)}
                    className="px-6 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors shadow-glow whitespace-nowrap"
                  >
                    Request to Join
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>

      {sortedGuilds.length === 0 && (
        <div className="text-center py-8 text-text-light-secondary dark:text-text-dark-secondary">
          No guilds found
        </div>
      )}

      {selectedGuild && (
        <GuildJoinModal
          guild={selectedGuild}
          onClose={() => setSelectedGuild(null)}
          onSubmitted={handleRequestSubmitted}
        />
      )}

      {/* Success Message */}
      {showSuccess && (
        <div className="fixed bottom-4 right-4 px-6 py-3 bg-green-500 text-white rounded-lg shadow-lg animate-fade-in">
          Request submitted successfully!
        </div>
      )}
    </div>
  );
};

================
File: src/components/Guild/GuildManagement.tsx
================
import { FC, useState, useEffect } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { guildService } from '../../services/guildService';
import { Guild } from '../../types/guild';
import { AddGuildModal } from '../Admin/AddGuildModal';
import { Plus, Users, Star, Shield } from 'lucide-react';

interface GuildManagementProps {
  wallet: string;
}

export const GuildManagement: FC<GuildManagementProps> = ({ wallet }) => {
  const [guilds, setGuilds] = useState<Guild[]>([]);
  const [showAddModal, setShowAddModal] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadGuilds = () => {
      try {
        const userGuilds = guildService.getCommunityGuilds()
          .filter(guild => guild.leaders?.includes(wallet));
        setGuilds(userGuilds);
      } catch (error) {
        console.error('Failed to load guilds:', error);
      } finally {
        setLoading(false);
      }
    };

    loadGuilds();
    guildService.addListener(loadGuilds);

    return () => {
      guildService.removeListener(loadGuilds);
    };
  }, [wallet]);

  const handleAddGuild = (formData: {
    name: string;
    description: string;
    imageUrl?: string;
    archetype: any;
  }) => {
    const newGuild = guildService.createGuild({
      ...formData,
      leaders: [wallet],
      isCore: false
    });

    if (newGuild) {
      setShowAddModal(false);
    }
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-[200px]">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-main"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h2 className="text-xl font-bold text-white">Manage Your Guilds</h2>
        <button
          onClick={() => setShowAddModal(true)}
          className="flex items-center gap-2 px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
        >
          <Plus className="w-4 h-4" />
          Create New Guild
        </button>
      </div>

      {guilds.length > 0 ? (
        <div className="space-y-4">
          {guilds.map((guild) => (
            <div
              key={guild.id}
              className="gradient-box p-6 hover:border-primary-main/40 transition-all"
            >
              <div className="flex items-center gap-6">
                {/* Guild Image */}
                <div className="w-16 h-16 rounded-lg overflow-hidden border border-primary-main/20">
                  {guild.imageUrl ? (
                    <img
                      src={guild.imageUrl}
                      alt={guild.name}
                      className="w-full h-full object-cover"
                    />
                  ) : (
                    <div className="w-full h-full bg-primary-main/10 flex items-center justify-center">
                      <Shield className="w-8 h-8 text-primary-main" />
                    </div>
                  )}
                </div>

                {/* Guild Info */}
                <div className="flex-grow min-w-0">
                  <h3 className="text-lg font-medium text-white mb-2">{guild.name}</h3>
                  <p className="text-base text-text-light-secondary dark:text-text-dark-secondary leading-relaxed line-clamp-2">
                    {guild.description}
                  </p>
                </div>

                {/* Stats */}
                <div className="flex items-center gap-6">
                  <div className="flex items-center gap-2">
                    <Users className="w-4 h-4 text-primary-main" />
                    <span className="text-white">{guild.members?.length || 0} Members</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Star className="w-4 h-4 text-primary-main" />
                    <span className="text-white">{guild.totalXp.toLocaleString()} XP</span>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div className="text-center py-8 text-text-light-secondary dark:text-text-dark-secondary">
          You are not managing any guilds yet
        </div>
      )}

      {showAddModal && (
        <AddGuildModal
          onClose={() => setShowAddModal(false)}
          onSubmit={handleAddGuild}
        />
      )}
    </div>
  );
};

================
File: src/components/Guild/index.tsx
================
import { FC, useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useWallet } from '@solana/wallet-adapter-react';
import { ConnectPrompt } from '../ConnectPrompt';
import { GuildList } from './GuildList';
import { MyGuild } from './MyGuild';
import { GuildManagement } from './GuildManagement';
import { Archetypes } from './Archetypes';
import { guildService } from '../../services/guildService';
import { playerService } from '../../services/playerService';
import { ContentBox } from '../ContentBox';
import { GlassPanel } from '../GlassPanel';

export const Guild: FC = () => {
  const { connected, publicKey } = useWallet();
  const navigate = useNavigate();
  const [activeTab, setActiveTab] = useState<'archetypes' | 'all-guilds' | 'my-guild' | 'manage'>('archetypes');
  const [isGuildLeader, setIsGuildLeader] = useState(false);
  const [playerGuildId, setPlayerGuildId] = useState<string | null>(null);

  useEffect(() => {
    if (publicKey) {
      const player = playerService.getPlayer(publicKey.toString());
      setPlayerGuildId(player?.guild || null);
      setIsGuildLeader(guildService.isGuildLeader(publicKey.toString()));
    }
  }, [publicKey]);

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="space-y-8">
      <ContentBox title="Guild System">
        <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
          Join a guild and compete with other raiders
        </p>

        {/* Tab Selection */}
        <div className="flex flex-wrap justify-center gap-4 mb-8">
          <button
            onClick={() => setActiveTab('archetypes')}
            className={`px-6 py-3 rounded-xl font-semibold transition-all ${
              activeTab === 'archetypes'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            Archetypes
          </button>

          <button
            onClick={() => setActiveTab('all-guilds')}
            className={`px-6 py-3 rounded-xl font-semibold transition-all ${
              activeTab === 'all-guilds'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            All Guilds
          </button>

          <button
            onClick={() => setActiveTab('my-guild')}
            className={`px-6 py-3 rounded-xl font-semibold transition-all ${
              activeTab === 'my-guild'
                ? 'bg-primary-main text-white shadow-glow'
                : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
            }`}
          >
            My Guild
          </button>

          {isGuildLeader && (
            <button
              onClick={() => setActiveTab('manage')}
              className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                activeTab === 'manage'
                  ? 'bg-primary-main text-white shadow-glow'
                  : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
              }`}
            >
              Manage Guild
            </button>
          )}
        </div>

        {/* Content */}
        <GlassPanel>
          {activeTab === 'archetypes' && <Archetypes />}
          {activeTab === 'all-guilds' && <GuildList />}
          {activeTab === 'my-guild' && (
            <MyGuild 
              onBrowseGuilds={() => setActiveTab('all-guilds')} 
            />
          )}
          {activeTab === 'manage' && isGuildLeader && publicKey && (
            <GuildManagement wallet={publicKey.toString()} />
          )}
        </GlassPanel>
      </ContentBox>
    </div>
  );
};

================
File: src/components/Guild/JoinRequestModal.tsx
================
import { FC, useState } from 'react';
import { X } from 'lucide-react';
import { useWallet } from '@solana/wallet-adapter-react';
import { guildService } from '../../services/guildService';

interface JoinRequestModalProps {
  guildId: string;
  onClose: () => void;
  onSubmitted: () => void;
}

export const JoinRequestModal: FC<JoinRequestModalProps> = ({ guildId, onClose, onSubmitted }) => {
  const { publicKey } = useWallet();
  const [message, setMessage] = useState('');
  const [error, setError] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  const guild = guildService.getGuildById(guildId);
  if (!guild || !publicKey) return null;

  const handleSubmit = async () => {
    if (!message.trim()) {
      setError('Please enter a message');
      return;
    }

    setIsSubmitting(true);
    try {
      const success = await guildService.submitMembershipRequest(
        guildId,
        publicKey.toString(),
        message
      );
      
      if (success) {
        onSubmitted();
        onClose();
      } else {
        setError('Failed to submit request. Please try again.');
      }
    } catch (err) {
      setError('Failed to submit request. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={onClose}
      />
      <div className="relative w-full max-w-md bg-[#1A1B23] rounded-xl border border-primary-main/20 shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b border-primary-main/20">
          <h3 className="text-xl font-bold text-white">Join {guild.name}</h3>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="p-6 space-y-4">
          <div>
            <label className="block text-sm font-medium text-neutral-lightGray mb-2">
              Message to Guild Leaders
            </label>
            <textarea
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              placeholder="Tell us why you want to join this guild..."
              className="w-full px-4 py-3 bg-black/40 border border-primary-main/20 rounded-lg text-white placeholder-neutral-lightGray focus:outline-none focus:border-primary-main/40 min-h-[100px]"
            />
          </div>

          {error && (
            <p className="text-red-400 text-sm">{error}</p>
          )}

          <button
            onClick={handleSubmit}
            disabled={isSubmitting}
            className="w-full px-4 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors disabled:opacity-50"
          >
            {isSubmitting ? 'Submitting...' : 'Submit Request'}
          </button>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/Guild/MyGuild.tsx
================
import { FC, useState, useEffect } from 'react';
import { Trophy, Star, Users, Crown, Shield, TrendingUp } from 'lucide-react';
import { useWallet } from '@solana/wallet-adapter-react';
import { guildService } from '../../services/guildService';
import { playerService } from '../../services/playerService';
import { calculateLevel } from '../../utils/levelCalculator';
import { ProfilePicture } from '../ProfilePicture';
import { Guild } from '../../types/guild';

interface MyGuildProps {
  onBrowseGuilds: () => void;
}

export const MyGuild: FC<MyGuildProps> = ({ onBrowseGuilds }) => {
  const { publicKey } = useWallet();
  const [guild, setGuild] = useState<Guild | null>(null);
  const [members, setMembers] = useState<any[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const loadGuildData = async () => {
      if (!publicKey) return;

      setIsLoading(true);
      try {
        const player = playerService.getPlayer(publicKey.toString());
        if (player?.guild) {
          const playerGuild = guildService.getGuildById(player.guild);
          if (playerGuild) {
            setGuild(playerGuild);
            const guildMembers = guildService.getGuildMembers(playerGuild.id);
            setMembers(guildMembers);
          }
        }
      } catch (error) {
        console.error('Error loading guild data:', error);
      } finally {
        setIsLoading(false);
      }
    };

    loadGuildData();

    // Set up interval to refresh data
    const interval = setInterval(loadGuildData, 5000);

    return () => clearInterval(interval);
  }, [publicKey]);

  if (isLoading) {
    return (
      <div className="flex justify-center items-center min-h-[200px]">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-main"></div>
      </div>
    );
  }

  if (!publicKey) return null;

  const player = playerService.getPlayer(publicKey.toString());
  if (!player?.guild || !guild) {
    return (
      <div className="text-center py-12">
        <h3 className="text-xl font-semibold text-white mb-4">No Guild</h3>
        <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
          You are not currently a member of any guild.
        </p>
        <button
          onClick={onBrowseGuilds}
          className="px-6 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors shadow-glow"
        >
          Browse Guilds
        </button>
      </div>
    );
  }

  const totalXp = members.reduce((sum, member) => {
    const player = playerService.getPlayer(member.wallet);
    return sum + (player?.experience || 0);
  }, 0);

  const averageLevel = Math.floor(
    members.reduce((sum, member) => {
      const player = playerService.getPlayer(member.wallet);
      if (!player) return sum;
      const { level } = calculateLevel(player.experience);
      return sum + level;
    }, 0) / (members.length || 1)
  );

  const isGuildLeader = guild.leaders?.includes(publicKey.toString());

  return (
    <div className="space-y-8">
      {/* Guild Header */}
      <div className="flex flex-col md:flex-row items-start gap-6">
        <div className="w-32 h-32 rounded-lg overflow-hidden border border-primary-main/20 flex-shrink-0">
          {guild.imageUrl ? (
            <img
              src={guild.imageUrl}
              alt={guild.name}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full bg-primary-main/10 flex items-center justify-center">
              <Shield className="w-12 h-12 text-primary-main" />
            </div>
          )}
        </div>

        <div className="flex-1">
          <div className="flex items-center gap-2 mb-2">
            <h2 className="text-2xl font-bold text-white">{guild.name}</h2>
            {isGuildLeader && (
              <span className="px-2 py-1 bg-primary-main/20 text-primary-main text-sm rounded-full">
                Guild Leader
              </span>
            )}
          </div>
          <p className="text-text-light-secondary dark:text-text-dark-secondary mb-4">
            {guild.description}
          </p>
          <div className="flex flex-wrap items-center gap-6">
            <div className="flex items-center gap-2">
              <Users className="w-4 h-4 text-primary-main" />
              <span className="text-white">{members.length} Members</span>
            </div>
            <div className="flex items-center gap-2">
              <Star className="w-4 h-4 text-primary-main" />
              <span className="text-white">{totalXp.toLocaleString()} XP</span>
            </div>
            <div className="flex items-center gap-2">
              <TrendingUp className="w-4 h-4 text-primary-main" />
              <span className="text-white">Average Level {averageLevel}</span>
            </div>
          </div>
        </div>
      </div>

      {/* Member List */}
      <div>
        <h3 className="text-xl font-semibold text-white mb-4">Members</h3>
        <div className="space-y-4">
          {members.map(member => {
            const memberPlayer = playerService.getPlayer(member.wallet);
            if (!memberPlayer) return null;

            const { level } = calculateLevel(memberPlayer.experience);
            const isGuildLeader = guild.leaders?.includes(member.wallet);

            return (
              <div
                key={member.wallet}
                className="flex items-center gap-4 p-4 bg-black/40 rounded-lg border border-primary-main/20"
              >
                <ProfilePicture wallet={member.wallet} size="md" />
                <div className="flex-grow min-w-0">
                  <div className="flex items-center gap-2">
                    <h4 className="text-white font-medium truncate">
                      {memberPlayer.username || `${member.wallet.slice(0, 4)}...${member.wallet.slice(-4)}`}
                    </h4>
                    {isGuildLeader && (
                      <Crown className="w-4 h-4 text-primary-main" />
                    )}
                  </div>
                  <p className="text-sm text-neutral-lightGray">
                    Joined {new Date(memberPlayer.dateJoined).toLocaleDateString()}
                  </p>
                </div>
                <div className="flex items-center gap-4">
                  <div className="text-white">Level {level}</div>
                  <div className="flex items-center gap-2">
                    <Star className="w-4 h-4 text-primary-main" />
                    <span className="text-white">{memberPlayer.experience.toLocaleString()} XP</span>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
};

================
File: src/components/Header.tsx
================
import { FC, useState, useEffect } from 'react';
import { WalletConnect } from './WalletConnect';
import { Navigation } from './Navigation';
import { Logo } from './Logo';

export const Header: FC = () => {
  const [isVisible, setIsVisible] = useState(true);
  const [isAtTop, setIsAtTop] = useState(true);
  const [lastScrollY, setLastScrollY] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      
      // Show header when scrolling up or at top
      setIsVisible(currentScrollY <= 0 || currentScrollY < lastScrollY);
      setIsAtTop(currentScrollY <= 0);
      setLastScrollY(currentScrollY);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, [lastScrollY]);

  return (
    <header 
      className={`fixed top-0 left-0 right-0 z-50 transition-all duration-300
        ${isVisible ? 'translate-y-0' : '-translate-y-full'}
        ${!isAtTop ? 'bg-white/80 dark:bg-black/80 backdrop-blur-lg shadow-lg' : 'bg-transparent'}`}
    >
      <div className="container mx-auto px-4">
        <div className="h-16 flex items-center justify-between">
          <Logo />
          <div className="flex items-center gap-2 sm:gap-4">
            <WalletConnect />
          </div>
        </div>
        
        {/* Navigation - Only visible on larger screens */}
        <div className="hidden lg:block pb-4">
          <Navigation />
        </div>

        {/* Mobile Navigation Button - Only visible on mobile */}
        <div className="lg:hidden flex justify-center pb-2">
          <Navigation />
        </div>
      </div>
    </header>
  );
};

================
File: src/components/HexagonBorder.tsx
================
import { FC } from 'react';

interface HexagonBorderProps {
  children: React.ReactNode;
  className?: string;
}

export const HexagonBorder: FC<HexagonBorderProps> = ({ children, className = '' }) => {
  return (
    <div className={`relative ${className}`}>
      <svg
        className="absolute inset-0 w-full h-full pointer-events-none"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M50 0L93.3013 25V75L50 100L6.69873 75V25L50 0Z"
          stroke="url(#hexagon-gradient)"
          strokeWidth="2"
          className="animate-pulse-slow"
        />
        <defs>
          <linearGradient
            id="hexagon-gradient"
            x1="0"
            y1="0"
            x2="100"
            y2="100"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0%" stopColor="#D24985" />
            <stop offset="50%" stopColor="#9071A8" />
            <stop offset="100%" stopColor="#D24985" />
          </linearGradient>
        </defs>
      </svg>
      {children}
    </div>
  );
};

================
File: src/components/HomePage/CallToActionSection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Button } from '../Button';
import { useNavigate } from 'react-router-dom';

export const CallToActionSection: FC = () => {
  const navigate = useNavigate();

  return (
    <div className="py-16">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center space-y-8">
          {/* Main Title */}
          <motion.h2
            className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-600"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            Ready to Start Your NFT Adventure?
          </motion.h2>

          {/* Description */}
          <motion.p
            className="text-base sm:text-lg text-gray-600 dark:text-sand-300 max-w-2xl mx-auto mb-8"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            Join RaidRally today and become part of the next generation of Web3 gaming
          </motion.p>

          {/* CTA Buttons */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
            <Button
              variant="primary"
              size="lg"
              className="bg-primary-500 hover:bg-primary-600 text-white font-semibold px-8 py-3 rounded-xl"
              onClick={() => navigate('/profile')}
            >
              Get Started Now
            </Button>
            <Button
              variant="secondary"
              size="lg"
              className="bg-white/50 dark:bg-black/10 hover:bg-white/60 dark:hover:bg-black/20 
                       text-sand-900 dark:text-sand-100 font-semibold px-8 py-3 rounded-xl
                       border border-sand-200/20 dark:border-white/10"
              onClick={() => {
                const element = document.getElementById('learn-more');
                element?.scrollIntoView({ behavior: 'smooth' });
              }}
            >
              Learn More
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/CommunitySection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Users, Trophy, Coins, MessageSquare, Shield, Target } from 'lucide-react';

interface Stat {
  icon: typeof Users;
  label: string;
  value: string;
  suffix?: string;
  description: string;
}

const stats: Stat[] = [
  {
    icon: Users,
    label: 'Active Raiders',
    value: '50',
    suffix: 'K+',
    description: 'Join our growing community of dedicated players'
  },
  {
    icon: Trophy,
    label: 'Raids Completed',
    value: '1',
    suffix: 'M+',
    description: 'Successfully completed raids and counting'
  },
  {
    icon: Coins,
    label: '$RAID Distributed',
    value: '100',
    suffix: 'M+',
    description: 'Rewards earned by our community members'
  }
];

export const CommunitySection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-8 sm:py-12 lg:py-16">
      <div className="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8">
        {/* Section Header - Centered Above */}
        <div className="text-center mb-8 sm:mb-12 lg:mb-16">
          <motion.h2 
            className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-600"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            Join Our Community
          </motion.h2>
          <motion.p 
            className="text-base sm:text-lg text-gray-600 dark:text-sand-300 max-w-2xl mx-auto mb-8"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            Connect with fellow raiders and stay updated on the latest news and events
          </motion.p>
        </div>

        {/* Two Column Layout */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-12 lg:gap-16 items-center">
          {/* Left Column - Image */}
          <motion.div 
            className="relative h-[400px] sm:h-[500px] lg:h-full mx-auto w-full max-w-sm lg:max-w-none"
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            <div className="relative rounded-3xl overflow-hidden shadow-xl shadow-primary-500/10 h-full">
              {/* Gradient Overlay */}
              <div className="absolute inset-0 bg-gradient-to-t from-background-900/80 via-background-900/20 to-transparent z-10" />
              
              {/* Image */}
              <img 
                src="/assets/social.png" 
                alt="Join our community" 
                className="absolute inset-0 w-full h-full object-cover object-center transform hover:scale-110 transition-transform duration-700"
              />
              
              {/* Decorative Elements */}
              <div className="absolute inset-0 bg-primary-500/10 mix-blend-overlay" />
              <div className="absolute inset-0 rounded-3xl ring-1 ring-white/20" />
            </div>
          </motion.div>

          {/* Right Column - Content */}
          <div className="space-y-6 sm:space-y-8">
            <motion.div 
              className="space-y-4"
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ duration: 0.6, delay: 0.2 }}
            >
              <p className="text-base sm:text-lg text-gray-600 dark:text-sand-300">
                RaidRally brings together gamers, NFT enthusiasts, and crypto lovers in an exciting Web3 gaming experience.
              </p>
              <p className="text-base sm:text-lg text-gray-600 dark:text-sand-300">
                Collaborate with fellow raiders, strategize for epic boss battles, and earn valuable rewards. Our community-driven platform ensures every player's contribution is valued and rewarded.
              </p>
            </motion.div>

            {/* Stats Grid with Buttons */}
            <div className="space-y-6 lg:space-y-8">
              {/* Stats Grid */}
              <motion.div 
                className="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6"
                variants={containerVariants}
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true }}
              >
                {stats.map((stat, index) => (
                  <motion.div
                    key={stat.label}
                    variants={itemVariants}
                    className={`group relative bg-white/10 dark:bg-black/10 backdrop-blur-sm rounded-2xl overflow-hidden 
                             border border-sand-200/20 dark:border-white/10 
                             hover:border-primary-500/50 transition-all duration-300
                             ${index === 2 ? 'col-span-2 sm:col-span-1' : ''}`}
                  >
                    <div className="p-3 sm:p-4 text-center">
                      <div className="inline-flex items-center justify-center w-8 h-8 sm:w-12 sm:h-12 mb-2 sm:mb-3 rounded-xl 
                                  bg-primary-500/10 group-hover:bg-primary-500/20 transition-colors">
                        <stat.icon className="w-4 h-4 sm:w-6 sm:h-6 text-primary-500" />
                      </div>
                      <div className="text-xl sm:text-2xl font-bold text-gray-900 dark:text-sand-100">
                        {stat.value}
                        <span className="text-primary-500">{stat.suffix}</span>
                      </div>
                      <div className="text-sm sm:text-base text-gray-600 dark:text-sand-400 font-medium mb-1 sm:mb-2">
                        {stat.label}
                      </div>
                      <div className="text-xs sm:text-sm text-gray-600 dark:text-sand-400">
                        {stat.description}
                      </div>
                    </div>
                  </motion.div>
                ))}

                {/* Call to Action Buttons - Now part of the grid */}
                <motion.div
                  variants={itemVariants}
                  className="col-span-2 sm:col-span-1 flex flex-col sm:flex-row lg:justify-center gap-4 items-stretch min-h-[48px]"
                >
                  <button 
                    className="flex-1 lg:flex-initial lg:w-40 inline-flex items-center justify-center px-6 py-3 rounded-xl 
                             bg-primary-500 hover:bg-primary-600 active:bg-primary-700
                             text-white font-semibold text-base
                             transition-all duration-200 ease-in-out
                             shadow-lg shadow-primary-500/20 hover:shadow-xl hover:shadow-primary-500/30
                             transform hover:-translate-y-0.5"
                  >
                    Join Discord
                  </button>
                  <button 
                    className="flex-1 lg:flex-initial lg:w-40 inline-flex items-center justify-center px-6 py-3 rounded-xl
                             bg-white/5 hover:bg-white/10 active:bg-white/15
                             text-gray-900 dark:text-sand-100 font-semibold text-base
                             transition-all duration-200 ease-in-out
                             border-2 border-sand-200/20 dark:border-white/10
                             hover:border-sand-200/30 dark:hover:border-white/20
                             shadow-lg shadow-black/5 hover:shadow-xl hover:shadow-black/10
                             transform hover:-translate-y-0.5"
                  >
                    Learn More
                  </button>
                </motion.div>
              </motion.div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/FAQSection.tsx
================
import { FC, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronDown, HelpCircle } from 'lucide-react';
import { GlassPanel } from '../GlassPanel';

const faqs = [
  {
    question: 'What is RaidRally?',
    answer: 'RaidRally is a Web3 gaming platform where players create, battle, and earn with unique NFT raid bosses. Join epic battles, build your collection, and earn rewards in our thriving community.'
  },
  {
    question: 'How do I start playing?',
    answer: 'Getting started is easy! Connect your wallet, mint or purchase your first raid boss NFT, and join ongoing raids. You can also create your own raid boss using our NFT Builder.'
  },
  {
    question: 'What are $RAID tokens?',
    answer: '$RAID is our in-game currency earned through participating in raids, winning battles, and contributing to the community. Use them for minting NFTs, upgrading raid bosses, or trade on exchanges.'
  },
  {
    question: 'How do raids work?',
    answer: 'Raids are collaborative battles where players team up to defeat powerful raid bosses. Success depends on strategy, timing, and coordination. Rewards are distributed based on contribution and performance.'
  },
  {
    question: 'Can I create my own raid boss?',
    answer: 'Yes! Use our NFT Builder to design unique raid bosses with custom attributes, abilities, and visual effects. Your creations can be used in battles or traded in our marketplace.'
  },
  {
    question: 'What makes RaidRally unique?',
    answer: 'RaidRally combines NFT creation, strategic gameplay, and community-driven rewards in a seamless Web3 experience. Every raid boss is unique, and every player contribution is valued and rewarded.'
  }
];

export const FAQSection: FC = () => {
  const [openIndex, setOpenIndex] = useState<number | null>(null);

  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-8 sm:py-12 lg:py-16">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Section Header */}
        <div className="text-center mb-8 sm:mb-12 lg:mb-16">
          <motion.h2 
            className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-600"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            Frequently Asked Questions
          </motion.h2>
          <motion.p 
            className="text-base sm:text-lg text-gray-600 dark:text-sand-300 max-w-2xl mx-auto mb-8"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            Find answers to common questions about RaidRally
          </motion.p>
        </div>

        {/* FAQ Grid */}
        <motion.div 
          variants={containerVariants}
          initial="hidden"
          whileInView="visible"
          viewport={{ once: true }}
          className="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 max-w-4xl mx-auto"
        >
          {faqs.map((faq, index) => (
            <motion.div
              key={index}
              variants={itemVariants}
            >
              <GlassPanel 
                className="h-full group hover:border-primary-500/50 transition-all duration-300"
                onClick={() => setOpenIndex(openIndex === index ? null : index)}
              >
                <div className="p-4 sm:p-6">
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex items-start gap-4">
                      <div className="flex-shrink-0 mt-1">
                        <HelpCircle className="w-5 h-5 text-primary-500" />
                      </div>
                      <span className="text-base sm:text-lg font-medium text-gray-900 dark:text-sand-100">
                        {faq.question}
                      </span>
                    </div>
                    <ChevronDown
                      className={`w-5 h-5 text-sand-500 transform transition-transform duration-200 flex-shrink-0 mt-1
                              ${openIndex === index ? 'rotate-180' : ''}`}
                    />
                  </div>
                  
                  <AnimatePresence>
                    {openIndex === index && (
                      <motion.div
                        initial={{ height: 0, opacity: 0 }}
                        animate={{ height: 'auto', opacity: 1 }}
                        exit={{ height: 0, opacity: 0 }}
                        transition={{ duration: 0.2 }}
                        className="mt-4 pl-9"
                      >
                        <div className="text-sm sm:text-base text-gray-600 dark:text-sand-400">
                          {faq.answer}
                        </div>
                      </motion.div>
                    )}
                  </AnimatePresence>
                </div>
              </GlassPanel>
            </motion.div>
          ))}
        </motion.div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/FeaturesSection.tsx
================
import React from 'react';
import { Sword, Shield, Trophy, Users, Gem, Zap } from 'lucide-react';

const features = [
  {
    icon: Sword,
    title: 'Epic Raid Battles',
    description: 'Challenge powerful raid bosses in intense strategic battles with your NFT team.',
  },
  {
    icon: Shield,
    title: 'Team Building',
    description: 'Create and customize your perfect raid team from unique NFT characters.',
  },
  {
    icon: Trophy,
    title: 'Rewards & Loot',
    description: 'Earn valuable rewards, rare NFTs, and tokens for completing raids.',
  },
  {
    icon: Users,
    title: 'Community Raids',
    description: 'Join forces with other players in cooperative raid events.',
  },
  {
    icon: Gem,
    title: 'NFT Marketplace',
    description: 'Trade and collect rare NFT characters in our integrated marketplace.',
  },
  {
    icon: Zap,
    title: 'Power Progression',
    description: 'Level up your characters and unlock powerful new abilities.',
  },
];

export const FeaturesSection: React.FC = () => {
  return (
    <section id="features" className="py-12 lg:py-20">
      <div className="container mx-auto px-4">
        <div className="text-center mb-10 lg:mb-16 animate-fade-in">
          <h2 className="text-4xl md:text-5xl font-title text-center mb-4
                        text-primary-main dark:text-orange-500">
            Platform Features
          </h2>
          <p className="text-xl text-center mb-12 
                       text-text-light-secondary dark:text-white/90 
                       max-w-2xl mx-auto">
            Experience the next generation of social gaming with these powerful features
          </p>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {features.map((feature, index) => (
            <div key={feature.title} 
                 className="bg-white/30 dark:bg-black/30 backdrop-blur-sm 
                        rounded-xl p-6 
                        border border-white/10
                        transform hover:scale-105 transition-all duration-300"
                 style={{ animationDelay: `${index * 100}ms` }}>
              <div className="text-primary-main dark:text-orange-500 mb-4">
                <feature.icon className="w-6 h-6 lg:w-7 lg:h-7" />
              </div>
              <h3 className="text-xl font-semibold mb-2 
                         text-text-light-primary dark:text-orange-500">
                {feature.title}
              </h3>
              <p className="text-text-light-secondary dark:text-white/90">
                {feature.description}
              </p>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

================
File: src/components/HomePage/GuildSection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Shield, Trophy, Users, Crown } from 'lucide-react';
import { useNavigate } from 'react-router-dom';

interface Guild {
  name: string;
  description: string;
  members: number;
  raidScore: number;
  specialization: string;
  icon: typeof Shield;
  banner: string;
}

const guilds: Guild[] = [
  {
    name: "Phoenix Raiders",
    description: "Elite raiders specializing in high-stakes missions",
    members: 150,
    raidScore: 9500,
    specialization: "High-Risk Raids",
    icon: Crown,
    banner: "bg-gradient-to-br from-orange-500 to-red-600"
  },
  {
    name: "Diamond Vanguard",
    description: "Strategic team focused on consistent raid victories",
    members: 120,
    raidScore: 8800,
    specialization: "Strategic Planning",
    icon: Shield,
    banner: "bg-gradient-to-br from-blue-500 to-purple-600"
  },
  {
    name: "Shadow Legion",
    description: "Stealth specialists with perfect raid execution",
    members: 100,
    raidScore: 8200,
    specialization: "Stealth Raids",
    icon: Users,
    banner: "bg-gradient-to-br from-gray-700 to-gray-900"
  },
  {
    name: "Crown Warriors",
    description: "Tournament champions and community leaders",
    members: 140,
    raidScore: 9200,
    specialization: "Tournament Play",
    icon: Trophy,
    banner: "bg-gradient-to-br from-yellow-400 to-yellow-600"
  }
];

export const GuildSection: FC = () => {
  const navigate = useNavigate();
  return (
    <div className="py-8 sm:py-12 lg:py-16">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Section Header */}
        <motion.div 
          className="text-center mb-8 sm:mb-12"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <motion.h2 
            className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-600"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            Unite & Conquer Together
          </motion.h2>
          <motion.p 
            className="text-base sm:text-lg text-gray-600 dark:text-sand-300 max-w-2xl mx-auto mb-8"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            Form guilds with other players to tackle challenging raids and earn greater rewards
          </motion.p>
        </motion.div>

        {/* Content Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-5 gap-8">
          {/* Guild Info - Left Side */}
          <motion.div 
            className="lg:col-span-2 space-y-6"
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.4 }}
          >
            <div className="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/20 dark:border-white/10">
              <h3 className="text-2xl font-bold text-gray-900 dark:text-sand-100 mb-4">
                Guild Features
              </h3>
              <div className="space-y-4">
                <div className="flex items-start space-x-3">
                  <Users className="w-5 h-5 mt-1 text-primary-500" />
                  <div>
                    <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100">Guild Chat & Team Coordination</h4>
                    <p className="text-gray-600 dark:text-sand-400">
                      Real-time communication and strategic planning with your guild members
                    </p>
                  </div>
                </div>
                <div className="flex items-start space-x-3">
                  <Trophy className="w-5 h-5 mt-1 text-primary-500" />
                  <div>
                    <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100">Guild Rankings & Raids</h4>
                    <p className="text-gray-600 dark:text-sand-400">
                      Compete in guild rankings and participate in epic raid missions
                    </p>
                  </div>
                </div>
                <div className="flex items-start space-x-3">
                  <Shield className="w-5 h-5 mt-1 text-primary-500" />
                  <div>
                    <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100">Guild Treasury</h4>
                    <p className="text-gray-600 dark:text-sand-400">
                      Share resources and rewards with your guild members
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div className="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/20 dark:border-white/10">
              <button 
                onClick={() => navigate('/guild')}
                className="w-full py-3 px-6 bg-primary-500 hover:bg-primary-600 text-white rounded-xl font-semibold transition-colors flex items-center justify-center space-x-2"
              >
                <Users className="w-5 h-5" />
                <span>Explore All Guilds</span>
              </button>
            </div>
          </motion.div>

          {/* Guild Grid - Right Side */}
          <motion.div 
            className="lg:col-span-3"
            initial={{ opacity: 0, x: 20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.4 }}
          >
            <h3 className="text-xl font-semibold text-gray-900 dark:text-sand-100 mb-4">Example Guilds</h3>
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              {guilds.map((guild, index) => (
                <motion.div
                  key={guild.name}
                  className="bg-white/5 backdrop-blur-sm rounded-xl border border-sand-200/20 dark:border-white/10 overflow-hidden hover:border-primary-500/50 transition-colors cursor-pointer"
                  initial={{ opacity: 0, y: 20 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  viewport={{ once: true }}
                  transition={{ duration: 0.4, delay: 0.1 * index }}
                >
                  <div className={`h-20 ${guild.banner} p-4 flex items-center justify-center`}>
                    <guild.icon className="w-8 h-8 text-white" />
                  </div>
                  <div className="p-4 space-y-2">
                    <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100">{guild.name}</h4>
                    <p className="text-sm text-gray-600 dark:text-sand-400">{guild.description}</p>
                    <div className="flex items-center justify-between text-sm text-gray-600 dark:text-sand-400">
                      <span>{guild.members} Members</span>
                      <span>{guild.specialization}</span>
                    </div>
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/HeroSection.tsx
================
import { FC, useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import { WalletMultiButton } from '@solana/wallet-adapter-react-ui';
import { useWallet } from '@solana/wallet-adapter-react';
import { Button } from '../Button';
import { useAudio } from '../../contexts/AudioContext';
import { useNavigate } from 'react-router-dom';

export const HeroSection: FC = () => {
  const { connected } = useWallet();
  const { isPlaying } = useAudio();
  const [hasScrolled, setHasScrolled] = useState(false);
  const navigate = useNavigate();

  return (
    <div className="relative min-h-[80vh] sm:min-h-[70vh] flex items-center justify-center overflow-hidden">
      {/* Video Background */}
      <div className="absolute inset-0 mx-2 sm:mx-6 lg:mx-8">
        <div className="relative w-full h-full rounded-3xl overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-b from-background-900/30 via-background-900/50 to-background-900/80 z-10" />
          <video
            autoPlay
            loop
            muted
            playsInline
            className="absolute inset-0 w-full h-full object-cover"
            style={{ opacity: isPlaying ? 1 : 0.5, transition: 'opacity 0.5s ease-in-out' }}
            poster="/assets/images/hero-poster.webp"
          >
            <source src="/videos/hero-background.webm" type="video/webm" />
            <source src="/videos/hero-background.mp4" type="video/mp4" />
          </video>
        </div>
      </div>

      {/* Content */}
      <div className="relative z-10 container mx-auto px-3 sm:px-4 py-6 sm:py-8 lg:py-12 flex flex-col items-center text-center">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="max-w-4xl mx-auto"
        >
          <h2 className="text-xl sm:text-2xl font-medium mb-2 text-sand-200">
            Welcome to
          </h2>
          <h1 className="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-6 sm:mb-8 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
            Pan Da Pan
          </h1>
          <p className="text-base sm:text-lg lg:text-xl text-sand-300 mb-8 sm:mb-10 max-w-2xl mx-auto">
            Join forces with fellow raiders, battle epic bosses, and earn valuable NFT rewards in this
            next-generation Web3 gaming experience.
          </p>

          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center max-w-md mx-auto sm:max-w-none">
            <WalletMultiButton className="!bg-primary-500 hover:!bg-primary-600 !transition-all !duration-300 !px-6 !py-3 !h-auto !rounded-xl" />

            

          </div>
        </motion.div>
      </div>

      {/* Decorative Elements */}
      <div className="absolute inset-0 pointer-events-none mx-2 sm:mx-6 lg:mx-8">
        <div className="relative w-full h-full rounded-3xl overflow-hidden">
          {/* Top gradient */}
          <div className="absolute top-0 inset-x-0 h-32 bg-gradient-to-b from-background-900 to-transparent" />
          
          {/* Bottom gradient */}
          <div className="absolute bottom-0 inset-x-0 h-32 bg-gradient-to-t from-background-900 to-transparent" />
          
          {/* Side gradients */}
          <div className="absolute inset-y-0 left-0 w-32 bg-gradient-to-r from-background-900 to-transparent" />
          <div className="absolute inset-y-0 right-0 w-32 bg-gradient-to-l from-background-900 to-transparent" />
        </div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/HomePage.tsx
================
import { FC } from 'react';
import { Link } from 'react-router-dom';
import { ArrowRight } from 'lucide-react';
import { motion } from 'framer-motion';
import { HeroSection } from './HeroSection';
import { NFTBuilderSection } from './NFTBuilderSection';
import { RaidBossesSection } from './RaidBossesSection';
import { QuestSection } from './QuestSection';
import { GuildSection } from './GuildSection';
import { CommunitySection } from './CommunitySection';
import { FAQSection } from './FAQSection';
import { CallToActionSection } from './CallToActionSection';

// Reusable section wrapper component with different styles
const SectionWrapper: FC<{ 
  children: React.ReactNode; 
  className?: string;
  variant?: 'default' | 'gradient' | 'dark' | 'highlight';
  fullWidth?: boolean;
}> = ({ children, className = '', variant = 'default', fullWidth = false }) => {
  const baseStyles = "backdrop-blur-md rounded-3xl transition-all duration-300 overflow-hidden";
  
  const variantStyles = {
    default: `bg-sand-100/95 dark:bg-black/40 
      border border-sand-300/50 dark:border-white/5 
      shadow-lg shadow-sand-400/20 dark:shadow-primary-500/20 
      hover:border-primary-500/20 dark:hover:border-primary-500/20
      hover:shadow-primary-500/10 dark:hover:shadow-primary-500/30`,
    gradient: `bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
      border border-primary-500/30 dark:border-primary-500/20
      shadow-xl shadow-primary-500/30 
      hover:shadow-primary-500/40 hover:border-primary-500/40`,
    dark: `bg-background-900/95 dark:bg-black/60
      border border-background-800/50 dark:border-white/10
      shadow-2xl shadow-black/40
      hover:border-primary-500/30 hover:shadow-primary-500/30`,
    highlight: `bg-gradient-to-br from-primary-500/30 via-sand-200/30 to-transparent
      border border-primary-500/40 dark:border-primary-500/30
      shadow-2xl shadow-primary-500/30
      hover:shadow-primary-500/50 hover:border-primary-500/50
      dark:from-primary-950 dark:via-background-900 dark:to-background-950`
  };

  const containerStyles = fullWidth ? 'w-full' : 'max-w-7xl mx-auto px-3 sm:px-6 lg:px-8';

  return (
    <div className={`${baseStyles} ${variantStyles[variant]} ${className}`}>
      <div className={`relative p-4 sm:p-8 lg:p-10 ${containerStyles}`}>
        {children}
      </div>
    </div>
  );
};

export const HomePage: FC = () => {
  return (
    <div className="relative space-y-12 sm:space-y-16 lg:space-y-24 pb-12 sm:pb-16 lg:pb-24">
      {/* Hero Section - Full width */}
      <section className="relative">
        <HeroSection />
      </section>

      {/* NFT Builder Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <NFTBuilderSection />
        </SectionWrapper>
      </section>

      {/* Raid Bosses Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <RaidBossesSection />
        </SectionWrapper>
      </section>

      {/* Quest Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <QuestSection />
        </SectionWrapper>
      </section>

      {/* Guild Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <GuildSection />
        </SectionWrapper>
      </section>

      {/* Community Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <CommunitySection />
        </SectionWrapper>
      </section>

      {/* FAQ Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <FAQSection />
        </SectionWrapper>
      </section>

      {/* Call to Action Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <CallToActionSection />
        </SectionWrapper>
      </section>
    </div>
  );
};

================
File: src/components/HomePage/index.ts
================
export { HomePage } from './HomePage';

================
File: src/components/HomePage/index.tsx
================
export { HomePage } from './HomePage';

================
File: src/components/HomePage/NFTBuilderSection.tsx
================
import { FC } from 'react';
import { Link } from 'react-router-dom';
import { ArrowRight } from 'lucide-react';
import { motion } from 'framer-motion';

export const NFTBuilderSection: FC = () => {
  return (
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div className="text-center mb-12">
        <motion.h2
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          className="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400"
        >
          Create Your Custom Panda PFP
        </motion.h2>
        <motion.p
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.2 }}
          className="mt-4 text-lg text-sand-700 dark:text-sand-300 max-w-3xl mx-auto"
        >
          Dive into the world of creativity with our easy-to-use NFT Builder! This tool lets anyone design a personalized 
          panda profile picture (PFP) inspired by the traits and layers of our RaidRally collection. Mix and match traits 
          like expressions, accessories, and backgrounds to craft a digital panda that's uniquely yours. While these designs 
          are separate from our official NFT collection, you can download your custom creation to use as a PFP or share it 
          with friends!
        </motion.p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
        {/* Left Side - 2x2 Grid */}
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <motion.div
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ delay: 0.1 }}
            className="bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-6 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-all duration-300"
          >
            <h3 className="text-xl font-semibold text-sand-900 dark:text-white mb-2">Start Designing</h3>
            <p className="text-sand-700 dark:text-sand-300">
              Choose from a variety of traits and layers to bring your panda vision to life.
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ delay: 0.2 }}
            className="bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-6 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-all duration-300"
          >
            <h3 className="text-xl font-semibold text-sand-900 dark:text-white mb-2">Real-Time Preview</h3>
            <p className="text-sand-700 dark:text-sand-300">
              Watch your panda take shape as you add and adjust traits.
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ delay: 0.3 }}
            className="bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-6 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-all duration-300"
          >
            <h3 className="text-xl font-semibold text-sand-900 dark:text-white mb-2">Download Your Creation</h3>
            <p className="text-sand-700 dark:text-sand-300">
              Save your personalized PFP directly to your device—completely free!
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ delay: 0.4 }}
            className="bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-6 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-all duration-300"
          >
            <h3 className="text-xl font-semibold text-sand-900 dark:text-white mb-2">Join the Community</h3>
            <p className="text-sand-700 dark:text-sand-300">
              Show off your design and connect with others who love the pandas as much as you do.
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ delay: 0.5 }}
            className="sm:col-span-2 mt-4"
          >
            <Link
              to="/nft-builder"
              className="inline-flex items-center px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-primary-500 to-primary-400 hover:from-primary-600 hover:to-primary-500 transition-all duration-200 shadow-lg shadow-primary-500/20 hover:shadow-primary-500/30"
            >
              Start Creating
              <ArrowRight className="ml-2 w-5 h-5" />
            </Link>
          </motion.div>
        </div>

        {/* Right Content - NFT Preview */}
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          whileInView={{ opacity: 1, scale: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.3 }}
          className="relative flex items-center"
        >
          <div className="aspect-square w-full rounded-2xl overflow-hidden border-2 border-sand-300/20 dark:border-sand-200/10 shadow-2xl shadow-primary-500/20">
            <img
              src="assets/defaultpfp.jpg"
              alt="Sample Panda NFT"
              className="w-full h-full object-cover"
            />
          </div>
          <div className="absolute -bottom-6 -right-6 w-24 h-24 bg-gradient-to-br from-primary-500 to-primary-400 rounded-full opacity-50 blur-2xl" />
          <div className="absolute -top-6 -left-6 w-32 h-32 bg-gradient-to-br from-sand-400 to-sand-300 rounded-full opacity-30 blur-2xl dark:opacity-20" />
        </motion.div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/QuestSection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Sword, Trophy, Target, Users, ArrowRight } from 'lucide-react';
import { useNavigate } from 'react-router-dom';

interface Quest {
  title: string;
  description: string;
  reward: string;
  difficulty: 'Easy' | 'Medium' | 'Hard' | 'Legendary';
  type: 'Daily' | 'Weekly' | 'Special';
  icon: typeof Sword;
}

const quests: Quest[] = [
  {
    title: "Twitter Warrior",
    description: "Like and Retweet 5 RaidRally community posts",
    reward: "50 $RAID",
    difficulty: "Easy",
    type: "Daily",
    icon: Target
  },
  {
    title: "Discord Champion",
    description: "Participate in 3 community discussions",
    reward: "100 $RAID",
    difficulty: "Medium",
    type: "Daily",
    icon: Users
  },
  {
    title: "Raid Leader",
    description: "Successfully complete 5 raids with your guild",
    reward: "500 $RAID",
    difficulty: "Hard",
    type: "Weekly",
    icon: Sword
  },
  {
    title: "Tournament Victor",
    description: "Win a RaidRally community tournament",
    reward: "1000 $RAID",
    difficulty: "Legendary",
    type: "Special",
    icon: Trophy
  }
];

const difficultyColors = {
  Easy: 'bg-green-500/10 text-green-500',
  Medium: 'bg-yellow-500/10 text-yellow-500',
  Hard: 'bg-orange-500/10 text-orange-500',
  Legendary: 'bg-purple-500/10 text-purple-500'
};

const typeColors = {
  Daily: 'bg-blue-500/10 text-blue-500',
  Weekly: 'bg-indigo-500/10 text-indigo-500',
  Special: 'bg-rose-500/10 text-rose-500'
};

export const QuestSection: FC = () => {
  const navigate = useNavigate();
  return (
    <div className="py-8 sm:py-12 lg:py-16">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Section Header */}
        <motion.div 
          className="text-center mb-8 sm:mb-12"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <motion.h2 
            className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-600"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            Available Quests
          </motion.h2>
          <motion.p 
            className="text-base sm:text-lg text-gray-600 dark:text-sand-300 max-w-2xl mx-auto"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            Complete quests to earn $RAID tokens and climb the ranks
          </motion.p>
        </motion.div>

        {/* Content Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-5 gap-8">
          {/* Quest Grid - Left Side */}
          <motion.div 
            className="lg:col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-4"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            {quests.map((quest, index) => (
              <motion.div
                key={quest.title}
                className="group relative bg-white/5 backdrop-blur-sm rounded-2xl overflow-hidden 
                         border border-sand-200/20 dark:border-white/10 
                         hover:border-primary-500/50 transition-all duration-300"
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.6, delay: 0.1 * index }}
              >
                <div className="p-6">
                  {/* Quest Icon */}
                  <div className="inline-flex items-center justify-center w-12 h-12 rounded-xl 
                              bg-primary-500/10 group-hover:bg-primary-500/20 transition-colors mb-4">
                    <quest.icon className="w-6 h-6 text-primary-500" />
                  </div>

                  {/* Quest Title */}
                  <h3 className="text-xl font-bold text-gray-900 dark:text-sand-100 mb-2">
                    {quest.title}
                  </h3>

                  {/* Quest Description */}
                  <p className="text-gray-600 dark:text-sand-400 mb-4">
                    {quest.description}
                  </p>

                  {/* Quest Metadata */}
                  <div className="flex flex-wrap gap-2 mt-auto">
                    {/* Difficulty Badge */}
                    <span className={`px-2.5 py-1 rounded-lg text-xs font-medium ${difficultyColors[quest.difficulty]}`}>
                      {quest.difficulty}
                    </span>

                    {/* Type Badge */}
                    <span className={`px-2.5 py-1 rounded-lg text-xs font-medium ${typeColors[quest.type]}`}>
                      {quest.type}
                    </span>

                    {/* Reward Badge */}
                    <span className="px-2.5 py-1 rounded-lg text-xs font-medium bg-primary-500/10 text-primary-500">
                      {quest.reward}
                    </span>
                  </div>
                </div>
              </motion.div>
            ))}
          </motion.div>

          {/* Quest Summary - Right Side */}
          <motion.div 
            className="lg:col-span-2 space-y-6"
            initial={{ opacity: 0, x: 20 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.4 }}
          >
            <div className="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/20 dark:border-white/10">
              <h3 className="text-2xl font-bold text-gray-900 dark:text-sand-100 mb-4">
                Quest Breakdown
              </h3>
              <div className="space-y-4">
                <div>
                  <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100 mb-2">Difficulty Levels</h4>
                  <div className="grid grid-cols-2 gap-2">
                    {Object.entries(difficultyColors).map(([difficulty, color]) => (
                      <div key={difficulty} className={`px-3 py-2 rounded-lg ${color} text-sm`}>
                        {difficulty}
                      </div>
                    ))}
                  </div>
                </div>
                <div>
                  <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100 mb-2">Quest Types</h4>
                  <div className="grid grid-cols-2 gap-2">
                    {Object.entries(typeColors).map(([type, color]) => (
                      <div key={type} className={`px-3 py-2 rounded-lg ${color} text-sm`}>
                        {type}
                      </div>
                    ))}
                  </div>
                </div>
                <div>
                  <h4 className="text-lg font-semibold text-gray-900 dark:text-sand-100 mb-2">Rewards</h4>
                  <p className="text-gray-600 dark:text-sand-400">
                    Complete quests to earn $RAID tokens. Higher difficulty quests offer greater rewards, ranging from 50 to 1000 $RAID tokens.
                  </p>
                </div>
              </div>
            </div>
            
            {/* Raid Navigation Button */}
            <div className="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/20 dark:border-white/10">
              <button 
                onClick={() => navigate('/raid')}
                className="w-full py-3 px-6 bg-primary-500 hover:bg-primary-600 text-white rounded-xl font-semibold transition-colors flex items-center justify-center space-x-2"
              >
                <Sword className="w-5 h-5" />
                <span>View All Raids</span>
                <ArrowRight className="w-5 h-5" />
              </button>
            </div>
          </motion.div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/RaidBossesSection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Sword, Users, Trophy, Target, Twitter, Heart, MessageCircle, Repeat } from 'lucide-react';

const raidBosses = [
  {
    name: 'Frank (DeGods)',
    difficulty: 'Extreme' as const,
    rewards: '5000-10000 $RAID',
    image: '/assets/raid/frank.jpg',
    description: 'Founder of DeGods & y00ts. Pioneer of the "DUST" ecosystem. Most influential builder in Solana NFTs.',
    twitter: '@frankdegods'
  },
  {
    name: 'Toly',
    difficulty: 'Extreme' as const,
    rewards: '5000-10000 $RAID',
    image: '/assets/raid/toly.jpg',
    description: 'Co-founder of Solana. Visionary behind the fastest blockchain in crypto.',
    twitter: '@aeyakovenko'
  },
  {
    name: 'PattyIce',
    difficulty: 'Hard' as const,
    rewards: '2500-5000 $RAID',
    image: '/assets/raid/pattyice.jpg',
    description: 'Elite NFT trader and market maker. Known for legendary calls and massive trades.',
    twitter: '@PattyIce_NFT'
  },
  {
    name: 'Cozy',
    difficulty: 'Hard' as const,
    rewards: '2500-5000 $RAID',
    image: '/assets/raid/cozypront.jpg',
    description: 'The Caller. Top alpha provider in the Solana ecosystem. Known for precise market insights.',
    twitter: '@cozypront'
  },
  {
    name: 'IcedKnife',
    difficulty: 'Hard' as const,
    rewards: '2500-5000 $RAID',
    image: '/assets/raid/icedknife.jpg',
    description: 'Prolific NFT trader and community leader. Sharp market analysis and consistent wins.',
    twitter: '@IcedKnife'
  },
  {
    name: 'EasyEats',
    difficulty: 'Hard' as const,
    rewards: '2500-5000 $RAID',
    image: '/assets/raid/easyeats.jpg',
    description: 'Bodega mastermind. High-volume trader with deep market expertise.',
    twitter: '@EasyEatsBodega'
  },
  {
    name: 'BAYC',
    difficulty: 'Extreme' as const,
    rewards: '5000-10000 $RAID',
    image: '/assets/raid/bored.jpg',
    description: 'The most prestigious NFT collection. Leading the way in Web3 culture and innovation.',
    twitter: '@BoredApeYC'
  },
  {
    name: 'Bonk!',
    difficulty: 'Hard' as const,
    rewards: '2500-5000 $RAID',
    image: '/assets/raid/bonk.jpg',
    description: 'The Solana meme coin that took the world by storm. Community-driven, fun-focused.',
    twitter: '@bonk_inu'
  }
];

const difficultyColors = {
  Easy: 'bg-green-500',
  Medium: 'bg-yellow-500',
  Hard: 'bg-orange-500',
  Extreme: 'bg-red-500',
};

export const RaidBossesSection: FC = () => {
  return (
    <div className="py-8 sm:py-12 lg:py-16">
      <div className="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8">
        {/* Section Header */}
        <div className="text-center mb-8 sm:mb-12">
          <motion.h2 
            className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-orange-600"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            Epic Raid Bosses
          </motion.h2>
          <motion.p 
            className="text-base sm:text-lg text-gray-600 dark:text-sand-300 max-w-2xl mx-auto mb-8"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            Battle against the most influential figures in Web3
          </motion.p>
        </div>

        {/* How Raids Work Section */}
        <motion.div 
          className="mb-8"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <div className="bg-white/50 dark:bg-black/10 backdrop-blur-sm rounded-2xl p-6 
                       border border-sand-200/20 dark:border-white/10">
            <div className="mt-12">
              <h3 className="text-2xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-orange-600">How Raids Work</h3>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
              <div 
                className="flex flex-col items-center text-center p-4 bg-white/30 dark:bg-black/30 rounded-xl cursor-pointer hover:bg-white/40 dark:hover:bg-black/40 transition-all duration-300"
                onClick={() => {
                  if (window.confirm('Would you like to view the Raid Boss\'s Twitter page?')) {
                    window.open('https://twitter.com/target_account', '_blank');
                  }
                }}
              >
                <Target className="w-10 h-10 text-primary-500 mb-3" />
                <h4 className="font-semibold mb-2 text-gray-900 dark:text-sand-100">Select Target</h4>
                <p className="text-sm text-gray-600 dark:text-sand-400">Choose from influential figures and top NFT projects</p>
              </div>
              <div 
                className="flex flex-col items-center text-center p-4 bg-white/30 dark:bg-black/30 rounded-xl cursor-pointer hover:bg-white/40 dark:hover:bg-black/40 transition-all duration-300"
                onClick={() => {
                  if (window.confirm('Would you like to view the Raid Boss\'s Twitter page?')) {
                    window.open('https://twitter.com/raid_party', '_blank');
                  }
                }}
              >
                <Users className="w-10 h-10 text-primary-500 mb-3" />
                <h4 className="font-semibold mb-2 text-gray-900 dark:text-sand-100">Form Raid Party</h4>
                <p className="text-sm text-gray-600 dark:text-sand-400">Team up with other raiders to increase your power</p>
              </div>
              <div 
                className="flex flex-col items-center text-center p-4 bg-white/30 dark:bg-black/30 rounded-xl cursor-pointer hover:bg-white/40 dark:hover:bg-black/40 transition-all duration-300"
                onClick={() => {
                  if (window.confirm('Would you like to view the Raid Boss\'s Twitter page?')) {
                    window.open('https://twitter.com/raid_attack', '_blank');
                  }
                }}
              >
                <Twitter className="w-10 h-10 text-primary-500 mb-3" />
                <h4 className="font-semibold mb-2 text-gray-900 dark:text-sand-100">Launch Attack</h4>
                <p className="text-sm text-gray-600 dark:text-sand-400">Engage with social content to deal damage</p>
              </div>
              <div 
                className="flex flex-col items-center text-center p-4 bg-white/30 dark:bg-black/30 rounded-xl cursor-pointer hover:bg-white/40 dark:hover:bg-black/40 transition-all duration-300"
                onClick={() => {
                  if (window.confirm('Would you like to view the Raid Boss\'s Twitter page?')) {
                    window.open('https://twitter.com/raid_rewards', '_blank');
                  }
                }}
              >
                <Trophy className="w-10 h-10 text-primary-500 mb-3" />
                <h4 className="font-semibold mb-2 text-gray-900 dark:text-sand-100">Earn Rewards</h4>
                <p className="text-sm text-gray-600 dark:text-sand-400">Claim $RAID tokens and special NFT rewards</p>
              </div>
            </div>

            <div className="space-y-4 text-gray-600 dark:text-sand-400">
              <p className="text-center mb-6">
                Raid bosses are Twitter influencers and NFT projects that players must team up to defeat. 
                Complete social quests to deal damage and earn rewards!
              </p>
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                <div className="flex items-center gap-2 justify-center">
                  <Heart className="w-5 h-5 text-primary-500" />
                  <span className="text-sm text-gray-900 dark:text-sand-100">Like Posts</span>
                </div>
                <div className="flex items-center gap-2 justify-center">
                  <Repeat className="w-5 h-5 text-primary-500" />
                  <span className="text-sm text-gray-900 dark:text-sand-100">Retweet</span>
                </div>
                <div className="flex items-center gap-2 justify-center">
                  <MessageCircle className="w-5 h-5 text-primary-500" />
                  <span className="text-sm text-gray-900 dark:text-sand-100">Comment</span>
                </div>
                <div className="flex items-center gap-2 justify-center">
                  <Users className="w-5 h-5 text-primary-500" />
                  <span className="text-sm text-gray-900 dark:text-sand-100">Follow</span>
                </div>
              </div>
            </div>
          </div>
        </motion.div>

        {/* Types of Raid Bosses Title */}
        <motion.div 
          className="text-center mb-6"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <div className="mt-12">
            <h3 className="text-2xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-orange-600">Types of Raid Bosses</h3>
          </div>
        </motion.div>

        {/* Raid Bosses Grid */}
        <motion.div 
          className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          {raidBosses.map((boss, index) => (
            <motion.div
              key={boss.name}
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ duration: 0.6, delay: index * 0.1 }}
              className="group h-full cursor-pointer"
              onClick={() => {
                if (window.confirm('Would you like to view the Raid Boss\'s Twitter page?')) {
                  window.open(`https://twitter.com/${boss.twitter.substring(1)}`, '_blank');
                }
              }}
            >
              <div className="relative bg-sand-50/80 dark:bg-black/40 rounded-2xl overflow-hidden border border-sand-200/50 dark:border-white/5 hover:border-primary-500/30 dark:hover:border-primary-500/30 transition-all duration-300 h-full flex flex-col">
                <div className="aspect-[1/1] relative">
                  <img 
                    src={boss.image} 
                    alt={boss.name}
                    className="absolute inset-0 w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"
                  />
                  <div className="absolute inset-0 bg-gradient-to-t from-background-900/80 to-transparent" />
                </div>
                <div className="p-4">
                  <div className="flex justify-between items-start mb-1.5">
                    <div>
                      <h3 className="text-base font-bold text-gray-900 dark:text-sand-100 mb-0.5">{boss.name}</h3>
                      <p className="text-xs text-gray-600 dark:text-sand-400">{boss.twitter}</p>
                    </div>
                    <span className={`px-2 py-0.5 rounded-full text-xs font-medium shrink-0
                      ${difficultyColors[boss.difficulty]}/10 text-${difficultyColors[boss.difficulty]}`}>
                      {boss.difficulty}
                    </span>
                  </div>
                  <p className="text-xs text-gray-600 dark:text-sand-400 mb-3 flex-grow line-clamp-2">{boss.description}</p>
                  <div className="flex items-center justify-between mt-auto">
                    <span className="text-xs font-medium text-gray-900 dark:text-sand-100">{boss.rewards}</span>
                    <button className="px-3 py-1.5 rounded-lg bg-primary-500/10 hover:bg-primary-500/20 
                                   text-primary-500 text-xs font-medium transition-colors">
                      Challenge
                    </button>
                  </div>
                </div>
              </div>
            </motion.div>
          ))}
        </motion.div>
      </div>
    </div>
  );
};

================
File: src/components/HomePage/TestimonialsSection.tsx
================
import { FC } from 'react';
import { Star, Quote } from 'lucide-react';
import { ContentBox } from '../ContentBox';
import { GlassPanel } from '../GlassPanel';

const TESTIMONIALS = [
  {
    name: 'CryptoRaider',
    avatar: '/assets/pandas/happypanda.PNG',
    role: 'Guild Leader',
    quote: 'The raid boss battles are incredibly engaging. Love teaming up with other raiders!',
    rating: 5
  },
  {
    name: 'NFTHunter',
    avatar: '/assets/pandas/nestledpanda.PNG',
    role: 'Veteran Player',
    quote: 'Best NFT gaming experience on Solana. The community is amazing!',
    rating: 5
  },
  {
    name: 'PandaWarrior',
    avatar: '/assets/pandas/sittingpanda.PNG',
    role: 'Top Raider',
    quote: 'The rewards system is fantastic. Every raid feels worthwhile.',
    rating: 5
  }
];

export const TestimonialsSection: FC = () => {
  return (
    <ContentBox>
      <div className="text-center mb-16">
        <h2 className="text-4xl md:text-5xl font-title 
                     bg-gradient-to-r from-primary-main to-primary-light dark:from-orange-400 dark:to-orange-500 
                     bg-clip-text text-transparent">
          Player Stories
        </h2>
        <p className="text-xl text-text-light-secondary dark:text-orange-300">
          Hear from our community
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {TESTIMONIALS.map((testimonial) => (
          <GlassPanel key={testimonial.name} className="relative">
            <Quote className="absolute top-6 right-6 w-8 h-8 text-primary-main/20" />
            
            <div className="flex items-center gap-4 mb-6">
              <div className="w-16 h-16 rounded-full overflow-hidden border-2 border-primary-main/20">
                <img 
                  src={testimonial.avatar}
                  alt={testimonial.name}
                  className="w-full h-full object-cover"
                />
              </div>
              <div>
                <h3 className="text-lg font-bold text-white">{testimonial.name}</h3>
                <p className="text-sm text-primary-main">{testimonial.role}</p>
              </div>
            </div>

            <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
              "{testimonial.quote}"
            </p>

            <div className="flex gap-1">
              {Array.from({ length: testimonial.rating }).map((_, i) => (
                <Star key={i} className="w-4 h-4 text-primary-main" fill="currentColor" />
              ))}
            </div>
          </GlassPanel>
        ))}
      </div>
    </ContentBox>
  );
};

================
File: src/components/InfoPage/CommunitySection.tsx
================
import { FC } from 'react';
import { Twitter, MessageCircle, Github, Users, Star, Heart } from 'lucide-react';
import { motion } from 'framer-motion';

const socialLinks = [
  {
    icon: Twitter,
    title: 'Follow on Twitter',
    description: 'Get the latest updates and announcements',
    href: '#',
    color: 'text-blue-400'
  },
  {
    icon: MessageCircle,
    title: 'Join Discord',
    description: 'Chat with players and share strategies',
    href: '#',
    color: 'text-indigo-400'
  },
  {
    icon: Github,
    title: 'Contribute on GitHub',
    description: 'Help shape the future of the platform',
    href: '#',
    color: 'text-gray-400'
  }
];

const stats = [
  {
    icon: Users,
    value: '10K+',
    label: 'Active Players',
    color: 'text-blue-400'
  },
  {
    icon: Star,
    value: '50K+',
    label: 'NFTs Minted',
    color: 'text-yellow-400'
  },
  {
    icon: Heart,
    value: '95%',
    label: 'Player Satisfaction',
    color: 'text-red-400'
  }
];

export const CommunitySection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-12 sm:py-16">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="text-center mb-12 sm:mb-16"
      >
        <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Join Our Community
        </h2>
        <p className="mt-4 text-lg text-gray-700 dark:text-sand-300 max-w-2xl mx-auto">
          Connect with fellow raiders, share strategies, and stay updated with the latest news
        </p>
      </motion.div>

      {/* Stats Section */}
      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8 mb-16"
      >
        {stats.map((stat) => (
          <motion.div
            key={stat.label}
            variants={itemVariants}
            className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
          >
            <div className="flex flex-col items-center text-center space-y-2">
              <div className="flex-shrink-0 w-12 h-12 rounded-xl bg-primary-500/10 flex items-center justify-center">
                <stat.icon className={`w-6 h-6 ${stat.color}`} />
              </div>
              <div>
                <div className="text-3xl font-bold text-gray-900 dark:text-sand-100">{stat.value}</div>
                <p className="mt-1 text-gray-600 dark:text-sand-400 text-sm">
                  {stat.label}
                </p>
              </div>
            </div>
            <div className="absolute inset-0 rounded-2xl ring-1 ring-white/10 group-hover:ring-primary-500/30 transition-colors duration-300" />
          </motion.div>
        ))}
      </motion.div>

      {/* Social Links */}
      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8"
      >
        {socialLinks.map((link) => (
          <motion.a
            key={link.title}
            href={link.href}
            variants={itemVariants}
            className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
          >
            <div className="flex items-center space-x-4">
              <div className="flex-shrink-0 w-12 h-12 rounded-xl bg-primary-500/10 flex items-center justify-center">
                <link.icon className={`w-6 h-6 ${link.color}`} />
              </div>
              <div className="flex-1 min-w-0">
                <h3 className="text-lg font-semibold text-gray-900 dark:text-sand-100 group-hover:text-primary-400 transition-colors duration-300">
                  {link.title}
                </h3>
                <p className="mt-1 text-gray-600 dark:text-sand-400 text-sm">
                  {link.description}
                </p>
              </div>
            </div>
            <div className="absolute inset-0 rounded-2xl ring-1 ring-white/10 group-hover:ring-primary-500/30 transition-colors duration-300" />
          </motion.a>
        ))}
      </motion.div>
    </div>
  );
};

================
File: src/components/InfoPage/FeaturesSection.tsx
================
import { FC } from 'react';
import { Gamepad2, Trophy, Coins, Users, Shield, Rocket } from 'lucide-react';
import { motion } from 'framer-motion';

const features = [
  {
    icon: Gamepad2,
    title: 'Play to Earn',
    description: 'Earn rewards by participating in raids and tournaments',
    iconColor: 'text-purple-400'
  },
  {
    icon: Trophy,
    title: 'Competitive Leagues',
    description: 'Climb the ranks and compete with the best raiders',
    iconColor: 'text-yellow-400'
  },
  {
    icon: Coins,
    title: 'NFT Marketplace',
    description: 'Trade unique in-game assets and collectibles',
    iconColor: 'text-green-400'
  },
  {
    icon: Users,
    title: 'Guild System',
    description: 'Form alliances and tackle challenges together',
    iconColor: 'text-blue-400'
  },
  {
    icon: Shield,
    title: 'Secure Platform',
    description: 'Built on Solana for fast and secure transactions',
    iconColor: 'text-red-400'
  },
  {
    icon: Rocket,
    title: 'Regular Updates',
    description: 'New content and features added regularly',
    iconColor: 'text-indigo-400'
  }
];

export const FeaturesSection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-12 sm:py-16">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="text-center mb-12 sm:mb-16"
      >
        <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Platform Features
        </h2>
        <p className="mt-4 text-lg text-gray-700 dark:text-sand-300 max-w-2xl mx-auto">
          Experience the future of gaming with our innovative features and rewards system
        </p>
      </motion.div>

      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8"
      >
        {features.map((feature) => (
          <motion.div
            key={feature.title}
            variants={itemVariants}
            className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
          >
            <div className="flex flex-col items-center text-center space-y-4">
              <div className="flex-shrink-0 w-16 h-16 rounded-xl bg-primary-500/10 flex items-center justify-center">
                <feature.icon className={`w-8 h-8 ${feature.iconColor}`} />
              </div>
              <div>
                <h3 className="text-xl font-semibold text-gray-900 dark:text-sand-100 group-hover:text-primary-400 transition-colors duration-300">
                  {feature.title}
                </h3>
                <p className="mt-2 text-gray-600 dark:text-sand-400 text-sm">
                  {feature.description}
                </p>
              </div>
            </div>
            <div className="absolute inset-0 rounded-2xl ring-1 ring-white/10 group-hover:ring-primary-500/30 transition-colors duration-300" />
          </motion.div>
        ))}
      </motion.div>
    </div>
  );
};

================
File: src/components/InfoPage/GuildSection.tsx
================
import { FC } from 'react';
import { ArrowRight, Coins, Mountain, Heart, PartyPopper, Users, Trophy, Star } from 'lucide-react';
import { motion } from 'framer-motion';

const archetypes = [
  {
    icon: Coins,
    title: 'The Aureus Coven',
    description: 'Masters of financial wisdom and strategic wealth building.',
    iconColor: 'text-yellow-400'
  },
  {
    icon: Mountain,
    title: 'The Emberseekers',
    description: 'Daring explorers guided by ancient flames.',
    iconColor: 'text-green-400'
  },
  {
    icon: Heart,
    title: 'The Solacebound',
    description: 'Guardians of peace and community welfare.',
    iconColor: 'text-red-400'
  },
  {
    icon: PartyPopper,
    title: 'The Revelkin',
    description: 'Celebrants of joy and festive spirit.',
    iconColor: 'text-purple-400'
  }
];

export const GuildSection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-12 sm:py-16">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="text-center mb-12 sm:mb-16"
      >
        <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Join a Guild
        </h2>
        <p className="mt-4 text-lg text-gray-700 dark:text-sand-300 max-w-2xl mx-auto">
          Unite with fellow raiders, compete in tournaments, and earn exclusive rewards together
        </p>
      </motion.div>

      {/* Guild Archetypes */}
      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 sm:gap-8 mb-16"
      >
        {archetypes.map((archetype) => (
          <motion.div
            key={archetype.title}
            variants={itemVariants}
            className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
          >
            <div className="flex flex-col items-center text-center space-y-4">
              <div className="flex-shrink-0 w-16 h-16 rounded-xl bg-primary-500/10 flex items-center justify-center">
                <archetype.icon className={`w-8 h-8 ${archetype.iconColor}`} />
              </div>
              <div>
                <h3 className="text-xl font-semibold text-gray-900 dark:text-sand-100 group-hover:text-primary-400 transition-colors duration-300">
                  {archetype.title}
                </h3>
                <p className="mt-2 text-gray-600 dark:text-sand-400 text-sm">
                  {archetype.description}
                </p>
              </div>
            </div>
            <div className="absolute inset-0 rounded-2xl ring-1 ring-white/10 group-hover:ring-primary-500/30 transition-colors duration-300" />
          </motion.div>
        ))}
      </motion.div>

      {/* Guild Benefits */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
        <motion.div
          initial={{ opacity: 0, x: -20 }}
          whileInView={{ opacity: 1, x: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
          className="lg:col-span-2"
        >
          <div className="relative rounded-2xl overflow-hidden">
            <img
              src="/assets/pandas/sittingpanda.PNG"
              alt="Guild Activities"
              className="w-full h-[300px] object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-background-900/80 via-background-900/40 to-transparent" />
          </div>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, x: 20 }}
          whileInView={{ opacity: 1, x: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
          className="space-y-6"
        >
          <h3 className="text-2xl font-bold text-gray-900 dark:text-sand-100">Guild Benefits</h3>
          <ul className="space-y-4">
            <li className="flex items-center space-x-3">
              <Users className="w-5 h-5 text-primary-400" />
              <span className="text-gray-700 dark:text-sand-300">Form powerful alliances</span>
            </li>
            <li className="flex items-center space-x-3">
              <Trophy className="w-5 h-5 text-primary-400" />
              <span className="text-gray-700 dark:text-sand-300">Compete in guild tournaments</span>
            </li>
            <li className="flex items-center space-x-3">
              <Star className="w-5 h-5 text-primary-400" />
              <span className="text-gray-700 dark:text-sand-300">Earn exclusive rewards</span>
            </li>
          </ul>
        </motion.div>
      </div>
    </div>
  );
};

================
File: src/components/InfoPage/HeroSection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';

export const HeroSection: FC = () => {
  return (
    <div className="relative min-h-[60vh] flex items-center justify-center overflow-hidden">
      {/* Background */}
      <div className="absolute inset-0 mx-2 sm:mx-6 lg:mx-8">
        <div className="relative w-full h-full rounded-3xl overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-b from-background-900/60 via-background-900/70 to-background-900/90 z-10" />
          <img 
            src="/assets/pandas/sittingpanda.PNG"
            alt="Pan Da Pan Info"
            className="absolute inset-0 w-full h-full object-cover transform hover:scale-105 transition-transform duration-700"
          />
          <div className="absolute inset-0 bg-primary-500/20 mix-blend-overlay" />
          <div className="absolute inset-0 rounded-3xl ring-1 ring-white/20" />
        </div>
      </div>

      {/* Content */}
      <div className="relative z-10 container mx-auto px-3 sm:px-4 py-6 sm:py-8 lg:py-12 flex flex-col items-center text-center">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="max-w-4xl mx-auto"
        >
          <h2 className="text-xl sm:text-2xl font-medium mb-2 text-sand-100">
            Discover
          </h2>
          <h1 className="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-6 sm:mb-8 bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
            Pan Da Pan
          </h1>
          <p className="text-base sm:text-lg lg:text-xl text-sand-200 mb-8 sm:mb-10 max-w-2xl mx-auto leading-relaxed">
            A revolutionary NFT gaming platform where your digital collectibles come to life in epic battles and quests. 
            Experience the future of gaming on Solana.
          </p>
        </motion.div>
      </div>
    </div>
  );
};

================
File: src/components/InfoPage/Info.tsx
================
import { FC } from 'react';
import { HeroSection } from './HeroSection';
import { FeaturesSection } from './FeaturesSection';
import { GuildSection } from './GuildSection';
import { CommunitySection } from './CommunitySection';
import { TokenomicsSection } from './TokenomicsSection';
import { RoadmapSection } from './RoadmapSection';
import { SecuritySection } from './SecuritySection';

// Reusable section wrapper component with different styles
const SectionWrapper: FC<{ 
  children: React.ReactNode; 
  className?: string;
  variant?: 'default' | 'gradient' | 'dark' | 'highlight';
  fullWidth?: boolean;
}> = ({ children, className = '', variant = 'default', fullWidth = false }) => {
  const baseStyles = "backdrop-blur-md rounded-3xl transition-all duration-300 overflow-hidden";
  
  const variantStyles = {
    default: `bg-sand-100/95 dark:bg-black/40 
      border border-sand-300/50 dark:border-white/5 
      shadow-lg shadow-sand-400/20 dark:shadow-primary-500/20 
      hover:border-primary-500/20 dark:hover:border-primary-500/20
      hover:shadow-primary-500/10 dark:hover:shadow-primary-500/30`,
    gradient: `bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
      border border-primary-500/30 dark:border-primary-500/20
      shadow-xl shadow-primary-500/30 
      hover:shadow-primary-500/40 hover:border-primary-500/40`,
    dark: `bg-background-900/95 dark:bg-black/60
      border border-background-800/50 dark:border-white/10
      shadow-2xl shadow-black/40
      hover:border-primary-500/30 hover:shadow-primary-500/30`,
    highlight: `bg-gradient-to-br from-primary-500/30 via-sand-200/30 to-transparent
      border border-primary-500/40 dark:border-primary-500/30
      shadow-2xl shadow-primary-500/30
      hover:shadow-primary-500/50 hover:border-primary-500/50
      dark:from-primary-950 dark:via-background-900 dark:to-background-950`
  };

  const containerStyles = fullWidth ? 'w-full' : 'max-w-7xl mx-auto px-3 sm:px-6 lg:px-8';

  return (
    <div className={`${baseStyles} ${variantStyles[variant]} ${className}`}>
      <div className={`relative p-4 sm:p-8 lg:p-10 ${containerStyles}`}>
        {children}
      </div>
    </div>
  );
};

export const Info: FC = () => {
  return (
    <div className="relative space-y-12 sm:space-y-16 lg:space-y-24 pb-12 sm:pb-16 lg:pb-24">
      {/* Hero Section - Full width */}
      <section className="relative">
        <SectionWrapper variant="highlight" fullWidth>
          <HeroSection />
        </SectionWrapper>
      </section>

      {/* Features Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <FeaturesSection />
        </SectionWrapper>
      </section>

      {/* Guild Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <GuildSection />
        </SectionWrapper>
      </section>

      {/* Tokenomics Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <TokenomicsSection />
        </SectionWrapper>
      </section>

      {/* Roadmap Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <RoadmapSection />
        </SectionWrapper>
      </section>

      {/* Security Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <SecuritySection />
        </SectionWrapper>
      </section>

      {/* Community Section */}
      <section className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <SectionWrapper variant="highlight">
          <CommunitySection />
        </SectionWrapper>
      </section>
    </div>
  );
};

================
File: src/components/InfoPage/RoadmapSection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Milestone, Rocket, Target, Users2, Zap, Brain, Sparkles } from 'lucide-react';

const roadmapData = [
  {
    icon: Rocket,
    phase: 'Phase 1',
    title: 'Launch & Core Features',
    items: [
      'Platform launch with basic raid mechanics',
      'NFT character system implementation',
      'Community building and social features',
      'Initial marketplace integration'
    ],
    status: 'completed',
    iconColor: 'text-green-400'
  },
  {
    icon: Target,
    phase: 'Phase 2',
    title: 'Expansion & Growth',
    items: [
      'Advanced raid mechanics and boss battles',
      'Guild system with governance features',
      'Token staking and rewards program',
      'Cross-chain integration'
    ],
    status: 'in-progress',
    iconColor: 'text-blue-400'
  },
  {
    icon: Brain,
    phase: 'Phase 3',
    title: 'AI Integration',
    items: [
      'AI Quest Master for dynamic quest generation',
      'Intelligent Raid Leader AI system',
      'Procedural lore and story generation',
      'AI-driven NPC interactions and dialogues'
    ],
    status: 'upcoming',
    iconColor: 'text-purple-400'
  },
  {
    icon: Sparkles,
    phase: 'Phase 4',
    title: 'Advanced AI Features',
    items: [
      'Adaptive difficulty AI for raids',
      'Personalized quest storylines',
      'Dynamic world events generation',
      'AI-powered guild strategy advisor'
    ],
    status: 'upcoming',
    iconColor: 'text-indigo-400'
  },
  {
    icon: Users2,
    phase: 'Phase 5',
    title: 'Community & DAO',
    items: [
      'DAO governance implementation',
      'Community-AI collaboration tools',
      'Advanced guild features',
      'Inter-guild tournaments with AI assistance'
    ],
    status: 'planned',
    iconColor: 'text-yellow-400'
  },
  {
    icon: Zap,
    phase: 'Phase 6',
    title: 'Future Innovation',
    items: [
      'Mobile app with AI integration',
      'Virtual reality raid experiences',
      'Advanced AI companion system',
      'Cross-game asset compatibility'
    ],
    status: 'planned',
    iconColor: 'text-red-400'
  }
];

export const RoadmapSection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.2,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, x: -20 },
    visible: { opacity: 1, x: 0 },
  };

  const getStatusStyles = (status: string) => {
    switch (status) {
      case 'completed':
        return 'bg-green-400/20 text-green-500 border-green-500/30';
      case 'in-progress':
        return 'bg-blue-400/20 text-blue-500 border-blue-500/30';
      case 'upcoming':
        return 'bg-purple-400/20 text-purple-500 border-purple-500/30';
      default:
        return 'bg-yellow-400/20 text-yellow-500 border-yellow-500/30';
    }
  };

  return (
    <div className="py-12 sm:py-16">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="text-center mb-12 sm:mb-16"
      >
        <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Development Roadmap
        </h2>
        <p className="mt-4 text-lg text-gray-700 dark:text-sand-300 max-w-2xl mx-auto">
          Our journey to revolutionize blockchain gaming
        </p>
      </motion.div>

      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="space-y-8"
      >
        {roadmapData.map((phase, index) => (
          <motion.div
            key={phase.phase}
            variants={itemVariants}
            className="relative"
          >
            <div className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300">
              <div className="flex flex-col md:flex-row items-start md:items-center gap-6">
                <div className="flex-shrink-0">
                  <div className="w-16 h-16 rounded-xl bg-primary-500/10 flex items-center justify-center">
                    <phase.icon className={`w-8 h-8 ${phase.iconColor}`} />
                  </div>
                </div>
                <div className="flex-grow">
                  <div className="flex flex-col md:flex-row md:items-center gap-4 mb-4">
                    <h3 className="text-xl font-semibold text-gray-900 dark:text-sand-100">
                      {phase.phase} - {phase.title}
                    </h3>
                    <span className={`inline-flex px-3 py-1 rounded-full text-sm font-medium ${getStatusStyles(phase.status)}`}>
                      {phase.status.charAt(0).toUpperCase() + phase.status.slice(1)}
                    </span>
                  </div>
                  <ul className="space-y-2">
                    {phase.items.map((item, itemIndex) => (
                      <li key={itemIndex} className="flex items-start">
                        <span className="mr-2 text-primary-500">•</span>
                        <span className="text-gray-600 dark:text-sand-400">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          </motion.div>
        ))}
      </motion.div>
    </div>
  );
};

================
File: src/components/InfoPage/SecuritySection.tsx
================
import { FC } from 'react';
import { motion } from 'framer-motion';
import { Shield, Lock, Key, FileCheck, Server, ShieldCheck } from 'lucide-react';

const securityFeatures = [
  {
    icon: Shield,
    title: 'Blockchain Security',
    description: 'Built on Solana for high-speed, secure transactions with minimal fees',
    iconColor: 'text-blue-400'
  },
  {
    icon: Lock,
    title: 'Smart Contract Audits',
    description: 'Regular third-party security audits of all smart contracts',
    iconColor: 'text-green-400'
  },
  {
    icon: Key,
    title: 'Wallet Integration',
    description: 'Secure wallet connections with industry-standard encryption',
    iconColor: 'text-yellow-400'
  },
  {
    icon: FileCheck,
    title: 'Asset Verification',
    description: 'Automated verification of NFT authenticity and ownership',
    iconColor: 'text-purple-400'
  },
  {
    icon: Server,
    title: 'Data Protection',
    description: 'Encrypted data storage with regular backups and monitoring',
    iconColor: 'text-red-400'
  },
  {
    icon: ShieldCheck,
    title: 'Anti-Cheat System',
    description: 'Advanced detection and prevention of exploits and cheating',
    iconColor: 'text-indigo-400'
  }
];

export const SecuritySection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-12 sm:py-16">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="text-center mb-12 sm:mb-16"
      >
        <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Security & Trust
        </h2>
        <p className="mt-4 text-lg text-gray-700 dark:text-sand-300 max-w-2xl mx-auto">
          Industry-leading security measures to protect our players and their assets
        </p>
      </motion.div>

      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8"
      >
        {securityFeatures.map((feature) => (
          <motion.div
            key={feature.title}
            variants={itemVariants}
            className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
          >
            <div className="flex flex-col items-center text-center space-y-4">
              <div className="flex-shrink-0 w-16 h-16 rounded-xl bg-primary-500/10 flex items-center justify-center">
                <feature.icon className={`w-8 h-8 ${feature.iconColor}`} />
              </div>
              <div>
                <h3 className="text-xl font-semibold text-gray-900 dark:text-sand-100 group-hover:text-primary-400 transition-colors duration-300">
                  {feature.title}
                </h3>
                <p className="mt-2 text-gray-600 dark:text-sand-400 text-sm">
                  {feature.description}
                </p>
              </div>
            </div>
          </motion.div>
        ))}
      </motion.div>
    </div>
  );
};

================
File: src/components/InfoPage/TokenomicsSection.tsx
================
import { FC } from 'react';
import { Wallet, PieChart, Coins, BarChart3, Lock, Gem } from 'lucide-react';
import { motion } from 'framer-motion';

const tokenomicsData = [
  {
    icon: Wallet,
    title: 'Player Rewards',
    percentage: '40%',
    description: 'Allocated for in-game rewards and achievements',
    iconColor: 'text-green-400'
  },
  {
    icon: Lock,
    title: 'Treasury',
    percentage: '20%',
    description: 'Reserved for platform development and maintenance',
    iconColor: 'text-blue-400'
  },
  {
    icon: Gem,
    title: 'Staking',
    percentage: '15%',
    description: 'Rewards for token staking and liquidity provision',
    iconColor: 'text-purple-400'
  },
  {
    icon: BarChart3,
    title: 'Team',
    percentage: '10%',
    description: 'Team allocation with vesting schedule',
    iconColor: 'text-red-400'
  },
  {
    icon: Coins,
    title: 'Community',
    percentage: '10%',
    description: 'Community initiatives and DAO governance',
    iconColor: 'text-yellow-400'
  },
  {
    icon: PieChart,
    title: 'Marketing',
    percentage: '5%',
    description: 'Marketing and partnership development',
    iconColor: 'text-indigo-400'
  }
];

export const TokenomicsSection: FC = () => {
  const containerVariants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 },
  };

  return (
    <div className="py-12 sm:py-16">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="text-center mb-12 sm:mb-16"
      >
        <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Tokenomics
        </h2>
        <p className="mt-4 text-lg text-gray-700 dark:text-sand-300 max-w-2xl mx-auto">
          Transparent and balanced token distribution designed for long-term sustainability
        </p>
      </motion.div>

      <motion.div
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true }}
        className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8"
      >
        {tokenomicsData.map((item) => (
          <motion.div
            key={item.title}
            variants={itemVariants}
            className="group relative bg-sand-100/5 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
          >
            <div className="flex flex-col items-center text-center space-y-4">
              <div className="flex-shrink-0 w-16 h-16 rounded-xl bg-primary-500/10 flex items-center justify-center">
                <item.icon className={`w-8 h-8 ${item.iconColor}`} />
              </div>
              <div>
                <h3 className="text-2xl font-bold text-gray-900 dark:text-sand-100 group-hover:text-primary-400 transition-colors duration-300">
                  {item.percentage}
                </h3>
                <h4 className="text-lg font-semibold text-gray-800 dark:text-sand-200">
                  {item.title}
                </h4>
                <p className="mt-2 text-gray-600 dark:text-sand-400 text-sm">
                  {item.description}
                </p>
              </div>
            </div>
          </motion.div>
        ))}
      </motion.div>
    </div>
  );
};

================
File: src/components/LevelDisplay.tsx
================
import { FC } from 'react';
import { calculateLevel } from '../utils/levelCalculator';

interface LevelDisplayProps {
  xp: number;
  showProgress?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

export const LevelDisplay: FC<LevelDisplayProps> = ({ xp, showProgress = false, size = 'md' }) => {
  const { level, currentLevelXp, nextLevelXp, progress } = calculateLevel(xp);

  const sizeClasses = {
    sm: 'text-sm',
    md: 'text-base',
    lg: 'text-lg'
  };

  return (
    <div className="flex flex-col">
      <div className={`font-bold ${sizeClasses[size]} text-primary-main`}>
        Level {level}
      </div>
      
      {showProgress && (
        <div className="space-y-1">
          <div className="text-xs text-text-light-secondary dark:text-text-dark-secondary">
            {currentLevelXp.toLocaleString()} / {nextLevelXp.toLocaleString()} XP
          </div>
          <div className="h-1 bg-primary-main/20 rounded-full overflow-hidden">
            <div 
              className="h-full bg-primary-main transition-all duration-300"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>
      )}
    </div>
  );
};

================
File: src/components/LoadingScreen.tsx
================
import { FC, useEffect, useState } from 'react';
import anime from 'animejs';
import { brandConfig } from '../config/brand';

interface LoadingScreenProps {
  onComplete: () => void;
}

export const LoadingScreen: FC<LoadingScreenProps> = ({ onComplete }) => {
  const [bgLoaded, setBgLoaded] = useState(false);

  useEffect(() => {
    // Lock scroll while loading
    document.body.style.overflow = 'hidden';

    // Preload background image
    const bgImage = new Image();
    bgImage.src = brandConfig.assets.loadingScreen;
    bgImage.onload = () => {
      setBgLoaded(true);
      startAnimation();
    };

    // Fallback if image doesn't load
    const fallbackTimer = setTimeout(() => {
      if (!bgLoaded) {
        setBgLoaded(true);
        startAnimation();
      }
    }, 1000);

    return () => {
      document.body.style.overflow = 'unset';
      clearTimeout(fallbackTimer);
    };
  }, []);

  const startAnimation = () => {
    const timeline = anime.timeline({
      easing: 'easeOutExpo',
    });

    timeline
      .add({
        targets: '.loading-progress',
        width: '100%',
        duration: 2000,
        easing: 'easeInOutQuart',
      })
      .add({
        targets: '.loading-screen, .loading-screen-bg',
        opacity: 0,
        duration: 800,
        easing: 'easeInOutQuad',
        complete: () => {
          onComplete();
        }
      }, '+=200');
  };

  return (
    <>
      {/* Background */}
      <div 
        className="loading-screen-bg fixed inset-0 z-[9998] transition-opacity duration-800 bg-background-dark"
        style={{
          backgroundImage: bgLoaded ? `url(${brandConfig.assets.loadingScreen})` : 'none',
          backgroundSize: 'cover',
          backgroundPosition: 'center',
          opacity: 1,
        }}
      />

      {/* Content */}
      <div className="loading-screen fixed inset-0 z-[9999] flex items-center justify-center p-4">
        <div className="glass-panel p-8 w-[400px]">
          <div className="text-center mb-8">
            <div className="text-3xl font-title text-primary-main tracking-wider glow-text">
              {brandConfig.name}
            </div>
            <div className="text-xs font-light text-primary-main/80 mt-1">
              {brandConfig.domain}
            </div>
          </div>

          <div className="w-full h-1 bg-primary-main/10 rounded-full overflow-hidden">
            <div className="loading-progress h-full bg-gradient-to-r from-primary-main to-primary-secondary rounded-full" />
          </div>
        </div>
      </div>
    </>
  );
};

================
File: src/components/Logo.tsx
================
import { FC } from 'react';
import { Link } from 'react-router-dom';

export const Logo: FC = () => {
  return (
    <Link to="/" className="flex-shrink-0">
      <div className="text-center">
        <div className="text-2xl font-display font-bold text-primary-main tracking-wider glow-text">
          Pan <span className="text-primary-500">Da Pan</span>
        </div>
      </div>
    </Link>
  );
};

================
File: src/components/Marketplace/index.tsx
================
import { FC } from 'react';
import { Helmet } from 'react-helmet';

export const Marketplace: FC = () => {
  return (
    <>
      <Helmet>
        <title>Marketplace - Raid Rally</title>
        <meta name="description" content="Trade NFT characters and items in the Raid Rally marketplace." />
      </Helmet>

      <div className="space-y-8">
        <div className="text-center">
          <h1 className="text-4xl font-bold text-orange-500 mb-4">Marketplace</h1>
          <p className="text-gray-600 dark:text-gray-300">Trade characters and items with other players</p>
        </div>

        {/* Featured Items */}
        <section className="space-y-4">
          <h2 className="text-2xl font-semibold text-orange-500">Featured Items</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {/* Placeholder Cards */}
            {[1, 2, 3].map((item) => (
              <div key={item} className="bg-white/5 dark:bg-black/10 backdrop-blur-sm rounded-xl p-6 
                shadow-[0_0_30px_-12px_rgba(249,115,22,0.2)]
                dark:shadow-[0_0_30px_-12px_rgba(249,115,22,0.3)]
                hover:shadow-[0_0_40px_-12px_rgba(249,115,22,0.4)]
                dark:hover:shadow-[0_0_40px_-12px_rgba(249,115,22,0.5)]
                border border-orange-500/10 dark:border-orange-500/20
                transition-all duration-300">
                <div className="aspect-square rounded-lg bg-gradient-to-br from-orange-500/20 to-purple-600/20 mb-4" />
                <h3 className="text-xl font-semibold mb-2">Item #{item}</h3>
                <p className="text-gray-600 dark:text-gray-300 mb-4">A unique NFT item with special properties</p>
                <div className="flex justify-between items-center">
                  <span className="text-orange-500 font-semibold">0.1 ETH</span>
                  <button className="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                    Buy Now
                  </button>
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* Categories */}
        <section className="space-y-4">
          <h2 className="text-2xl font-semibold text-orange-500">Categories</h2>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {['Characters', 'Weapons', 'Armor', 'Consumables'].map((category) => (
              <button key={category} className="p-4 bg-white/5 dark:bg-black/10 backdrop-blur-sm rounded-xl
                shadow-[0_0_30px_-12px_rgba(249,115,22,0.2)]
                dark:shadow-[0_0_30px_-12px_rgba(249,115,22,0.3)]
                hover:shadow-[0_0_40px_-12px_rgba(249,115,22,0.4)]
                dark:hover:shadow-[0_0_40px_-12px_rgba(249,115,22,0.5)]
                border border-orange-500/10 dark:border-orange-500/20
                transition-all duration-300
                text-center font-semibold text-orange-500">
                {category}
              </button>
            ))}
          </div>
        </section>

        {/* Recent Listings */}
        <section className="space-y-4">
          <h2 className="text-2xl font-semibold text-orange-500">Recent Listings</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {/* Placeholder Cards */}
            {[4, 5, 6].map((item) => (
              <div key={item} className="bg-white/5 dark:bg-black/10 backdrop-blur-sm rounded-xl p-6 
                shadow-[0_0_30px_-12px_rgba(249,115,22,0.2)]
                dark:shadow-[0_0_30px_-12px_rgba(249,115,22,0.3)]
                hover:shadow-[0_0_40px_-12px_rgba(249,115,22,0.4)]
                dark:hover:shadow-[0_0_40px_-12px_rgba(249,115,22,0.5)]
                border border-orange-500/10 dark:border-orange-500/20
                transition-all duration-300">
                <div className="aspect-square rounded-lg bg-gradient-to-br from-orange-500/20 to-purple-600/20 mb-4" />
                <h3 className="text-xl font-semibold mb-2">Item #{item}</h3>
                <p className="text-gray-600 dark:text-gray-300 mb-4">A unique NFT item with special properties</p>
                <div className="flex justify-between items-center">
                  <span className="text-orange-500 font-semibold">0.1 ETH</span>
                  <button className="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                    Buy Now
                  </button>
                </div>
              </div>
            ))}
          </div>
        </section>
      </div>
    </>
  );
};

================
File: src/components/Navigation.tsx
================
import { FC, useState, useEffect, useRef } from 'react';
import { Link, NavLink, useLocation } from 'react-router-dom';
import { useWallet } from '@solana/wallet-adapter-react';
import { Menu, Home, Info, Settings, Swords, Palette, Trophy, User, Users } from 'lucide-react';

// Navigation items configuration
const navigationItems = {
  public: [
    { icon: Home, label: 'Home', path: '/' },
    { icon: Info, label: 'Info', path: '/info' },
    { icon: Palette, label: 'NFT Builder', path: '/nft-builder' },
    { icon: Trophy, label: 'Leaderboards', path: '/leaderboards' },
  ],
  protected: [
    { icon: Swords, label: 'Raid', path: '/raid' },
    { icon: Users, label: 'Guild', path: '/guild' },
    { icon: User, label: 'Profile', path: '/profile' },
    { icon: Settings, label: 'Settings', path: '/settings' },
  ],
  admin: [
    { icon: Settings, label: 'Admin Panel', path: '/admin' },
  ],
};

export const Navigation: FC = () => {
  const { connected, publicKey } = useWallet();
  const location = useLocation();
  const [isOpen, setIsOpen] = useState(false);
  const menuRef = useRef<HTMLDivElement>(null);
  
  const isAdmin = publicKey?.toString() === "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

  const menuItems = [
    ...navigationItems.public,
    ...(connected ? navigationItems.protected : []),
    ...(isAdmin ? navigationItems.admin : []),
  ];

  useEffect(() => {
    closeMenu();
  }, [location.pathname]);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        closeMenu();
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
      document.addEventListener('touchstart', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
      document.removeEventListener('touchstart', handleClickOutside);
    };
  }, [isOpen]);

  const toggleMenu = () => {
    setIsOpen(!isOpen);
    document.body.style.overflow = !isOpen ? 'hidden' : 'unset';
  };

  const closeMenu = () => {
    setIsOpen(false);
    document.body.style.overflow = 'unset';
  };

  return (
    <>
      {/* Desktop Navigation */}
      <nav className="hidden lg:block">
        <ul className="flex items-center justify-center gap-6">
          {menuItems.map(({ icon: Icon, label, path }) => (
            <li key={path}>
              <NavLink
                to={path}
                className={({ isActive }) =>
                  `flex items-center gap-2 px-3 py-2 rounded-lg text-base font-medium transition-colors duration-300
                   ${isActive 
                     ? 'text-primary-main dark:text-orange-500 bg-primary-main/10' 
                     : 'text-text-light-primary dark:text-white/90 hover:text-primary-main dark:hover:text-orange-500 hover:bg-primary-main/5'
                   }`
                }
              >
                <Icon className="w-5 h-5" />
                {label}
              </NavLink>
            </li>
          ))}
        </ul>
      </nav>

      {/* Mobile Menu Button */}
      <div className="lg:hidden">
        <button 
          onClick={toggleMenu}
          className="p-2 text-primary-main dark:text-orange-500 hover:bg-primary-main/10 rounded-lg transition-colors"
          aria-label="Toggle menu"
        >
          <Menu className="w-5 h-5" />
        </button>

        {/* Mobile Menu Overlay */}
        {isOpen && (
          <div className="fixed inset-0 z-50 lg:hidden flex flex-col justify-end">
            <div 
              className="absolute inset-0 bg-black/50 backdrop-blur-sm"
              onClick={closeMenu}
            />
            
            {/* Bottom Navigation Bar */}
            <div 
              ref={menuRef}
              className="relative bg-white dark:bg-background-900 shadow-xl rounded-t-xl"
            >
              {/* Navigation Icons */}
              <nav className="p-4">
                <ul className="flex items-center justify-around gap-1 overflow-x-auto px-2">
                  {menuItems.map(({ icon: Icon, label, path }) => (
                    <li key={path}>
                      <NavLink
                        to={path}
                        onClick={closeMenu}
                        className={({ isActive }) =>
                          `flex flex-col items-center gap-0.5 p-2 rounded-lg transition-all duration-300 min-w-[56px]
                           ${isActive 
                             ? 'text-primary-main dark:text-orange-500 bg-primary-main/10 scale-110 shadow-lg' 
                             : 'text-text-light-primary dark:text-white/90 hover:text-primary-main dark:hover:text-orange-500 hover:bg-primary-main/5'
                           }`
                        }
                      >
                        <Icon className="w-4 h-4" />
                        <span className="text-[10px] font-medium whitespace-nowrap">{label}</span>
                      </NavLink>
                    </li>
                  ))}
                </ul>
              </nav>

              {/* Safe Area Spacing for Mobile */}

            </div>
          </div>
        )}
      </div>
    </>
  );
};

================
File: src/components/Navigation/index.tsx
================
import { FC, useState, useEffect } from 'react';
import { Link, NavLink, useLocation } from 'react-router-dom';
import { useWallet } from '@solana/wallet-adapter-react';
import { Menu, X } from 'lucide-react';
import { navigationItems } from './navigationItems';
import { WalletConnect } from '../WalletConnect';
import { ThemeToggle } from '../ThemeToggle';

export const Navigation: FC = () => {
  const { connected, publicKey } = useWallet();
  const location = useLocation();
  const [isOpen, setIsOpen] = useState(false);
  
  const isAdmin = publicKey?.toString() === "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

  const menuItems = [
    ...navigationItems.public,
    ...(connected ? navigationItems.protected : []),
    ...(isAdmin ? navigationItems.admin : []),
  ];

  // Close menu on route change
  useEffect(() => {
    closeMenu();
  }, [location.pathname]);

  const toggleMenu = () => {
    setIsOpen(!isOpen);
    document.body.style.overflow = !isOpen ? 'hidden' : 'unset';
  };

  const closeMenu = () => {
    setIsOpen(false);
    document.body.style.overflow = 'unset';
  };

  return (
    <>
      {/* Desktop Navigation */}
      <nav className="hidden lg:block">
        <ul className="flex items-center gap-8">
          {menuItems.map(({ label, path }) => (
            <li key={path}>
              <NavLink
                to={path}
                className={({ isActive }) =>
                  `text-base font-medium transition-colors duration-300
                   ${isActive 
                     ? 'text-primary-main dark:text-orange-500' 
                     : 'text-text-light-primary dark:text-white/90 hover:text-primary-main dark:hover:text-orange-500'
                   }`
                }
              >
                {label}
              </NavLink>
            </li>
          ))}
        </ul>
      </nav>

      {/* Mobile Menu Button */}
      <button 
        onClick={toggleMenu}
        className="lg:hidden p-2 text-primary-main dark:text-orange-500 hover:bg-primary-main/10 rounded-lg transition-colors"
        aria-label="Toggle menu"
      >
        {isOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
      </button>

      {/* Mobile Menu Overlay */}
      {isOpen && (
        <div className="fixed inset-0 z-50 lg:hidden">
          <div 
            className="absolute inset-0 bg-black/50 backdrop-blur-sm"
            onClick={closeMenu}
          />
          <div className="absolute right-0 top-0 h-full w-[280px] bg-white dark:bg-background-900 shadow-xl transform transition-transform duration-200">
            <div className="flex flex-col h-full">
              <div className="p-4">
                <button 
                  onClick={closeMenu}
                  className="ml-auto p-2 text-primary-main dark:text-orange-500 hover:bg-primary-main/10 rounded-lg transition-colors"
                >
                  <X className="w-6 h-6" />
                </button>
              </div>

              <nav className="flex-1 overflow-y-auto px-4">
                <ul className="space-y-2">
                  {menuItems.map(({ label, path }) => (
                    <li key={path}>
                      <NavLink
                        to={path}
                        onClick={closeMenu}
                        className={({ isActive }) =>
                          `block px-4 py-3 rounded-lg transition-colors duration-300
                           ${isActive 
                             ? 'bg-primary-main/10 text-primary-main dark:text-orange-500' 
                             : 'text-text-light-primary dark:text-white/90 hover:bg-primary-main/5 hover:text-primary-main dark:hover:text-orange-500'
                           }`
                        }
                      >
                        {label}
                      </NavLink>
                    </li>
                  ))}
                </ul>
              </nav>

              {/* Mobile Menu Footer */}
              <div className="p-4 border-t border-gray-200 dark:border-gray-800">
                <div className="flex flex-col gap-4">
                  <WalletConnect className="w-full" />
                  <div className="flex justify-center">
                    <ThemeToggle />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  );
};

================
File: src/components/Navigation/Menu.tsx
================
import { Menu as MenuIcon } from 'lucide-react';

export const Menu = MenuIcon;

================
File: src/components/Navigation/Navigation.tsx
================
export { Navigation } from './index';

================
File: src/components/Navigation/navigationItems.ts
================
import { Home, Info, Settings, Sword, Palette, Trophy, User, Users } from 'lucide-react';

export const navigationItems = {
  public: [
    { icon: Home, label: 'Home', path: '/' },
    { icon: Info, label: 'Info', path: '/info' },
    { icon: Palette, label: 'NFT Builder', path: '/builder' },
    { icon: Trophy, label: 'Leaderboards', path: '/leaderboards' },
  ],
  protected: [
    { icon: Sword, label: 'Raid', path: '/raid' },
    { icon: Users, label: 'Guild', path: '/guild' },
    { icon: User, label: 'Raid Profile', path: '/profile' },
    { icon: Settings, label: 'Settings', path: '/settings' },
  ],
  admin: [
    { icon: Settings, label: 'Admin Panel', path: '/admin' },
  ],
} as const;

================
File: src/components/NFTBuilder/index.ts
================
export { NFTBuilder } from './NFTBuilder';
export type { Layer } from './types';

================
File: src/components/NFTBuilder/index.tsx
================
import { NFTBuilder } from './NFTBuilder';
export { NFTBuilder };
export type { Layer } from './types';

================
File: src/components/NFTBuilder/layers.ts
================
import { Layer } from './types';

export const LAYERS: Layer[] = [
  {
    id: 1,
    name: 'Background',
    traits: [
      { id: 101, name: 'Byzantium Purple', image: '/assets/layers/Background/Byzantium_Purple.png' },
      { id: 102, name: 'Cream', image: '/assets/layers/Background/Cream.png' },
      { id: 103, name: 'Ruddy Blue', image: '/assets/layers/Background/Ruddy_Blue.png' }
    ]
  },
  {
    id: 2,
    name: 'Skin',
    traits: [
      { id: 201, name: 'Tree', image: '/assets/layers/Skin/Tree.png' },
      { id: 202, name: 'Cybersuit', image: '/assets/layers/Skin/Cybersuit.png' },
      { id: 203, name: 'Dreamland', image: '/assets/layers/Skin/Dreamland.png' }
    ]
  },
  {
    id: 3,
    name: 'Eyes',
    traits: [
      { id: 301, name: 'Gaze', image: '/assets/layers/Eyes/Gaze.png' },
      { id: 302, name: 'Nano', image: '/assets/layers/Eyes/Nano.png' },
      { id: 303, name: 'Bloodshot', image: '/assets/layers/Eyes/Bloodshot.png' }
    ]
  },
  {
    id: 4,
    name: 'Mouth',
    traits: [
      { id: 401, name: 'Red', image: '/assets/layers/Mouth/Red.png' },
      { id: 402, name: 'Bone', image: '/assets/layers/Mouth/Bone.png' },
      { id: 403, name: 'Gold Cheese', image: '/assets/layers/Mouth/Gold_Cheese.png' }
    ]
  },
  {
    id: 5,
    name: 'Outfit',
    traits: [
      { id: 501, name: 'Birfday', image: '/assets/layers/Outfit/Birfday.png' },
      { id: 502, name: 'Colonial', image: '/assets/layers/Outfit/Colonial.png' },
      { id: 503, name: 'Bear Suit', image: '/assets/layers/Outfit/Bear_Suit.png' },
    ]
  },
  {
    id: 6,
    name: 'Hat',
    traits: [
      { id: 601, name: 'Crown', image: '/assets/layers/Hat/Crown.png' },
      { id: 602, name: 'Troll', image: '/assets/layers/Hat/Troll.png' },
      { id: 603, name: 'Forest Ancients', image: '/assets/layers/Hat/Forest_Ancients.png' }
    ]
  }
];

================
File: src/components/NFTBuilder/LayerSelector.tsx
================
import { FC, useState } from 'react';
import { Layer } from './types';
import { motion } from 'framer-motion';
import { Info } from 'lucide-react';

interface LayerSelectorProps {
  layer: Layer;
  selectedTrait: number;
  onSelect: (traitId: number) => void;
  isLoading?: boolean;
}

export const LayerSelector: FC<LayerSelectorProps> = ({
  layer,
  selectedTrait,
  onSelect,
  isLoading = false,
}) => {
  const [loadingStates, setLoadingStates] = useState<Record<number, boolean>>({});

  const handleImageLoad = (traitId: number) => {
    setLoadingStates(prev => ({
      ...prev,
      [traitId]: false
    }));
  };

  const handleImageError = (traitId: number) => {
    setLoadingStates(prev => ({
      ...prev,
      [traitId]: false
    }));
  };

  return (
    <div className={`
      bg-white/80 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4 
      border border-sand-300/20 dark:border-sand-200/10 
      hover:border-primary-500/30 transition-colors duration-300
      ${isLoading ? 'opacity-50 pointer-events-none' : ''}
    `}>
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-sm font-medium text-sand-800 dark:text-sand-200">
          {layer.name}
        </h3>
        <button
          className="p-1 text-sand-500 hover:text-primary-500 transition-colors"
          onClick={() => {}}
          title={`${layer.name} traits information`}
        >
          <Info className="w-4 h-4" />
        </button>
      </div>

      <div className="grid grid-cols-3 gap-2">
        {layer.traits.map((trait) => (
          <div
            key={trait.id}
            className="relative group"
            title={trait.name}
          >
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={() => !isLoading && onSelect(trait.id)}
              disabled={isLoading}
              className={`
                relative aspect-square rounded-lg overflow-hidden border-2 transition-all duration-200
                ${selectedTrait === trait.id
                  ? 'border-primary-500 shadow-lg shadow-primary-500/20'
                  : 'border-transparent hover:border-primary-500/50'
                }
                ${isLoading ? 'cursor-not-allowed' : ''}
              `}
            >
              {(loadingStates[trait.id] || isLoading) && (
                <div className="absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm">
                  <div className="w-4 h-4 border-2 border-primary-500 border-t-transparent rounded-full animate-spin" />
                </div>
              )}
              <img
                src={trait.image}
                alt={trait.name}
                className="w-full h-full object-cover"
                onLoad={() => handleImageLoad(trait.id)}
                onError={() => handleImageError(trait.id)}
                loading="lazy"
              />
              {selectedTrait === trait.id && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  className="absolute inset-0 bg-primary-500/10 pointer-events-none"
                />
              )}
            </motion.button>
            <div className="absolute inset-x-0 bottom-0 p-1 bg-black/60 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">
              {trait.name}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

================
File: src/components/NFTBuilder/NFTBuilder.tsx
================
import { FC, useState, useEffect, useCallback } from 'react';
import { NFTPreview } from './NFTPreview';
import { LayerSelector } from './LayerSelector';
import { LAYERS } from './layers';
import { motion, AnimatePresence } from 'framer-motion';
import { Wand2, Download, Shuffle, Loader } from 'lucide-react';
import { mergeImages, preloadImages } from './utils';

// Toast notification component
const Toast: FC<{ message: string; type: 'success' | 'error' | 'warning' }> = ({ message, type }) => (
  <div className={`
    fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50
    ${type === 'success' ? 'bg-green-500' : ''}
    ${type === 'error' ? 'bg-red-500' : ''}
    ${type === 'warning' ? 'bg-yellow-500' : ''}
  `}>
    {message}
  </div>
);

// Loading overlay component
const LoadingOverlay: FC<{ message: string; progress?: number }> = ({ message, progress }) => (
  <motion.div
    initial={{ opacity: 0 }}
    animate={{ opacity: 1 }}
    exit={{ opacity: 0 }}
    className="absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"
  >
    <div className="flex flex-col items-center">
      <div className="relative">
        <div className="w-12 h-12">
          <motion.div
            className="absolute inset-0 border-4 border-primary-500/30 rounded-full"
            animate={{ rotate: 360 }}
            transition={{ duration: 1.5, repeat: Infinity, ease: "linear" }}
          />
          <motion.div
            className="absolute inset-0 border-4 border-t-primary-500 rounded-full"
            animate={{ rotate: 360 }}
            transition={{ duration: 1.5, repeat: Infinity, ease: "linear" }}
          />
        </div>
      </div>
      <p className="mt-4 text-white font-medium">{message}</p>
      {progress !== undefined && (
        <div className="w-48 h-1 bg-black/20 rounded-full mt-2">
          <motion.div 
            className="h-full bg-primary-500 rounded-full"
            initial={{ width: 0 }}
            animate={{ width: `${progress}%` }}
            transition={{ duration: 0.3 }}
          />
        </div>
      )}
    </div>
  </motion.div>
);

// Simple toast hook
const useCustomToast = () => {
  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' | 'warning' } | null>(null);

  const showToast = useCallback((message: string, type: 'success' | 'error' | 'warning') => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3000);
  }, []);

  return { toast, showToast };
};

export const NFTBuilder: FC = () => {
  const [selectedTraits, setSelectedTraits] = useState<Record<number, number>>({});
  const [downloading, setDownloading] = useState(false);
  const [loadingProgress, setLoadingProgress] = useState(0);
  const [retryCount, setRetryCount] = useState(0);
  const [isLoading, setIsLoading] = useState(true);
  const { toast, showToast } = useCustomToast();

  // Preload all layer images on mount
  useEffect(() => {
    let mounted = true;
    
    const loadAssets = async () => {
      try {
        setIsLoading(true);
        // Get all image sources
        const imageSources = LAYERS.flatMap(layer =>
          layer.traits.map(trait => trait.image)
        );

        // Calculate total images for progress
        const totalImages = imageSources.length;
        let loadedImages = 0;

        // Create a progress callback
        const onProgress = () => {
          if (mounted) {
            loadedImages++;
            setLoadingProgress(Math.floor((loadedImages / totalImages) * 100));
          }
        };

        // Load images in parallel with progress
        await Promise.all(
          imageSources.map(async src => {
            try {
              await preloadImages([src]);
              onProgress();
            } catch (error) {
              console.error(`Failed to load image: ${src}`, error);
              onProgress(); // Still update progress even on error
              showToast(`Failed to load image: ${src}`, 'error');
            }
          })
        );

        if (mounted) {
          setLoadingProgress(100);
          setIsLoading(false);
        }
      } catch (error) {
        console.error('Failed to preload images:', error);
        if (mounted) {
          if (retryCount < 3) {
            setRetryCount(prev => prev + 1);
            showToast('Loading assets failed. Retrying...', 'warning');
          } else {
            showToast('Failed to load assets. Please refresh the page.', 'error');
          }
        }
      }
    };

    loadAssets();
    
    return () => {
      mounted = false;
    };
  }, [retryCount, showToast]);

  // Generate random configuration immediately
  useEffect(() => {
    handleRandomize();
  }, []);

  const handleTraitSelect = useCallback((layerId: number, traitId: number) => {
    setSelectedTraits(prev => ({
      ...prev,
      [layerId]: traitId
    }));
  }, []);

  const handleRandomize = useCallback(() => {
    const randomTraits: Record<number, number> = {};
    LAYERS.forEach(layer => {
      const randomTrait = layer.traits[Math.floor(Math.random() * layer.traits.length)];
      randomTraits[layer.id] = randomTrait.id;
    });
    setSelectedTraits(randomTraits);
  }, []);

  const handleDownload = async () => {
    try {
      setDownloading(true);
      const selectedImages = LAYERS.map(layer => {
        const traitId = selectedTraits[layer.id];
        const trait = layer.traits.find(t => t.id === traitId);
        return trait?.image || '';
      }).filter(Boolean);

      if (selectedImages.length > 0) {
        const mergedImage = await mergeImages(selectedImages);
        const link = document.createElement('a');
        link.href = mergedImage;
        link.download = 'my-nft.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showToast('NFT Downloaded Successfully', 'success');
      }
    } catch (error) {
      console.error('Failed to download NFT:', error);
      showToast('Failed to download NFT. Please try again.', 'error');
    } finally {
      setDownloading(false);
    }
  };

  return (
    <div className="relative space-y-12 sm:space-y-16 lg:space-y-24 pb-12 sm:pb-16 lg:pb-24">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.3 }}
          className="text-center mb-12 sm:mb-16"
        >
          <h1 className="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400 sm:text-5xl">
            Create Your Character
          </h1>
          <p className="mt-4 text-lg font-medium text-sand-600 dark:text-sand-300">
            Customize your unique NFT warrior with powerful traits and attributes
          </p>
        </motion.div>

        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
          {/* Preview */}
          <motion.div
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.3 }}
            className="lg:col-span-4"
          >
            <div className="sticky top-24 z-10">
              <div className="relative bg-white/80 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300 shadow-xl shadow-sand-900/5 transform-gpu">
                <div className="relative">
                  <NFTPreview 
                    layers={LAYERS} 
                    selectedTraits={selectedTraits}
                    loadingProgress={loadingProgress}
                    onError={(message) => showToast(message, 'warning')}
                  />
                  <AnimatePresence>
                    {isLoading && (
                      <LoadingOverlay 
                        message="Loading assets..." 
                        progress={loadingProgress}
                      />
                    )}
                    {downloading && (
                      <LoadingOverlay message="Generating your NFT..." />
                    )}
                  </AnimatePresence>
                </div>

                <div className="flex gap-3 mt-4">
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={handleRandomize}
                    disabled={isLoading}
                    className="flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-primary-500/10 text-primary-700 dark:text-primary-400 text-sm rounded-lg hover:bg-primary-500/20 transition-colors disabled:opacity-50"
                  >
                    <Shuffle className="w-4 h-4" />
                    Randomize
                  </motion.button>
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={handleDownload}
                    disabled={downloading || isLoading}
                    className="flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-primary-500 text-white text-sm rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 shadow-sm shadow-primary-500/20"
                  >
                    {downloading ? (
                      <>
                        <Wand2 className="w-4 h-4 animate-spin" />
                        Generating...
                      </>
                    ) : (
                      <>
                        <Download className="w-4 h-4" />
                        Download
                      </>
                    )}
                  </motion.button>
                </div>
              </div>
            </div>
          </motion.div>

          {/* Layer Selectors */}
          <motion.div
            initial={{ opacity: 0, x: 20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.3 }}
            className="lg:col-span-8 flex items-center"
          >
            <div className="grid grid-cols-2 lg:grid-cols-3 gap-4 w-full">
              {LAYERS.map((layer, index) => (
                <motion.div
                  key={layer.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.2, delay: index * 0.05 }}
                >
                  <LayerSelector
                    layer={layer}
                    selectedTrait={selectedTraits[layer.id]}
                    onSelect={(traitId) => handleTraitSelect(layer.id, traitId)}
                    isLoading={isLoading}
                  />
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      </div>

      {/* Toast Notifications */}
      {toast && <Toast message={toast.message} type={toast.type} />}
    </div>
  );
};

================
File: src/components/NFTBuilder/NFTPreview.tsx
================
import { FC, useEffect, useRef, useState, useMemo } from 'react';
import { Layer } from './types';
import { Loader, AlertCircle, RefreshCw } from 'lucide-react';
import { motion } from 'framer-motion';
import { getCachedImage, isImageCached, preloadImage } from './utils';

interface NFTPreviewProps {
  layers: Layer[];
  selectedTraits: Record<number, number>;
  loadingProgress: number;
  onError?: (message: string) => void;
}

export const NFTPreview: FC<NFTPreviewProps> = ({ 
  layers, 
  selectedTraits,
  loadingProgress,
  onError 
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [error, setError] = useState<string | null>(null);
  const [retryAttempt, setRetryAttempt] = useState(0);
  const [isDrawing, setIsDrawing] = useState(false);

  // Memoize the selected images array
  const selectedImages = useMemo(() => {
    return layers.map(layer => {
      const traitId = selectedTraits[layer.id];
      const trait = layer.traits.find(t => t.id === traitId);
      return trait?.image || '';
    }).filter(Boolean);
  }, [layers, selectedTraits]);

  // Draw layers on canvas
  const drawLayers = async () => {
    const canvas = canvasRef.current;
    if (!canvas || isDrawing) return;

    const ctx = canvas.getContext('2d', { alpha: true });
    if (!ctx) {
      setError('Could not initialize canvas context');
      onError?.('Could not initialize canvas context');
      return;
    }

    setIsDrawing(true);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    setError(null);

    try {
      // Enable image smoothing for better quality
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';

      for (const src of selectedImages) {
        try {
          // Use cached image if available
          let img: HTMLImageElement;
          if (isImageCached(src)) {
            img = getCachedImage(src)!;
          } else {
            img = await preloadImage(src);
          }
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        } catch (error) {
          console.error(`Failed to load image:`, error);
          onError?.(`Failed to load image. Retrying...`);
          if (retryAttempt < 3) {
            setRetryAttempt(prev => prev + 1);
            return;
          }
          setError(`Failed to load image`);
        }
      }
    } catch (error) {
      console.error('Failed to draw layers:', error);
      setError('Failed to generate preview');
      onError?.('Failed to generate preview');
    } finally {
      setIsDrawing(false);
    }
  };

  // Only redraw when selected images change or loading completes
  useEffect(() => {
    if (loadingProgress === 100 && selectedImages.length > 0) {
      drawLayers();
    }
  }, [selectedImages, loadingProgress]);

  return (
    <div className="relative aspect-square w-full rounded-lg overflow-hidden bg-gradient-to-br from-black/40 to-black/20 border-2 border-primary-500/20">
      <canvas
        ref={canvasRef}
        width={500}
        height={500}
        className="w-full h-full"
      />
      
      {loadingProgress < 100 && (
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="absolute inset-0 flex flex-col items-center justify-center bg-black/40 backdrop-blur-sm"
        >
          <div className="relative">
            <div className="absolute inset-0 animate-ping rounded-full bg-primary-500/20" />
            <Loader className="w-8 h-8 text-primary-500 animate-spin relative z-10" />
          </div>
          <div className="mt-4 text-sm text-white font-medium">
            Loading assets... {loadingProgress}%
          </div>
          <div className="w-48 h-1 bg-black/20 rounded-full mt-2">
            <motion.div 
              className="h-full bg-primary-500 rounded-full"
              initial={{ width: 0 }}
              animate={{ width: `${loadingProgress}%` }}
              transition={{ duration: 0.3 }}
            />
          </div>
        </motion.div>
      )}

      {error && (
        <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/40 backdrop-blur-sm">
          <AlertCircle className="w-8 h-8 text-red-500" />
          <div className="mt-4 text-sm text-white font-medium text-center px-4">
            {error}
          </div>
          <button
            onClick={() => drawLayers()}
            className="mt-4 px-4 py-2 bg-primary-500 text-white rounded-lg flex items-center gap-2 hover:bg-primary-600 transition-colors"
          >
            <RefreshCw className="w-4 h-4" />
            Retry
          </button>
        </div>
      )}
    </div>
  );
};

================
File: src/components/NFTBuilder/types.ts
================
export interface Layer {
  id: number;
  name: string;
  traits: {
    id: number;
    name: string;
    image: string;
  }[];
}

================
File: src/components/NFTBuilder/useLayerPreloader.ts
================
import { useState, useEffect } from 'react';
import { Layer } from './index';

export const useLayerPreloader = (layers: Layer[]) => {
  const [loadingProgress, setLoadingProgress] = useState(0);
  const [loadedImages, setLoadedImages] = useState(new Set<string>());

  useEffect(() => {
    const allImagePaths = layers.flatMap(layer => 
      layer.traits.map(trait => trait.image)
    );

    const totalImages = allImagePaths.length;
    let loadedCount = 0;
    let hasError = false;

    const preloadImage = (src: string) => {
      if (loadedImages.has(src)) {
        loadedCount++;
        setLoadingProgress(Math.floor((loadedCount / totalImages) * 100));
        return Promise.resolve();
      }

      return new Promise<void>((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        
        img.onload = () => {
          loadedCount++;
          setLoadedImages(prev => new Set(prev).add(src));
          setLoadingProgress(Math.floor((loadedCount / totalImages) * 100));
          resolve();
        };

        img.onerror = () => {
          hasError = true;
          console.error(`Failed to load image: ${src}`);
          loadedCount++;
          setLoadingProgress(Math.floor((loadedCount / totalImages) * 100));
          resolve(); // Resolve anyway to continue loading other images
        };

        img.src = src;
      });
    };

    // Load images in small batches to prevent overwhelming the browser
    const loadImagesInBatches = async () => {
      const batchSize = 5;
      for (let i = 0; i < allImagePaths.length; i += batchSize) {
        const batch = allImagePaths.slice(i, i + batchSize);
        await Promise.all(batch.map(preloadImage));
      }

      if (hasError) {
        console.warn('Some images failed to load. Preview may be incomplete.');
      }
    };

    loadImagesInBatches();

    return () => {
      // Cleanup function
      setLoadedImages(new Set());
      setLoadingProgress(0);
    };
  }, [layers]);

  return { loadingProgress };
};

================
File: src/components/NFTBuilder/utils.ts
================
// Global image cache
const imageCache = new Map<string, HTMLImageElement>();

// Preload a single image with retry logic
export async function preloadImage(src: string, retries = 3): Promise<HTMLImageElement> {
  if (imageCache.has(src)) {
    return imageCache.get(src)!;
  }

  let lastError: Error | null = null;
  for (let attempt = 1; attempt <= retries; attempt++) {
    try {
      const img = await new Promise<HTMLImageElement>((resolve, reject) => {
        const image = new Image();
        image.crossOrigin = 'anonymous';
        image.onload = () => resolve(image);
        image.onerror = reject;
        image.src = src;
      });
      imageCache.set(src, img);
      return img;
    } catch (error) {
      lastError = error as Error;
      if (attempt < retries) {
        await new Promise(resolve => setTimeout(resolve, attempt * 500));
      }
    }
  }
  throw lastError;
}

// Batch preload images with concurrency control
export async function preloadImages(sources: string[], concurrency = 5): Promise<void> {
  const chunks: string[][] = [];
  for (let i = 0; i < sources.length; i += concurrency) {
    chunks.push(sources.slice(i, i + concurrency));
  }

  for (const chunk of chunks) {
    await Promise.all(chunk.map(src => preloadImage(src).catch(console.error)));
  }
}

// Optimized image merging with canvas reuse
export async function mergeImages(images: string[]): Promise<string> {
  const canvas = document.createElement('canvas');
  canvas.width = 500;
  canvas.height = 500;
  const ctx = canvas.getContext('2d', { alpha: true });
  if (!ctx) throw new Error('Could not get canvas context');

  // Enable image smoothing for better quality
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';

  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw all images in sequence
  for (const src of images) {
    try {
      const img = await preloadImage(src);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    } catch (error) {
      console.error('Failed to load image:', error);
    }
  }

  return canvas.toDataURL('image/png', 1.0);
}

// Check if an image is cached
export function isImageCached(src: string): boolean {
  return imageCache.has(src);
}

// Get cached image
export function getCachedImage(src: string): HTMLImageElement | undefined {
  return imageCache.get(src);
}

// Clear image cache
export function clearImageCache(): void {
  imageCache.clear();
}

// Get cache size
export function getImageCacheSize(): number {
  return imageCache.size;
}

================
File: src/components/NFTCard.tsx
================
import { FC } from 'react';
import { NFTMetadata } from '../types/nft';
import { Heart, ExternalLink } from 'lucide-react';
import { NFTProfileButton } from './Dashboard/NFTProfileButton';
import { useWallet } from '@solana/wallet-adapter-react';
import { GlassPanel } from './GlassPanel';

interface NFTCardProps {
  nft: NFTMetadata;
  isFavorite: boolean;
  onFavoriteToggle: () => void;
  showProfileButton?: boolean;
}

export const NFTCard: FC<NFTCardProps> = ({ 
  nft, 
  isFavorite, 
  onFavoriteToggle,
  showProfileButton = false
}) => {
  const { connected } = useWallet();
  const COLLECTION_ADDRESS = 'Hcudg3n6ggbc5kMo2ZtVbXKJb7oXhNCQxJsY42ZMiPpp';
  
  return (
    <div className="bg-white/30 dark:bg-black/30 backdrop-blur-sm rounded-xl overflow-hidden border border-white/10 transform hover:scale-105 transition-all duration-300">
      {/* Action Buttons */}
      <div className="absolute top-2 right-2 z-10 flex gap-2">
        <button
          onClick={(e) => {
            e.preventDefault();
            e.stopPropagation();
            onFavoriteToggle();
          }}
          className={`p-2 rounded-lg backdrop-blur-sm transition-colors ${
            isFavorite 
              ? 'bg-primary-main text-white' 
              : 'bg-black/40 text-primary-main hover:bg-primary-main/20'
          }`}
          title={isFavorite ? 'Remove from favorites' : 'Add to favorites'}
        >
          <Heart className="w-4 h-4" fill={isFavorite ? 'currentColor' : 'none'} />
        </button>
        <a
          href={`https://solscan.io/token/${nft.mint}?cluster=mainnet`}
          target="_blank"
          rel="noopener noreferrer"
          className="p-2 rounded-lg bg-black/40 text-primary-main hover:bg-primary-main/20 backdrop-blur-sm transition-colors"
          onClick={(e) => e.stopPropagation()}
          title="View on Solscan"
        >
          <ExternalLink className="w-4 h-4" />
        </a>
      </div>

      {/* Profile Picture Button */}
      {showProfileButton && connected && (
        <NFTProfileButton nft={nft} />
      )}

      {/* NFT Image */}
      <div className="relative aspect-square">
        {nft.image && (
          <img
            src={nft.image}
            alt={nft.name}
            className="w-full h-full object-cover"
          />
        )}
      </div>

      {/* NFT Details */}
      <div className="p-4">
        <h3 className="text-lg font-semibold text-text-light-primary dark:text-orange-500 mb-1">
          {nft.name || 'Unnamed NFT'}
        </h3>

        {/* Attributes */}
        {nft.attributes && nft.attributes.length > 0 && (
          <div className="grid grid-cols-2 gap-4 mb-4">
            {nft.attributes.slice(0, 4).map((attr, index) => (
              <div 
                key={index} 
                className="bg-primary-main/10 rounded-lg p-2 group-hover:bg-primary-main/20 transition-colors"
                title={`${attr.trait_type}: ${attr.value}`}
              >
                <p className="text-xs text-primary-main line-clamp-1">
                  {attr.trait_type}
                </p>
                <p className="text-sm font-medium text-white line-clamp-1">
                  {attr.value}
                </p>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};

================
File: src/components/NFTGrid.tsx
================
import { FC, useEffect, useState, useCallback, useMemo } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { NFTCard } from './NFTCard';
import { fetchCollectionNFTs, fetchWalletNFTs } from '../utils/api';
import { NFTMetadata } from '../types/nft';
import { ChevronDown, Search } from 'lucide-react';
import { GlassPanel } from './GlassPanel';
import { ContentBox } from './ContentBox';

interface NFTGridProps {
  showWalletOnly: boolean;
  initialDisplayCount: number;
  showSearch: boolean;
  showProfileButtons?: boolean;
  traitFilters?: Array<{ type: string; value: string }>;
  onTraitTypesFound?: (nfts: NFTMetadata[]) => void;
}

export const NFTGrid: FC<NFTGridProps> = ({ 
  showWalletOnly,
  initialDisplayCount,
  showSearch,
  showProfileButtons = false,
  traitFilters = [],
  onTraitTypesFound 
}) => {
  const { publicKey } = useWallet();
  const [nfts, setNfts] = useState<NFTMetadata[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [displayCount, setDisplayCount] = useState(initialDisplayCount);
  const [loadingMore, setLoadingMore] = useState(false);
  const [favorites, setFavorites] = useState<Set<string>>(new Set());
  const [lastFetchTime, setLastFetchTime] = useState<number>(0);
  const FETCH_COOLDOWN = 60000;

  // Load NFTs with caching and rate limiting
  useEffect(() => {
    const loadNFTs = async () => {
      try {
        setLoading(true);
        setError(null);

        const now = Date.now();
        if (now - lastFetchTime < FETCH_COOLDOWN) {
          return;
        }

        const fetchedNFTs = showWalletOnly && publicKey
          ? await fetchWalletNFTs(publicKey.toString())
          : await fetchCollectionNFTs();

        if (onTraitTypesFound) {
          onTraitTypesFound(fetchedNFTs);
        }

        setNfts(fetchedNFTs);
        setLastFetchTime(now);
      } catch (error) {
        console.error('Error loading NFTs:', error);
        setError('Failed to load NFTs. Please try again later.');
      } finally {
        setLoading(false);
      }
    };

    loadNFTs();
  }, [publicKey, showWalletOnly, onTraitTypesFound, lastFetchTime]);

  // Filter and sort NFTs
  const filteredAndSortedNfts = useMemo(() => {
    let filtered = [...nfts];

    if (traitFilters.length > 0) {
      filtered = filtered.filter(nft => 
        traitFilters.every(filter =>
          nft.attributes.some(attr =>
            attr.trait_type === filter.type && attr.value === filter.value
          )
        )
      );
    }

    if (searchQuery) {
      filtered = filtered.filter(nft =>
        nft.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        nft.name.match(new RegExp(`#${searchQuery}$`))
      );
    }

    filtered.sort((a, b) => {
      if (favorites.has(a.name) && !favorites.has(b.name)) return -1;
      if (!favorites.has(a.name) && favorites.has(b.name)) return 1;
      return 0;
    });

    return filtered;
  }, [nfts, traitFilters, searchQuery, favorites]);

  const displayedNfts = useMemo(() => {
    return filteredAndSortedNfts.slice(0, displayCount);
  }, [filteredAndSortedNfts, displayCount]);

  const loadMore = useCallback(async () => {
    setLoadingMore(true);
    await new Promise(resolve => setTimeout(resolve, 500));
    setDisplayCount(prev => prev + initialDisplayCount);
    setLoadingMore(false);
  }, [initialDisplayCount]);

  const toggleFavorite = useCallback((nftName: string) => {
    setFavorites(prev => {
      const newFavorites = new Set(prev);
      if (newFavorites.has(nftName)) {
        newFavorites.delete(nftName);
      } else {
        newFavorites.add(nftName);
      }
      return newFavorites;
    });
  }, []);

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-[60vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-main"></div>
      </div>
    );
  }

  if (error) {
    return (
      <ContentBox>
        <div className="text-center py-8">
          <p className="text-red-400 mb-4">{error}</p>
          <button 
            onClick={() => window.location.reload()} 
            className="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition-colors"
          >
            Try Again
          </button>
        </div>
      </ContentBox>
    );
  }

  return (
    <div className="space-y-6">
      {showSearch && (
        <GlassPanel>
          <div className="relative">
            <input
              type="text"
              placeholder="Search by name or number..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full px-4 py-2 bg-black/20 border border-primary-main/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-main/40"
            />
            <Search className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
          </div>
        </GlassPanel>
      )}

      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {displayedNfts.length === 0 ? (
          <div className="col-span-full">
            <GlassPanel>
              <p className="text-center py-8 text-gray-400">
                {searchQuery 
                  ? 'No NFTs found matching your search'
                  : showWalletOnly 
                    ? 'No NFTs found in your wallet from this collection'
                    : traitFilters.length > 0
                      ? 'No NFTs found matching the selected filters'
                      : 'No NFTs found in the collection'}
              </p>
            </GlassPanel>
          </div>
        ) : (
          displayedNfts.map((nft, index) => (
            <NFTCard 
              key={`${nft.name}-${index}`}
              nft={nft} 
              isFavorite={favorites.has(nft.name)}
              onFavoriteToggle={() => toggleFavorite(nft.name)}
              showProfileButton={showProfileButtons}
            />
          ))
        )}
      </div>

      {displayedNfts.length < filteredAndSortedNfts.length && (
        <div className="flex justify-center">
          <button
            onClick={loadMore}
            disabled={loadingMore}
            className="flex items-center gap-2 px-6 py-3 bg-primary-main/20 hover:bg-primary-main/30 text-primary-main rounded-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:hover:scale-100"
          >
            {loadingMore ? (
              <div className="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-primary-main" />
            ) : (
              <>
                Show More
                <ChevronDown className="w-4 h-4" />
              </>
            )}
          </button>
        </div>
      )}
    </div>
  );
};

================
File: src/components/ProfilePicture.tsx
================
import { FC } from 'react';
import { HexagonBorder } from './HexagonBorder';
import { playerService } from '../services/playerService';

interface ProfilePictureProps {
  wallet: string;
  size?: 'sm' | 'md' | 'lg';
  showBorder?: boolean;
}

export const ProfilePicture: FC<ProfilePictureProps> = ({ 
  wallet, 
  size = 'md',
  showBorder = true 
}) => {
  const player = playerService.getPlayer(wallet);
  const isNFTProfile = player?.profilePicture?.startsWith('http');

  const sizeClasses = {
    sm: 'w-8 h-8',
    md: 'w-12 h-12',
    lg: 'w-16 h-16'
  };

  const Picture = () => (
    <div className={`${sizeClasses[size]} rounded-full overflow-hidden bg-primary-pink/20`}>
      {player?.profilePicture ? (
        <img
          src={player.profilePicture}
          alt="Profile"
          className="w-full h-full object-cover"
        />
      ) : (
        <img
          src="/assets/defaultpfp.png"
          alt="Default Profile"
          className="w-full h-full object-cover"
        />
      )}
    </div>
  );

  if (isNFTProfile && showBorder) {
    return (
      <HexagonBorder className={sizeClasses[size]}>
        <Picture />
      </HexagonBorder>
    );
  }

  return <Picture />;
};

================
File: src/components/ProtectedRoute.tsx
================
import { FC, ReactNode } from 'react';
import { Navigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { ConnectPrompt } from './ConnectPrompt';

interface ProtectedRouteProps {
  children: ReactNode;
  requiresAdmin?: boolean;
}

export const ProtectedRoute: FC<ProtectedRouteProps> = ({ 
  children, 
  requiresAdmin = false 
}) => {
  const { user, loading } = useAuth();

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-[60vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-main"></div>
      </div>
    );
  }

  if (!user) {
    return <ConnectPrompt />;
  }

  if (requiresAdmin && user.uid !== import.meta.env.VITE_ADMIN_WALLET) {
    return <Navigate to="/" replace />;
  }

  return <>{children}</>;
};

================
File: src/components/Raid/CompletedRaids.tsx
================
import { FC, useState } from 'react';
import { Trophy, Star, Users } from 'lucide-react';
import { RaidState } from '../../types/raid';
import { RaidBossDetailsModal } from './RaidBossDetailsModal';
import { RaidBossShareModal } from './RaidBossShareModal';
import { useWallet } from '@solana/wallet-adapter-react';
import { GlassPanel } from '../GlassPanel';

interface CompletedRaidsProps {
  raids: RaidState[];
}

export const CompletedRaids: FC<CompletedRaidsProps> = ({ raids }) => {
  const { publicKey } = useWallet();
  const [selectedRaid, setSelectedRaid] = useState<RaidState | null>(null);
  const [showShareModal, setShowShareModal] = useState(false);

  const handleShare = (raid: RaidState) => {
    setSelectedRaid(raid);
    setShowShareModal(true);
  };

  const didParticipate = (raid: RaidState) => {
    return raid.participants.some(p => p.wallet === publicKey?.toString());
  };

  return (
    <div className="bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-xl p-6
      border border-sand-300/20 dark:border-sand-200/10 
      hover:border-primary-500/30 transition-all duration-300">
      <div className="text-center mb-6">
        <h3 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Completed Raids
        </h3>
      </div>

      <div className="space-y-4 max-h-[300px] overflow-y-auto custom-scrollbar pr-2">
        {raids.map((raid) => (
          <div
            key={raid.id}
            className="bg-white/10 dark:bg-black/20 rounded-xl overflow-hidden 
              border border-sand-300/20 dark:border-sand-200/10 
              hover:border-primary-500/30 transition-all duration-300"
          >
            <div className="aspect-[3/2] relative">
              <img
                src={raid.boss.imageUrl}
                alt={raid.boss.name}
                className="w-full h-full object-cover"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
              <div className="absolute bottom-0 left-0 right-0 p-3">
                <h4 className="text-base md:text-lg font-semibold text-white mb-1">{raid.boss.name}</h4>
                <div className="flex items-center gap-3 text-xs md:text-sm">
                  <div className="flex items-center gap-1 text-sand-300">
                    <Users className="w-3 h-3 md:w-4 md:h-4" />
                    {raid.participants.length}
                  </div>
                  <div className="flex items-center gap-1 text-primary-400">
                    <Star className="w-3 h-3 md:w-4 md:h-4" />
                    {raid.boss.rewards.bonusXp.toLocaleString()} XP
                  </div>
                </div>
              </div>
            </div>

            <div className="p-4 flex justify-between items-center">
              <button
                onClick={() => setSelectedRaid(raid)}
                className="text-sm md:text-base text-sand-600 dark:text-sand-400 hover:text-primary-400 transition-colors"
              >
                View Details
              </button>
              <button
                onClick={() => handleShare(raid)}
                className="px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-400 
                  text-white rounded-lg hover:from-primary-600 hover:to-primary-500 
                  transition-all duration-300 text-sm md:text-base"
              >
                Share Victory
              </button>
            </div>
          </div>
        ))}

        {raids.length === 0 && (
          <div className="text-center py-8 text-sand-600 dark:text-sand-400 text-base md:text-lg">
            No completed raids yet
          </div>
        )}
      </div>

      {selectedRaid && !showShareModal && (
        <RaidBossDetailsModal
          raid={selectedRaid}
          onClose={() => setSelectedRaid(null)}
        />
      )}

      {selectedRaid && showShareModal && (
        <RaidBossShareModal
          raid={selectedRaid}
          participated={didParticipate(selectedRaid)}
          onClose={() => {
            setSelectedRaid(null);
            setShowShareModal(false);
          }}
        />
      )}
    </div>
  );
};

================
File: src/components/Raid/index.tsx
================
import { FC, useState, useEffect } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { QuestList } from './QuestList';
import { Leaderboard } from './Leaderboard';
import { UserProfile } from './UserProfile';
import { RaidBoss } from './RaidBoss';
import { CompletedRaids } from './CompletedRaids';
import { ConnectPrompt } from '../ConnectPrompt';
import { raidService } from '../../services/raidService';
import { ContentBox } from '../ContentBox';
import { RaidState } from '../../types/raid';

export const Raid: FC = () => {
  const { connected } = useWallet();
  const [completedRaids, setCompletedRaids] = useState<RaidState[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchCompletedRaids = async () => {
      try {
        const raids = await raidService.getCompletedRaids();
        setCompletedRaids(raids);
      } catch (error) {
        console.error('Error fetching completed raids:', error);
      } finally {
        setLoading(false);
      }
    };

    if (connected) {
      fetchCompletedRaids();
    }
  }, [connected]);

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="pt-4 md:pt-6">
      <div className="bg-gradient-to-br from-primary-500/30 via-sand-200/30 to-transparent
      border border-primary-500/40 dark:border-primary-500/30
      shadow-2xl shadow-primary-500/30
      hover:shadow-primary-500/50 hover:border-primary-500/50
      dark:from-primary-950 dark:via-background-900 dark:to-background-950
      backdrop-blur-md rounded-xl p-8">
        
        <div className="text-center mb-8">
          <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
            Raid Arena
          </h1>
          <p className="text-lg text-sand-600 dark:text-sand-400 max-w-2xl mx-auto mt-2">
            Join epic raid battles and earn rewards
          </p>
        </div>

        {/* User Profile */}
        <div className="mb-8 bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
          border border-primary-500/30 dark:border-primary-500/20
          shadow-xl shadow-primary-500/30 
          hover:shadow-primary-500/40 hover:border-primary-500/40
          backdrop-blur-md rounded-xl p-6 transition-all duration-300">
          <UserProfile />
        </div>

        {/* Active Raid Bosses */}
        <div className="mb-8 bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
          border border-primary-500/30 dark:border-primary-500/20
          shadow-xl shadow-primary-500/30 
          hover:shadow-primary-500/40 hover:border-primary-500/40
          backdrop-blur-md rounded-xl p-6 transition-all duration-300">
          <RaidBoss />
        </div>

        {/* Two Column Layout */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Available Quests */}
          <div className="lg:col-span-2 bg-gradient-to-br from-primary-500/30 via-sand-200/30 to-transparent
            border border-primary-500/40 dark:border-primary-500/30
            shadow-2xl shadow-primary-500/30
            hover:shadow-primary-500/50 hover:border-primary-500/50
            dark:from-primary-950 dark:via-background-900 dark:to-background-950
            backdrop-blur-md rounded-xl p-6 transition-all duration-300">
            <QuestList />
          </div>

          {/* Leaderboard & Completed Raids */}
          <div className="space-y-8">
            <div className="bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
              border border-primary-500/30 dark:border-primary-500/20
              shadow-xl shadow-primary-500/30 
              hover:shadow-primary-500/40 hover:border-primary-500/40
              backdrop-blur-md rounded-xl p-6 transition-all duration-300">
              <Leaderboard />
            </div>
            {loading ? (
              <div className="animate-pulse bg-sand-200/20 dark:bg-sand-800/20 backdrop-blur-sm rounded-xl h-48" />
            ) : (
              <div className="bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
                border border-primary-500/30 dark:border-primary-500/20
                shadow-xl shadow-primary-500/30 
                hover:shadow-primary-500/40 hover:border-primary-500/40
                backdrop-blur-md rounded-xl p-6 transition-all duration-300">
                <CompletedRaids raids={completedRaids} />
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export { RaidBossDetails } from './RaidBossDetails';

================
File: src/components/Raid/Leaderboard.tsx
================
import { FC, useEffect, useState } from 'react';
import { Trophy, Medal, Star } from 'lucide-react';
import { LeaderboardEntry } from '../../types/player';
import { playerService } from '../../services/playerService';
import { ProfileModal } from '../RaidLeaderboards/ProfileModal';

export const Leaderboard: FC = () => {
  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);
  const [selectedPlayer, setSelectedPlayer] = useState<LeaderboardEntry | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const updateLeaderboard = async () => {
      try {
        setLoading(true);
        const data = await playerService.getLeaderboard();
        setLeaderboard(data.slice(0, 5));
      } catch (error) {
        console.error('Error fetching leaderboard:', error);
      } finally {
        setLoading(false);
      }
    };

    updateLeaderboard();
    const interval = setInterval(updateLeaderboard, 30000); // Update every 30 seconds

    return () => clearInterval(interval);
  }, []);

  const handleProfileClick = async (entry: LeaderboardEntry) => {
    try {
      const player = await playerService.getPlayer(entry.wallet);
      if (player) {
        setSelectedPlayer(entry);
      }
    } catch (error) {
      console.error('Error fetching player profile:', error);
    }
  };

  const getRankDisplay = (rank: number) => {
    if (rank <= 3) {
      return (
        <Medal className={`w-5 h-5 md:w-6 md:h-6 ${
          rank === 1 ? 'text-yellow-400' :
          rank === 2 ? 'text-gray-400' :
          'text-amber-700'
        }`} />
      );
    }
    return <span className="text-sand-500 dark:text-sand-400 font-mono text-sm md:text-base">#{rank}</span>;
  };

  return (
    <div className="p-4">
      <div className="text-center mb-6">
        <h2 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Top Raiders
        </h2>
      </div>

      {loading ? (
        <div className="space-y-4">
          {[...Array(5)].map((_, i) => (
            <div key={i} className="animate-pulse flex items-center gap-4 p-3 rounded-lg 
              bg-sand-300/20 dark:bg-sand-700/20">
              <div className="w-8 h-8 rounded-full bg-sand-400/20 dark:bg-sand-600/20" />
              <div className="flex-1">
                <div className="h-4 w-24 bg-sand-400/20 dark:bg-sand-600/20 rounded" />
              </div>
              <div className="h-4 w-16 bg-sand-400/20 dark:bg-sand-600/20 rounded" />
            </div>
          ))}
        </div>
      ) : (
        <div className="space-y-2">
          {leaderboard.map((entry, index) => (
            <button
              key={entry.wallet}
              onClick={() => handleProfileClick(entry)}
              className="w-full flex items-center gap-4 p-3 rounded-lg
                bg-sand-100/80 dark:bg-black/40
                hover:bg-primary-500/10 dark:hover:bg-primary-500/20
                border border-sand-300/50 dark:border-sand-200/10
                hover:border-primary-500/30 dark:hover:border-primary-500/30
                transition-all duration-300"
            >
              <div className="flex items-center justify-center w-8">
                {getRankDisplay(index + 1)}
              </div>
              
              <div className="flex-1 text-left">
                <span className="font-semibold text-sand-700 dark:text-sand-300">
                  {entry.username || entry.wallet.slice(0, 4) + '...' + entry.wallet.slice(-4)}
                </span>
              </div>
              
              <div className="flex items-center text-sand-600 dark:text-sand-400">
                <Star className="w-4 h-4 text-primary-500 mr-2" />
                <span>{entry.experience.toLocaleString()}</span>
              </div>
            </button>
          ))}
        </div>
      )}

      {selectedPlayer && (
        <ProfileModal
          player={selectedPlayer}
          onClose={() => setSelectedPlayer(null)}
        />
      )}
    </div>
  );
};

================
File: src/components/Raid/QuestList.tsx
================
import { FC, useState, useEffect } from 'react';
import { Star, ScrollText, ChevronDown, Clock, Calendar, Trophy } from 'lucide-react';
import { Quest } from '../../types/quest';
import { QuestSubmissionModal } from './QuestSubmissionModal';
import { questService } from '../../services/questService';
import { useWallet } from '@solana/wallet-adapter-react';
import { useAuth } from '../../contexts/AuthContext';

interface QuestListProps {}

export const QuestList: FC<QuestListProps> = () => {
  const { publicKey } = useWallet();
  const { isAuthenticated } = useAuth();
  const [activeTab, setActiveTab] = useState<'daily' | 'weekly' | 'monthly'>('daily');
  const [quests, setQuests] = useState<Quest[]>([]);
  const [completedQuests, setCompletedQuests] = useState<Quest[]>([]);
  const [submittingQuest, setSubmittingQuest] = useState<Quest | null>(null);
  const [showAllCompleted, setShowAllCompleted] = useState(false);
  const [refreshKey, setRefreshKey] = useState(0);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadQuests = async () => {
      if (!publicKey || !isAuthenticated) {
        setQuests([]);
        setCompletedQuests([]);
        setLoading(false);
        return;
      }

      try {
        setLoading(true);
        setError(null);
        const allQuests = await questService.getQuests();
        
        if (!Array.isArray(allQuests)) {
          throw new Error('Failed to load quests');
        }

        const walletAddress = publicKey?.toString() || '';
        
        const activeQuests = allQuests.filter(quest => 
          quest.type === activeTab && 
          !quest.completedBy?.includes(walletAddress)
        );

        const completed = allQuests.filter(quest => 
          quest.completedBy?.includes(walletAddress)
        ).sort((a, b) => b.dateCreated - a.dateCreated);

        setQuests(activeQuests);
        setCompletedQuests(completed);
      } catch (err: any) {
        console.error('Error loading quests:', err);
        if (err.message === 'Not authenticated') {
          setError('Please wait while we authenticate your wallet...');
        } else {
          setError('Failed to load quests. Please try again.');
        }
      } finally {
        setLoading(false);
      }
    };

    loadQuests();
  }, [activeTab, publicKey, refreshKey, isAuthenticated]);

  const handleSubmitProof = async (submission: { url: string; screenshot?: File }) => {
    if (!submittingQuest || !publicKey) return;

    try {
      const success = await questService.submitQuestProof(
        submittingQuest.id,
        publicKey.toString(),
        submission
      );

      if (success) {
        setSubmittingQuest(null);
        setRefreshKey(prev => prev + 1);
      }
    } catch (err) {
      console.error('Error submitting quest proof:', err);
    }
  };

  const displayedCompletedQuests = showAllCompleted 
    ? completedQuests 
    : completedQuests.slice(0, 3);

  if (loading) {
    return (
      <div className="text-center py-8">
        <p className="text-neutral-lightGray">Loading quests...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="text-red-500 bg-red-500/10 p-4 rounded-lg">
        <p>{error}</p>
        <button 
          onClick={() => setRefreshKey(prev => prev + 1)}
          className="text-sm underline hover:no-underline mt-2"
        >
          Try Again
        </button>
      </div>
    );
  }

  if (!publicKey || !isAuthenticated) {
    return (
      <div className="text-center py-8">
        <p className="text-neutral-lightGray">Please connect your wallet and authenticate to view quests.</p>
      </div>
    );
  }

  return (
    <div className="bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-xl p-6
      border border-sand-300/20 dark:border-sand-200/10 
      hover:border-primary-500/30 transition-all duration-300">
      <div className="text-center mb-8">
        <h3 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Available Quests
        </h3>
      </div>

      {/* Quest Type Tabs */}
      <div className="flex flex-wrap justify-center gap-3 mb-8">
        <button
          onClick={() => setActiveTab('daily')}
          className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-300 text-sm md:text-base ${
            activeTab === 'daily'
              ? 'bg-gradient-to-r from-primary-500 to-primary-400 text-white'
              : 'text-sand-600 dark:text-sand-400 hover:bg-sand-200/10 dark:hover:bg-sand-800/10 hover:text-primary-400'
          }`}
        >
          <Clock className="w-4 h-4 md:w-5 md:h-5" />
          Daily
        </button>
        <button
          onClick={() => setActiveTab('weekly')}
          className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-300 text-sm md:text-base ${
            activeTab === 'weekly'
              ? 'bg-gradient-to-r from-primary-500 to-primary-400 text-white'
              : 'text-sand-600 dark:text-sand-400 hover:bg-sand-200/10 dark:hover:bg-sand-800/10 hover:text-primary-400'
          }`}
        >
          <Calendar className="w-4 h-4 md:w-5 md:h-5" />
          Weekly
        </button>
        <button
          onClick={() => setActiveTab('monthly')}
          className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-300 text-sm md:text-base ${
            activeTab === 'monthly'
              ? 'bg-gradient-to-r from-primary-500 to-primary-400 text-white'
              : 'text-sand-600 dark:text-sand-400 hover:bg-sand-200/10 dark:hover:bg-sand-800/10 hover:text-primary-400'
          }`}
        >
          <Trophy className="w-4 h-4 md:w-5 md:h-5" />
          Monthly
        </button>
      </div>

      {/* Available Quests */}
      <div className="space-y-4 mb-8">
        {quests.map(quest => (
          <div 
            key={quest.id} 
            className="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4
              border border-sand-300/20 dark:border-sand-200/10 
              hover:border-primary-500/30 transition-all duration-300
              transform hover:scale-[1.01]"
          >
            <div className="flex flex-col sm:flex-row sm:items-center gap-4">
              <div className="flex-1">
                <h4 className="text-lg md:text-xl font-semibold text-sand-800 dark:text-sand-200 mb-2">
                  {quest.title}
                </h4>
                <p className="text-base md:text-lg text-sand-600 dark:text-sand-400 mb-3">
                  {quest.description}
                </p>
                <div className="flex items-center gap-3 text-sm md:text-base">
                  <div className="flex items-center gap-1">
                    <Star className="w-4 h-4 md:w-5 md:h-5 text-primary-400" />
                    <span className="text-primary-400">+{quest.xpReward} XP</span>
                  </div>
                  {quest.timeLeft && (
                    <div className="flex items-center gap-1">
                      <Clock className="w-4 h-4 md:w-5 md:h-5 text-sand-500 dark:text-sand-400" />
                      <span className="text-sand-500 dark:text-sand-400">{quest.timeLeft}</span>
                    </div>
                  )}
                </div>
              </div>
              <button
                onClick={() => setSubmittingQuest(quest)}
                className="px-6 py-2 bg-gradient-to-r from-primary-500 to-primary-400 
                  text-white rounded-lg hover:from-primary-600 hover:to-primary-500 
                  transition-all duration-300 text-sm md:text-base whitespace-nowrap"
              >
                Submit Proof
              </button>
            </div>
          </div>
        ))}

        {quests.length === 0 && (
          <div className="text-center py-8 text-sand-600 dark:text-sand-400 text-base md:text-lg">
            No {activeTab} quests available
          </div>
        )}
      </div>

      {/* Completed Quests */}
      <div className="mt-12">
        <div className="text-center mb-6">
          <h3 className="text-xl md:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
            Completed Quests
          </h3>
        </div>

        <div className="space-y-4">
          {displayedCompletedQuests.map(quest => (
            <div
              key={quest.id}
              className="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4
                border border-sand-300/20 dark:border-sand-200/10 
                hover:border-primary-500/30 transition-all duration-300"
            >
              <div className="flex flex-col sm:flex-row sm:items-center gap-4">
                <div className="flex-1">
                  <h4 className="text-base md:text-lg font-semibold text-sand-800 dark:text-sand-200 mb-1">
                    {quest.title}
                  </h4>
                  <div className="flex items-center gap-2 text-sm md:text-base">
                    <Star className="w-4 h-4 md:w-5 md:h-5 text-primary-400" />
                    <span className="text-primary-400">+{quest.xpReward} XP</span>
                  </div>
                </div>
                <div className="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-sm md:text-base">
                  Completed
                </div>
              </div>
            </div>
          ))}

          {completedQuests.length === 0 && (
            <div className="text-center py-8 text-sand-600 dark:text-sand-400 text-base md:text-lg">
              No completed quests
            </div>
          )}

          {completedQuests.length > 3 && (
            <button
              onClick={() => setShowAllCompleted(!showAllCompleted)}
              className="w-full mt-4 px-4 py-2 flex items-center justify-center gap-2
                text-sand-600 dark:text-sand-400 hover:text-primary-400
                transition-colors text-sm md:text-base"
            >
              {showAllCompleted ? 'Show Less' : 'Show All'}
              <ChevronDown className={`w-4 h-4 transform transition-transform ${
                showAllCompleted ? 'rotate-180' : ''
              }`} />
            </button>
          )}
        </div>
      </div>

      {submittingQuest && (
        <QuestSubmissionModal
          quest={submittingQuest}
          onClose={() => setSubmittingQuest(null)}
          onSubmit={handleSubmitProof}
        />
      )}
    </div>
  );
};

================
File: src/components/Raid/QuestSubmissionModal.tsx
================
import { FC, useState } from 'react';
import { X, Upload, Link, Star } from 'lucide-react';
import { QuestSubmission } from '../../types/quest';
import { useWallet } from '@solana/wallet-adapter-react';
import { playerService } from '../../services/playerService';
import { LevelDisplay } from '../LevelDisplay';
import { GlassPanel } from '../GlassPanel';

interface QuestSubmissionModalProps {
  onClose: () => void;
  onSubmit: (submission: QuestSubmission) => void;
  xpReward: number;
}

export const QuestSubmissionModal: FC<QuestSubmissionModalProps> = ({ 
  onClose, 
  onSubmit,
  xpReward 
}) => {
  const { publicKey } = useWallet();
  const [screenshot, setScreenshot] = useState<File | null>(null);
  const [url, setUrl] = useState('');
  const [error, setError] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const player = publicKey ? playerService.getPlayer(publicKey.toString()) : null;

  const handleSubmit = async () => {
    if (!url) {
      setError('URL is required');
      return;
    }

    setIsSubmitting(true);
    try {
      await onSubmit({
        screenshot: screenshot || undefined,
        url
      });
      setShowSuccess(true);
      setTimeout(() => {
        onClose();
      }, 2000);
    } catch (error) {
      setError('Failed to submit quest. Please try again.');
      setIsSubmitting(false);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={onClose}
      />
      <GlassPanel className="relative w-full max-w-md">
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-xl font-bold text-white">Submit Quest Proof</h3>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="space-y-6">
          {showSuccess ? (
            <div className="text-center space-y-4">
              <div className="text-green-400 text-lg font-medium mb-2">
                Quest Completed!
              </div>
              <div className="flex items-center justify-center gap-2">
                <Star className="w-5 h-5 text-primary-main" />
                <span className="text-white text-lg">+{xpReward} XP</span>
              </div>
              {player && (
                <div className="mt-4">
                  <LevelDisplay xp={player.experience + xpReward} showProgress size="lg" />
                </div>
              )}
            </div>
          ) : (
            <>
              <div>
                <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                  Screenshot (Optional)
                </label>
                <div className="border-2 border-dashed border-primary-main/20 rounded-lg p-4 text-center">
                  {screenshot ? (
                    <div className="flex items-center justify-between">
                      <span className="text-sm text-neutral-lightGray truncate flex-1 text-left">
                        {screenshot.name}
                      </span>
                      <button
                        onClick={() => setScreenshot(null)}
                        className="ml-2 text-red-400 hover:text-red-300 transition-colors"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  ) : (
                    <label className="cursor-pointer flex flex-col items-center">
                      <Upload className="w-8 h-8 text-primary-main mb-2" />
                      <span className="text-sm text-neutral-lightGray">
                        Click to upload or drag and drop
                      </span>
                      <input
                        type="file"
                        className="hidden"
                        accept="image/*"
                        onChange={(e) => {
                          const file = e.target.files?.[0];
                          if (file) setScreenshot(file);
                        }}
                      />
                    </label>
                  )}
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-neutral-lightGray mb-2">
                  URL Link (Required)
                </label>
                <div className="relative">
                  <input
                    type="url"
                    value={url}
                    onChange={(e) => setUrl(e.target.value)}
                    placeholder="https://..."
                    className="w-full px-4 py-2 bg-black/20 border border-primary-main/20 rounded-lg text-white placeholder-neutral-lightGray focus:outline-none focus:border-primary-main/40"
                  />
                  <Link className="absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-lightGray w-4 h-4" />
                </div>
                {error && <p className="text-red-400 text-sm mt-1">{error}</p>}
              </div>

              <button
                onClick={handleSubmit}
                disabled={isSubmitting}
                className="w-full px-4 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors disabled:opacity-50"
              >
                {isSubmitting ? 'Submitting...' : 'Submit Quest'}
              </button>
            </>
          )}
        </div>
      </GlassPanel>
    </div>
  );
};

================
File: src/components/Raid/RaidBoss.tsx
================
import { FC, useState, useEffect } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { useRaid } from '../../hooks/useRaid';
import { RaidQuestList } from './RaidQuestList';
import { RaidBossCard } from './RaidBossCard';
import { RaidBossDetails } from './RaidBossDetails';

export const RaidBoss: FC = () => {
  const { publicKey } = useWallet();
  const { currentRaids, joinRaid } = useRaid();
  const [showQuests, setShowQuests] = useState(false);
  const [selectedRaidId, setSelectedRaidId] = useState<string | null>(null);
  const [showDetails, setShowDetails] = useState(false);

  // Auto-refresh raid status
  useEffect(() => {
    const interval = setInterval(() => {
      setSelectedRaidId(prev => prev);
    }, 5000);

    return () => clearInterval(interval);
  }, []);

  const handleJoinRaid = (raidId: string) => {
    if (!publicKey) return;
    const success = joinRaid(raidId, 'default-nft-id');
    if (success) {
      setSelectedRaidId(raidId);
      setShowQuests(true);
    }
  };

  const handleShowQuests = (raidId: string) => {
    setSelectedRaidId(raidId);
    setShowQuests(true);
  };

  const handleShowDetails = (raidId: string) => {
    setSelectedRaidId(raidId);
    setShowDetails(true);
  };

  return (
    <div className="bg-white/30 dark:bg-black/10 backdrop-blur-sm rounded-xl p-6
      border border-sand-300/20 dark:border-sand-200/10 
      hover:border-primary-500/30 transition-all duration-300">
      <h2 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400 mb-6">
        Active Raid Bosses
      </h2>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {currentRaids.map((raid) => {
          const isParticipating = raid.participants.some(
            p => p.wallet === publicKey?.toString()
          );
          const hasCompletedAllQuests = raid.boss.quests.every(
            quest => quest.completedBy.includes(publicKey?.toString() || '')
          );

          return (
            <RaidBossCard
              key={raid.id}
              raid={raid}
              onJoin={() => handleJoinRaid(raid.id)}
              onViewQuests={() => handleShowQuests(raid.id)}
              onShowDetails={() => handleShowDetails(raid.id)}
              isParticipating={isParticipating}
              hasCompletedAllQuests={hasCompletedAllQuests}
            />
          );
        })}

        {currentRaids.length === 0 && (
          <div className="col-span-full text-center py-8 text-sand-600 dark:text-sand-400">
            No active raid bosses
          </div>
        )}
      </div>

      {showQuests && selectedRaidId && (
        <RaidQuestList
          raidId={selectedRaidId}
          onClose={() => {
            setShowQuests(false);
            setSelectedRaidId(null);
          }}
        />
      )}

      {showDetails && selectedRaidId && (
        <RaidBossDetails
          raid={currentRaids.find(r => r.id === selectedRaidId)!}
          onClose={() => {
            setShowDetails(false);
            setSelectedRaidId(null);
          }}
          onJoin={() => handleJoinRaid(selectedRaidId)}
          onViewQuests={() => {
            setShowDetails(false);
            handleShowQuests(selectedRaidId);
          }}
          isParticipating={currentRaids.find(r => r.id === selectedRaidId)?.participants.some(
            p => p.wallet === publicKey?.toString()
          ) || false}
        />
      )}
    </div>
  );
};

================
File: src/components/Raid/RaidBossCard.tsx
================
import { FC } from 'react';
import { Shield, Star } from 'lucide-react';
import { RaidState } from '../../types/raid';

interface RaidBossCardProps {
  raid: RaidState;
  onJoin: () => void;
  onViewQuests: () => void;
  onShowDetails: () => void;
  isParticipating: boolean;
  hasCompletedAllQuests: boolean;
}

export const RaidBossCard: FC<RaidBossCardProps> = ({
  raid,
  onJoin,
  onViewQuests,
  onShowDetails,
  isParticipating,
  hasCompletedAllQuests
}) => {
  const healthPercentage = (raid.boss.health / raid.boss.maxHealth) * 100;

  return (
    <div className="bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-xl 
      border border-sand-300/20 dark:border-sand-200/10 
      group hover:border-primary-500/30 transition-all duration-300">
      {/* Raid Boss Image */}
      <button
        onClick={onShowDetails}
        className="w-full aspect-video relative overflow-hidden rounded-t-xl"
      >
        <img
          src={raid.boss.imageUrl}
          alt={raid.boss.name}
          className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent" />
        <div className="absolute bottom-0 left-0 right-0 p-4">
          <h3 className="text-lg font-semibold text-white mb-2 group-hover:text-primary-400 transition-colors">
            {raid.boss.name}
          </h3>
          <div className="flex items-center gap-4 text-sm">
            <div className="flex items-center gap-1">
              <Shield className="w-4 h-4 text-primary-400" />
              <span className="text-sand-200">{raid.boss.defense}</span>
            </div>
            <div className="flex items-center gap-1">
              <Star className="w-4 h-4 text-primary-400" />
              <span className="text-sand-200">
                {raid.boss.rewards.xp.toLocaleString()} XP
              </span>
            </div>
          </div>
        </div>
      </button>

      {/* Health Bar */}
      <div className="px-4 py-3">
        <div className="flex items-center justify-between text-sm mb-2">
          <span className="text-sand-700 dark:text-sand-300 font-medium">Boss HP</span>
          <span className="text-sand-700 dark:text-sand-300 font-medium">
            {Math.ceil(raid.boss.health).toLocaleString()} / {raid.boss.maxHealth.toLocaleString()}
          </span>
        </div>
        <div className="h-2 bg-sand-200/20 dark:bg-sand-800/20 rounded-full overflow-hidden">
          <div
            className="h-full bg-gradient-to-r from-primary-500 to-primary-400 transition-all duration-300"
            style={{ width: `${healthPercentage}%` }}
          >
            <div className="w-full h-full animate-pulse opacity-50 bg-white/20" />
          </div>
        </div>
      </div>

      {/* Actions */}
      <div className="p-4 pt-2">
        {isParticipating ? (
          <button
            onClick={onViewQuests}
            className={`w-full px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
              hasCompletedAllQuests
                ? 'bg-green-500/20 text-green-400 hover:bg-green-500/30'
                : 'bg-gradient-to-r from-primary-500 to-primary-400 text-white hover:from-primary-600 hover:to-primary-500'
            }`}
          >
            {hasCompletedAllQuests ? 'Completed' : 'View Quests'}
          </button>
        ) : (
          <button
            onClick={onJoin}
            className="w-full px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-400 text-white rounded-lg 
              hover:from-primary-600 hover:to-primary-500 transition-all duration-300"
          >
            Join Raid
          </button>
        )}
      </div>
    </div>
  );
};

================
File: src/components/Raid/RaidBossDetails.tsx
================
import { FC } from 'react';
import { X, Shield, Star, Users, Sword } from 'lucide-react';
import { RaidState } from '../../types/raid';
import { GlassPanel } from '../GlassPanel';

interface RaidBossDetailsProps {
  raid: RaidState;
  onClose: () => void;
  onJoin: () => void;
  onViewQuests: () => void;
  isParticipating: boolean;
}

export const RaidBossDetails: FC<RaidBossDetailsProps> = ({
  raid,
  onClose,
  onJoin,
  onViewQuests,
  isParticipating
}) => {
  const healthPercentage = (raid.boss.health / raid.boss.maxHealth) * 100;
  const healthColor = healthPercentage > 50 
    ? 'bg-primary-main' 
    : healthPercentage > 25 
      ? 'bg-accent-warning' 
      : 'bg-accent-danger';

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-background-dark/90 backdrop-blur-md"
        onClick={onClose}
      />
      <GlassPanel className="relative w-full max-w-3xl">
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-xl font-title text-white">{raid.boss.name}</h3>
          <button
            onClick={onClose}
            className="p-2 text-text-dark-secondary hover:text-white transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
          {/* Left Column - Image and Health */}
          <div>
            <div className="rounded-xl overflow-hidden mb-6">
              <img
                src={raid.boss.imageUrl}
                alt={raid.boss.name}
                className="w-full aspect-square object-cover"
              />
            </div>

            {/* Health Bar */}
            <div className="space-y-2">
              <div className="flex items-center justify-between text-sm">
                <span className="text-white font-medium">Boss HP</span>
                <span className="text-text-dark-secondary">
                  {Math.ceil(raid.boss.health).toLocaleString()} / {raid.boss.maxHealth.toLocaleString()}
                </span>
              </div>
              <div className="h-3 bg-background-darker rounded-full overflow-hidden">
                <div
                  className={`h-full ${healthColor} transition-all duration-300`}
                  style={{ width: `${healthPercentage}%` }}
                >
                  <div className="w-full h-full animate-pulse opacity-50" />
                </div>
              </div>
            </div>
          </div>

          {/* Right Column - Stats and Actions */}
          <div className="space-y-6">
            <p className="text-text-dark-secondary">
              {raid.boss.description}
            </p>

            {/* Stats Grid */}
            <div className="grid grid-cols-2 gap-4">
              <GlassPanel>
                <div className="flex items-center gap-2 mb-2">
                  <Shield className="w-4 h-4 text-primary-main" />
                  <span className="text-white font-medium">Defense</span>
                </div>
                <p className="text-2xl font-bold text-primary-main">
                  {raid.boss.defense}
                </p>
              </GlassPanel>

              <GlassPanel>
                <div className="flex items-center gap-2 mb-2">
                  <Star className="w-4 h-4 text-primary-main" />
                  <span className="text-white font-medium">XP Reward</span>
                </div>
                <p className="text-2xl font-bold text-primary-main">
                  {raid.boss.rewards.xp.toLocaleString()}
                </p>
              </GlassPanel>

              <GlassPanel>
                <div className="flex items-center gap-2 mb-2">
                  <Users className="w-4 h-4 text-primary-main" />
                  <span className="text-white font-medium">Raiders</span>
                </div>
                <p className="text-2xl font-bold text-primary-main">
                  {raid.participants.length}
                </p>
              </GlassPanel>

              <GlassPanel>
                <div className="flex items-center gap-2 mb-2">
                  <Sword className="w-4 h-4 text-primary-main" />
                  <span className="text-white font-medium">Quests</span>
                </div>
                <p className="text-2xl font-bold text-primary-main">
                  {raid.boss.quests.length}
                </p>
              </GlassPanel>
            </div>

            {/* Action Buttons */}
            <div className="flex gap-4">
              {isParticipating ? (
                <button
                  onClick={onViewQuests}
                  className="flex-1 px-6 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors shadow-glow"
                >
                  View Quests
                </button>
              ) : (
                <button
                  onClick={onJoin}
                  className="flex-1 px-6 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors shadow-glow"
                >
                  Join Raid
                </button>
              )}
            </div>
          </div>
        </div>
      </GlassPanel>
    </div>
  );
};

================
File: src/components/Raid/RaidBossDetailsModal.tsx
================
import { FC } from 'react';
import { RaidState } from '../../types/raid';
import { X, Shield, Star, Users, CheckCircle } from 'lucide-react';

interface RaidBossDetailsModalProps {
  raid: RaidState;
  onClose: () => void;
}

export const RaidBossDetailsModal: FC<RaidBossDetailsModalProps> = ({ raid, onClose }) => {
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-neutral-charcoal/90 backdrop-blur-md"
        onClick={onClose}
      />
      <div className="relative w-full max-w-3xl bg-[#1A1B23] rounded-xl border border-primary-pink/20 shadow-2xl transform transition-all overflow-hidden max-h-[90vh] flex flex-col">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-primary-pink/20 bg-black/40">
          <div className="flex items-center gap-4">
            <div className="w-16 h-16 rounded-lg overflow-hidden border border-primary-pink/20">
              <img
                src={raid.boss.imageUrl}
                alt={raid.boss.name}
                className="w-full h-full object-cover"
              />
            </div>
            <div>
              <h3 className="text-xl font-bold text-white">{raid.boss.name}</h3>
              <p className="text-sm text-neutral-lightGray">
                Completed {new Date(raid.endTime).toLocaleDateString()}
              </p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-primary-pink/10"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Scrollable Content */}
        <div className="flex-1 overflow-y-auto custom-scrollbar">
          <div className="p-6 space-y-6">
            {/* Boss Stats */}
            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
              <div className="bg-black/40 rounded-lg p-4 border border-primary-pink/20">
                <div className="flex items-center gap-2 mb-2">
                  <Shield className="w-4 h-4 text-primary-teal flex-shrink-0" />
                  <h4 className="text-white font-medium truncate">Defense</h4>
                </div>
                <p className="text-2xl font-bold text-primary-teal">
                  {raid.boss.defense}
                </p>
              </div>

              <div className="bg-black/40 rounded-lg p-4 border border-primary-pink/20">
                <div className="flex items-center gap-2 mb-2">
                  <Star className="w-4 h-4 text-primary-pink flex-shrink-0" />
                  <h4 className="text-white font-medium truncate">XP Reward</h4>
                </div>
                <p className="text-2xl font-bold text-primary-pink">
                  {raid.boss.rewards.xp.toLocaleString()}
                </p>
              </div>

              <div className="bg-black/40 rounded-lg p-4 border border-primary-pink/20">
                <div className="flex items-center gap-2 mb-2">
                  <Users className="w-4 h-4 text-primary-pink flex-shrink-0" />
                  <h4 className="text-white font-medium truncate">Participants</h4>
                </div>
                <p className="text-2xl font-bold text-primary-pink">
                  {raid.participants.length}
                </p>
              </div>
            </div>

            {/* Description */}
            <div className="bg-black/40 rounded-lg p-4 border border-primary-pink/20">
              <p className="text-neutral-lightGray break-words">
                {raid.boss.description}
              </p>
            </div>

            {/* Quests */}
            <div>
              <h4 className="text-lg font-semibold text-white mb-4">Required Quests</h4>
              <div className="space-y-3">
                {raid.boss.quests.map((quest) => (
                  <div
                    key={quest.id}
                    className="bg-black/40 rounded-lg p-4 border border-primary-pink/20 hover:border-primary-pink/40 transition-colors"
                  >
                    <div className="flex items-start gap-4">
                      <div className="flex-1 min-w-0">
                        <p className="text-white mb-2 break-words">{quest.description}</p>
                        <div className="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm">
                          <span className="text-primary-pink flex items-center gap-1">
                            <Star className="w-3 h-3" />
                            {quest.xpReward} XP
                          </span>
                          <span className="text-neutral-lightGray flex items-center gap-1">
                            <Users className="w-3 h-3" />
                            {quest.completedBy.length} raiders
                          </span>
                        </div>
                      </div>
                      <CheckCircle className="w-5 h-5 text-green-400 flex-shrink-0" />
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/Raid/RaidBossShareModal.tsx
================
import { FC, useEffect, useRef } from 'react';
import { X, Share2 } from 'lucide-react';
import { RaidState } from '../../types/raid';

interface RaidBossShareModalProps {
  raid: RaidState;
  participated: boolean;
  onClose: () => void;
}

export const RaidBossShareModal: FC<RaidBossShareModalProps> = ({ raid, participated, onClose }) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const createShareImage = async () => {
      canvas.width = 1200;
      canvas.height = 630;

      // Background
      ctx.fillStyle = '#1A1B23';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      try {
        // Load and draw raid boss image
        const img = new Image();
        img.crossOrigin = 'anonymous';
        await new Promise((resolve, reject) => {
          img.onload = resolve;
          img.onerror = reject;
          img.src = raid.boss.imageUrl;
        });

        // Draw raid boss image with gradient overlay
        ctx.drawImage(img, 0, 0, canvas.width / 2, canvas.height);
        
        // Add gradient overlay
        const gradient = ctx.createLinearGradient(canvas.width / 2 - 200, 0, canvas.width / 2, 0);
        gradient.addColorStop(0, 'rgba(26, 27, 35, 0)');
        gradient.addColorStop(1, 'rgba(26, 27, 35, 1)');
        ctx.fillStyle = gradient;
        ctx.fillRect(canvas.width / 2 - 200, 0, 200, canvas.height);

        // Draw text content
        ctx.fillStyle = '#FFFFFF';
        ctx.font = 'bold 64px sans-serif';
        ctx.fillText('Raid Boss Defeated!', canvas.width / 2 + 40, 100);

        ctx.font = 'bold 48px sans-serif';
        ctx.fillText(raid.boss.name, canvas.width / 2 + 40, 180);

        ctx.font = '32px sans-serif';
        ctx.fillStyle = '#D24985';
        ctx.fillText(`${raid.boss.rewards.xp.toLocaleString()} XP Reward`, canvas.width / 2 + 40, 240);

        if (participated) {
          ctx.fillStyle = '#4CAF50';
          ctx.font = 'bold 36px sans-serif';
          ctx.fillText('✓ I Participated in this Raid!', canvas.width / 2 + 40, 300);
        }

        // Draw stats
        ctx.font = '24px sans-serif';
        ctx.fillStyle = '#9071A8';
        ctx.fillText(`${raid.participants.length} Raiders`, canvas.width / 2 + 40, 360);
        ctx.fillText(`${raid.questCompletions} Quests Completed`, canvas.width / 2 + 40, 400);
      } catch (error) {
        console.error('Error creating share image:', error);
      }
    };

    createShareImage();
  }, [raid, participated]);

  const handleShare = async () => {
    if (!canvasRef.current) return;

    try {
      const imageData = canvasRef.current.toDataURL('image/png');
      const text = participated 
        ? `I helped defeat the #RaidBoss ${raid.boss.name} on @KibalzXYZ! 🐼⚔️`
        : `The #RaidBoss ${raid.boss.name} has been defeated on @KibalzXYZ! 🐼⚔️`;

      // Open Twitter share dialog
      const shareUrl = new URL('https://twitter.com/intent/tweet');
      shareUrl.searchParams.append('text', text);
      
      // Open in new window
      window.open(shareUrl.toString(), '_blank', 'width=550,height=420');
    } catch (error) {
      console.error('Error sharing to Twitter:', error);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-neutral-charcoal/90 backdrop-blur-md"
        onClick={onClose}
      />
      <div className="relative bg-[#1A1B23] rounded-xl border border-primary-pink/20 p-6 max-w-2xl w-full">
        <div className="flex justify-between items-center mb-6">
          <h3 className="text-xl font-bold text-white">Share Victory</h3>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="aspect-[1200/630] w-full rounded-lg overflow-hidden mb-6">
          <canvas
            ref={canvasRef}
            className="w-full h-full"
          />
        </div>

        <div className="flex justify-end">
          <button
            onClick={handleShare}
            className="flex items-center gap-2 px-6 py-3 bg-[#1DA1F2] text-white rounded-lg hover:bg-[#1A8CD8] transition-colors"
          >
            <Share2 className="w-5 h-5" />
            Share on Twitter
          </button>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/Raid/RaidQuestList.tsx
================
import { FC, useState, useEffect } from 'react';
import { X, Star } from 'lucide-react';
import { QuestSubmissionModal } from './QuestSubmissionModal';
import { raidService } from '../../services/raidService';
import { useWallet } from '@solana/wallet-adapter-react';
import { QuestSubmission } from '../../types/raid';

interface RaidQuestListProps {
  raidId: string;
  onClose: () => void;
}

export const RaidQuestList: FC<RaidQuestListProps> = ({ raidId, onClose }) => {
  const { publicKey } = useWallet();
  const [showSubmitModal, setShowSubmitModal] = useState(false);
  const [selectedQuestId, setSelectedQuestId] = useState<string | null>(null);
  const [refreshKey, setRefreshKey] = useState(0);

  const raids = raidService.getActiveRaids();
  const raid = raids.find(r => r.id === raidId);
  const quests = raid?.boss.quests || [];

  // Lock body scroll when modal is open
  useEffect(() => {
    document.body.style.overflow = 'hidden';
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, []);

  const handleQuestComplete = (questId: string) => {
    setSelectedQuestId(questId);
    setShowSubmitModal(true);
  };

  const handleSubmitProof = async (submission: QuestSubmission) => {
    if (!publicKey || !selectedQuestId) return;
    
    const success = await raidService.completeQuest(raidId, selectedQuestId, publicKey.toString(), submission);
    if (success) {
      setShowSubmitModal(false);
      setSelectedQuestId(null);
      setRefreshKey(prev => prev + 1);
    }
  };

  if (!raid) {
    return null;
  }

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      <div 
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={onClose}
      />
      <div className="relative w-full max-w-2xl mx-4 max-h-[90vh] flex flex-col 
        bg-white/20 dark:bg-black/20 backdrop-blur-sm rounded-xl 
        border border-sand-300/20 dark:border-sand-200/10 
        shadow-xl shadow-sand-400/20 dark:shadow-primary-500/20
        transform transition-all">
        {/* Header */}
        <div className="text-center p-6 border-b border-sand-300/20 dark:border-sand-200/10">
          <h3 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
            {raid.boss.name} - Quests
          </h3>
          <button
            onClick={onClose}
            className="absolute top-4 right-4 p-2 text-sand-600 dark:text-sand-400 
              hover:text-primary-400 transition-colors rounded-lg 
              hover:bg-sand-200/10 dark:hover:bg-sand-800/10"
          >
            <X className="w-5 h-5 md:w-6 md:h-6" />
          </button>
        </div>

        {/* Quest List */}
        <div className="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
          {quests.map((quest) => {
            const isCompleted = quest.completedBy?.includes(publicKey?.toString() || '');

            return (
              <div
                key={`${quest.id}-${refreshKey}`}
                className="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4 
                  border border-sand-300/20 dark:border-sand-200/10 
                  hover:border-primary-500/30 transition-all duration-300"
              >
                <div className="flex justify-between items-start gap-4">
                  <div>
                    <p className="text-base md:text-lg text-sand-800 dark:text-sand-200 mb-2">
                      {quest.description}
                    </p>
                    <div className="flex items-center gap-2 text-sm md:text-base">
                      <Star className="w-4 h-4 md:w-5 md:h-5 text-primary-400" />
                      <span className="text-primary-400">+{quest.xpReward} XP</span>
                    </div>
                  </div>
                  {isCompleted ? (
                    <div className="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-sm md:text-base">
                      Completed
                    </div>
                  ) : (
                    <button
                      onClick={() => handleQuestComplete(quest.id)}
                      className="px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-400 
                        text-white rounded-lg hover:from-primary-600 hover:to-primary-500 
                        transition-all duration-300 text-sm md:text-base whitespace-nowrap"
                    >
                      Complete Quest
                    </button>
                  )}
                </div>
              </div>
            );
          })}

          {quests.length === 0 && (
            <div className="text-center py-8 text-neutral-lightGray">
              No quests available for this raid boss
            </div>
          )}
        </div>
      </div>

      {showSubmitModal && (
        <QuestSubmissionModal
          onClose={() => {
            setShowSubmitModal(false);
            setSelectedQuestId(null);
          }}
          onSubmit={handleSubmitProof}
        />
      )}
    </div>
  );
};

================
File: src/components/Raid/UserProfile.tsx
================
import { FC, useEffect, useState } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { Star, TrendingUp, User } from 'lucide-react';
import { playerService } from '../../services/playerService';
import { Link } from 'react-router-dom';
import { LevelDisplay } from '../LevelDisplay';
import { Player } from '../../types/player';

export const UserProfile: FC = () => {
  const { publicKey } = useWallet();
  const [player, setPlayer] = useState<Player | null>(null);
  const [loading, setLoading] = useState(true);
  const [rank, setRank] = useState<number | null>(null);

  useEffect(() => {
    const fetchPlayerData = async () => {
      if (!publicKey) {
        setLoading(false);
        return;
      }

      try {
        const fetchedPlayer = await playerService.getPlayer(publicKey.toString());
        setPlayer(fetchedPlayer);
        
        // Fetch rank
        const leaderboard = await playerService.getLeaderboard();
        const playerRank = leaderboard.findIndex(p => p.wallet === publicKey.toString()) + 1;
        setRank(playerRank > 0 ? playerRank : null);
      } catch (error) {
        console.error('Error fetching player data:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchPlayerData();
  }, [publicKey]);

  if (loading) {
    return (
      <div className="animate-pulse flex flex-col items-center justify-center gap-4 p-4">
        <div className="flex items-center gap-4">
          <div className="w-16 h-16 rounded-full bg-sand-300/20 dark:bg-sand-700/20" />
          <div className="space-y-2">
            <div className="h-6 w-32 bg-sand-300/20 dark:bg-sand-700/20 rounded" />
            <div className="h-4 w-24 bg-sand-300/20 dark:bg-sand-700/20 rounded" />
          </div>
        </div>
      </div>
    );
  }

  if (!player) {
    return null;
  }

  return (
    <div className="flex flex-col items-center justify-center p-4">
      <div className="text-center mb-4">
        <h2 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Your Profile
        </h2>
      </div>
      
      <div className="flex flex-col md:flex-row items-center justify-center gap-8 w-full">
        <div className="flex items-center gap-4">
          <div className="w-16 h-16 rounded-full bg-gradient-to-br from-primary-500/20 to-sand-200/20 
            border-2 border-primary-500/30 flex items-center justify-center">
            <User className="w-8 h-8 text-primary-500" />
          </div>
          <div className="text-center md:text-left">
            <h3 className="text-xl font-semibold text-sand-700 dark:text-sand-300">
              {player.username || 'Anonymous Raider'}
            </h3>
            <p className="text-sand-600 dark:text-sand-400">
              Level {player.level}
            </p>
          </div>
        </div>

        <div className="flex items-center gap-8">
          <div className="text-center">
            <div className="flex items-center justify-center mb-1">
              <Star className="w-5 h-5 text-primary-500 mr-2" />
              <span className="text-lg font-semibold text-sand-700 dark:text-sand-300">{player.experience}</span>
            </div>
            <p className="text-sm text-sand-600 dark:text-sand-400">Experience</p>
          </div>

          {rank && (
            <div className="text-center">
              <div className="flex items-center justify-center mb-1">
                <TrendingUp className="w-5 h-5 text-primary-500 mr-2" />
                <span className="text-lg font-semibold text-sand-700 dark:text-sand-300">#{rank}</span>
              </div>
              <p className="text-sm text-sand-600 dark:text-sand-400">Rank</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

================
File: src/components/RaidLeaderboards/ArchetypeLeaderboards.tsx
================
import { FC, useState, useEffect } from 'react';
import { Trophy, Users, Star, Coins, Mountain, Heart, PartyPopper, X } from 'lucide-react';
import { guildService } from '../../services/guildService';
import { playerService } from '../../services/playerService';
import { CORE_GUILDS } from '../../types/guild';
import { calculateLevel } from '../../utils/levelCalculator';
import { motion, AnimatePresence } from 'framer-motion';
import { Player } from '../../types/player';

interface ArchetypeLeaderboardsProps {
  timeRange: 'daily' | 'weekly' | 'monthly' | 'allTime';
}

interface ArchetypeMembersModalProps {
  isOpen: boolean;
  onClose: () => void;
  archetype: typeof CORE_GUILDS[0];
  members: Player[];
}

const ArchetypeMembersModal: FC<ArchetypeMembersModalProps> = ({ isOpen, onClose, archetype, members }) => {
  if (!isOpen) return null;

  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
          onClick={onClose}
        >
          <motion.div
            initial={{ scale: 0.9, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            exit={{ scale: 0.9, opacity: 0 }}
            className="relative w-full max-w-3xl max-h-[80vh] overflow-y-auto bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-xl"
            onClick={e => e.stopPropagation()}
          >
            {/* Header */}
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-sand-900 dark:text-white">
                {archetype.name} Members
              </h2>
              <button
                onClick={onClose}
                className="p-2 rounded-full hover:bg-sand-100 dark:hover:bg-sand-800 transition-colors"
              >
                <X className="w-6 h-6 text-sand-600 dark:text-sand-400" />
              </button>
            </div>

            {/* Members List */}
            <div className="space-y-4">
              {members.map((member, index) => {
                const { level } = calculateLevel(member.experience);
                return (
                  <motion.div
                    key={member.wallet}
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: index * 0.05 }}
                    className="flex items-center gap-4 p-4 bg-sand-50 dark:bg-gray-800 rounded-xl"
                  >
                    <div className="w-10 h-10 rounded-full bg-primary-500/10 flex items-center justify-center">
                      <Trophy className="w-5 h-5 text-primary-500" />
                    </div>
                    <div className="flex-grow">
                      <div className="font-medium text-sand-900 dark:text-white">
                        {member.name || member.wallet.slice(0, 6) + '...' + member.wallet.slice(-4)}
                      </div>
                      <div className="text-sm text-sand-600 dark:text-sand-400">
                        Level {level} • {member.experience.toLocaleString()} XP
                      </div>
                    </div>
                  </motion.div>
                );
              })}

              {members.length === 0 && (
                <div className="text-center py-8 text-sand-600 dark:text-sand-400">
                  No members found in this archetype
                </div>
              )}
            </div>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
};

const ArchetypeCard: FC<{
  archetype: typeof CORE_GUILDS[0] & {
    memberCount: number;
    totalXp: number;
    averageLevel: number;
  };
  index: number;
  onShowMembers: () => void;
}> = ({ archetype, index, onShowMembers }) => {
  const getArchetypeIcon = (archetypeType: string) => {
    switch (archetypeType) {
      case 'Finance':
        return <Coins className="w-8 h-8 text-yellow-500" />;
      case 'Adventurer':
        return <Mountain className="w-8 h-8 text-green-500" />;
      case 'Philanthropist':
        return <Heart className="w-8 h-8 text-red-500" />;
      case 'PartyAnimal':
        return <PartyPopper className="w-8 h-8 text-purple-500" />;
      default:
        return <Trophy className="w-8 h-8 text-primary-500" />;
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.1 }}
      whileHover={{ scale: 1.02 }}
      onClick={onShowMembers}
      className="relative bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300 cursor-pointer"
    >
      <div className="flex items-center gap-6">
        {/* Rank */}
        <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
          index === 0 ? 'bg-yellow-500/10' :
          index === 1 ? 'bg-gray-400/10' :
          index === 2 ? 'bg-amber-700/10' :
          'bg-primary-500/10'
        }`}>
          <Trophy className={`w-6 h-6 ${
            index === 0 ? 'text-yellow-500' :
            index === 1 ? 'text-gray-400' :
            index === 2 ? 'text-amber-700' :
            'text-primary-500'
          }`} />
        </div>

        {/* Archetype Icon */}
        <div className="relative w-16 h-16 rounded-xl overflow-hidden border border-sand-300/20 dark:border-sand-200/10 flex items-center justify-center bg-white/20 dark:bg-black/40">
          {getArchetypeIcon(archetype.archetype)}
        </div>

        {/* Archetype Info */}
        <div className="flex-grow min-w-0">
          <h3 className="text-lg font-bold text-sand-900 dark:text-white mb-2">{archetype.name}</h3>
          <div className="flex items-center gap-6">
            <div className="flex items-center gap-2">
              <Users className="w-4 h-4 text-primary-500" />
              <span className="text-sand-700 dark:text-sand-300 font-medium">
                {archetype.memberCount} Members
              </span>
            </div>
            <div className="flex items-center gap-2">
              <Star className="w-4 h-4 text-primary-500" />
              <span className="text-sand-700 dark:text-sand-300 font-medium">
                {archetype.totalXp.toLocaleString()} XP
              </span>
            </div>
            {archetype.averageLevel > 0 && (
              <div className="text-sand-700 dark:text-sand-300 font-medium">
                Avg Level: {archetype.averageLevel}
              </div>
            )}
          </div>
        </div>

        {/* Rank Display */}
        <div className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          #{index + 1}
        </div>
      </div>
    </motion.div>
  );
};

export const ArchetypeLeaderboards: FC<ArchetypeLeaderboardsProps> = ({ timeRange }) => {
  const [loading, setLoading] = useState(true);
  const [archetypeStats, setArchetypeStats] = useState(CORE_GUILDS.map(guild => ({
    ...guild,
    memberCount: 0,
    totalXp: 0,
    averageLevel: 0
  })));
  const [selectedArchetype, setSelectedArchetype] = useState<typeof CORE_GUILDS[0] | null>(null);
  const [archetypeMembers, setArchetypeMembers] = useState<Player[]>([]);

  useEffect(() => {
    const loadStats = () => {
      try {
        // Get all players
        const allPlayers = Array.from(playerService.getLeaderboard());

        // Calculate stats for each archetype
        const stats = CORE_GUILDS.map(guild => {
          // Get players with this archetype
          const archetypePlayers = allPlayers.filter(player => {
            const playerData = playerService.getPlayer(player.wallet);
            return playerData?.archetype === guild.archetype;
          });

          const totalXp = archetypePlayers.reduce((sum, player) => sum + player.experience, 0);
          const averageLevel = archetypePlayers.length > 0
            ? Math.floor(
                archetypePlayers.reduce((sum, player) => {
                  const { level } = calculateLevel(player.experience);
                  return sum + level;
                }, 0) / archetypePlayers.length
              )
            : 0;

          return {
            ...guild,
            memberCount: archetypePlayers.length,
            totalXp,
            averageLevel
          };
        }).sort((a, b) => b.totalXp - a.totalXp);

        setArchetypeStats(stats);
      } catch (error) {
        console.error('Failed to load archetype stats:', error);
      } finally {
        setLoading(false);
      }
    };

    loadStats();
    const interval = setInterval(loadStats, 30000); // Refresh every 30 seconds

    return () => clearInterval(interval);
  }, [timeRange]);

  const handleShowMembers = (archetype: typeof CORE_GUILDS[0]) => {
    setSelectedArchetype(archetype);
    // Get members for the selected archetype
    const allPlayers = Array.from(playerService.getLeaderboard());
    const members = allPlayers
      .filter(player => {
        const playerData = playerService.getPlayer(player.wallet);
        return playerData?.archetype === archetype.archetype;
      })
      .sort((a, b) => b.experience - a.experience);
    setArchetypeMembers(members);
  };

  if (loading) {
    return (
      <div className="flex justify-center py-8">
        <motion.div 
          animate={{ rotate: 360 }}
          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
          className="w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full"
        />
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {archetypeStats.map((archetype, index) => (
        <ArchetypeCard
          key={archetype.id}
          archetype={archetype}
          index={index}
          onShowMembers={() => handleShowMembers(archetype)}
        />
      ))}

      {archetypeStats.length === 0 && (
        <div className="text-center py-8 text-sand-600 dark:text-sand-400">
          No archetype data available
        </div>
      )}

      <ArchetypeMembersModal
        isOpen={selectedArchetype !== null}
        onClose={() => setSelectedArchetype(null)}
        archetype={selectedArchetype || CORE_GUILDS[0]}
        members={archetypeMembers}
      />
    </div>
  );
};

================
File: src/components/RaidLeaderboards/GuildLeaderboards.tsx
================
import { FC, useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import { Skeleton } from '../ui/skeleton';
import { Shield, Trophy, Users, Star } from 'lucide-react';
import { guildService } from '../../services/guildService';
import { Guild } from '../../types/guild';
import { CORE_GUILDS } from '../../types/guild';
import { playerService } from '../../services/playerService';

interface GuildLeaderboardsProps {
  timeRange: 'allTime' | 'daily' | 'weekly' | 'monthly';
}

interface GuildWithStats extends Guild {
  periodXp: number;
  memberCount: number;
}

export const GuildLeaderboards: FC<GuildLeaderboardsProps> = ({ timeRange }) => {
  const [guilds, setGuilds] = useState<GuildWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchLeaderboardData();
  }, [timeRange]);

  const fetchLeaderboardData = async () => {
    setLoading(true);
    setError(null);

    try {
      // Get all guilds including core guilds and community guilds
      const communityGuilds = guildService.getCommunityGuilds();
      const allGuilds = [...communityGuilds, ...CORE_GUILDS];

      // Calculate additional stats for each guild
      const guildsWithStats = await Promise.all(allGuilds.map(async guild => {
        const members = guild.members || [];
        let periodXp = guild.totalXp || 0;

        // Calculate XP based on time range
        if (timeRange !== 'allTime') {
          const now = new Date();
          let startDate = new Date(now);
          
          switch (timeRange) {
            case 'daily':
              startDate.setDate(startDate.getDate() - 1);
              break;
            case 'weekly':
              startDate.setDate(startDate.getDate() - 7);
              break;
            case 'monthly':
              startDate.setMonth(startDate.getMonth() - 1);
              break;
          }

          // Sum up XP gained by members in the time period
          const memberXPs = await Promise.all(members.map(async memberId => {
            const player = await playerService.getPlayer(memberId);
            return player?.experience || 0;
          }));
          
          periodXp = memberXPs.reduce((sum, xp) => sum + xp, 0);
        }

        return {
          ...guild,
          periodXp,
          memberCount: members.length
        };
      }));

      // Sort guilds by XP
      const sortedGuilds = guildsWithStats.sort((a, b) => b.periodXp - a.periodXp);
      setGuilds(sortedGuilds);
    } catch (err) {
      console.error('Error fetching guild leaderboard data:', err);
      setError('Failed to load guild leaderboard data');
    } finally {
      setLoading(false);
    }
  };

  if (error) {
    return (
      <div className="text-center py-8 text-red-500">
        {error}
      </div>
    );
  }

  if (loading) {
    return (
      <div className="space-y-4">
        {[...Array(5)].map((_, i) => (
          <Skeleton key={i} className="h-16 w-full" />
        ))}
      </div>
    );
  }

  if (guilds.length === 0) {
    return (
      <div className="text-center py-8 text-sand-600 dark:text-sand-400">
        No guilds found for the selected time range
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {guilds.map((guild, index) => (
        <motion.div
          key={guild.id}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.3, delay: index * 0.1 }}
          className="bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4 flex items-center gap-4 border border-sand-300/20 dark:border-sand-200/10"
        >
          <div className="flex-shrink-0 w-12 h-12 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold">
            {index < 3 ? (
              <Trophy className={`w-6 h-6 ${
                index === 0 ? 'text-yellow-300' :
                index === 1 ? 'text-gray-300' :
                'text-amber-600'
              }`} />
            ) : (
              `#${index + 1}`
            )}
          </div>
          
          <div className="flex-grow">
            <h3 className="font-semibold text-lg text-sand-900 dark:text-white">
              {guild.name}
            </h3>
            <p className="text-sm text-sand-600 dark:text-sand-400">
              {guild.description}
            </p>
          </div>
          
          <div className="flex flex-col items-end gap-1">
            <div className="flex items-center gap-2">
              <Star className="w-4 h-4 text-primary-500" />
              <span className="font-semibold text-primary-500">
                {guild.periodXp.toLocaleString()} XP
              </span>
            </div>
            <div className="flex items-center gap-2 text-sm text-sand-600 dark:text-sand-400">
              <Users className="w-4 h-4" />
              <span>{guild.memberCount} Members</span>
            </div>
          </div>
        </motion.div>
      ))}
    </div>
  );
};

================
File: src/components/RaidLeaderboards/GuildMemberModal.tsx
================
import { FC } from 'react';
import { X, Star } from 'lucide-react';
import { Guild } from '../../types/guild';
import { guildService } from '../../services/guildService';
import { ProfilePicture } from '../ProfilePicture';

interface GuildMemberModalProps {
  guild: Guild;
  onClose: () => void;
}

export const GuildMemberModal: FC<GuildMemberModalProps> = ({ guild, onClose }) => {
  const members = guildService.getGuildMembers(guild.id);

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-neutral-charcoal/90 backdrop-blur-md"
        onClick={onClose}
      />
      <div className="relative w-full max-w-2xl bg-[#1A1B23] rounded-xl border border-primary-neonGreen/20 shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b border-primary-neonGreen/20">
          <div className="flex items-center gap-4">
            <img
              src={guild.imageUrl}
              alt={guild.name}
              className="w-12 h-12 rounded-lg"
            />
            <div>
              <h3 className="text-xl font-bold text-white">{guild.name}</h3>
              <p className="text-sm text-neutral-lightGray">
                {members.length} Members
              </p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        <div className="p-6 max-h-[60vh] overflow-y-auto custom-scrollbar">
          <div className="space-y-4">
            {members.map((member, index) => (
              <div
                key={member.wallet}
                className="flex items-center gap-4 p-4 bg-black/40 rounded-lg border border-primary-neonGreen/20"
              >
                <div className="w-8 h-8 flex items-center justify-center text-primary-neonGreen font-mono">
                  #{index + 1}
                </div>
                <ProfilePicture wallet={member.wallet} size="sm" />
                <div className="flex-1 min-w-0">
                  <p className="text-white font-medium truncate">
                    {member.username || `${member.wallet.slice(0, 4)}...${member.wallet.slice(-4)}`}
                  </p>
                  <div className="flex items-center gap-2 text-sm">
                    <Star className="w-3 h-3 text-primary-neonGreen" />
                    <span className="text-primary-neonGreen">
                      {member.experience.toLocaleString()} XP
                    </span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: src/components/RaidLeaderboards/GuildMembersModal.tsx
================
import { FC, useEffect, useState } from 'react';
import { X, User, Star } from 'lucide-react';
import { guildService } from '../../services/guildService';
import { GuildMember } from '../../types/guild';
import { LevelDisplay } from '../LevelDisplay';

interface GuildMembersModalProps {
  guildId: string;
  onClose: () => void;
}

export const GuildMembersModal: FC<GuildMembersModalProps> = ({ guildId, onClose }) => {
  const [members, setMembers] = useState<GuildMember[]>([]);
  const [loading, setLoading] = useState(true);
  const guild = guildService.getGuildById(guildId);

  useEffect(() => {
    const loadMembers = async () => {
      try {
        const guildMembers = await guildService.getGuildMembers(guildId);
        setMembers(guildMembers);
      } catch (error) {
        console.error('Failed to load guild members:', error);
      } finally {
        setLoading(false);
      }
    };

    loadMembers();
  }, [guildId]);

  if (!guild) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={onClose}
      />
      <div className="relative w-full max-w-3xl bg-[#1A1B23] rounded-xl border border-primary-main/20 shadow-2xl max-h-[90vh] flex flex-col">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-primary-main/20">
          <div className="flex items-center gap-4">
            <div className="w-12 h-12 rounded-lg overflow-hidden border border-primary-main/20">
              {guild.imageUrl ? (
                <img
                  src={guild.imageUrl}
                  alt={guild.name}
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full bg-primary-main/10 flex items-center justify-center">
                  <User className="w-6 h-6 text-primary-main" />
                </div>
              )}
            </div>
            <div>
              <h3 className="text-xl font-bold text-white">{guild.name}</h3>
              <p className="text-sm text-neutral-lightGray">{members.length} Members</p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Member List */}
        <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">
          {loading ? (
            <div className="flex justify-center py-8">
              <div className="animate-spin rounded-full h-8 w-8 border-2 border-primary-main"></div>
            </div>
          ) : (
            <div className="space-y-4">
              {members.map((member) => (
                <div
                  key={member.wallet}
                  className="flex items-center gap-4 p-4 bg-black/40 rounded-lg border border-primary-main/20"
                >
                  <div className="w-10 h-10 rounded-full overflow-hidden border border-primary-main/20">
                    {member.profilePicture ? (
                      <img
                        src={member.profilePicture}
                        alt={member.username || 'Member'}
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <div className="w-full h-full bg-primary-main/10 flex items-center justify-center">
                        <User className="w-5 h-5 text-primary-main" />
                      </div>
                    )}
                  </div>

                  <div className="flex-grow min-w-0">
                    <h4 className="text-white font-medium truncate">
                      {member.username || `${member.wallet.slice(0, 4)}...${member.wallet.slice(-4)}`}
                    </h4>
                  </div>

                  <div className="flex items-center gap-4">
                    <LevelDisplay xp={member.experience} size="sm" />
                    <div className="flex items-center gap-2">
                      <Star className="w-4 h-4 text-primary-main" />
                      <span className="text-white">{member.experience.toLocaleString()} XP</span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

================
File: src/components/RaidLeaderboards/index.tsx
================
export { RaidLeaderboards } from './RaidLeaderboards';

================
File: src/components/RaidLeaderboards/PlayerLeaderboards.tsx
================
import { FC, useEffect, useState } from 'react';
import { supabase } from '../../lib/supabase';
import { motion } from 'framer-motion';
import { Skeleton } from '../ui/skeleton';
import { Player } from '../../types/player';

interface PlayerLeaderboardsProps {
  timeRange: 'allTime' | 'daily' | 'weekly' | 'monthly';
}

export const PlayerLeaderboards: FC<PlayerLeaderboardsProps> = ({ timeRange }) => {
  const [players, setPlayers] = useState<Player[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchLeaderboardData();
  }, [timeRange]);

  const fetchLeaderboardData = async () => {
    setLoading(true);
    setError(null);

    try {
      let query = supabase
        .from('players')
        .select('*');

      // Add time range filters
      const now = new Date();
      if (timeRange !== 'allTime') {
        let startDate = new Date(now);
        
        switch (timeRange) {
          case 'daily':
            startDate.setDate(startDate.getDate() - 1);
            break;
          case 'weekly':
            startDate.setDate(startDate.getDate() - 7);
            break;
          case 'monthly':
            startDate.setMonth(startDate.getMonth() - 1);
            break;
        }

        // Filter by updated_at since that's when the player's data was last modified
        query = query.gte('updated_at', startDate.toISOString());
      }

      // Add sorting and pagination
      const { data, error: fetchError } = await query
        .order('experience', { ascending: false })
        .limit(50);

      if (fetchError) {
        throw fetchError;
      }

      setPlayers(data as Player[] || []);
    } catch (err) {
      console.error('Error fetching leaderboard data:', err);
      setError('Failed to load leaderboard data');
    } finally {
      setLoading(false);
    }
  };

  if (error) {
    return (
      <div className="text-center py-8 text-red-500">
        {error}
      </div>
    );
  }

  if (loading) {
    return (
      <div className="space-y-4">
        {[...Array(5)].map((_, i) => (
          <Skeleton key={i} className="h-16 w-full" />
        ))}
      </div>
    );
  }

  if (players.length === 0) {
    return (
      <div className="text-center py-8 text-sand-600 dark:text-sand-400">
        No players found for the selected time range
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {players.map((player, index) => (
        <motion.div
          key={player.wallet}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.3, delay: index * 0.1 }}
          className="bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4 flex items-center gap-4 border border-sand-300/20 dark:border-sand-200/10"
        >
          <div className="flex-shrink-0 w-12 h-12 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold">
            #{index + 1}
          </div>
          
          <div className="flex-grow">
            <h3 className="font-semibold text-lg text-sand-900 dark:text-white">
              {player.username || player.handle || player.wallet.slice(0, 8)}
            </h3>
            <p className="text-sm text-sand-600 dark:text-sand-400">
              {player.archetype || 'Unknown Archetype'} • Level {Math.floor(player.experience / 1000)}
            </p>
          </div>
          
          <div className="text-right">
            <p className="font-semibold text-primary-500">
              {player.experience.toLocaleString()} XP
            </p>
            <p className="text-sm text-sand-600 dark:text-sand-400">
              {player.questsCompleted || 0} Quests
            </p>
          </div>
        </motion.div>
      ))}
    </div>
  );
};

================
File: src/components/RaidLeaderboards/ProfileModal.tsx
================
import { FC } from 'react';
import { Star, TrendingUp, Trophy, Sword, X } from 'lucide-react';
import { Player } from '../../types/player';
import { motion, AnimatePresence } from 'framer-motion';

interface ProfileModalProps {
  player: Player;
  onClose: () => void;
}

const StatCard: FC<{
  icon: React.ReactNode;
  label: string;
  value: string | number;
}> = ({ icon, label, value }) => (
  <div className="bg-white/80 dark:bg-black/40 backdrop-blur-sm rounded-2xl p-6 border border-sand-300/20 dark:border-sand-200/10">
    <div className="flex items-center gap-2 mb-2">
      <div className="p-2 rounded-xl bg-primary-500/10">
        {icon}
      </div>
      <h4 className="text-sand-900 dark:text-white font-medium">{label}</h4>
    </div>
    <p className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
      {typeof value === 'number' ? value.toLocaleString() : value}
    </p>
  </div>
);

export const ProfileModal: FC<ProfileModalProps> = ({ player, onClose }) => {
  return (
    <AnimatePresence>
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
        {/* Backdrop */}
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="absolute inset-0 bg-black/60"
          onClick={onClose}
        />

        {/* Modal */}
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          exit={{ opacity: 0, scale: 0.9 }}
          className="relative bg-white/90 dark:bg-black/90 backdrop-blur-md rounded-3xl p-8 max-w-2xl w-full border border-sand-300/20 dark:border-sand-200/10 shadow-xl"
        >
          {/* Close Button */}
          <button
            onClick={onClose}
            className="absolute top-4 right-4 p-2 text-sand-600 hover:text-primary-500 transition-colors rounded-lg hover:bg-primary-500/10"
          >
            <X className="w-5 h-5" />
          </button>

          {/* Header */}
          <div className="flex items-center gap-4 mb-8">
            <div className="w-16 h-16 rounded-xl overflow-hidden border border-sand-300/20 dark:border-sand-200/10">
              {player.profilePicture ? (
                <img
                  src={player.profilePicture}
                  alt="Profile"
                  className="w-full h-full object-cover"
                />
              ) : (
                <img
                  src="/assets/defaultpfp.png"
                  alt="Default Profile"
                  className="w-full h-full object-cover"
                />
              )}
            </div>
            <div className="min-w-0">
              <h3 className="text-2xl font-bold text-sand-900 dark:text-white mb-1">
                {player.showWallet 
                  ? `${player.wallet.slice(0, 4)}...${player.wallet.slice(-4)}`
                  : player.username || player.handle || `${player.wallet.slice(0, 4)}...${player.wallet.slice(-4)}`}
              </h3>
              <p className="text-sand-600 dark:text-sand-400">
                Joined {new Date(player.dateJoined).toLocaleDateString()}
              </p>
            </div>
          </div>

          {/* Stats Grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <StatCard
              icon={<TrendingUp className="w-5 h-5 text-primary-500" />}
              label="Global Rank"
              value={`#${player.rank || 'N/A'}`}
            />
            <StatCard
              icon={<Star className="w-5 h-5 text-primary-500" />}
              label="Experience"
              value={player.experience}
            />
            <StatCard
              icon={<Trophy className="w-5 h-5 text-primary-500" />}
              label="Quests Completed"
              value={player.questsCompleted}
            />
            <StatCard
              icon={<Sword className="w-5 h-5 text-primary-500" />}
              label="Raid Bosses"
              value={player.raidBossesDefeated}
            />
          </div>
        </motion.div>
      </div>
    </AnimatePresence>
  );
};

================
File: src/components/RaidLeaderboards/RaidLeaderboards.tsx
================
import { useState } from 'react';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '../ui/tabs';
import { PlayerLeaderboards } from './PlayerLeaderboards';
import { GuildLeaderboards } from './GuildLeaderboards';
import { SectionWrapper } from '../SectionWrapper';

const variantStyles = {
  default: `bg-sand-100/95 dark:bg-black/40 
    border border-sand-300/50 dark:border-white/5 
    shadow-lg shadow-sand-400/20 dark:shadow-primary-500/20 
    hover:border-primary-500/20 dark:hover:border-primary-500/20
    hover:shadow-primary-500/10 dark:hover:shadow-primary-500/30`,
  gradient: `bg-gradient-to-br from-primary-500/20 via-sand-200/20 to-transparent 
    border border-primary-500/30 dark:border-primary-500/20
    shadow-xl shadow-primary-500/30 
    hover:shadow-primary-500/40 hover:border-primary-500/40`,
  dark: `bg-background-900/95 dark:bg-black/60
    border border-background-800/50 dark:border-white/10
    shadow-2xl shadow-black/40
    hover:border-primary-500/30 hover:shadow-primary-500/30`,
  highlight: `bg-gradient-to-br from-primary-500/30 via-sand-200/30 to-transparent
    border border-primary-500/40 dark:border-primary-500/30
    shadow-2xl shadow-primary-500/30
    hover:shadow-primary-500/50 hover:border-primary-500/50
    dark:from-primary-950 dark:via-background-900 dark:to-background-950`
};

interface RaidLeaderboardsProps {
  variant?: 'default' | 'alternate';
}

export const RaidLeaderboards = ({ variant = 'default' }: RaidLeaderboardsProps) => {
  const [timeRange, setTimeRange] = useState<'allTime' | 'daily' | 'weekly' | 'monthly'>('allTime');
  const [activeTab, setActiveTab] = useState<'players' | 'guilds'>('players');

  return (
    <SectionWrapper variant={variant} className="bg-gradient-to-br from-primary-500/30 rounded-xl p-8 via-sand-200/30 to-transparent
      border border-primary-500/40 dark:border-primary-500/30
      shadow-2xl shadow-primary-500/30
      hover:shadow-primary-500/50 hover:border-primary-500/50
      dark:from-primary-950 dark:via-background-900 dark:to-background-950">
    
      <div className="text-center mb-8">
        <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-400">
          Leaderboards
        </h1>
        <p className="text-lg text-sand-600 dark:text-sand-400 max-w-2xl mx-auto mt-2">
          Track your progress and compete with other players and guilds in Pan Da Pan.
        </p>
      </div>

      {/* Time Range Selector */}
      <Tabs value={timeRange} className="w-full max-w-4xl mx-auto mb-8" onValueChange={(value) => setTimeRange(value as typeof timeRange)}>
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="allTime">All Time</TabsTrigger>
          <TabsTrigger value="daily">Daily</TabsTrigger>
          <TabsTrigger value="weekly">Weekly</TabsTrigger>
          <TabsTrigger value="monthly">Monthly</TabsTrigger>
        </TabsList>
      </Tabs>
          
      {/* Players/Guilds Tabs */}
      <Tabs value={activeTab} className="w-full max-w-4xl mx-auto" onValueChange={(value) => setActiveTab(value as typeof activeTab)}>
        <TabsList className="grid w-full grid-cols-2 mb-8">
          <TabsTrigger value="players">Players</TabsTrigger>
          <TabsTrigger value="guilds">Guilds</TabsTrigger>
        </TabsList>

        <TabsContent value="players" className="focus-visible:outline-none">
          <PlayerLeaderboards timeRange={timeRange} />
        </TabsContent>

        <TabsContent value="guilds" className="focus-visible:outline-none">
          <GuildLeaderboards timeRange={timeRange} />
        </TabsContent>
      </Tabs>
      
    </SectionWrapper>
  );
};

================
File: src/components/RaidLeaderboards/TimeRangeStats.tsx
================
import { FC } from 'react';
import { Trophy, Star, Users } from 'lucide-react';
import { playerService } from '../../services/playerService';
import { motion } from 'framer-motion';

interface TimeRangeStatsProps {
  timeRange: 'daily' | 'weekly' | 'monthly' | 'allTime';
  onTimeRangeChange: (range: 'daily' | 'weekly' | 'monthly' | 'allTime') => void;
}

const StatCard: FC<{
  icon: React.ReactNode;
  label: string;
  value: string;
}> = ({ icon, label, value }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    whileHover={{ scale: 1.02 }}
    className="relative bg-white/40 dark:bg-black/20 backdrop-blur-sm rounded-xl p-4 border border-sand-300/20 dark:border-sand-200/10 hover:border-primary-500/30 transition-colors duration-300"
  >
    <div className="flex items-center gap-4">
      <div className="w-12 h-12 rounded-lg bg-primary-500/10 flex items-center justify-center">
        {icon}
      </div>
      <div>
        <p className="text-sm font-medium text-sand-600 dark:text-sand-400">{label}</p>
        <p className="text-lg font-bold text-sand-900 dark:text-white">{value}</p>
      </div>
    </div>
  </motion.div>
);

const TimeRangeButton: FC<{
  range: 'daily' | 'weekly' | 'monthly' | 'allTime';
  label: string;
  active: boolean;
  onClick: () => void;
}> = ({ range, label, active, onClick }) => (
  <motion.button
    whileHover={{ scale: 1.02 }}
    whileTap={{ scale: 0.98 }}
    onClick={onClick}
    className={`
      relative px-4 py-2 rounded-lg font-medium transition-all duration-200
      ${active
        ? 'text-white shadow-lg'
        : 'text-sand-700 dark:text-sand-300 hover:text-primary-500 dark:hover:text-primary-400'
      }
    `}
  >
    {label}
    {active && (
      <motion.div
        layoutId="activeTimeRange"
        className="absolute inset-0 -z-10 rounded-lg bg-gradient-to-r from-primary-500 to-primary-400"
      />
    )}
  </motion.button>
);

export const TimeRangeStats: FC<TimeRangeStatsProps> = ({ timeRange, onTimeRangeChange }) => {
  const stats = playerService.getTimeRangeStats(timeRange);

  return (
    <div className="space-y-6">
      {/* Time Range Selection */}
      <div className="flex justify-center gap-2 p-1 bg-white/20 dark:bg-black/20 backdrop-blur-sm rounded-xl border border-sand-300/20 dark:border-sand-200/10">
        <TimeRangeButton
          range="daily"
          label="Daily"
          active={timeRange === 'daily'}
          onClick={() => onTimeRangeChange('daily')}
        />
        <TimeRangeButton
          range="weekly"
          label="Weekly"
          active={timeRange === 'weekly'}
          onClick={() => onTimeRangeChange('weekly')}
        />
        <TimeRangeButton
          range="monthly"
          label="Monthly"
          active={timeRange === 'monthly'}
          onClick={() => onTimeRangeChange('monthly')}
        />
        <TimeRangeButton
          range="allTime"
          label="All Time"
          active={timeRange === 'allTime'}
          onClick={() => onTimeRangeChange('allTime')}
        />
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <StatCard
          icon={<Trophy className="w-6 h-6 text-primary-500" />}
          label="Top Raider"
          value={stats.topRaider?.username || 
            `${stats.topRaider?.wallet.slice(0, 4)}...${stats.topRaider?.wallet.slice(-4)}`}
        />
        <StatCard
          icon={<Star className="w-6 h-6 text-primary-500" />}
          label="Total XP"
          value={stats.totalXP.toLocaleString()}
        />
        <StatCard
          icon={<Users className="w-6 h-6 text-primary-500" />}
          label="Active Raiders"
          value={stats.activeRaiders.toString()}
        />
      </div>
    </div>
  );
};

================
File: src/components/RaidProfile/GuildQuestions.tsx
================
import { FC, useState } from 'react';
import { X, ArrowLeft, Share2 } from 'lucide-react';
import { guildQuestions } from '../../data/guildQuestions';
import { Guild, GuildArchetype } from '../../types/guild';
import { guildService } from '../../services/guildService';
import { useWallet } from '@solana/wallet-adapter-react';
import { playerService } from '../../services/playerService';
import { GlassPanel } from '../GlassPanel';

interface GuildQuestionsProps {
  onComplete: (guild: Guild) => void;
  onClose: () => void;
}

export const GuildQuestions: FC<GuildQuestionsProps> = ({ onComplete, onClose }) => {
  const { publicKey } = useWallet();
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState<{ questionId: string; archetype: GuildArchetype; }[]>([]);
  const [showCongrats, setShowCongrats] = useState(false);
  const [assignedArchetype, setAssignedArchetype] = useState<GuildArchetype | null>(null);

  // Get 5 random questions
  const [questions] = useState(() => {
    const shuffled = [...guildQuestions].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 5);
  });

  const currentQuestion = questions[currentQuestionIndex];

  const handleAnswer = (archetype: GuildArchetype) => {
    if (!publicKey) return;

    const newAnswers = [...answers, { questionId: currentQuestion.id, archetype }];
    setAnswers(newAnswers);

    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(prev => prev + 1);
    } else {
      // Randomly select an archetype from the answers
      const randomIndex = Math.floor(Math.random() * newAnswers.length);
      const selectedArchetype = newAnswers[randomIndex].archetype;
      setAssignedArchetype(selectedArchetype);

      // Update player's archetype
      playerService.setArchetype(publicKey.toString(), selectedArchetype);

      // Get the corresponding guild
      const guild = guildService.getGuildByArchetype(selectedArchetype);
      if (guild) {
        setShowCongrats(true);
        onComplete(guild);
      }
    }
  };

  const handlePreviousQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(prev => prev - 1);
      setAnswers(prev => prev.slice(0, -1));
    }
  };

  const handleShareToTwitter = () => {
    if (!assignedArchetype) return;
    
    const text = `I just joined the ${assignedArchetype} archetype on @PanDaPan! 🐼✨`;
    const url = 'https://pandapan.xyz';
    
    window.open(
      `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`,
      '_blank'
    );
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-background-dark/90 backdrop-blur-md"
        onClick={onClose}
      />
      <GlassPanel className="relative w-full max-w-lg">
        {/* Header */}
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-xl font-bold text-white">Choose Your Panda Pack</h3>
          <button
            onClick={onClose}
            className="p-2 text-text-dark-secondary hover:text-white transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Content */}
        {showCongrats && assignedArchetype ? (
          <div className="text-center space-y-6">
            <div className="w-24 h-24 mx-auto rounded-full overflow-hidden border-4 border-primary-main mb-4">
              <img
                src={`/assets/archetypes/${assignedArchetype.toLowerCase()}.png`}
                alt={assignedArchetype}
                className="w-full h-full object-cover"
              />
            </div>
            
            <div>
              <h4 className="text-2xl font-bold text-white mb-2">
                Welcome to the {assignedArchetype} Archetype!
              </h4>
              <p className="text-text-dark-secondary">
                Your journey as a {assignedArchetype} begins now. Share your new path with others!
              </p>
            </div>

            <div className="flex flex-col sm:flex-row justify-center gap-4">
              <button
                onClick={handleShareToTwitter}
                className="flex items-center justify-center gap-2 px-6 py-3 bg-[#1DA1F2] text-white rounded-lg hover:bg-[#1A8CD8] transition-colors"
              >
                <Share2 className="w-4 h-4" />
                Share on Twitter
              </button>
              <button
                onClick={onClose}
                className="px-6 py-3 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
              >
                Continue
              </button>
            </div>
          </div>
        ) : (
          <div className="space-y-6">
            {/* Progress Bar */}
            <div className="text-center mb-8">
              <p className="text-sm text-text-dark-secondary">
                Question {currentQuestionIndex + 1} of {questions.length}
              </p>
              <div className="w-full bg-primary-main/20 h-1 rounded-full mt-2">
                <div 
                  className="h-full bg-primary-main rounded-full transition-all duration-300"
                  style={{ width: `${((currentQuestionIndex + 1) / questions.length) * 100}%` }}
                />
              </div>
            </div>

            <p className="text-lg text-white text-center px-4">
              {currentQuestion.question}
            </p>

            <div className="grid grid-cols-1 gap-3">
              {currentQuestion.choices.map((choice, index) => (
                <button
                  key={index}
                  onClick={() => handleAnswer(choice.archetype)}
                  className="w-full px-6 py-4 bg-black/20 border border-primary-main/20 rounded-lg text-white hover:bg-primary-main/10 hover:border-primary-main/40 transition-all text-left active:scale-[0.98]"
                >
                  {choice.text}
                </button>
              ))}
            </div>

            {currentQuestionIndex > 0 && (
              <button
                onClick={handlePreviousQuestion}
                className="flex items-center gap-2 text-text-dark-secondary hover:text-white transition-colors mt-4"
              >
                <ArrowLeft className="w-4 h-4" />
                Previous Question
              </button>
            )}
          </div>
        )}
      </GlassPanel>
    </div>
  );
};

================
File: src/components/RaidProfile/GuildSelector.tsx
================
import { FC } from 'react';
import { useNavigate } from 'react-router-dom';
import { playerService } from '../../services/playerService';
import { CORE_GUILDS } from '../../types/guild';

interface GuildSelectorProps {
  wallet: string;
}

export const GuildSelector: FC<GuildSelectorProps> = ({ wallet }) => {
  const navigate = useNavigate();
  const player = playerService.getPlayer(wallet);
  const hasArchetype = player?.archetype !== null;

  return (
    <div className="gradient-box p-6">
      {hasArchetype ? (
        <div className="text-center">
          <h3 className="text-xl font-bold text-white mb-4">
            Your Archetype: {player?.archetype}
          </h3>
          <div className="w-24 h-24 mx-auto rounded-full overflow-hidden border-4 border-primary-main mb-6">
            <img
              src={CORE_GUILDS.find(g => g.archetype === player?.archetype)?.imageUrl}
              alt={player?.archetype}
              className="w-full h-full object-cover"
            />
          </div>
          <p className="text-neutral-lightGray">
            {CORE_GUILDS.find(g => g.archetype === player?.archetype)?.description}
          </p>
        </div>
      ) : (
        <div className="text-center">
          <p className="text-text-light-secondary dark:text-neutral-lightGray mb-4">
            Choose your archetype to begin your journey
          </p>
          <button
            onClick={() => navigate('/profile/pack')}
            className="inline-flex items-center gap-2 px-8 py-4 bg-primary-main text-white rounded-xl text-lg font-semibold transition-all transform hover:scale-105 hover:bg-primary-main/90 shadow-glow"
          >
            Choose Your Panda Pack
          </button>
        </div>
      )}
    </div>
  );
};

================
File: src/components/RaidProfile/index.tsx
================
import { FC, useState } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { ConnectPrompt } from '../ConnectPrompt';
import { ProfilePage } from './ProfilePage';
import { Dashboard } from '../Dashboard';
import { Gallery } from '../Gallery';

type TabType = 'profile' | 'nfts' | 'gallery';

export const RaidProfile: FC = () => {
  const { connected } = useWallet();
  const [activeTab, setActiveTab] = useState<TabType>('profile');

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="max-w-6xl mx-auto space-y-8 px-4">
      {/* Header */}
      <div className="text-center">
        <h1 className="text-4xl font-title text-text-light-primary dark:text-white mb-2 flex items-center justify-center gap-3">
          <img 
            src="/assets/pandas/nestledpanda.PNG" 
            alt="Raid Panda"
            className="w-12 h-12 object-contain"
          />
          Raid Profile
          <img 
            src="/assets/pandas/nestledpanda.PNG" 
            alt="Raid Panda"
            className="w-12 h-12 object-contain"
          />
        </h1>
        <p className="text-text-light-secondary dark:text-text-dark-secondary">
          Manage your profile, NFTs, and gallery
        </p>
      </div>

      {/* Tab Selection */}
      <div className="flex justify-center gap-4">
        <button
          onClick={() => setActiveTab('profile')}
          className={`px-6 py-3 rounded-xl font-semibold transition-all ${
            activeTab === 'profile'
              ? 'bg-primary-main text-white shadow-glow'
              : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
          }`}
        >
          Profile
        </button>

        <button
          onClick={() => setActiveTab('nfts')}
          className={`px-6 py-3 rounded-xl font-semibold transition-all ${
            activeTab === 'nfts'
              ? 'bg-primary-main text-white shadow-glow'
              : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
          }`}
        >
          My NFTs
        </button>

        <button
          onClick={() => setActiveTab('gallery')}
          className={`px-6 py-3 rounded-xl font-semibold transition-all ${
            activeTab === 'gallery'
              ? 'bg-primary-main text-white shadow-glow'
              : 'bg-primary-main/20 text-text-light-primary dark:text-white hover:bg-primary-main/30'
          }`}
        >
          Gallery
        </button>
      </div>

      {/* Content */}
      <div className="gradient-box p-6">
        {activeTab === 'profile' && <ProfilePage />}
        {activeTab === 'nfts' && <Dashboard />}
        {activeTab === 'gallery' && <Gallery />}
      </div>
    </div>
  );
};

================
File: src/components/RaidProfile/PandaPack.tsx
================
import { FC, useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useWallet } from '@solana/wallet-adapter-react';
import { Share2, ArrowLeft } from 'lucide-react';
import { guildQuestions } from '../../data/guildQuestions';
import { Guild, GuildArchetype, CORE_GUILDS } from '../../types/guild';
import { guildService } from '../../services/guildService';
import { playerService } from '../../services/playerService';

export const PandaPack: FC = () => {
  const navigate = useNavigate();
  const { publicKey } = useWallet();
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState<{ questionId: string; archetype: GuildArchetype; }[]>([]);
  const [showCongrats, setShowCongrats] = useState(false);
  const [assignedArchetype, setAssignedArchetype] = useState<GuildArchetype | null>(null);
  const [error, setError] = useState<string | null>(null);

  // Redirect if user already has an archetype
  useEffect(() => {
    if (publicKey) {
      const player = playerService.getPlayer(publicKey.toString());
      if (player?.archetype) {
        navigate('/profile');
      }
    }
  }, [publicKey, navigate]);

  // Get 5 random questions
  const [questions] = useState(() => {
    const shuffled = [...guildQuestions].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 5);
  });

  const currentQuestion = questions[currentQuestionIndex];

  const handleAnswer = (archetype: GuildArchetype) => {
    if (!publicKey) return;

    const newAnswers = [...answers, { questionId: currentQuestion.id, archetype }];
    setAnswers(newAnswers);

    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(prev => prev + 1);
    } else {
      // Randomly select an archetype from the answers
      const randomIndex = Math.floor(Math.random() * newAnswers.length);
      const selectedArchetype = newAnswers[randomIndex].archetype;

      // Verify it's a valid core archetype
      const isValidArchetype = CORE_GUILDS.some(guild => guild.archetype === selectedArchetype);
      if (!isValidArchetype) {
        setError('Invalid archetype selected. Please try again.');
        return;
      }

      setAssignedArchetype(selectedArchetype);

      // Update player's archetype and guild
      const success = playerService.setArchetype(publicKey.toString(), selectedArchetype);
      if (success) {
        setShowCongrats(true);
      } else {
        setError('Failed to assign archetype. Please try again.');
      }
    }
  };

  const handlePreviousQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(prev => prev - 1);
      setAnswers(prev => prev.slice(0, -1));
    }
  };

  const handleShareToTwitter = () => {
    if (!assignedArchetype) return;
    
    const text = `I just joined the ${assignedArchetype} archetype on @PanDaPan! 🐼✨`;
    const url = 'https://pandapan.xyz';
    
    window.open(
      `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`,
      '_blank'
    );
  };

  if (error) {
    return (
      <div className="text-center py-8">
        <p className="text-red-400 mb-4">{error}</p>
        <button
          onClick={() => window.location.reload()}
          className="px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
        >
          Try Again
        </button>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto">
      <div className="gradient-box p-8">
        {showCongrats && assignedArchetype ? (
          <div className="text-center space-y-6">
            <div className="w-24 h-24 mx-auto rounded-full overflow-hidden border-4 border-primary-main mb-4">
              <img
                src={`/assets/archetypes/${assignedArchetype.toLowerCase()}.png`}
                alt={assignedArchetype}
                className="w-full h-full object-cover"
              />
            </div>
            
            <div>
              <h4 className="text-2xl font-bold text-white mb-2">
                Welcome to the {assignedArchetype} Archetype!
              </h4>
              <p className="text-neutral-lightGray">
                Your journey as a {assignedArchetype} begins now. Share your new path with others!
              </p>
            </div>

            <div className="flex flex-col sm:flex-row justify-center gap-4">
              <button
                onClick={handleShareToTwitter}
                className="flex items-center justify-center gap-2 px-4 py-2 bg-[#1DA1F2] text-white rounded-lg hover:bg-[#1A8CD8] transition-colors"
              >
                <Share2 className="w-4 h-4" />
                Share on Twitter
              </button>
              <button
                onClick={() => navigate('/profile')}
                className="px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
              >
                Continue
              </button>
            </div>
          </div>
        ) : (
          <div className="space-y-6">
            {/* Progress Bar */}
            <div className="text-center mb-8">
              <p className="text-sm text-neutral-lightGray">
                Question {currentQuestionIndex + 1} of {questions.length}
              </p>
              <div className="w-full bg-primary-main/20 h-1 rounded-full mt-2">
                <div 
                  className="h-full bg-primary-main rounded-full transition-all duration-300"
                  style={{ width: `${((currentQuestionIndex + 1) / questions.length) * 100}%` }}
                />
              </div>
            </div>

            <p className="text-lg text-white text-center px-4">
              {currentQuestion.question}
            </p>

            <div className="grid grid-cols-1 gap-3">
              {currentQuestion.choices.map((choice, index) => (
                <button
                  key={index}
                  onClick={() => handleAnswer(choice.archetype)}
                  className="w-full px-6 py-4 bg-black/40 border border-primary-main/20 rounded-lg text-white hover:bg-primary-main/10 hover:border-primary-main/40 transition-all text-left active:scale-[0.98]"
                >
                  {choice.text}
                </button>
              ))}
            </div>

            {currentQuestionIndex > 0 && (
              <button
                onClick={handlePreviousQuestion}
                className="flex items-center gap-2 text-neutral-lightGray hover:text-white transition-colors mt-4"
              >
                <ArrowLeft className="w-4 h-4" />
                Previous Question
              </button>
            )}
          </div>
        )}
      </div>
    </div>
  );
};

================
File: src/components/RaidProfile/ProfilePage.tsx
================
import React, { FC, useState, useEffect } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { playerService } from '../../services/playerService';
import { Player } from '../../types/Player';
import { ProfileUpload } from './ProfileUpload';
import { ContentBox } from '../ContentBox';
import { LevelDisplay } from '../LevelDisplay';

export const ProfilePage: FC = () => {
  const formatWalletAddress = (wallet: string | undefined | null) => {
    if (!wallet) return 'Not Connected';
    if (typeof wallet !== 'string') return 'Invalid Wallet';
    return `${wallet.slice(0, 4)}...${wallet.slice(-4)}`;
  };

  const { publicKey } = useWallet();
  const [player, setPlayer] = useState<Player | null>(null);
  const [loading, setLoading] = useState(true);

  const refreshPlayerData = async () => {
    if (publicKey) {
      try {
        const updatedPlayer = await playerService.getPlayer(publicKey.toString());
        if (updatedPlayer) {
          setPlayer(updatedPlayer);
        }
      } catch (error) {
        console.error('Error refreshing player data:', error);
      }
    }
  };

  useEffect(() => {
    const loadPlayerData = async () => {
      if (publicKey) {
        try {
          const playerData = await playerService.getPlayer(publicKey.toString());
          setPlayer(playerData);
        } catch (error) {
          console.error('Error loading player data:', error);
        }
      }
      setLoading(false);
    };

    loadPlayerData();
  }, [publicKey]);

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-screen">
        <div className="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-orange-500"></div>
      </div>
    );
  }

  if (!player || !publicKey) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen p-8">
        <h2 className="text-3xl font-bold text-gray-800 dark:text-white mb-4">
          Profile Not Found
        </h2>
        <p className="text-gray-600 dark:text-gray-400 text-center">
          Please connect your wallet to view your profile.
        </p>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 space-y-8">
      <ContentBox title="Raid Profile">
        <div className="flex flex-col md:flex-row items-start gap-8">
          {/* Profile Picture Section */}
          <div className="w-full md:w-1/3">
            <div className="relative w-48 h-48 mx-auto rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700">
              <ProfileUpload
                currentImageUrl={player.profile_picture}
                walletAddress={player.wallet}
                onUploadSuccess={refreshPlayerData}
              />
            </div>
          </div>

          {/* Profile Info Section */}
          <div className="flex-1 space-y-6">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
                {player.username || formatWalletAddress(player.wallet)}
              </h1>
              <p className="text-gray-500 dark:text-gray-400">
                {formatWalletAddress(player.wallet)}
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Stats */}
              <div className="space-y-4">
                <h2 className="text-xl font-semibold text-gray-800 dark:text-white">
                  Stats
                </h2>
                <div className="space-y-2">
                  <LevelDisplay experience={player.experience} />
                  <p>Quests Completed: {player.questsCompleted}</p>
                  <p>Raid Bosses Defeated: {player.raidBossesDefeated}</p>
                  <p>Total Raids: {player.totalRaidsParticipated}</p>
                </div>
              </div>

              {/* Details */}
              <div className="space-y-4">
                <h2 className="text-xl font-semibold text-gray-800 dark:text-white">
                  Details
                </h2>
                <div className="space-y-2">
                  <p>Archetype: {player.archetype}</p>
                  <p>Member Since: {new Date(player.dateJoined).toLocaleDateString()}</p>
                  <p>Last Active: {new Date(player.lastLogin).toLocaleDateString()}</p>
                  {player.discordHandle && (
                    <p>Discord: {player.discordHandle}</p>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      </ContentBox>

      {/* Achievements Section */}
      <ContentBox title="Achievements">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {player.achievements && player.achievements.length > 0 ? (
            player.achievements.map((achievement, index) => (
              <div
                key={index}
                className="p-4 bg-white dark:bg-gray-800 rounded-lg shadow"
              >
                <h3 className="font-semibold">{achievement}</h3>
              </div>
            ))
          ) : (
            <p className="col-span-3 text-center text-gray-500">
              No achievements yet. Complete quests and raids to earn achievements!
            </p>
          )}
        </div>
      </ContentBox>
    </div>
  );
};

================
File: src/components/RaidProfile/ProfileUpload.tsx
================
import React, { FC, useRef, useState } from 'react';
import { playerService } from '../../services/playerService';
import { User } from 'lucide-react';

interface ProfileUploadProps {
  currentImageUrl?: string;
  walletAddress: string;
  onClose?: () => void;
  onUploadSuccess?: () => void;
}

export const ProfileUpload: FC<ProfileUploadProps> = ({
  currentImageUrl,
  walletAddress,
  onClose,
  onUploadSuccess
}) => {
  const [isUploading, setIsUploading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [showModal, setShowModal] = useState(false);

  const handleFileChange = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    // Validate file type and size
    if (!file.type.startsWith('image/')) {
      setError('Please upload an image file.');
      return;
    }

    // 2MB max size for base64 storage
    if (file.size > 2 * 1024 * 1024) {
      setError('Image size should be less than 2MB.');
      return;
    }

    setIsUploading(true);
    setError(null);

    try {
      const success = await playerService.updateProfilePicture(walletAddress, file);
      
      if (success) {
        if (onUploadSuccess) {
          onUploadSuccess();
        }
        setShowModal(false);
      } else {
        setError('Failed to upload profile picture. Please try again.');
      }
    } catch (error) {
      console.error('Error uploading profile picture:', error);
      setError('Error uploading profile picture. Please try again.');
    } finally {
      setIsUploading(false);
    }
  };

  const handleClick = () => {
    setShowModal(true);
  };

  return (
    <>
      {/* Profile Picture Display/Button */}
      <button
        onClick={handleClick}
        className="w-full h-full group relative cursor-pointer"
      >
        {currentImageUrl ? (
          <div className="w-full h-full">
            <img
              src={currentImageUrl}
              alt="Profile"
              className="w-full h-full object-cover"
              onError={(e) => {
                const target = e.target as HTMLImageElement;
                target.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUtdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRINmE0IDQgMCAwIDAtNCA0djIiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiLz48L3N2Zz4=';
              }}
            />
          </div>
        ) : (
          <div className="w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
            <User className="w-12 h-12 text-gray-400 dark:text-gray-500" />
          </div>
        )}
        <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-opacity flex items-center justify-center">
          <span className="text-white opacity-0 group-hover:opacity-100 transition-opacity">
            Change Picture
          </span>
        </div>
      </button>

      {/* Upload Modal */}
      {showModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full">
            <h3 className="text-xl font-semibold mb-4 text-gray-900 dark:text-white">
              Update Profile Picture
            </h3>
            
            <div className="space-y-4">
              <input
                type="file"
                ref={fileInputRef}
                onChange={handleFileChange}
                accept="image/*"
                className="hidden"
              />
              
              <div className="text-sm text-gray-600 dark:text-gray-400">
                <p>• Maximum file size: 2MB</p>
                <p>• Supported formats: JPG, PNG, GIF</p>
              </div>

              <button
                onClick={() => fileInputRef.current?.click()}
                disabled={isUploading}
                className="w-full px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {isUploading ? 'Uploading...' : 'Choose File'}
              </button>

              {error && (
                <p className="text-red-500 text-sm">{error}</p>
              )}

              <button
                onClick={() => setShowModal(false)}
                disabled={isUploading}
                className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
};

================
File: src/components/RaidProfile/UsernameManager.tsx
================
import { FC, useState } from 'react';
import { Edit2, Check, X } from 'lucide-react';
import { playerService } from '../../services/playerService';

interface UsernameManagerProps {
  wallet: string;
}

export const UsernameManager: FC<UsernameManagerProps> = ({ wallet }) => {
  const [isEditing, setIsEditing] = useState(false);
  const [newUsername, setNewUsername] = useState('');
  const [error, setError] = useState('');
  
  const player = playerService.getPlayer(wallet);
  if (!player) return null;

  const handleSubmit = () => {
    if (!newUsername.trim()) {
      setError('Username cannot be empty');
      return;
    }

    if (playerService.isUsernameTaken(newUsername)) {
      setError('Username is already taken');
      return;
    }

    const success = playerService.setUsername(wallet, newUsername);
    if (success) {
      setIsEditing(false);
      setError('');
    } else {
      setError('Failed to update username');
    }
  };

  const handleToggleDisplay = () => {
    playerService.toggleDisplayMode(wallet);
  };

  return (
    <div className="space-y-4">
      {isEditing ? (
        <div className="space-y-2">
          <div className="flex items-center gap-2">
            <input
              type="text"
              value={newUsername}
              onChange={(e) => setNewUsername(e.target.value)}
              placeholder="Enter new username"
              className="flex-1 px-3 py-2 bg-black/40 border border-primary-pink/20 rounded-lg text-white placeholder-neutral-lightGray focus:outline-none focus:border-primary-pink/40"
            />
            <button
              onClick={handleSubmit}
              className="p-2 text-green-400 hover:text-green-300 transition-colors rounded-lg hover:bg-green-400/5"
            >
              <Check className="w-5 h-5" />
            </button>
            <button
              onClick={() => {
                setIsEditing(false);
                setError('');
              }}
              className="p-2 text-red-400 hover:text-red-300 transition-colors rounded-lg hover:bg-red-400/5"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
          {error && (
            <p className="text-red-400 text-sm">{error}</p>
          )}
        </div>
      ) : (
        <div className="flex items-center gap-4">
          <h2 className="text-xl font-bold text-white">
            {player.showWallet 
              ? `${wallet.slice(0, 4)}...${wallet.slice(-4)}`
              : player.username || `${wallet.slice(0, 4)}...${wallet.slice(-4)}`}
          </h2>
          <button
            onClick={() => setIsEditing(true)}
            className="p-2 text-neutral-lightGray hover:text-white transition-colors rounded-lg hover:bg-white/5"
          >
            <Edit2 className="w-4 h-4" />
          </button>
        </div>
      )}

      {player.username && (
        <button
          onClick={handleToggleDisplay}
          className="px-4 py-2 bg-primary-pink/20 text-primary-pink rounded-lg hover:bg-primary-pink/30 transition-colors text-sm"
        >
          {player.showWallet ? 'Use Username' : 'Use Wallet'}
        </button>
      )}
    </div>
  );
};

================
File: src/components/ScrollToTop.tsx
================
import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';

export const ScrollToTop = () => {
  const { pathname } = useLocation();

  useEffect(() => {
    window.scrollTo(0, 0);
  }, [pathname]);

  return null;
};

================
File: src/components/SectionWrapper.tsx
================
import { FC, ReactNode } from 'react';
import { cn } from '../lib/utils';

interface SectionWrapperProps {
  children: ReactNode;
  className?: string;
  variant?: 'default' | 'alternate';
}

export const SectionWrapper: FC<SectionWrapperProps> = ({
  children,
  className,
  variant = 'default'
}) => {
  return (
    <section
      className={cn(
        'w-full py-8 md:py-12',
        variant === 'alternate' ? 'bg-sand-100/50 dark:bg-sand-900/50' : '',
        className
      )}
    >
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        {children}
      </div>
    </section>
  );
};

================
File: src/components/Settings.tsx
================
import { FC, useState, useEffect } from 'react';
import { Save, Server, Key, AlertCircle } from 'lucide-react';
import { useWallet } from '@solana/wallet-adapter-react';
import { ConnectPrompt } from './ConnectPrompt';
import { ContentBox } from './ContentBox';

export const Settings: FC = () => {
  const { connected } = useWallet();
  const [rpcUrl, setRpcUrl] = useState('');
  const [apiKey, setApiKey] = useState('');
  const [saved, setSaved] = useState(false);
  const [useCustomEndpoint, setUseCustomEndpoint] = useState(false);

  useEffect(() => {
    const storedRpcUrl = localStorage.getItem('custom_rpc_url');
    const storedApiKey = localStorage.getItem('custom_api_key');
    
    if (storedRpcUrl && storedApiKey) {
      setRpcUrl(storedRpcUrl);
      setApiKey(storedApiKey);
      setUseCustomEndpoint(true);
    }
  }, []);

  const handleSave = () => {
    if (useCustomEndpoint && rpcUrl && apiKey) {
      localStorage.setItem('custom_rpc_url', rpcUrl);
      localStorage.setItem('custom_api_key', apiKey);
    } else {
      localStorage.removeItem('custom_rpc_url');
      localStorage.removeItem('custom_api_key');
    }
    setSaved(true);
    setTimeout(() => setSaved(false), 2000);
  };

  if (!connected) {
    return <ConnectPrompt />;
  }

  return (
    <div className="page-container">
      <div className="page-content">
        <ContentBox title="API Configuration">
          <div className="space-y-6">
            <div className="flex items-center gap-3 p-4 bg-primary-main/10 rounded-lg">
              <input
                type="checkbox"
                id="use-custom"
                checked={useCustomEndpoint}
                onChange={(e) => setUseCustomEndpoint(e.target.checked)}
                className="w-4 h-4 rounded"
              />
              <div>
                <label htmlFor="use-custom" className="font-medium">
                  Use Custom RPC Endpoint
                </label>
                <p className="text-sm text-text-light-secondary dark:text-text-dark-secondary">
                  Enable to use your own RPC endpoint and API key
                </p>
              </div>
            </div>

            {useCustomEndpoint && (
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">RPC URL</label>
                  <input
                    type="text"
                    value={rpcUrl}
                    onChange={(e) => setRpcUrl(e.target.value)}
                    className="w-full px-4 py-2 bg-background-dark/20 rounded-lg"
                    placeholder="https://your-rpc-endpoint.com"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2">API Key</label>
                  <input
                    type="password"
                    value={apiKey}
                    onChange={(e) => setApiKey(e.target.value)}
                    className="w-full px-4 py-2 bg-background-dark/20 rounded-lg"
                    placeholder="Your API key"
                  />
                </div>
              </div>
            )}

            <button
              onClick={handleSave}
              className="w-full px-4 py-2 bg-primary-main text-white rounded-lg hover:bg-primary-main/90 transition-colors"
            >
              {saved ? 'Settings Saved!' : 'Save Settings'}
            </button>
          </div>
        </ContentBox>
      </div>
    </div>
  );
};

================
File: src/components/StateProvider.tsx
================
import React, { useEffect } from 'react';
import { useStateSync } from '../hooks/useStateSync';
import { playerService } from '../services/playerService';
import { guildService } from '../services/guildService';

interface StateProviderProps {
  children: React.ReactNode;
}

export const StateProvider: React.FC<StateProviderProps> = ({ children }) => {
  // Sync player state
  useStateSync('playerStateUpdate', () => {
    playerService.loadState();
  });

  // Sync guild state
  useStateSync('guildStateUpdate', () => {
    guildService.loadState();
  });

  // Check for updates periodically
  useEffect(() => {
    const interval = setInterval(() => {
      playerService.loadState();
      guildService.loadState();
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  return <>{children}</>;
}

================
File: src/components/ThemeToggle.tsx
================
import { FC } from 'react';
import { Sun, Moon } from 'lucide-react';
import { useTheme } from '../contexts/ThemeContext';

export const ThemeToggle: FC = () => {
  const { theme, toggleTheme } = useTheme();

  return (
    <button
      onClick={toggleTheme}
      className="p-2 rounded-lg text-text-light-primary dark:text-white/90 hover:bg-primary-main/10 transition-colors"
      aria-label="Toggle theme"
    >
      {theme === 'dark' ? (
        <Sun className="w-5 h-5" />
      ) : (
        <Moon className="w-5 h-5" />
      )}
    </button>
  );
};

================
File: src/components/ui/Section.tsx
================
import { FC, ReactNode } from 'react';
import { cn } from '../../utils/cn';

interface SectionProps {
  children: ReactNode;
  className?: string;
  noPadding?: boolean;
  size?: 'sm' | 'md' | 'lg' | 'xl';
  variant?: 'primary' | 'secondary';
}

export const Section: FC<SectionProps> = ({
  children,
  className,
  noPadding = false,
  size = 'md',
  variant = 'primary',
}) => {
  const sizeClasses = {
    sm: 'p-4 sm:p-6',
    md: 'p-6 sm:p-8',
    lg: 'p-8 sm:p-12',
    xl: 'p-12 sm:p-16',
  };

  const variantClasses = {
    primary: `
      bg-surface-light-primary dark:bg-surface-dark-primary
      backdrop-blur-sm
      shadow-glow
      border border-border-light-primary dark:border-border-dark-primary
    `,
    secondary: `
      bg-surface-light-secondary dark:bg-surface-dark-secondary
      backdrop-blur-sm
      shadow-glow-sm
      border border-border-light-secondary dark:border-border-dark-secondary
    `,
  };

  return (
    <section
      className={cn(
        'rounded-2xl',
        !noPadding && sizeClasses[size],
        variantClasses[variant],
        'transition-all duration-300',
        'hover:shadow-glow-lg',
        className
      )}
    >
      {children}
    </section>
  );
};

================
File: src/components/ui/skeleton.tsx
================
import { cn } from "../../lib/utils";

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-sand-200/50 dark:bg-sand-800/50", className)}
      {...props}
    />
  );
}

export { Skeleton };

================
File: src/components/ui/tabs.tsx
================
import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs";
import { cn } from "../../lib/utils";

const Tabs = TabsPrimitive.Root;

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-12 items-center justify-center rounded-xl bg-white/40 dark:bg-black/20 p-1 text-sand-600 dark:text-sand-400 backdrop-blur-sm border border-sand-300/20 dark:border-sand-200/10",
      className
    )}
    {...props}
  />
));
TabsList.displayName = TabsPrimitive.List.displayName;

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-2 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-primary-500 data-[state=active]:text-white data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
));
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName;

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
));
TabsContent.displayName = TabsPrimitive.Content.displayName;

export { Tabs, TabsList, TabsTrigger, TabsContent };

================
File: src/components/VolumeControl.tsx
================
import { FC } from 'react';
import { Volume2, VolumeX } from 'lucide-react';
import { useAudio } from '../contexts/AudioContext';

export const VolumeControl: FC = () => {
  const { volume, setVolume, isMuted, toggleMute } = useAudio();

  return (
    <div className="fixed bottom-4 right-4 z-50 flex items-center gap-2 glass-panel p-2">
      <button
        onClick={toggleMute}
        className="p-2 hover:bg-primary-main/20 rounded-lg transition-colors"
      >
        {isMuted ? (
          <VolumeX className="w-5 h-5 text-primary-main" />
        ) : (
          <Volume2 className="w-5 h-5 text-primary-main" />
        )}
      </button>
      <input
        type="range"
        min="0"
        max="1"
        step="0.01"
        value={volume}
        onChange={(e) => setVolume(parseFloat(e.target.value))}
        className="w-24 h-1 bg-primary-main/30 rounded-lg appearance-none cursor-pointer 
          [&::-webkit-slider-thumb]:appearance-none 
          [&::-webkit-slider-thumb]:w-3 
          [&::-webkit-slider-thumb]:h-3 
          [&::-webkit-slider-thumb]:rounded-full 
          [&::-webkit-slider-thumb]:bg-primary-main
          [&::-webkit-slider-thumb]:hover:bg-primary-main/80
          [&::-webkit-slider-thumb]:transition-colors
          [&::-webkit-slider-thumb]:shadow-glow
          dark:[&::-webkit-slider-thumb]:shadow-glow-light"
      />
    </div>
  );
};

================
File: src/components/WalletConnect.tsx
================
import { FC, useEffect, useState } from 'react';
import { WalletMultiButton } from '@solana/wallet-adapter-react-ui';
import { useWallet } from '@solana/wallet-adapter-react';
import { useAuth } from '../contexts/AuthContext';
import '../styles/wallet.css';

type ConnectionState = 'disconnected' | 'connecting' | 'connected' | 'authenticating' | 'error';

export const WalletConnect: FC = () => {
  const { connected } = useWallet();
  const { isAuthenticated, isLoading, error: authError } = useAuth();
  const [connectionState, setConnectionState] = useState<ConnectionState>('disconnected');

  useEffect(() => {
    if (!connected) {
      setConnectionState('disconnected');
    } else if (isLoading) {
      setConnectionState('authenticating');
    } else if (isAuthenticated) {
      setConnectionState('connected');
    } else if (authError) {
      setConnectionState('error');
    }
  }, [connected, isLoading, isAuthenticated, authError]);

  return (
    <div className="wallet-connect">
      <WalletMultiButton />
      {authError && (
        <div className="error-message">
          {authError.message}
        </div>
      )}
      {connectionState === 'authenticating' && (
        <div className="status-message">
          Authenticating...
        </div>
      )}
    </div>
  );
};

export default WalletConnect;

================
File: src/components/WalletContextProvider.tsx
================
import { FC, ReactNode, useMemo } from 'react';
import { ConnectionProvider, WalletProvider } from '@solana/wallet-adapter-react';
import { WalletModalProvider } from '@solana/wallet-adapter-react-ui';
import { PhantomWalletAdapter } from '@solana/wallet-adapter-phantom';
import { SolflareWalletAdapter } from '@solana/wallet-adapter-solflare';
import { clusterApiUrl } from '@solana/web3.js';

// Import wallet adapter styles
import '@solana/wallet-adapter-react-ui/styles.css';

interface Props {
  children: ReactNode;
}

export const WalletContextProvider: FC<Props> = ({ children }) => {
  // You can also provide a custom RPC endpoint
  const endpoint = useMemo(() => clusterApiUrl('devnet'), []);

  // @solana/wallet-adapter-wallets includes all the adapters but supports tree shaking and lazy loading --
  // Only the wallets you configure here will be compiled into your application, and only the dependencies
  // of wallets that your users connect to will be loaded
  const wallets = useMemo(
    () => [
      new PhantomWalletAdapter(),
      new SolflareWalletAdapter()
    ],
    []
  );

  return (
    <ConnectionProvider endpoint={endpoint}>
      <WalletProvider 
        wallets={wallets} 
        autoConnect={false}
        onError={(error) => {
          console.error('Wallet error:', error);
          // Handle specific error types
          if (error.name === 'WalletConnectionError') {
            console.log('Please check if your wallet is unlocked and try again');
          }
        }}
      >
        <WalletModalProvider>
          {children}
        </WalletModalProvider>
      </WalletProvider>
    </ConnectionProvider>
  );
};

================
File: src/components/Welcome.tsx
================
import { FC } from 'react';
import { Wallet } from 'lucide-react';
import { GlassPanel } from './GlassPanel';

export const Welcome: FC = () => {
  return (
    <div className="flex flex-col items-center justify-center min-h-[60vh] text-center">
      <GlassPanel className="max-w-md mx-auto p-8">
        <Wallet className="w-16 h-16 text-primary-main mb-4" />
        <h2 className="text-3xl font-bold text-white mb-4">
          Welcome to Solana NFT Dashboard
        </h2>
        <p className="text-text-light-secondary dark:text-text-dark-secondary">
          Connect your wallet to view your NFT collection and access exclusive features.
        </p>
      </GlassPanel>
    </div>
  );
};

================
File: src/components/XPProgress.tsx
================
import { FC, useEffect, useState } from 'react';
import { Star } from 'lucide-react';
import { calculateLevel } from '../utils/levelCalculator';

interface XPProgressProps {
  xp: number;
  size?: 'sm' | 'md' | 'lg';
  showDetails?: boolean;
  animate?: boolean;
}

export const XPProgress: FC<XPProgressProps> = ({ 
  xp, 
  size = 'md',
  showDetails = false,
  animate = true 
}) => {
  const [displayXP, setDisplayXP] = useState(0);
  const { level, currentLevelXp, nextLevelXp, progress } = calculateLevel(xp);

  useEffect(() => {
    if (animate && xp !== displayXP) {
      const step = Math.ceil((xp - displayXP) / 20);
      const interval = setInterval(() => {
        setDisplayXP(prev => {
          const next = prev + step;
          return next >= xp ? xp : next;
        });
      }, 50);

      return () => clearInterval(interval);
    } else {
      setDisplayXP(xp);
    }
  }, [xp, animate, displayXP]);

  const sizeClasses = {
    sm: 'text-sm space-y-1',
    md: 'text-base space-y-2',
    lg: 'text-lg space-y-3'
  };

  return (
    <div className={sizeClasses[size]}>
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Star className={`${
            size === 'sm' ? 'w-4 h-4' :
            size === 'md' ? 'w-5 h-5' :
            'w-6 h-6'
          } text-primary-main`} />
          <span className="font-bold text-primary-main">Level {level}</span>
        </div>
        {showDetails && (
          <span className="text-text-light-secondary dark:text-text-dark-secondary">
            {displayXP.toLocaleString()} XP
          </span>
        )}
      </div>

      <div className="space-y-1">
        {showDetails && (
          <div className="flex justify-between text-xs text-text-light-secondary dark:text-text-dark-secondary">
            <span>{currentLevelXp.toLocaleString()} XP</span>
            <span>{nextLevelXp.toLocaleString()} XP</span>
          </div>
        )}
        <div className="h-2 bg-primary-main/20 rounded-full overflow-hidden">
          <div 
            className="h-full bg-gradient-to-r from-primary-main to-primary-main/80 transition-all duration-300"
            style={{ width: `${progress}%` }}
          >
            {animate && (
              <div className="w-full h-full animate-pulse opacity-50 bg-white/20" />
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: src/config/brand.ts
================
export const brandConfig = {
  name: "Pan Da Pan",
  domain: "pandapan.xyz",
  title: "NFT Portfolio Dashboard",
  description: "The ultimate NFT gaming experience on Solana",

  admin: {
    wallet: "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs"
  },

  theme: {
    colors: {
      primary: '#E8825F',
      secondary: '#63b0ad',
      tertiary: '#ADC8E2',
      accent: {
        coral: '#D76A4C',
        teal: '#567A82',
        blue: '#6A94BE'
      },
      background: {
        light: '#F3E5C5',
        sand: '#E2CD9F',
        lavender: '#E6E5F8',
        dark: '#2F3B54',
        darker: '#242B3D'
      },
      text: {
        light: {
          primary: '#3E3534',
          secondary: '#2B3C5A',
          muted: '#567A82'
        },
        dark: {
          primary: '#E2CD9F',
          secondary: '#ADC8E2',
          muted: '#63b0ad'
        }
      }
    },
    glass: {
      light: 'rgba(232, 130, 95, 0.08)',
      dark: 'rgba(232, 130, 95, 0.05)'
    }
  },

  assets: {
    logo: {
      light: '/assets/logo-light.svg',
      dark: '/assets/logo-dark.svg'
    },
    favicon: '/vite.svg',
    defaultPfp: '/assets/defaultpfp.jpg',
    loadingScreen: '/assets/loading.png',
    music: '/assets/music/music.mp3'
  }
};

================
File: src/config/cache.ts
================
import { Cache } from '../utils/cache';

// Cache durations in milliseconds
export const CACHE_DURATION = {
  nft: {
    metadata: 5 * 60 * 1000,     // 5 minutes
    collection: 15 * 60 * 1000,  // 15 minutes
    userNFTs: 2 * 60 * 1000     // 2 minutes
  },
  player: {
    profile: 60 * 1000,         // 1 minute
    stats: 30 * 1000,          // 30 seconds
    leaderboard: 30 * 1000     // 30 seconds
  },
  guild: {
    info: 5 * 60 * 1000,       // 5 minutes
    members: 2 * 60 * 1000,    // 2 minutes
    leaderboard: 60 * 1000     // 1 minute
  },
  raid: {
    active: 30 * 1000,         // 30 seconds
    completed: 5 * 60 * 1000   // 5 minutes
  }
};

// Initialize cache with optimal settings
const initCache = () => {
  const cache = Cache.getInstance();
  cache.setMaxSize(100 * 1024 * 1024); // 100MB
  cache.enableCompression(true);
  return cache;
};

export { initCache };

================
File: src/config/constants.ts
================
export const ADMIN_WALLET = "8jN1XtgiuWeyNjzysYVqGZ1mPAG37sjmuCTnENz66wrs";

export const SOCIAL_LINKS = {
  twitter: "https://twitter.com/PanDaPan",
  discord: "https://discord.gg/pandapan",
  github: "https://github.com/pandapan"
};

export const PROJECT_CONFIG = {
  name: "Pan Da Pan",
  domain: "pandapan.xyz",
  description: "The ultimate NFT gaming experience on Solana",
  defaultTitle: "Pan Da Pan",
  themeColor: "#E8825F"
};

================
File: src/config/database.ts
================
import { initializeApp } from 'firebase/app';
import { getFirestore, enableIndexedDbPersistence } from 'firebase/firestore';
import { getAuth } from 'firebase/auth';
import { scaleConfig } from './scale';

// Firebase configuration
const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize Firestore with persistence
const db = getFirestore(app);
enableIndexedDbPersistence(db, {
  synchronizeTabs: true,
  cacheSizeBytes: scaleConfig.performance.maxCacheSize
}).catch((err) => {
  if (err.code === 'failed-precondition') {
    console.warn('Multiple tabs open, persistence can only be enabled in one tab at a time.');
  } else if (err.code === 'unimplemented') {
    console.warn('Browser doesn\'t support persistence');
  }
});

// Initialize Auth
const auth = getAuth(app);

// Database collections
export const collections = {
  USERS: 'users',
  QUESTS: 'quests',
  GUILDS: 'guilds',
  RAIDS: 'raids',
  LEADERBOARDS: 'leaderboards',
  SETTINGS: 'settings'
} as const;

// Cache durations
export const cacheDuration = {
  SHORT: 5 * 60 * 1000,    // 5 minutes
  MEDIUM: 15 * 60 * 1000,  // 15 minutes
  LONG: 60 * 60 * 1000     // 1 hour
} as const;

// Batch sizes for operations
export const batchSize = {
  WRITE: 500,              // Maximum batch write size
  READ: 1000,              // Maximum batch read size
  QUERY: 100               // Default query limit
} as const;

export { db, auth };

================
File: src/config/firebase.ts
================
import { initializeApp } from 'firebase/app';
import { getFirestore, enableIndexedDbPersistence } from 'firebase/firestore';
import { getAuth } from 'firebase/auth';
import { getAnalytics } from 'firebase/analytics';

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize Firestore with persistence
const db = getFirestore(app);
enableIndexedDbPersistence(db).catch((err) => {
  console.error('Failed to enable persistence:', err);
});

// Initialize Auth
const auth = getAuth(app);

// Initialize Analytics
const analytics = getAnalytics(app);

export { db, auth, analytics };

================
File: src/config/index.ts
================
// Export all configurations
export * from './firebase';
export * from './rpc';
export * from './cache';
export * from './monitoring';
export * from './security';
export * from './scale';

================
File: src/config/monitoring.ts
================
export const monitoringConfig = {
  metrics: {
    collection: {
      interval: 60000, // Collect metrics every minute
      retention: 7 * 24 * 60 * 60 * 1000 // Keep 7 days of metrics
    },
    
    thresholds: {
      error: {
        rate: 0.05, // Alert if error rate exceeds 5%
        count: 100  // Alert if more than 100 errors in interval
      },
      latency: {
        p95: 1000,  // 95th percentile should be under 1s
        p99: 2000   // 99th percentile should be under 2s
      },
      memory: {
        usage: 0.85 // Alert if memory usage exceeds 85%
      }
    }
  },

  alerts: {
    channels: {
      email: ['admin@raidrally.xyz'],
      discord: import.meta.env.VITE_DISCORD_WEBHOOK_URL,
      slack: import.meta.env.VITE_SLACK_WEBHOOK_URL
    },
    
    cooldown: {
      similar: 300000,  // 5 minutes between similar alerts
      general: 60000    // 1 minute between any alerts
    },
    
    levels: {
      info: {
        color: '#3498db',
        notify: false
      },
      warning: {
        color: '#f1c40f',
        notify: true
      },
      error: {
        color: '#e74c3c',
        notify: true
      },
      critical: {
        color: '#c0392b',
        notify: true,
        escalate: true
      }
    }
  },

  logging: {
    level: import.meta.env.PROD ? 'info' : 'debug',
    format: 'json',
    
    retention: {
      error: 30,  // Keep error logs for 30 days
      info: 7,    // Keep info logs for 7 days
      debug: 1    // Keep debug logs for 1 day
    },
    
    sensitive: {
      fields: ['password', 'token', 'key', 'secret'],
      replacement: '[REDACTED]'
    }
  }
};

================
File: src/config/relayer.ts
================
export const relayerConfig = {
  endpoints: {
    primary: import.meta.env.VITE_HELIUS_RPC_URL,
    fallback: [
      'https://api.mainnet-beta.solana.com',
      'https://solana-api.projectserum.com'
    ]
  },
  
  retryPolicy: {
    maxAttempts: 3,
    baseDelay: 1000,
    maxDelay: 5000
  },
  
  rateLimit: {
    transactions: {
      perSecond: 50,
      burstSize: 100
    },
    queries: {
      perSecond: 100,
      burstSize: 200
    }
  },
  
  compression: {
    enabled: true,
    minSize: 1024, // Only compress data larger than 1KB
    algorithm: 'snappy'
  },
  
  queue: {
    maxSize: 1000,
    priorityLevels: {
      high: 2,
      normal: 1,
      low: 0
    },
    timeoutMs: 30000
  },
  
  monitoring: {
    errorThreshold: 0.1, // 10% error rate triggers alert
    latencyThreshold: 2000, // Alert if latency exceeds 2s
    metricsInterval: 60000 // Report metrics every minute
  }
};

================
File: src/config/rpc.ts
================
import { Connection, Commitment } from '@solana/web3.js';

// RPC endpoints for load balancing
const RPC_ENDPOINTS = [
  import.meta.env.VITE_SOLANA_RPC_URL,
  `https://rpc.helius.xyz/?api-key=${import.meta.env.VITE_HELIUS_API_KEY}`
];

// Get random RPC endpoint
const getRandomRPC = () => {
  return RPC_ENDPOINTS[Math.floor(Math.random() * RPC_ENDPOINTS.length)];
};

// Create connection with retry logic
const createConnection = (commitment: Commitment = 'confirmed') => {
  const endpoint = getRandomRPC();
  return new Connection(endpoint, {
    commitment,
    wsEndpoint: endpoint.replace('https', 'wss'),
    confirmTransactionInitialTimeout: 60000
  });
};

// Monitor RPC performance
const monitorRPCCall = async (method: string, params: any[]) => {
  const start = performance.now();
  const connection = createConnection();
  
  try {
    const result = await connection.rpcRequest(method, params);
    const duration = performance.now() - start;
    console.debug(`RPC ${method} took ${duration}ms`);
    return result;
  } catch (error) {
    console.error(`RPC ${method} failed:`, error);
    throw error;
  }
};

export { createConnection, monitorRPCCall };

================
File: src/config/scale.ts
================
export const scaleConfig = {
  performance: {
    maxWebSocketConnections: 1000,
    maxConcurrentRequests: 100,
    maxCacheSize: 100 * 1024 * 1024, // 100MB
    requestTimeout: 30000 // 30 seconds
  },

  cache: {
    player: {
      profile: 300000,    // 5 minutes
      inventory: 60000,   // 1 minute
      quests: 120000,    // 2 minutes
    },
    guild: {
      info: 600000,      // 10 minutes
      members: 300000,   // 5 minutes
    },
    leaderboard: 60000,  // 1 minute
    transaction: 300000  // 5 minutes
  },

  batch: {
    leaderboardUpdate: 50,   // Update leaderboard in batches of 50
    questUpdate: 100,        // Process quest updates in batches of 100
    inventoryUpdate: 200,    // Process inventory updates in batches of 200
    transactionBatch: 25     // Process transactions in batches of 25
  },

  limits: {
    maxPlayersPerGuild: 1000,
    maxQuestsPerPlayer: 50,
    maxItemsPerInventory: 1000,
    maxConcurrentRaids: 10,
    
    rateLimit: {
      windowMs: 60000,      // 1 minute window
      maxRequests: {
        global: 1000,       // 1000 requests per minute per IP
        auth: 30,           // 30 auth requests per minute
        quest: 10,          // 10 quest submissions per minute
        transaction: 50     // 50 transactions per minute
      }
    },

    transaction: {
      maxRetries: 3,
      maxPending: 100,
      maxBatchSize: 25
    }
  },

  monitoring: {
    errorThreshold: 0.05,    // 5% error rate threshold
    latencyThreshold: 1000,  // 1 second latency threshold
    metricsInterval: 60000   // Report metrics every minute
  }
};

================
File: src/config/security.ts
================
import { QuestSubmission } from '../types/quest';

// Rate limiting configuration
export const RATE_LIMITS = {
  global: {
    requests: 1000,
    windowMs: 60 * 1000 // 1 minute
  },
  quest: {
    submissions: 10,
    windowMs: 60 * 1000 // 1 minute
  },
  nft: {
    operations: 100,
    windowMs: 60 * 1000 // 1 minute
  }
};

// Input validation
export const validateQuestSubmission = (submission: QuestSubmission): boolean => {
  if (!submission.questId || !submission.wallet) return false;
  if (submission.screenshot && submission.screenshot.size > 2 * 1024 * 1024) return false;
  if (submission.url && !isValidUrl(submission.url)) return false;
  return true;
};

// URL validation
const isValidUrl = (url: string): boolean => {
  try {
    new URL(url);
    return true;
  } catch {
    return false;
  }
};

// XSS prevention
export const sanitizeInput = (input: string): string => {
  return input
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;')
    .replace(/\//g, '&#x2F;');
};

================
File: src/contexts/AudioContext.tsx
================
import React, { createContext, useContext, useEffect, useRef, useState } from 'react';

interface AudioContextType {
  isPlaying: boolean;
  volume: number;
  togglePlay: () => void;
  setVolume: (volume: number) => void;
  hasScrolled: boolean;
  setHasScrolled: (hasScrolled: boolean) => void;
}

const AudioContext = createContext<AudioContextType>({
  isPlaying: false,
  volume: 0.5,
  togglePlay: () => {},
  setVolume: () => {},
  hasScrolled: false,
  setHasScrolled: () => {},
});

export const useAudio = () => useContext(AudioContext);

interface AudioProviderProps {
  children: React.ReactNode;
}

export const AudioProvider: React.FC<AudioProviderProps> = ({ children }) => {
  const audioRef = useRef<HTMLAudioElement | null>(null);
  const [isPlaying, setIsPlaying] = useState(false);
  const [volume, setVolume] = useState(() => {
    return parseFloat(localStorage.getItem('audioVolume') || '0.1');
  });
  const [hasScrolled, setHasScrolled] = useState(false);
  const [hasPlayedBefore, setHasPlayedBefore] = useState(() => {
    return localStorage.getItem('hasPlayedBefore') === 'true';
  });

  // Initialize audio element
  useEffect(() => {
    const audio = new Audio('/assets/music/music.mp3');
    audio.loop = true;
    audio.volume = volume;
    audioRef.current = audio;

    // Clean up on unmount
    return () => {
      if (audio) {
        audio.pause();
        audio.src = '';
      }
    };
  }, []);

  // Handle volume changes
  useEffect(() => {
    if (audioRef.current) {
      audioRef.current.volume = volume;
      localStorage.setItem('audioVolume', volume.toString());
    }
  }, [volume]);

  // Handle visibility change
  useEffect(() => {
    const handleVisibilityChange = () => {
      if (!audioRef.current) return;

      if (document.hidden) {
        audioRef.current.pause();
      } else if (isPlaying) {
        audioRef.current.play().catch(console.error);
      }
    };

    document.addEventListener('visibilitychange', handleVisibilityChange);
    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange);
    };
  }, [isPlaying]);

  // Handle scroll detection for first-time visitors
  useEffect(() => {
    if (!hasPlayedBefore && hasScrolled && !isPlaying && audioRef.current) {
      const playPromise = audioRef.current.play();
      
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            setIsPlaying(true);
            setHasPlayedBefore(true);
            localStorage.setItem('hasPlayedBefore', 'true');
          })
          .catch(error => {
            console.error('Auto-play error:', error);
            // Reset states if autoplay fails
            setIsPlaying(false);
            setHasPlayedBefore(false);
          });
      }
    }
  }, [hasScrolled, hasPlayedBefore, isPlaying]);

  // Update audio playback state
  useEffect(() => {
    const audio = audioRef.current;
    if (!audio) return;

    if (isPlaying) {
      const playPromise = audio.play();
      if (playPromise !== undefined) {
        playPromise.catch(error => {
          console.error('Playback error:', error);
          setIsPlaying(false);
        });
      }
    } else {
      audio.pause();
    }
  }, [isPlaying]);

  const togglePlay = () => {
    setIsPlaying(!isPlaying);
  };

  const handleVolumeChange = (newVolume: number) => {
    const clampedVolume = Math.max(0, Math.min(1, newVolume));
    setVolume(clampedVolume);
  };

  return (
    <AudioContext.Provider
      value={{
        isPlaying,
        volume,
        togglePlay,
        setVolume: handleVolumeChange,
        hasScrolled,
        setHasScrolled,
      }}
    >
      {children}
    </AudioContext.Provider>
  );
};

================
File: src/contexts/AuthContext.tsx
================
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { supabase } from '../services/supabaseClient';
import { playerService } from '../services/playerService';
import bs58 from 'bs58';
import nacl from 'tweetnacl';

interface AuthContextType {
  isAuthenticated: boolean;
  isLoading: boolean;
  userId: string | null;
  signIn: () => Promise<void>;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType>({
  isAuthenticated: false,
  isLoading: true,
  userId: null,
  signIn: async () => {},
  signOut: async () => {},
});

export const useAuth = () => useContext(AuthContext);

interface AuthProviderProps {
  children: ReactNode;
}

export const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [userId, setUserId] = useState<string | null>(null);
  const { publicKey, signMessage, disconnect } = useWallet();

  useEffect(() => {
    const checkSession = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        setIsAuthenticated(!!session);
        setUserId(session?.user?.id || null);
      } catch (error) {
        console.error('Session check error:', error);
      } finally {
        setIsLoading(false);
      }
    };

    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {
      setIsAuthenticated(!!session);
      setUserId(session?.user?.id || null);
      setIsLoading(false);
    });

    checkSession();

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  const signIn = async () => {
    try {
      if (!publicKey || !signMessage) {
        throw new Error('Wallet not connected');
      }

      // Get the nonce from Supabase
      const { data: { nonce }, error: nonceError } = await supabase.functions.invoke('get-nonce', {
        body: { wallet: publicKey.toString() }
      });

      if (nonceError) throw nonceError;

      // Sign the nonce
      const message = new TextEncoder().encode(`Sign this message for authenticating with your wallet. Nonce: ${nonce}`);
      const signedMessage = await signMessage(message);
      const signature = bs58.encode(signedMessage);

      // Verify and sign in
      const { data, error } = await supabase.auth.signInWithPassword({
        email: `${publicKey.toString()}@phantom.com`,
        password: signature,
      });

      if (error) throw error;

      // Create or update player record
      await playerService.createOrUpdatePlayer(publicKey.toString());

      setIsAuthenticated(true);
      setUserId(data.user.id);
    } catch (error) {
      console.error('Wallet auth error:', error);
      throw error;
    }
  };

  const signOut = async () => {
    try {
      await supabase.auth.signOut();
      await disconnect();
      setIsAuthenticated(false);
      setUserId(null);
    } catch (error) {
      console.error('Sign out error:', error);
      throw error;
    }
  };

  return (
    <AuthContext.Provider value={{
      isAuthenticated,
      isLoading,
      userId,
      signIn,
      signOut,
    }}>
      {children}
    </AuthContext.Provider>
  );
};

================
File: src/contexts/index.ts
================
// Export all contexts
export * from './AudioContext';
export * from './ThemeContext';

================
File: src/contexts/ThemeContext.tsx
================
import { createContext, useContext, useState, useEffect, FC, ReactNode } from 'react';

type Theme = 'light' | 'dark';

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType>({
  theme: 'dark',
  toggleTheme: () => {},
});

export const useTheme = () => useContext(ThemeContext);

interface ThemeProviderProps {
  children: ReactNode | ((props: ThemeContextType) => ReactNode);
}

export const ThemeProvider: FC<ThemeProviderProps> = ({ children }) => {
  const [theme, setTheme] = useState<Theme>(() => {
    const savedTheme = localStorage.getItem('theme');
    return (savedTheme as Theme) || 'dark';
  });

  useEffect(() => {
    localStorage.setItem('theme', theme);
    document.documentElement.classList.toggle('dark', theme === 'dark');
    document.documentElement.classList.toggle('light', theme === 'light');
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'dark' ? 'light' : 'dark');
  };

  const value = { theme, toggleTheme };

  return (
    <ThemeContext.Provider value={value}>
      {typeof children === 'function' ? children(value) : children}
    </ThemeContext.Provider>
  );
};

================
File: src/data/guildQuestions.ts
================
export const guildQuestions = [
  {
    id: 'q1',
    question: 'What would you do with a treasure map?',
    choices: [
      { text: 'Analyze its market value and potential ROI', archetype: 'Finance' },
      { text: 'Start the adventure immediately', archetype: 'Adventurer' },
      { text: 'Share it with those in need', archetype: 'Philanthropist' },
      { text: 'Turn it into a treasure hunt party', archetype: 'PartyAnimal' }
    ]
  },
  {
    id: 'q2',
    question: 'How do you prefer to spend your weekends?',
    choices: [
      { text: 'Researching investment opportunities', archetype: 'Finance' },
      { text: 'Exploring new places', archetype: 'Adventurer' },
      { text: 'Volunteering and helping others', archetype: 'Philanthropist' },
      { text: 'Hosting gatherings with friends', archetype: 'PartyAnimal' }
    ]
  },
  {
    id: 'q3',
    question: "What is your ideal NFT collection?",
    choices: [
      { text: 'One with strong utility and value potential', archetype: 'Finance' },
      { text: 'Rare and unique pieces with a story', archetype: 'Adventurer' },
      { text: 'Projects that support good causes', archetype: 'Philanthropist' },
      { text: 'Fun, social collections with events', archetype: 'PartyAnimal' }
    ]
  },
  {
    id: 'q4',
    question: 'How would you use your influence in the community?',
    choices: [
      { text: 'Create investment strategies and guides', archetype: 'Finance' },
      { text: 'Lead expeditions and discoveries', archetype: 'Adventurer' },
      { text: 'Organize charity events and fundraisers', archetype: 'Philanthropist' },
      { text: 'Host community events and celebrations', archetype: 'PartyAnimal' }
    ]
  },
  {
    id: 'q5',
    question: 'What attracts you most to Web3?',
    choices: [
      { text: 'The potential for financial innovation', archetype: 'Finance' },
      { text: 'The unexplored technological frontier', archetype: 'Adventurer' },
      { text: 'The ability to help others globally', archetype: 'Philanthropist' },
      { text: 'The vibrant social communities', archetype: 'PartyAnimal' }
    ]
  }
];

================
File: src/data/questPool.ts
================
export const questPoolData = {
  daily: [
    {
      id: 'daily-1',
      type: 'daily',
      description: 'Share a meme in the Discord community',
      xpReward: 100,
      isAutomatic: true
    },
    {
      id: 'daily-2',
      type: 'daily',
      description: 'Like and retweet a post from @KibalzXYZ',
      xpReward: 150,
      isAutomatic: true
    },
    {
      id: 'daily-3',
      type: 'daily',
      description: 'Post your favorite NFT from your collection',
      xpReward: 200,
      isAutomatic: true
    },
    // Add more daily quests to reach 15 total
  ],
  weekly: [
    {
      id: 'weekly-1',
      type: 'weekly',
      description: 'Create a guide for new raiders',
      xpReward: 500,
      isAutomatic: true
    },
    {
      id: 'weekly-2',
      type: 'weekly',
      description: 'Participate in 3 raid boss battles',
      xpReward: 750,
      isAutomatic: true
    },
    // Add more weekly quests to reach 10 total
  ],
  monthly: [
    {
      id: 'monthly-1',
      type: 'monthly',
      description: 'Complete all weekly quests',
      xpReward: 2000,
      isAutomatic: true
    },
    {
      id: 'monthly-2',
      type: 'monthly',
      description: 'Defeat 5 raid bosses',
      xpReward: 2500,
      isAutomatic: true
    },
    // Add more monthly quests to reach 5 total
  ]
};

================
File: src/hooks/index.ts
================
// Export all hooks
export * from './useRaid';
export * from './useQuests';
export * from './useStateSync';
export * from './useLayerPreloader';

================
File: src/hooks/useQuests.ts
================
import { useState, useEffect } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { Quest } from '../types/quest';
import { questService } from '../services/questService';

export function useQuests(type?: 'daily' | 'weekly' | 'monthly') {
  const { publicKey } = useWallet();
  const [quests, setQuests] = useState<Quest[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadQuests = () => {
      const allQuests = questService.getQuests(type);
      setQuests(allQuests);
      setLoading(false);
    };

    loadQuests();
    // In a real implementation, we would set up WebSocket or polling here
    const interval = setInterval(loadQuests, 60000); // Refresh every minute

    return () => clearInterval(interval);
  }, [type]);

  const submitQuestProof = async (questId: string, proof: { url: string; screenshot?: File }) => {
    if (!publicKey) return false;

    return questService.submitQuestProof(questId, publicKey.toString(), proof);
  };

  return {
    quests,
    loading,
    submitQuestProof
  };
}

================
File: src/hooks/useRaid.ts
================
import { useState, useEffect } from 'react';
import { useWallet } from '@solana/wallet-adapter-react';
import { RaidState, QuestSubmission } from '../types/raid';
import { raidService } from '../services/raidService';

export function useRaid() {
  const { publicKey } = useWallet();
  const [currentRaids, setCurrentRaids] = useState<RaidState[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadRaids = async () => {
      try {
        const raids = await raidService.getAllRaids();
        setCurrentRaids(raids.filter(raid => raid.state === 'active'));
        setError(null);
      } catch (err) {
        console.error('Error loading raids:', err);
        setError('Failed to load raids');
      } finally {
        setLoading(false);
      }
    };

    loadRaids();
    const interval = setInterval(loadRaids, 5000); // Update every 5 seconds

    return () => clearInterval(interval);
  }, []);

  const joinRaid = async (raidId: string, nftId: string) => {
    if (!publicKey) return false;
    try {
      return await raidService.joinRaid(raidId, publicKey.toString(), nftId);
    } catch (err) {
      console.error('Error joining raid:', err);
      return false;
    }
  };

  const completeQuest = async (raidId: string, questId: string, submission: QuestSubmission) => {
    if (!publicKey) return false;
    try {
      return await raidService.completeQuest(raidId, questId, publicKey.toString(), submission);
    } catch (err) {
      console.error('Error completing quest:', err);
      return false;
    }
  };

  return {
    currentRaids,
    loading,
    error,
    joinRaid,
    completeQuest
  };
}

================
File: src/hooks/useScrollEffect.ts
================
import { useEffect, useState } from 'react';

export function useScrollEffect() {
  const [scrollY, setScrollY] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      setScrollY(window.scrollY);
    };

    // Initial scroll position
    handleScroll();

    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const getParallaxStyle = (speed: number = 0.02) => ({
    transform: `translate3d(0, ${scrollY * speed}px, 0)`,
  });

  return { scrollY, getParallaxStyle };
}

================
File: src/hooks/useStateSync.ts
================
import { useEffect } from 'react';
import { stateManager } from '../services/StateManager';

export function useStateSync(event: string, callback: (...args: any[]) => void) {
  useEffect(() => {
    const unsubscribe = stateManager.subscribe(event, callback);
    return () => unsubscribe();
  }, [event, callback]);
}

export function useGlobalStateSync(callback: () => void) {
  useEffect(() => {
    const unsubscribe = stateManager.subscribe('stateSync', callback);
    return () => unsubscribe();
  }, [callback]);
}

================
File: src/index.css
================
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background-start: 255, 255, 255;
  --background-end: 249, 250, 251;
  --text-primary: 17, 24, 39;
  --text-secondary: 55, 65, 81;
  --primary-glow: 249, 115, 22;
  --header-height: 4rem;
  @screen sm {
    --header-height: 4.5rem;
  }
  @screen lg {
    --header-height: 5rem;
  }
}

.dark {
  --background-start: 17, 24, 39;
  --background-end: 11, 15, 25;
  --text-primary: 243, 244, 246;
  --text-secondary: 209, 213, 219;
  --primary-glow: 249, 115, 22;
}

body {
  background: linear-gradient(
    to bottom,
    rgb(var(--background-start)),
    rgb(var(--background-end))
  );
  color: rgb(var(--text-primary));
  min-height: 100vh;
}

/* Smooth color transitions */
*, *::before, *::after {
  transition-property: background-color, border-color, color;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 200ms;
}

/* Gradient overlays */
.gradient-overlay {
  background: linear-gradient(
    to bottom,
    rgba(var(--background-start), 0.97),
    rgba(var(--background-end), 0.97)
  );
  backdrop-filter: blur(4px);
}

/* Card styles */
.card-background {
  background: rgba(var(--background-start), 0.8);
  border: 1px solid rgba(var(--text-primary), 0.1);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Glow effects */
.primary-glow {
  position: relative;
}

.primary-glow::before {
  content: '';
  position: absolute;
  inset: -1px;
  background: linear-gradient(
    135deg,
    rgba(var(--primary-glow), 0.2),
    rgba(var(--primary-glow), 0.1),
    rgba(var(--primary-glow), 0.05)
  );
  border-radius: inherit;
  z-index: -1;
  transition: opacity 0.3s ease;
  opacity: 0;
}

.primary-glow:hover::before {
  opacity: 1;
}

/* Glass effect */
.glass-effect {
  background: linear-gradient(
    to bottom,
    rgba(var(--background-start), 0.8),
    rgba(var(--background-end), 0.7)
  );
  backdrop-filter: blur(12px);
  border: 1px solid rgba(var(--primary-glow), 0.2);
  transition: all 300ms ease-in-out;
}

.glass-effect:hover {
  background: linear-gradient(
    to bottom,
    rgba(var(--background-start), 0.85),
    rgba(var(--background-end), 0.75)
  );
  border-color: rgba(var(--primary-glow), 0.3);
}

/* Base styles */
@layer base {
  /* Base styles */
  html {
    font-family: theme('fontFamily.body');
    -webkit-tap-highlight-color: transparent;
    scroll-behavior: smooth;
    scroll-padding-top: var(--header-height);
  }

  /* Theme transition for all elements */
  *, *::before, *::after {
    @apply transition-colors duration-700;
  }

  body {
    @apply bg-white dark:bg-background-950 text-background-900 dark:text-white;
    min-height: 100vh;
    min-height: -webkit-fill-available;
  }

  /* Header height variable */
  :root {
    --header-height: 4rem;
    @screen sm {
      --header-height: 4.5rem;
    }
    @screen lg {
      --header-height: 5rem;
    }
  }

  /* Theme-aware text colors */
  h1, h2, h3, h4, h5, h6 {
    @apply text-primary-500 dark:text-primary-400 font-bold;
  }

  p {
    @apply text-background-900 dark:text-white;
  }

  /* Theme-aware backgrounds */
  .bg-theme {
    @apply bg-white dark:bg-background-950;
  }

  .bg-theme-gradient {
    @apply bg-gradient-to-b from-white to-gray-100 
           dark:from-background-900 dark:to-background-950;
  }

  /* Theme-aware glass effect */
  .glass-effect {
    @apply bg-white/90 dark:bg-background-900/90 backdrop-blur-md
           border border-primary-500/20 dark:border-primary-500/20 
           hover:border-primary-500/40 dark:hover:border-primary-500/40;
  }

  /* Ensure content is pushed down by fixed header */
  main {
    min-height: calc(100vh - var(--header-height));
  }

  /* Override for homepage */
  .homepage-main {
    padding-top: 0;
  }
}

@layer components {
  /* Container and Section Styles */
  .page-container {
    @apply relative min-h-screen w-full 
           bg-gradient-to-b from-sand-50 to-sand-100 
           dark:from-background-900 dark:to-background-950;
  }

  .content-container {
    @apply container mx-auto px-4 sm:px-6 lg:px-8 py-8 
           max-w-7xl space-y-8;
  }

  /* Card and Section Styling */
  .section-container {
    @apply relative overflow-hidden
           rounded-3xl
           bg-gradient-to-br from-white/95 via-white/90 to-white/95
           dark:from-background-900/95 dark:via-background-900/90 dark:to-background-900/95
           shadow-lg hover:shadow-xl
           border border-primary-500/10 dark:border-primary-500/10
           backdrop-blur-md
           transition-all duration-300
           hover:border-primary-500/20;
  }

  .section-inner {
    @apply relative z-10 p-6 sm:p-8;
  }

  .section-background {
    @apply absolute inset-0 z-0
           bg-gradient-to-br from-primary-500/5 to-transparent
           opacity-50;
  }

  /* Glass Effects */
  .glass-panel {
    @apply relative overflow-hidden
           bg-white/80 dark:bg-background-900/80
           backdrop-blur-md
           border border-white/20 dark:border-white/10
           shadow-lg
           transition-all duration-300;
  }

  .glass-panel-hover {
    @apply hover:shadow-xl
           hover:border-primary-500/20 dark:hover:border-primary-500/20
           hover:bg-white/90 dark:hover:bg-background-900/90;
  }

  /* Responsive Text Styles */
  .section-title {
    @apply text-2xl sm:text-3xl lg:text-4xl
           font-bold text-primary-500 dark:text-primary-400
           mb-4 sm:mb-6;
  }

  .section-subtitle {
    @apply text-lg sm:text-xl
           text-sand-700 dark:text-sand-300
           mb-6 sm:mb-8;
  }

  /* Media Queries for Responsive Layout */
  @screen sm {
    .content-container {
      @apply py-12;
    }
  }

  @screen lg {
    .content-container {
      @apply py-16;
    }
  }

  /* Card Styles */
  .card {
    @apply bg-white/90 dark:bg-background-900/90
           border border-primary-500/20 dark:border-primary-600/20
           hover:border-primary-500/40 dark:hover:border-primary-500/40
           rounded-xl shadow-lg shadow-gray-400/10 dark:shadow-black/30
           backdrop-blur-sm
           transition-all duration-300;
  }

  .card-hover {
    @apply hover:shadow-xl hover:shadow-primary-500/10 dark:hover:shadow-primary-500/30
           hover:-translate-y-1
           transition-all duration-300;
  }

  /* Button Styles */
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 
           rounded-lg font-semibold text-white
           bg-primary-500 hover:bg-primary-600 
           dark:bg-primary-600 dark:hover:bg-primary-700
           transition-colors duration-200
           disabled:opacity-50 disabled:cursor-not-allowed
           focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
           dark:focus:ring-primary-400 dark:focus:ring-offset-background-900;
  }

  .btn-secondary {
    @apply bg-gray-500 hover:bg-gray-600 
           dark:bg-gray-600 dark:hover:bg-gray-700
           focus:ring-gray-500 dark:focus:ring-gray-400;
  }

  .btn-outline {
    @apply border-2 border-primary-500 bg-transparent text-primary-500
           hover:bg-primary-500 hover:text-white
           dark:border-primary-400 dark:text-primary-400
           dark:hover:bg-primary-400 dark:hover:text-background-900;
  }

  /* Input Styles */
  .input {
    @apply w-full px-4 py-2 
           bg-white/80 dark:bg-background-800/80
           border border-gray-200 dark:border-background-700
           rounded-lg
           text-background-900 dark:text-white
           placeholder-gray-400 dark:placeholder-background-500
           focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400
           focus:border-transparent
           transition-all duration-300;
  }

  /* Glass Panel Effects */
  .glass-panel {
    @apply relative
           after:absolute after:inset-0 after:rounded-3xl
           after:bg-gradient-to-br after:from-white/5 after:to-white/0
           after:dark:from-primary-500/5 after:dark:to-transparent
           after:opacity-50 after:z-[-1];
  }

  .glass-panel-hover {
    @apply hover:border-primary-500/20 dark:hover:border-primary-500/20
           hover:shadow-primary-500/10 dark:hover:shadow-primary-500/30
           transition-all duration-300;
  }

  /* Scrollbar Styling */
  .custom-scrollbar {
    @apply scrollbar-thin
           scrollbar-track-gray-100 dark:scrollbar-track-background-900
           scrollbar-thumb-primary-500 dark:scrollbar-thumb-primary-600
           scrollbar-thumb-rounded-full
           hover:scrollbar-thumb-primary-600 dark:hover:scrollbar-thumb-primary-500;
  }

  /* Loading Spinner */
  .loading-spinner {
    @apply animate-spin rounded-full 
           border-4 border-primary-500/20 
           border-t-primary-500
           h-8 w-8;
  }

  /* Navigation Links */
  .nav-link {
    @apply text-gray-600 dark:text-gray-300
           hover:text-primary-500 dark:hover:text-primary-400
           transition-colors duration-200;
  }

  .nav-link-active {
    @apply text-primary-500 dark:text-primary-400
           font-semibold;
  }

  /* Container Glow Effect */
  .container-glow {
    @apply animate-[container-glow_4s_ease-in-out_infinite];
  }

  /* Scroll Indicator */
  .scroll-indicator {
    @apply absolute bottom-8 left-1/2 -translate-x-1/2
           text-primary-500 animate-bounce
           transition-all duration-300
           hover:text-primary-400 hover:scale-110
           cursor-pointer;
  }

  .scroll-indicator svg {
    @apply w-6 h-6 drop-shadow-glow;
  }

  /* Drop Shadow Effects */
  .drop-shadow-glow {
    filter: drop-shadow(0 0 8px rgba(var(--primary-glow), 0.5));
  }

  /* Wallet Connection Styles */
  .wallet-connect {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
  }

  .status-message {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
  }

  .status-message.connecting {
    background-color: #3b82f6;
    color: white;
  }

  .status-message.authenticating {
    background-color: #6366f1;
    color: white;
  }

  .status-message.error {
    background-color: #ef4444;
    color: white;
  }

  .status-message.connected {
    background-color: #10b981;
    color: white;
  }

  .retry-button {
    padding: 0.5rem 1rem;
    background-color: #4f46e5;
    color: white;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s ease;
  }

  .retry-button:hover {
    background-color: #4338ca;
  }

  .retry-button:active {
    transform: scale(0.98);
  }

  /* Wallet Button Override Styles */
  .wallet-adapter-button {
    height: 48px !important;
    padding: 0 24px !important;
    font-size: 16px !important;
    font-weight: 500 !important;
    border-radius: 12px !important;
    background-color: #4f46e5 !important;
    color: white !important;
    border: none !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
  }

  .wallet-adapter-button:not([disabled]):hover {
    background-color: #4338ca !important;
  }

  .wallet-adapter-button[disabled] {
    background-color: #6b7280 !important;
    cursor: not-allowed !important;
  }

  .wallet-adapter-button-trigger {
    background-color: #4f46e5 !important;
  }

  /* Wallet Modal Override Styles */
  .wallet-adapter-modal-wrapper {
    background-color: #1f2937 !important;
  }

  .wallet-adapter-modal-button-close {
    background-color: #374151 !important;
  }

  .wallet-adapter-modal-list-more {
    color: #9ca3af !important;
  }

  .wallet-adapter-modal-list {
    margin: 0 0 4px !important;
  }

  .wallet-adapter-modal-list li:not(:first-of-type) {
    margin-top: 4px !important;
  }
}

@layer utilities {
  /* Safe Area Insets */
  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }

  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* Text Effects */
  .text-gradient {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-primary-500 to-primary-600;
  }

  .text-shadow {
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .text-shadow-lg {
    text-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
}

/* Animation Keyframes */
@keyframes container-glow {
  0%, 100% {
    box-shadow: 0 0 15px -3px rgba(var(--primary-glow), 0.3);
    border-color: rgba(var(--primary-glow), 0.2);
  }
  50% {
    box-shadow: 0 0 30px -3px rgba(var(--primary-glow), 0.4);
    border-color: rgba(var(--primary-glow), 0.4);
  }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@keyframes slowBounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

================
File: src/lib/supabase.ts
================
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = 'https://prwzpyrplldwpsydmxkb.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByd3pweXJwbGxkd3BzeWRteGtiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIxNDAzNTgsImV4cCI6MjA0NzcxNjM1OH0.RK-0gSUcBBqJ-ep7Ti_wttEUnQImbFt7AJJSNfwpMao'

export const supabase = createClient(supabaseUrl, supabaseKey)

================
File: src/lib/utils.ts
================
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

================
File: src/main.tsx
================
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { App } from './App';
import './index.css';

const container = document.getElementById('root');
if (!container) throw new Error('Failed to find the root element');

const root = createRoot(container);

root.render(
  <StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </StrictMode>
);

================
File: src/schemas/guild.ts
================
import { Timestamp } from 'firebase/firestore';

export interface Guild {
  id: string;
  name: string;
  description: string;
  imageUrl?: string;
  members: string[];
  leaders: string[];
  totalXp: number;
  dateCreated: Timestamp;
  archetype: GuildArchetype;
  isCore: boolean;
  isDeleted?: boolean;
  bank?: GuildBank;
  questLimits?: {
    daily: number;
    weekly: number;
    monthly: number;
  };
  membershipRequests?: GuildMembershipRequest[];
  lastUpdated: Timestamp;
}

export interface GuildBank {
  address: string;
  balance: number;
  weeklyReward: number;
  lastRewardDate: Timestamp;
  transactions: GuildTransaction[];
}

export interface GuildTransaction {
  id: string;
  type: 'deposit' | 'withdraw' | 'reward';
  amount: number;
  wallet: string;
  timestamp: Timestamp;
  signature: string;
}

export interface GuildMembershipRequest {
  wallet: string;
  message: string;
  timestamp: Timestamp;
  status: 'pending' | 'approved' | 'rejected';
  reviewedBy?: string;
  reviewedAt?: Timestamp;
}

================
File: src/schemas/index.ts
================
export * from './user';
export * from './quest';
export * from './guild';
export * from './raid';
export * from './leaderboard';
export * from './settings';

================
File: src/schemas/leaderboard.ts
================
import { Timestamp } from 'firebase/firestore';

export interface Leaderboard {
  id: string;
  type: 'daily' | 'weekly' | 'monthly' | 'all-time';
  category: 'xp' | 'quests' | 'raids';
  entries: LeaderboardEntry[];
  lastUpdated: Timestamp;
  nextUpdate: Timestamp;
}

export interface LeaderboardEntry {
  rank: number;
  wallet: string;
  username: string | null;
  profilePicture: string | null;
  score: number;
  guild: string | null;
  archetype: string | null;
  timestamp: Timestamp;
}

export interface LeaderboardSnapshot {
  id: string;
  leaderboardId: string;
  entries: LeaderboardEntry[];
  timestamp: Timestamp;
  type: 'daily' | 'weekly' | 'monthly';
}

================
File: src/schemas/quest.ts
================
import { Timestamp } from 'firebase/firestore';

export interface Quest {
  id: string;
  type: 'daily' | 'weekly' | 'monthly' | 'raid-boss';
  title: string;
  description: string;
  xpReward: number;
  dateCreated: Timestamp;
  dateAvailable: Timestamp;
  dateExpires: Timestamp;
  status: 'available' | 'completed' | 'expired';
  completedBy: string[];
  isAutomatic?: boolean;
  imageUrl?: string;
  questUrl?: string;
  requirements?: {
    level?: number;
    guild?: string;
    archetype?: string;
  };
}

export interface QuestSubmission {
  questId: string;
  wallet: string;
  timestamp: Timestamp;
  screenshot?: string;
  url: string;
  status: 'pending' | 'approved' | 'rejected';
  reviewedBy?: string;
  reviewedAt?: Timestamp;
  rewardClaimed: boolean;
  claimedAt?: Timestamp;
}

================
File: src/schemas/raid.ts
================
import { Timestamp } from 'firebase/firestore';

export interface Raid {
  id: string;
  boss: RaidBoss;
  participants: RaidParticipant[];
  startTime: Timestamp;
  endTime: Timestamp;
  status: 'preparing' | 'active' | 'completed' | 'failed';
  questCompletions: number;
  rewards: {
    xp: number;
    bonusXp: number;
    items?: string[];
  };
  lastUpdated: Timestamp;
}

export interface RaidBoss {
  id: string;
  name: string;
  level: number;
  health: number;
  maxHealth: number;
  defense: number;
  imageUrl: string;
  twitterHandle: string;
  description: string;
  quests: RaidQuest[];
}

export interface RaidQuest {
  id: string;
  description: string;
  xpReward: number;
  completedBy: string[];
  requirements?: {
    level?: number;
    guild?: string;
    archetype?: string;
  };
}

export interface RaidParticipant {
  wallet: string;
  nftId: string;
  questsCompleted: number;
  lastQuestCompletionTime: Timestamp;
  joinedAt: Timestamp;
  status: 'active' | 'inactive';
}

================
File: src/schemas/settings.ts
================
import { Timestamp } from 'firebase/firestore';

export interface SystemSettings {
  maintenance: {
    enabled: boolean;
    message: string;
    startTime?: Timestamp;
    endTime?: Timestamp;
  };
  features: {
    raids: boolean;
    quests: boolean;
    guilds: boolean;
    trading: boolean;
  };
  limits: {
    maxPlayersPerGuild: number;
    maxQuestsPerDay: number;
    maxRaidsPerDay: number;
    maxItemsPerInventory: number;
  };
  rewards: {
    questXp: {
      daily: number;
      weekly: number;
      monthly: number;
    };
    raidXp: {
      completion: number;
      bonus: number;
    };
  };
  version: string;
  lastUpdated: Timestamp;
}

================
File: src/schemas/user.ts
================
import { Timestamp } from 'firebase/firestore';

export interface UserProfile {
  wallet: string;            // Primary key (wallet address or session key)
  username: string | null;   // Optional username
  handle: string | null;     // Social media handle
  profilePicture: string | null;
  experience: number;
  dateJoined: number;
  questsCompleted: number;
  raidBossesDefeated: number;
  lastQuestCompletionTime: number;
  showWallet: boolean;
  guild: string | null;      // Guild ID
  archetype: string | null;  // Player archetype
  discordHandle: string | null;
  sessionKey?: string;       // For guest accounts
  lastUpdated: Timestamp;
}

export interface UserStats {
  dailyXP: number;
  weeklyXP: number;
  monthlyXP: number;
  questsCompletedToday: number;
  questsCompletedWeek: number;
  questsCompletedMonth: number;
  lastQuestReset: Timestamp;
  lastWeeklyReset: Timestamp;
  lastMonthlyReset: Timestamp;
}

export interface UserInventory {
  nftMint: string;          // NFT mint address
  equipped: boolean;
  dateAcquired: Timestamp;
  metadata: {
    name: string;
    image: string;
    attributes: Array<{
      trait_type: string;
      value: string;
    }>;
  };
}

================
File: src/scripts/migrateToSupabase.ts
================
import { supabase } from '../lib/supabase';
import type { Player } from '../types/player';
import type { RaidState } from '../types/raid';

export async function migrateData() {
  console.log('Starting data migration to Supabase...');
  
  try {
    // Migrate Players
    const playersData = localStorage.getItem('players_v1');
    if (playersData) {
      const players = Object.values(JSON.parse(playersData)) as Player[];
      console.log(`Found ${players.length} players to migrate`);
      
      for (const player of players) {
        const { data, error } = await supabase
          .from('players')
          .insert({
            wallet: player.wallet,
            username: player.username,
            handle: player.handle,
            profile_picture: player.profilePicture,
            experience: player.experience,
            date_joined: new Date(player.dateJoined).toISOString(),
            quests_completed: player.questsCompleted,
            raid_bosses_defeated: player.raidBossesDefeated,
            last_quest_completion_time: new Date(player.lastQuestCompletionTime).toISOString(),
            show_wallet: player.showWallet,
            guild: player.guild,
            archetype: player.archetype,
            discord_handle: player.discordHandle
          })
          .select()
          .single();

        if (error) {
          console.error(`Failed to migrate player ${player.wallet}:`, error);
        } else {
          console.log(`Migrated player ${player.wallet}`);
        }
      }
    }

    // Migrate Raids
    const raidsData = localStorage.getItem('raids');
    if (raidsData) {
      const raids = Object.values(JSON.parse(raidsData)) as RaidState[];
      console.log(`Found ${raids.length} raids to migrate`);

      for (const raid of raids) {
        // Create raid entry
        const { data: raidData, error: raidError } = await supabase
          .from('raids')
          .insert({
            id: raid.id,
            boss_name: raid.boss.name,
            boss_health: raid.boss.health,
            boss_max_health: raid.boss.maxHealth,
            boss_defense: raid.boss.defense,
            state: raid.state,
            start_time: new Date(raid.startTime).toISOString(),
            end_time: raid.endTime ? new Date(raid.endTime).toISOString() : null
          })
          .select()
          .single();

        if (raidError) {
          console.error(`Failed to migrate raid ${raid.id}:`, raidError);
          continue;
        }

        // Migrate participants
        for (const participant of raid.participants) {
          const { error: participantError } = await supabase
            .from('raid_participants')
            .insert({
              raid_id: raid.id,
              player_id: participant.playerId,
              join_time: new Date(participant.joinTime).toISOString(),
              contribution: participant.contribution
            });

          if (participantError) {
            console.error(`Failed to migrate participant for raid ${raid.id}:`, participantError);
          }
        }

        // Migrate quest submissions
        for (const quest of raid.boss.quests) {
          for (const playerId of quest.completedBy) {
            const { error: questError } = await supabase
              .from('quest_submissions')
              .insert({
                raid_id: raid.id,
                player_id: playerId,
                quest_type: quest.type,
                submission_time: new Date().toISOString(),
                verified: true
              });

            if (questError) {
              console.error(`Failed to migrate quest submission for raid ${raid.id}:`, questError);
            }
          }
        }

        console.log(`Migrated raid ${raid.id} with participants and quests`);
      }
    }

    console.log('Migration completed successfully!');
    return true;
  } catch (error) {
    console.error('Migration failed:', error);
    return false;
  }
}

// Helper function to clear localStorage after successful migration
export function clearLocalStorage() {
  localStorage.removeItem('players_v1');
  localStorage.removeItem('raids');
  console.log('Cleared localStorage data');
}

================
File: src/scripts/runMigration.ts
================
import { migrateData, clearLocalStorage } from './migrateToSupabase';

async function runMigration() {
  console.log('Starting migration process...');
  
  try {
    const success = await migrateData();
    
    if (success) {
      console.log('Migration completed successfully!');
      console.log('Clearing localStorage...');
      clearLocalStorage();
      console.log('Migration process finished.');
    } else {
      console.error('Migration failed. Please check the logs for details.');
    }
  } catch (error) {
    console.error('Migration failed with error:', error);
  }
}

runMigration();

================
File: src/services/compression.ts
================
import * as snappy from 'snappy';
import { encode as encodeBase64, decode as decodeBase64 } from 'base64-arraybuffer';

export const compressData = async (data: any): Promise<string> => {
  try {
    const jsonString = JSON.stringify(data);
    const buffer = Buffer.from(jsonString);
    const compressed = await snappy.compress(buffer);
    return encodeBase64(compressed);
  } catch (error) {
    console.error('Compression failed:', error);
    throw error;
  }
};

export const decompressData = async (compressed: string): Promise<any> => {
  try {
    const buffer = Buffer.from(decodeBase64(compressed));
    const decompressed = await snappy.uncompress(buffer);
    const jsonString = decompressed.toString();
    return JSON.parse(jsonString);
  } catch (error) {
    console.error('Decompression failed:', error);
    throw error;
  }
};

================
File: src/services/crypto.ts
================
import * as tweetnacl from 'tweetnacl';
import { encode as encodeBase58, decode as decodeBase58 } from 'bs58';

export const generateSessionKey = () => {
  const keyPair = tweetnacl.sign.keyPair();
  return {
    publicKey: encodeBase58(keyPair.publicKey),
    privateKey: encodeBase58(keyPair.secretKey)
  };
};

export const signMessage = (message: string, privateKey: string) => {
  const messageBytes = new TextEncoder().encode(message);
  const secretKeyBytes = decodeBase58(privateKey);
  const signature = tweetnacl.sign.detached(messageBytes, secretKeyBytes);
  return encodeBase58(signature);
};

export const verifySignature = (
  message: string,
  signature: string,
  publicKey: string
) => {
  const messageBytes = new TextEncoder().encode(message);
  const signatureBytes = decodeBase58(signature);
  const publicKeyBytes = decodeBase58(publicKey);
  return tweetnacl.sign.detached.verify(messageBytes, signatureBytes, publicKeyBytes);
};

================
File: src/services/database/BatchProcessor.ts
================
import { 
  writeBatch, 
  DocumentReference,
  DocumentData,
  Firestore
} from 'firebase/firestore';
import { db } from '../../config/database';
import { batchSize } from '../../config/database';

export class BatchProcessor {
  private static instance: BatchProcessor;
  private db: Firestore;
  private pendingOperations: Array<{
    type: 'set' | 'update' | 'delete';
    ref: DocumentReference;
    data?: DocumentData;
  }>;

  private constructor() {
    this.db = db;
    this.pendingOperations = [];
  }

  static getInstance(): BatchProcessor {
    if (!BatchProcessor.instance) {
      BatchProcessor.instance = new BatchProcessor();
    }
    return BatchProcessor.instance;
  }

  addOperation(
    type: 'set' | 'update' | 'delete',
    ref: DocumentReference,
    data?: DocumentData
  ): void {
    this.pendingOperations.push({ type, ref, data });

    if (this.pendingOperations.length >= batchSize.WRITE) {
      this.processBatch();
    }
  }

  async processBatch(): Promise<void> {
    if (this.pendingOperations.length === 0) return;

    const batches = [];
    let currentBatch = writeBatch(this.db);
    let operationCount = 0;

    for (const op of this.pendingOperations) {
      switch (op.type) {
        case 'set':
          currentBatch.set(op.ref, op.data!);
          break;
        case 'update':
          currentBatch.update(op.ref, op.data!);
          break;
        case 'delete':
          currentBatch.delete(op.ref);
          break;
      }

      operationCount++;

      if (operationCount === batchSize.WRITE) {
        batches.push(currentBatch);
        currentBatch = writeBatch(this.db);
        operationCount = 0;
      }
    }

    if (operationCount > 0) {
      batches.push(currentBatch);
    }

    try {
      await Promise.all(batches.map(batch => batch.commit()));
      this.pendingOperations = [];
    } catch (error) {
      console.error('Failed to process batch operations:', error);
      throw error;
    }
  }

  async flush(): Promise<void> {
    await this.processBatch();
  }

  clear(): void {
    this.pendingOperations = [];
  }
}

================
File: src/services/database/CacheManager.ts
================
import { Cache } from '../../utils/cache';
import { cacheDuration } from '../../config/database';

export class CacheManager {
  private static instance: CacheManager;
  private cache: Cache;
  private keyPrefix: string = 'db:';

  private constructor() {
    this.cache = Cache.getInstance();
  }

  static getInstance(): CacheManager {
    if (!CacheManager.instance) {
      CacheManager.instance = new CacheManager();
    }
    return CacheManager.instance;
  }

  get<T>(key: string): T | null {
    return this.cache.get<T>(`${this.keyPrefix}${key}`);
  }

  set<T>(key: string, value: T, duration: number = cacheDuration.SHORT): void {
    this.cache.set(`${this.keyPrefix}${key}`, value, duration);
  }

  delete(key: string): void {
    this.cache.delete(`${this.keyPrefix}${key}`);
  }

  clear(): void {
    this.cache.clear();
  }

  clearPattern(pattern: string): void {
    const prefix = `${this.keyPrefix}${pattern}`;
    this.cache.clearPattern(prefix);
  }

  setWithTags<T>(key: string, value: T, tags: string[], duration: number = cacheDuration.SHORT): void {
    this.set(key, value, duration);
    tags.forEach(tag => {
      const taggedKeys = this.get<string[]>(`tag:${tag}`) || [];
      if (!taggedKeys.includes(key)) {
        taggedKeys.push(key);
        this.set(`tag:${tag}`, taggedKeys, cacheDuration.LONG);
      }
    });
  }

  invalidateTag(tag: string): void {
    const taggedKeys = this.get<string[]>(`tag:${tag}`);
    if (taggedKeys) {
      taggedKeys.forEach(key => this.delete(key));
      this.delete(`tag:${tag}`);
    }
  }
}

================
File: src/services/database/DatabaseService.ts
================
import { 
  collection,
  doc,
  getDoc,
  getDocs,
  setDoc,
  updateDoc,
  deleteDoc,
  DocumentReference,
  DocumentData,
  QuerySnapshot
} from 'firebase/firestore';
import { db } from '../../config/database';
import { BatchProcessor } from './BatchProcessor';
import { QueryBuilder } from './QueryBuilder';
import { CacheManager } from './CacheManager';

export class DatabaseService<T extends DocumentData = DocumentData> {
  protected collectionName: string;
  protected batchProcessor: BatchProcessor;
  protected cache: CacheManager;

  constructor(collectionName: string) {
    this.collectionName = collectionName;
    this.batchProcessor = BatchProcessor.getInstance();
    this.cache = CacheManager.getInstance();
  }

  protected getRef(id: string): DocumentReference<T> {
    return doc(db, this.collectionName, id) as DocumentReference<T>;
  }

  protected createQueryBuilder(): QueryBuilder<T> {
    return new QueryBuilder<T>(collection(db, this.collectionName));
  }

  async get(id: string): Promise<T | null> {
    // Check cache first
    const cached = this.cache.get<T>(id);
    if (cached) return cached;

    try {
      const docSnap = await getDoc(this.getRef(id));
      if (!docSnap.exists()) return null;

      const data = docSnap.data();
      this.cache.set(id, data);
      return data;
    } catch (error) {
      console.error(`Failed to get document ${id}:`, error);
      return null;
    }
  }

  async set(id: string, data: T): Promise<boolean> {
    try {
      await setDoc(this.getRef(id), data);
      this.cache.set(id, data);
      return true;
    } catch (error) {
      console.error(`Failed to set document ${id}:`, error);
      return false;
    }
  }

  async update(id: string, updates: Partial<T>): Promise<boolean> {
    try {
      await updateDoc(this.getRef(id), updates);
      this.cache.delete(id);
      return true;
    } catch (error) {
      console.error(`Failed to update document ${id}:`, error);
      return false;
    }
  }

  async delete(id: string): Promise<boolean> {
    try {
      await deleteDoc(this.getRef(id));
      this.cache.delete(id);
      return true;
    } catch (error) {
      console.error(`Failed to delete document ${id}:`, error);
      return false;
    }
  }

  async batchSet(items: { id: string; data: T }[]): Promise<boolean> {
    try {
      items.forEach(({ id, data }) => {
        this.batchProcessor.addOperation('set', this.getRef(id), data);
      });
      await this.batchProcessor.processBatch();
      return true;
    } catch (error) {
      console.error('Failed to batch set documents:', error);
      return false;
    }
  }

  async batchUpdate(items: { id: string; updates: Partial<T> }[]): Promise<boolean> {
    try {
      items.forEach(({ id, updates }) => {
        this.batchProcessor.addOperation('update', this.getRef(id), updates);
      });
      await this.batchProcessor.processBatch();
      return true;
    } catch (error) {
      console.error('Failed to batch update documents:', error);
      return false;
    }
  }

  async batchDelete(ids: string[]): Promise<boolean> {
    try {
      ids.forEach(id => {
        this.batchProcessor.addOperation('delete', this.getRef(id));
      });
      await this.batchProcessor.processBatch();
      return true;
    } catch (error) {
      console.error('Failed to batch delete documents:', error);
      return false;
    }
  }

  protected async executeQuery(query: QueryBuilder<T>): Promise<QuerySnapshot<T>> {
    try {
      return await getDocs(query.build());
    } catch (error) {
      console.error('Failed to execute query:', error);
      throw error;
    }
  }
}

================
File: src/services/database/GuildService.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs } from 'firebase/firestore';
import { db } from '../firebase';
import { Guild } from '../../types/guild';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';
import { BatchProcessor } from './BatchProcessor';

export class GuildService {
  private static instance: GuildService;
  private cache: Cache;
  private batchProcessor: BatchProcessor;

  private constructor() {
    this.cache = Cache.getInstance();
    this.batchProcessor = BatchProcessor.getInstance();
  }

  static getInstance(): GuildService {
    if (!GuildService.instance) {
      GuildService.instance = new GuildService();
    }
    return GuildService.instance;
  }

  async getGuild(guildId: string): Promise<Guild | null> {
    const cacheKey = `guild:${guildId}`;
    const cached = this.cache.get<Guild>(cacheKey);
    if (cached) return cached;

    try {
      const docRef = doc(db, 'guilds', guildId);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as Guild;
        this.cache.set(cacheKey, data, CACHE_DURATION.guild.info);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get guild:', error);
      return null;
    }
  }

  async addMember(guildId: string, wallet: string): Promise<boolean> {
    try {
      const guild = await this.getGuild(guildId);
      if (!guild) return false;

      const members = new Set(guild.members);
      if (members.has(wallet)) return false;

      members.add(wallet);

      await this.batchProcessor.addOperation('update', doc(db, 'guilds', guildId), {
        members: Array.from(members)
      });

      // Update user's guild
      await this.batchProcessor.addOperation('update', doc(db, 'users', wallet), {
        guild: guildId
      });

      await this.batchProcessor.processBatch();
      this.cache.delete(`guild:${guildId}`);
      this.cache.delete(`user:${wallet}`);

      return true;
    } catch (error) {
      console.error('Failed to add member to guild:', error);
      return false;
    }
  }

  async removeMember(guildId: string, wallet: string): Promise<boolean> {
    try {
      const guild = await this.getGuild(guildId);
      if (!guild) return false;

      const members = new Set(guild.members);
      if (!members.has(wallet)) return false;

      members.delete(wallet);

      await this.batchProcessor.addOperation('update', doc(db, 'guilds', guildId), {
        members: Array.from(members)
      });

      // Update user's guild
      await this.batchProcessor.addOperation('update', doc(db, 'users', wallet), {
        guild: null
      });

      await this.batchProcessor.processBatch();
      this.cache.delete(`guild:${guildId}`);
      this.cache.delete(`user:${wallet}`);

      return true;
    } catch (error) {
      console.error('Failed to remove member from guild:', error);
      return false;
    }
  }

  async updateGuildXP(guildId: string, xpChange: number): Promise<boolean> {
    try {
      await updateDoc(doc(db, 'guilds', guildId), {
        totalXp: increment(xpChange)
      });
      this.cache.delete(`guild:${guildId}`);
      return true;
    } catch (error) {
      console.error('Failed to update guild XP:', error);
      return false;
    }
  }

  async batchUpdateGuilds(updates: { guildId: string; updates: Partial<Guild> }[]): Promise<boolean> {
    try {
      updates.forEach(({ guildId, updates }) => {
        const ref = doc(db, 'guilds', guildId);
        this.batchProcessor.addOperation('update', ref, updates);
        this.cache.delete(`guild:${guildId}`);
      });

      await this.batchProcessor.processBatch();
      return true;
    } catch (error) {
      console.error('Failed to batch update guilds:', error);
      return false;
    }
  }
}

================
File: src/services/database/QueryBuilder.ts
================
import {
  query,
  where,
  orderBy,
  limit,
  startAfter,
  QueryConstraint,
  CollectionReference,
  Query,
  DocumentData
} from 'firebase/firestore';
import { batchSize } from '../../config/database';

export class QueryBuilder<T = DocumentData> {
  private constraints: QueryConstraint[] = [];
  private collection: CollectionReference;

  constructor(collection: CollectionReference) {
    this.collection = collection;
  }

  where(field: string, operator: '<' | '<=' | '==' | '>=' | '>' | '!=', value: any): this {
    this.constraints.push(where(field, operator, value));
    return this;
  }

  orderBy(field: string, direction: 'asc' | 'desc' = 'asc'): this {
    this.constraints.push(orderBy(field, direction));
    return this;
  }

  limitTo(n: number = batchSize.QUERY): this {
    this.constraints.push(limit(n));
    return this;
  }

  startAfter(doc: any): this {
    this.constraints.push(startAfter(doc));
    return this;
  }

  build(): Query<T> {
    return query(this.collection, ...this.constraints) as Query<T>;
  }

  reset(): this {
    this.constraints = [];
    return this;
  }
}

================
File: src/services/database/QuestService.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs, Timestamp } from 'firebase/firestore';
import { db } from '../firebase';
import { Quest, QuestSubmission } from '../../types/quest';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';
import { BatchProcessor } from './BatchProcessor';

export class QuestService {
  private static instance: QuestService;
  private cache: Cache;
  private batchProcessor: BatchProcessor;

  private constructor() {
    this.cache = Cache.getInstance();
    this.batchProcessor = BatchProcessor.getInstance();
  }

  static getInstance(): QuestService {
    if (!QuestService.instance) {
      QuestService.instance = new QuestService();
    }
    return QuestService.instance;
  }

  async getQuest(questId: string): Promise<Quest | null> {
    const cacheKey = `quest:${questId}`;
    const cached = this.cache.get<Quest>(cacheKey);
    if (cached) return cached;

    try {
      const docRef = doc(db, 'quests', questId);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as Quest;
        this.cache.set(cacheKey, data, CACHE_DURATION.player.profile);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get quest:', error);
      return null;
    }
  }

  async getActiveQuests(type: 'daily' | 'weekly' | 'monthly'): Promise<Quest[]> {
    const cacheKey = `quests:${type}:active`;
    const cached = this.cache.get<Quest[]>(cacheKey);
    if (cached) return cached;

    try {
      const now = Timestamp.now();
      const questsQuery = query(
        collection(db, 'quests'),
        where('type', '==', type),
        where('status', '==', 'available'),
        where('dateExpires', '>', now)
      );
      
      const querySnapshot = await getDocs(questsQuery);
      const quests = querySnapshot.docs.map(doc => doc.data() as Quest);
      
      this.cache.set(cacheKey, quests, CACHE_DURATION.player.profile);
      return quests;
    } catch (error) {
      console.error('Failed to get active quests:', error);
      return [];
    }
  }

  async completeQuest(questId: string, wallet: string): Promise<boolean> {
    try {
      const quest = await this.getQuest(questId);
      if (!quest) return false;

      const completedBy = new Set(quest.completedBy || []);
      if (completedBy.has(wallet)) return false;

      completedBy.add(wallet);

      await this.batchProcessor.addOperation('update', doc(db, 'quests', questId), {
        completedBy: Array.from(completedBy)
      });

      // Update user stats
      await this.batchProcessor.addOperation('update', doc(db, 'users', wallet), {
        questsCompleted: increment(1),
        experience: increment(quest.xpReward),
        lastQuestCompletionTime: Timestamp.now()
      });

      await this.batchProcessor.processBatch();
      this.cache.delete(`quest:${questId}`);
      this.cache.delete(`user:${wallet}`);

      return true;
    } catch (error) {
      console.error('Failed to complete quest:', error);
      return false;
    }
  }

  async batchUpdateQuests(updates: { questId: string; updates: Partial<Quest> }[]): Promise<boolean> {
    try {
      updates.forEach(({ questId, updates }) => {
        const ref = doc(db, 'quests', questId);
        this.batchProcessor.addOperation('update', ref, updates);
        this.cache.delete(`quest:${questId}`);
      });

      await this.batchProcessor.processBatch();
      return true;
    } catch (error) {
      console.error('Failed to batch update quests:', error);
      return false;
    }
  }
}

================
File: src/services/database/UserService.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs } from 'firebase/firestore';
import { db } from '../firebase';
import { User } from '../../types/user';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';
import { BatchProcessor } from './BatchProcessor';

export class UserService {
  private static instance: UserService;
  private cache: Cache;
  private batchProcessor: BatchProcessor;

  private constructor() {
    this.cache = Cache.getInstance();
    this.batchProcessor = BatchProcessor.getInstance();
  }

  static getInstance(): UserService {
    if (!UserService.instance) {
      UserService.instance = new UserService();
    }
    return UserService.instance;
  }

  async getUser(wallet: string): Promise<User | null> {
    const cacheKey = `user:${wallet}`;
    const cached = this.cache.get<User>(cacheKey);
    if (cached) return cached;

    try {
      const docRef = doc(db, 'users', wallet);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as User;
        this.cache.set(cacheKey, data, CACHE_DURATION.player.profile);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get user:', error);
      return null;
    }
  }

  async createUser(user: User): Promise<boolean> {
    try {
      await setDoc(doc(db, 'users', user.wallet), user);
      this.cache.set(`user:${user.wallet}`, user, CACHE_DURATION.player.profile);
      return true;
    } catch (error) {
      console.error('Failed to create user:', error);
      return false;
    }
  }

  async updateUser(wallet: string, updates: Partial<User>): Promise<boolean> {
    try {
      await updateDoc(doc(db, 'users', wallet), updates);
      this.cache.delete(`user:${wallet}`);
      return true;
    } catch (error) {
      console.error('Failed to update user:', error);
      return false;
    }
  }

  async addToInventory(wallet: string, nftMint: string): Promise<boolean> {
    try {
      const user = await this.getUser(wallet);
      if (!user) return false;

      const inventory = new Set(user.inventory || []);
      inventory.add(nftMint);

      await this.updateUser(wallet, {
        inventory: Array.from(inventory)
      });

      return true;
    } catch (error) {
      console.error('Failed to add to inventory:', error);
      return false;
    }
  }

  async removeFromInventory(wallet: string, nftMint: string): Promise<boolean> {
    try {
      const user = await this.getUser(wallet);
      if (!user) return false;

      const inventory = new Set(user.inventory || []);
      inventory.delete(nftMint);

      await this.updateUser(wallet, {
        inventory: Array.from(inventory)
      });

      return true;
    } catch (error) {
      console.error('Failed to remove from inventory:', error);
      return false;
    }
  }

  async batchUpdateUsers(updates: { wallet: string; updates: Partial<User> }[]): Promise<boolean> {
    try {
      updates.forEach(({ wallet, updates }) => {
        const ref = doc(db, 'users', wallet);
        this.batchProcessor.addOperation('update', ref, updates);
        this.cache.delete(`user:${wallet}`);
      });

      await this.batchProcessor.processBatch();
      return true;
    } catch (error) {
      console.error('Failed to batch update users:', error);
      return false;
    }
  }

  async searchUsers(query: string, limit: number = 10): Promise<User[]> {
    try {
      const q = query.toLowerCase();
      const usersQuery = query(
        collection(db, 'users'),
        where('username', '>=', q),
        where('username', '<=', q + '\uf8ff')
      );
      
      const querySnapshot = await getDocs(usersQuery);
      return querySnapshot.docs
        .map(doc => doc.data() as User)
        .slice(0, limit);
    } catch (error) {
      console.error('Failed to search users:', error);
      return [];
    }
  }
}

================
File: src/services/db/guildDB.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs } from 'firebase/firestore';
import { db } from '../firebase';
import { Guild, GuildMembershipRequest } from '../../schemas/guild';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';

const cache = Cache.getInstance();
const GUILDS_COLLECTION = 'guilds';

export const guildDB = {
  async getGuild(guildId: string): Promise<Guild | null> {
    const cached = cache.get<Guild>(`guild:${guildId}`);
    if (cached) return cached;

    try {
      const docRef = doc(db, GUILDS_COLLECTION, guildId);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as Guild;
        cache.set(`guild:${guildId}`, data, CACHE_DURATION.guild.info);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get guild:', error);
      return null;
    }
  },

  async createGuild(guild: Guild): Promise<boolean> {
    try {
      await setDoc(doc(db, GUILDS_COLLECTION, guild.id), guild);
      cache.set(`guild:${guild.id}`, guild, CACHE_DURATION.guild.info);
      return true;
    } catch (error) {
      console.error('Failed to create guild:', error);
      return false;
    }
  },

  async updateGuild(guildId: string, updates: Partial<Guild>): Promise<boolean> {
    try {
      await updateDoc(doc(db, GUILDS_COLLECTION, guildId), updates);
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to update guild:', error);
      return false;
    }
  },

  async getGuildsByArchetype(archetype: string): Promise<Guild[]> {
    const cacheKey = `guilds:archetype:${archetype}`;
    const cached = cache.get<Guild[]>(cacheKey);
    if (cached) return cached;

    try {
      const guildsQuery = query(
        collection(db, GUILDS_COLLECTION),
        where('archetype', '==', archetype),
        where('isDeleted', '==', false)
      );
      
      const querySnapshot = await getDocs(guildsQuery);
      const guilds = querySnapshot.docs.map(doc => doc.data() as Guild);
      
      cache.set(cacheKey, guilds, CACHE_DURATION.guild.info);
      return guilds;
    } catch (error) {
      console.error('Failed to get guilds by archetype:', error);
      return [];
    }
  },

  async getGuildMembers(guildId: string): Promise<string[]> {
    const cached = cache.get<string[]>(`guild:${guildId}:members`);
    if (cached) return cached;

    try {
      const guildDoc = await getDoc(doc(db, GUILDS_COLLECTION, guildId));
      if (!guildDoc.exists()) return [];
      
      const members = guildDoc.data().members || [];
      cache.set(`guild:${guildId}:members`, members, CACHE_DURATION.guild.members);
      return members;
    } catch (error) {
      console.error('Failed to get guild members:', error);
      return [];
    }
  },

  async submitMembershipRequest(
    guildId: string,
    request: GuildMembershipRequest
  ): Promise<boolean> {
    try {
      const requestDoc = doc(
        db,
        GUILDS_COLLECTION,
        guildId,
        'membershipRequests',
        request.wallet
      );
      
      await setDoc(requestDoc, request);
      return true;
    } catch (error) {
      console.error('Failed to submit membership request:', error);
      return false;
    }
  },

  async getMembershipRequests(guildId: string): Promise<GuildMembershipRequest[]> {
    try {
      const requestsQuery = query(
        collection(db, GUILDS_COLLECTION, guildId, 'membershipRequests'),
        where('status', '==', 'pending')
      );
      
      const querySnapshot = await getDocs(requestsQuery);
      return querySnapshot.docs.map(doc => doc.data() as GuildMembershipRequest);
    } catch (error) {
      console.error('Failed to get membership requests:', error);
      return [];
    }
  },

  async updateMembershipRequest(
    guildId: string,
    wallet: string,
    updates: Partial<GuildMembershipRequest>
  ): Promise<boolean> {
    try {
      await updateDoc(
        doc(db, GUILDS_COLLECTION, guildId, 'membershipRequests', wallet),
        updates
      );
      return true;
    } catch (error) {
      console.error('Failed to update membership request:', error);
      return false;
    }
  }
};

================
File: src/services/db/index.ts
================
export * from './userDB';
export * from './questDB';
export * from './guildDB';

================
File: src/services/db/leaderboardDB.ts
================
import { doc, getDoc, setDoc, query, collection, where, getDocs, orderBy, limit } from 'firebase/firestore';
import { db } from '../firebase';
import { Leaderboard, LeaderboardEntry } from '../../schemas/leaderboard';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';

const cache = Cache.getInstance();
const LEADERBOARDS_COLLECTION = 'leaderboards';

export const leaderboardDB = {
  async getLeaderboard(
    type: 'daily' | 'weekly' | 'monthly' | 'all-time',
    category: 'xp' | 'quests' | 'raids'
  ): Promise<Leaderboard | null> {
    const cacheKey = `leaderboard:${type}:${category}`;
    const cached = cache.get<Leaderboard>(cacheKey);
    if (cached) return cached;

    try {
      const docRef = doc(db, LEADERBOARDS_COLLECTION, `${type}_${category}`);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as Leaderboard;
        cache.set(cacheKey, data, CACHE_DURATION.player.leaderboard);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get leaderboard:', error);
      return null;
    }
  },

  async updateLeaderboard(leaderboard: Leaderboard): Promise<boolean> {
    try {
      await setDoc(
        doc(db, LEADERBOARDS_COLLECTION, `${leaderboard.type}_${leaderboard.category}`),
        leaderboard
      );
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to update leaderboard:', error);
      return false;
    }
  },

  async getTopPlayers(
    type: 'daily' | 'weekly' | 'monthly' | 'all-time',
    category: 'xp' | 'quests' | 'raids',
    count: number = 100
  ): Promise<LeaderboardEntry[]> {
    const cacheKey = `leaderboard:${type}:${category}:top${count}`;
    const cached = cache.get<LeaderboardEntry[]>(cacheKey);
    if (cached) return cached;

    try {
      const entriesQuery = query(
        collection(db, LEADERBOARDS_COLLECTION, `${type}_${category}`, 'entries'),
        orderBy('score', 'desc'),
        limit(count)
      );
      
      const querySnapshot = await getDocs(entriesQuery);
      const entries = querySnapshot.docs.map(doc => doc.data() as LeaderboardEntry);
      
      cache.set(cacheKey, entries, CACHE_DURATION.player.leaderboard);
      return entries;
    } catch (error) {
      console.error('Failed to get top players:', error);
      return [];
    }
  },

  async getPlayerRank(
    type: 'daily' | 'weekly' | 'monthly' | 'all-time',
    category: 'xp' | 'quests' | 'raids',
    wallet: string
  ): Promise<number> {
    try {
      const entriesQuery = query(
        collection(db, LEADERBOARDS_COLLECTION, `${type}_${category}`, 'entries'),
        where('wallet', '==', wallet)
      );
      
      const querySnapshot = await getDocs(entriesQuery);
      if (querySnapshot.empty) return 0;
      
      return querySnapshot.docs[0].data().rank;
    } catch (error) {
      console.error('Failed to get player rank:', error);
      return 0;
    }
  },

  async getGuildLeaderboard(
    type: 'daily' | 'weekly' | 'monthly' | 'all-time'
  ): Promise<LeaderboardEntry[]> {
    const cacheKey = `leaderboard:guilds:${type}`;
    const cached = cache.get<LeaderboardEntry[]>(cacheKey);
    if (cached) return cached;

    try {
      const entriesQuery = query(
        collection(db, LEADERBOARDS_COLLECTION, `${type}_guilds`, 'entries'),
        orderBy('score', 'desc'),
        limit(100)
      );
      
      const querySnapshot = await getDocs(entriesQuery);
      const entries = querySnapshot.docs.map(doc => doc.data() as LeaderboardEntry);
      
      cache.set(cacheKey, entries, CACHE_DURATION.guild.leaderboard);
      return entries;
    } catch (error) {
      console.error('Failed to get guild leaderboard:', error);
      return [];
    }
  }
};

================
File: src/services/db/questDB.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs, Timestamp } from 'firebase/firestore';
import { db } from '../firebase';
import { Quest, QuestSubmission } from '../../schemas/quest';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';

const cache = Cache.getInstance();
const QUESTS_COLLECTION = 'quests';

export const questDB = {
  async getQuest(questId: string): Promise<Quest | null> {
    const cached = cache.get<Quest>(`quest:${questId}`);
    if (cached) return cached;

    try {
      const docRef = doc(db, QUESTS_COLLECTION, questId);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as Quest;
        cache.set(`quest:${questId}`, data, CACHE_DURATION.player.profile);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get quest:', error);
      return null;
    }
  },

  async createQuest(quest: Quest): Promise<boolean> {
    try {
      await setDoc(doc(db, QUESTS_COLLECTION, quest.id), quest);
      cache.set(`quest:${quest.id}`, quest, CACHE_DURATION.player.profile);
      return true;
    } catch (error) {
      console.error('Failed to create quest:', error);
      return false;
    }
  },

  async updateQuest(questId: string, updates: Partial<Quest>): Promise<boolean> {
    try {
      await updateDoc(doc(db, QUESTS_COLLECTION, questId), updates);
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to update quest:', error);
      return false;
    }
  },

  async getActiveQuests(type: 'daily' | 'weekly' | 'monthly'): Promise<Quest[]> {
    const cacheKey = `quests:${type}:active`;
    const cached = cache.get<Quest[]>(cacheKey);
    if (cached) return cached;

    try {
      const now = Timestamp.now();
      const questsQuery = query(
        collection(db, QUESTS_COLLECTION),
        where('type', '==', type),
        where('status', '==', 'available'),
        where('dateExpires', '>', now)
      );
      
      const querySnapshot = await getDocs(questsQuery);
      const quests = querySnapshot.docs.map(doc => doc.data() as Quest);
      
      cache.set(cacheKey, quests, CACHE_DURATION.player.profile);
      return quests;
    } catch (error) {
      console.error('Failed to get active quests:', error);
      return [];
    }
  },

  async submitQuest(submission: QuestSubmission): Promise<boolean> {
    try {
      const submissionDoc = doc(
        db,
        QUESTS_COLLECTION,
        submission.questId,
        'submissions',
        submission.wallet
      );
      
      await setDoc(submissionDoc, submission);
      
      // Update quest completion status
      await updateDoc(doc(db, QUESTS_COLLECTION, submission.questId), {
        completedBy: arrayUnion(submission.wallet)
      });
      
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to submit quest:', error);
      return false;
    }
  },

  async getQuestSubmissions(questId: string): Promise<QuestSubmission[]> {
    try {
      const submissionsQuery = query(
        collection(db, QUESTS_COLLECTION, questId, 'submissions')
      );
      
      const querySnapshot = await getDocs(submissionsQuery);
      return querySnapshot.docs.map(doc => doc.data() as QuestSubmission);
    } catch (error) {
      console.error('Failed to get quest submissions:', error);
      return [];
    }
  },

  async getUserQuestSubmissions(wallet: string): Promise<QuestSubmission[]> {
    try {
      const submissions: QuestSubmission[] = [];
      const questsSnapshot = await getDocs(collection(db, QUESTS_COLLECTION));
      
      for (const questDoc of questsSnapshot.docs) {
        const submissionDoc = await getDoc(
          doc(db, QUESTS_COLLECTION, questDoc.id, 'submissions', wallet)
        );
        
        if (submissionDoc.exists()) {
          submissions.push(submissionDoc.data() as QuestSubmission);
        }
      }
      
      return submissions;
    } catch (error) {
      console.error('Failed to get user quest submissions:', error);
      return [];
    }
  }
};

================
File: src/services/db/raidDB.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs, Timestamp } from 'firebase/firestore';
import { db } from '../firebase';
import { Raid, RaidParticipant } from '../../schemas/raid';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';

const cache = Cache.getInstance();
const RAIDS_COLLECTION = 'raids';

export const raidDB = {
  async getRaid(raidId: string): Promise<Raid | null> {
    const cached = cache.get<Raid>(`raid:${raidId}`);
    if (cached) return cached;

    try {
      const docRef = doc(db, RAIDS_COLLECTION, raidId);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as Raid;
        cache.set(`raid:${raidId}`, data, CACHE_DURATION.raid.active);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get raid:', error);
      return null;
    }
  },

  async createRaid(raid: Raid): Promise<boolean> {
    try {
      await setDoc(doc(db, RAIDS_COLLECTION, raid.id), raid);
      cache.set(`raid:${raid.id}`, raid, CACHE_DURATION.raid.active);
      return true;
    } catch (error) {
      console.error('Failed to create raid:', error);
      return false;
    }
  },

  async updateRaid(raidId: string, updates: Partial<Raid>): Promise<boolean> {
    try {
      await updateDoc(doc(db, RAIDS_COLLECTION, raidId), updates);
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to update raid:', error);
      return false;
    }
  },

  async getActiveRaids(): Promise<Raid[]> {
    const cacheKey = 'raids:active';
    const cached = cache.get<Raid[]>(cacheKey);
    if (cached) return cached;

    try {
      const now = Timestamp.now();
      const raidsQuery = query(
        collection(db, RAIDS_COLLECTION),
        where('status', '==', 'active'),
        where('endTime', '>', now)
      );
      
      const querySnapshot = await getDocs(raidsQuery);
      const raids = querySnapshot.docs.map(doc => doc.data() as Raid);
      
      cache.set(cacheKey, raids, CACHE_DURATION.raid.active);
      return raids;
    } catch (error) {
      console.error('Failed to get active raids:', error);
      return [];
    }
  },

  async joinRaid(
    raidId: string,
    participant: RaidParticipant
  ): Promise<boolean> {
    try {
      const participantDoc = doc(
        db,
        RAIDS_COLLECTION,
        raidId,
        'participants',
        participant.wallet
      );
      
      await setDoc(participantDoc, participant);
      
      // Update raid participants count
      await updateDoc(doc(db, RAIDS_COLLECTION, raidId), {
        'participants': arrayUnion(participant)
      });
      
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to join raid:', error);
      return false;
    }
  },

  async getRaidParticipants(raidId: string): Promise<RaidParticipant[]> {
    try {
      const participantsQuery = query(
        collection(db, RAIDS_COLLECTION, raidId, 'participants')
      );
      
      const querySnapshot = await getDocs(participantsQuery);
      return querySnapshot.docs.map(doc => doc.data() as RaidParticipant);
    } catch (error) {
      console.error('Failed to get raid participants:', error);
      return [];
    }
  },

  async updateParticipant(
    raidId: string,
    wallet: string,
    updates: Partial<RaidParticipant>
  ): Promise<boolean> {
    try {
      await updateDoc(
        doc(db, RAIDS_COLLECTION, raidId, 'participants', wallet),
        updates
      );
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to update participant:', error);
      return false;
    }
  }
};

================
File: src/services/db/userDB.ts
================
import { doc, getDoc, setDoc, updateDoc, query, collection, where, getDocs } from 'firebase/firestore';
import { db } from '../firebase';
import { UserProfile, UserStats, UserInventory } from '../../schemas/user';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';

const cache = Cache.getInstance();
const USERS_COLLECTION = 'users';

export const userDB = {
  async getProfile(wallet: string): Promise<UserProfile | null> {
    // Check cache first
    const cached = cache.get<UserProfile>(`user:${wallet}`);
    if (cached) return cached;

    try {
      const docRef = doc(db, USERS_COLLECTION, wallet);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as UserProfile;
        cache.set(`user:${wallet}`, data, CACHE_DURATION.player.profile);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get user profile:', error);
      return null;
    }
  },

  async createProfile(profile: UserProfile): Promise<boolean> {
    try {
      await setDoc(doc(db, USERS_COLLECTION, profile.wallet), profile);
      cache.set(`user:${profile.wallet}`, profile, CACHE_DURATION.player.profile);
      return true;
    } catch (error) {
      console.error('Failed to create user profile:', error);
      return false;
    }
  },

  async updateProfile(wallet: string, updates: Partial<UserProfile>): Promise<boolean> {
    try {
      await updateDoc(doc(db, USERS_COLLECTION, wallet), updates);
      cache.clear(); // Clear cache since we don't know what changed
      return true;
    } catch (error) {
      console.error('Failed to update user profile:', error);
      return false;
    }
  },

  async getStats(wallet: string): Promise<UserStats | null> {
    const cached = cache.get<UserStats>(`stats:${wallet}`);
    if (cached) return cached;

    try {
      const docRef = doc(db, USERS_COLLECTION, wallet, 'stats', 'current');
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data() as UserStats;
        cache.set(`stats:${wallet}`, data, CACHE_DURATION.player.stats);
        return data;
      }
      
      return null;
    } catch (error) {
      console.error('Failed to get user stats:', error);
      return null;
    }
  },

  async updateStats(wallet: string, updates: Partial<UserStats>): Promise<boolean> {
    try {
      await updateDoc(doc(db, USERS_COLLECTION, wallet, 'stats', 'current'), updates);
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to update user stats:', error);
      return false;
    }
  },

  async getInventory(wallet: string): Promise<UserInventory[]> {
    const cached = cache.get<UserInventory[]>(`inventory:${wallet}`);
    if (cached) return cached;

    try {
      const q = query(collection(db, USERS_COLLECTION, wallet, 'inventory'));
      const querySnapshot = await getDocs(q);
      
      const inventory = querySnapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      })) as UserInventory[];

      cache.set(`inventory:${wallet}`, inventory, CACHE_DURATION.player.profile);
      return inventory;
    } catch (error) {
      console.error('Failed to get user inventory:', error);
      return [];
    }
  },

  async addToInventory(wallet: string, item: UserInventory): Promise<boolean> {
    try {
      await setDoc(
        doc(db, USERS_COLLECTION, wallet, 'inventory', item.nftMint),
        item
      );
      cache.clear();
      return true;
    } catch (error) {
      console.error('Failed to add item to inventory:', error);
      return false;
    }
  },

  async searchUsers(query: string, limit: number = 10): Promise<UserProfile[]> {
    try {
      const q = query.toLowerCase();
      const usersQuery = query(
        collection(db, USERS_COLLECTION),
        where('username', '>=', q),
        where('username', '<=', q + '\uf8ff')
      );
      
      const querySnapshot = await getDocs(usersQuery);
      return querySnapshot.docs
        .map(doc => doc.data() as UserProfile)
        .slice(0, limit);
    } catch (error) {
      console.error('Failed to search users:', error);
      return [];
    }
  }
};

================
File: src/services/firebase/auth.ts
================
import { 
  signInWithCustomToken,
  signInAnonymously,
  signOut as firebaseSignOut,
  onAuthStateChanged,
  User
} from 'firebase/auth';
import { auth } from './index';
import { generateSessionKey } from '../crypto';
import { playerService } from '../playerService';

export const signInWithWallet = async (wallet: string, signature: string) => {
  try {
    // Verify wallet signature and get custom token
    const response = await fetch('/api/auth/wallet', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ wallet, signature })
    });
    
    const { token } = await response.json();
    await signInWithCustomToken(auth, token);
    
    // Initialize player profile
    await playerService.enrollPlayer(wallet);
    
    return true;
  } catch (error) {
    console.error('Failed to sign in with wallet:', error);
    return false;
  }
};

export const signInAsGuest = async () => {
  try {
    // Sign in anonymously with Firebase
    const { user } = await signInAnonymously(auth);
    if (!user) throw new Error('Failed to create anonymous user');

    // Generate session key pair for the guest
    const { publicKey } = await generateSessionKey();
    
    // Initialize guest profile with anonymous user ID
    await playerService.enrollPlayer(user.uid);
    
    return true;
  } catch (error) {
    console.error('Failed to sign in as guest:', error);
    throw error;
  }
};

export const signOut = async () => {
  try {
    await firebaseSignOut(auth);
    localStorage.removeItem('sessionKey');
    return true;
  } catch (error) {
    console.error('Failed to sign out:', error);
    return false;
  }
};

export const onAuthChange = (callback: (user: User | null) => void) => {
  return onAuthStateChanged(auth, callback);
};

================
File: src/services/firebase/db.ts
================
import {
  collection,
  doc,
  getDoc,
  getDocs,
  setDoc,
  updateDoc,
  query,
  where,
  orderBy,
  limit,
  startAfter,
  DocumentData,
  QueryDocumentSnapshot
} from 'firebase/firestore';
import { db } from './index';
import { Cache } from '../../utils/cache';
import { CACHE_DURATION } from '../../config/cache';

const cache = Cache.getInstance();

export const getDocument = async <T>(
  collectionName: string,
  id: string
): Promise<T | null> => {
  // Check cache first
  const cached = cache.get<T>(`${collectionName}:${id}`);
  if (cached) return cached;

  try {
    const docRef = doc(db, collectionName, id);
    const docSnap = await getDoc(docRef);
    
    if (docSnap.exists()) {
      const data = docSnap.data() as T;
      cache.set(`${collectionName}:${id}`, data, CACHE_DURATION.player.profile);
      return data;
    }
    
    return null;
  } catch (error) {
    console.error(`Failed to get document ${collectionName}/${id}:`, error);
    return null;
  }
};

export const setDocument = async <T extends DocumentData>(
  collectionName: string,
  id: string,
  data: T
): Promise<boolean> => {
  try {
    await setDoc(doc(db, collectionName, id), data);
    cache.set(`${collectionName}:${id}`, data, CACHE_DURATION.player.profile);
    return true;
  } catch (error) {
    console.error(`Failed to set document ${collectionName}/${id}:`, error);
    return false;
  }
};

export const updateDocument = async (
  collectionName: string,
  id: string,
  updates: Partial<DocumentData>
): Promise<boolean> => {
  try {
    await updateDoc(doc(db, collectionName, id), updates);
    cache.clear(); // Clear cache since we don't know what changed
    return true;
  } catch (error) {
    console.error(`Failed to update document ${collectionName}/${id}:`, error);
    return false;
  }
};

export const queryDocuments = async <T>(
  collectionName: string,
  conditions: {
    field: string;
    operator: '==' | '>' | '<' | '>=' | '<=';
    value: any;
  }[],
  orderByField?: string,
  orderDirection?: 'asc' | 'desc',
  limitCount?: number,
  startAfterDoc?: QueryDocumentSnapshot
) => {
  try {
    let q = query(collection(db, collectionName));

    // Apply conditions
    conditions.forEach(({ field, operator, value }) => {
      q = query(q, where(field, operator, value));
    });

    // Apply ordering
    if (orderByField) {
      q = query(q, orderBy(orderByField, orderDirection || 'asc'));
    }

    // Apply pagination
    if (limitCount) {
      q = query(q, limit(limitCount));
    }

    if (startAfterDoc) {
      q = query(q, startAfter(startAfterDoc));
    }

    const querySnapshot = await getDocs(q);
    return querySnapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    })) as T[];
  } catch (error) {
    console.error(`Failed to query documents in ${collectionName}:`, error);
    return [];
  }
};

================
File: src/services/firebase/index.ts
================
import { initializeApp } from 'firebase/app';
import { getFirestore, enableIndexedDbPersistence } from 'firebase/firestore';
import { getAuth, connectAuthEmulator } from 'firebase/auth';
import { getAnalytics } from 'firebase/analytics';
import { scaleConfig } from '../../config/scale';

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID,
  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID
};

// Initialize Firebase with performance monitoring
const app = initializeApp(firebaseConfig);

// Initialize Firestore with persistence and caching
const db = getFirestore(app);
enableIndexedDbPersistence(db, {
  synchronizeTabs: true,
  cacheSizeBytes: scaleConfig.performance.maxCacheSize
}).catch((err) => {
  console.error('Failed to enable persistence:', err);
});

// Initialize Auth with emulator in development
const auth = getAuth(app);
if (import.meta.env.DEV) {
  connectAuthEmulator(auth, 'http://localhost:9099');
}

// Initialize Analytics in production only
const analytics = import.meta.env.PROD ? getAnalytics(app) : null;

export { app, db, auth, analytics };

================
File: src/services/guildService.ts
================
import { EventEmitter } from 'events';
import { Guild, GuildArchetype, DEFAULT_COMMUNITY_GUILDS } from '../types/guild';
import { stateManager } from './StateManager';

class GuildService {
  private static instance: GuildService;
  private guilds: Map<string, Guild>;
  private membershipRequests: Map<string, { wallet: string; message: string; timestamp: number; }[]>;
  private emitter: EventEmitter;
  private lastSync: number = 0;

  private constructor() {
    this.guilds = new Map();
    this.membershipRequests = new Map();
    this.emitter = new EventEmitter();
    this.loadGuilds();
    this.setupAutoSync();
  }

  static getInstance(): GuildService {
    if (!GuildService.instance) {
      GuildService.instance = new GuildService();
    }
    return GuildService.instance;
  }

  private setupAutoSync() {
    setInterval(() => {
      this.loadState();
    }, 1000);
  }

  private syncState() {
    const guildData = {
      guilds: Array.from(this.guilds.entries()),
      requests: Array.from(this.membershipRequests.entries())
    };
    localStorage.setItem('guilds', JSON.stringify(guildData));
    stateManager.publish('guildStateUpdate', guildData);
    this.lastSync = Date.now();
    this.notifyListeners();
  }

  public loadState() {
    const lastUpdate = stateManager.getLastUpdate();
    if (lastUpdate > this.lastSync) {
      this.loadGuilds();
      this.notifyListeners();
      this.lastSync = Date.now();
    }
  }

  private loadGuilds(): void {
    try {
      const savedData = localStorage.getItem('guilds');
      if (savedData) {
        const parsed = JSON.parse(savedData);
        this.guilds = new Map(parsed.guilds);
        this.membershipRequests = new Map(parsed.requests);
      } else {
        // Initialize with default community guilds if no saved data exists
        DEFAULT_COMMUNITY_GUILDS.forEach(guild => {
          this.guilds.set(guild.id, guild);
        });
        this.syncState();
      }
    } catch (error) {
      console.error('Failed to load guild data:', error);
      this.guilds = new Map();
      this.membershipRequests = new Map();
      
      // Initialize with defaults on error
      DEFAULT_COMMUNITY_GUILDS.forEach(guild => {
        this.guilds.set(guild.id, guild);
      });
      this.syncState();
    }
  }

  public createGuild(guildData: Omit<Guild, 'id' | 'members' | 'totalXp' | 'dateCreated'>): Guild {
    const newGuild: Guild = {
      ...guildData,
      id: `guild-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      members: [],
      totalXp: 0,
      dateCreated: Date.now()
    };

    this.guilds.set(newGuild.id, newGuild);
    this.syncState();
    return newGuild;
  }

  public addListener(callback: () => void): void {
    this.emitter.on('guildUpdate', callback);
  }

  public removeListener(callback: () => void): void {
    this.emitter.off('guildUpdate', callback);
  }

  private notifyListeners(): void {
    this.emitter.emit('guildUpdate');
  }

  public getGuildById(id: string): Guild | null {
    return this.guilds.get(id) || null;
  }

  public getGuildByArchetype(archetype: GuildArchetype): Guild | null {
    return Array.from(this.guilds.values()).find(g => g.archetype === archetype) || null;
  }

  public getCommunityGuilds(): Guild[] {
    return Array.from(this.guilds.values())
      .filter(guild => !guild.isCore && !guild.isDeleted);
  }

  public getGuildMembers(guildId: string): any[] {
    const guild = this.guilds.get(guildId);
    if (!guild || !Array.isArray(guild.members)) return [];
    return guild.members;
  }

  public updateGuild(guildId: string, updates: Partial<Guild>): boolean {
    const guild = this.guilds.get(guildId);
    if (!guild) return false;

    this.guilds.set(guildId, { ...guild, ...updates });
    this.syncState();
    return true;
  }

  public isGuildLeader(wallet: string): boolean {
    return Array.from(this.guilds.values()).some(guild => 
      Array.isArray(guild.leaders) && guild.leaders.includes(wallet)
    );
  }

  public submitMembershipRequest(guildId: string, wallet: string, message: string): boolean {
    const guild = this.guilds.get(guildId);
    if (!guild) return false;

    if (!this.membershipRequests.has(guildId)) {
      this.membershipRequests.set(guildId, []);
    }

    const requests = this.membershipRequests.get(guildId)!;
    requests.push({
      wallet,
      message,
      timestamp: Date.now()
    });

    this.syncState();
    return true;
  }

  public acceptMembershipRequest(guildId: string, wallet: string): boolean {
    const guild = this.guilds.get(guildId);
    if (!guild) return false;

    if (!Array.isArray(guild.members)) {
      guild.members = [];
    }

    if (!guild.members.includes(wallet)) {
      guild.members.push(wallet);
      
      // Remove the request
      const requests = this.membershipRequests.get(guildId) || [];
      this.membershipRequests.set(
        guildId,
        requests.filter(req => req.wallet !== wallet)
      );

      this.syncState();
      return true;
    }

    return false;
  }

  public getMembershipRequests(guildId: string) {
    return this.membershipRequests.get(guildId) || [];
  }
}

export const guildService = GuildService.getInstance();

================
File: src/services/index.ts
================
// Export all services
export * from './playerService';
export * from './questService';
export * from './raidService';
export * from './guildService';
export * from './submissionService';
export * from './twitterService';

================
File: src/services/playerService.ts
================
import { Player } from '../types/player';
import { supabase } from './supabaseClient';
import { PublicKey } from '@solana/web3.js';

export interface PFPTraits {
  selectedTraits: Record<number, number>;
}

export class PlayerService {
  private listeners: Array<(data: any) => void> = [];
  private readonly PFP_STORAGE_KEY = 'player_pfp_traits';
  
  addEventListener(callback: (data: any) => void) {
    this.listeners.push(callback);
  }

  removeEventListener(callback: (data: any) => void) {
    this.listeners = this.listeners.filter(listener => listener !== callback);
  }

  private emit(data: any) {
    this.listeners.forEach(listener => listener(data));
  }

  private validateWalletAddress(address: string): string | null {
    try {
      if (address.includes('-') || address.startsWith('guest_')) {
        return address;
      }
      
      const pubKey = new PublicKey(address);
      return pubKey.toString();
    } catch (error) {
      console.error('Invalid wallet address:', error);
      return null;
    }
  }

  private async retryOperation<T>(operation: () => Promise<T>, maxRetries: number = 3): Promise<T> {
    let lastError: any;
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await operation();
      } catch (error: any) {
        lastError = error;
        if (error?.code === 'PGRST116' || error?.code?.includes('auth')) {
          break; // Don't retry auth or not found errors
        }
        console.warn(`Operation failed (attempt ${attempt}/${maxRetries}):`, error);
        if (attempt < maxRetries) {
          await new Promise(resolve => setTimeout(resolve, attempt * 1000));
        }
      }
    }
    throw lastError;
  }

  private getPFPTraits(): Record<string, PFPTraits> {
    try {
      const stored = localStorage.getItem(this.PFP_STORAGE_KEY);
      return stored ? JSON.parse(stored) : {};
    } catch (error) {
      console.error('Error reading PFP traits:', error);
      return {};
    }
  }

  private savePFPTraits(traits: Record<string, PFPTraits>): void {
    try {
      localStorage.setItem(this.PFP_STORAGE_KEY, JSON.stringify(traits));
    } catch (error) {
      console.error('Error saving PFP traits:', error);
    }
  }

  async getPlayer(wallet: string): Promise<Player | null> {
    try {
      const validWallet = this.validateWalletAddress(wallet);
      if (!validWallet) {
        return null;
      }

      const { data, error } = await this.retryOperation(async () => {
        return await supabase
          .from('players')
          .select('*')
          .eq('wallet', validWallet)
          .maybeSingle();
      });

      if (error) {
        throw error;
      }

      // If player exists, check for PFP traits
      if (data) {
        const pfpTraits = this.getPFPTraits();
        if (pfpTraits[validWallet]) {
          (data as any).pfp_traits = pfpTraits[validWallet];
        }
      }

      return data as Player;
    } catch (error) {
      console.error('Error getting player:', error);
      return null;
    }
  }

  async createOrUpdatePlayer(wallet: string, isGuest: boolean = false): Promise<Player | null> {
    try {
      const validWallet = this.validateWalletAddress(wallet);
      if (!validWallet) {
        throw new Error('Invalid wallet address');
      }

      const playerData = {
        wallet: validWallet,
        experience: 0,
        quests_completed: 0,
        raid_bosses_defeated: 0,
        show_wallet: true,
        date_joined: new Date().toISOString(),
        last_quest_completion_time: null,
        archetype: null,
        discord_handle: null,
        is_guest: isGuest
      };

      const { data, error } = await this.retryOperation(async () => {
        return await supabase
          .from('players')
          .upsert(playerData)
          .select()
          .maybeSingle();
      });

      if (error) {
        console.error('Error upserting player:', error);
        throw error;
      }

      return data as Player;
    } catch (error) {
      console.error('Error in createOrUpdatePlayer:', error);
      throw error;
    }
  }

  async updatePlayerStats(wallet: string, stats: Partial<Player>): Promise<Player | null> {
    try {
      const validWallet = this.validateWalletAddress(wallet);
      if (!validWallet) {
        throw new Error('Invalid wallet address');
      }

      // First check if player exists
      const existingPlayer = await this.getPlayer(validWallet);
      if (!existingPlayer) {
        // Create player first with default values
        const newPlayer = await this.createOrUpdatePlayer(validWallet);
        if (!newPlayer) {
          throw new Error('Failed to create player profile');
        }
      }

      // Format the stats object to match database column names
      const formattedStats: any = {};
      if (stats.experience !== undefined) {
        formattedStats.experience = stats.experience;
      }
      if (stats.questsCompleted !== undefined) {
        formattedStats.quests_completed = stats.questsCompleted;
      }
      if (stats.raidBossesDefeated !== undefined) {
        formattedStats.raid_bosses_defeated = stats.raidBossesDefeated;
      }
      if (stats.archetype !== undefined) {
        formattedStats.archetype = stats.archetype;
      }
      if (stats.guild !== undefined) {
        formattedStats.guild = stats.guild;
      }
      if (stats.discordHandle !== undefined) {
        formattedStats.discord_handle = stats.discordHandle;
      }

      // Now update the player with the formatted stats
      const { data, error } = await this.retryOperation(async () => {
        return await supabase
          .from('players')
          .update(formattedStats)
          .eq('wallet', validWallet)
          .select()
          .maybeSingle();
      });

      if (error) {
        throw error;
      }

      if (!data) {
        throw new Error('Failed to update player stats');
      }

      this.emit(data as Player);
      return data as Player;
    } catch (error) {
      console.error('Error updating player stats:', error);
      throw error;
    }
  }

  async updatePlayerPFP(wallet: string, traits: PFPTraits): Promise<Player | null> {
    try {
      const validWallet = this.validateWalletAddress(wallet);
      if (!validWallet) {
        throw new Error('Invalid wallet address');
      }

      // First check if player exists
      const existingPlayer = await this.getPlayer(validWallet);
      if (!existingPlayer) {
        // Create player first with default values
        const newPlayer = await this.createOrUpdatePlayer(validWallet);
        if (!newPlayer) {
          throw new Error('Failed to create player profile');
        }
      }

      // Store PFP traits in localStorage
      const allPFPTraits = this.getPFPTraits();
      allPFPTraits[validWallet] = traits;
      this.savePFPTraits(allPFPTraits);

      // Return the updated player
      const updatedPlayer = await this.getPlayer(validWallet);
      if (!updatedPlayer) {
        throw new Error('Failed to update player PFP');
      }

      this.emit(updatedPlayer);
      return updatedPlayer;
    } catch (error) {
      console.error('Error updating player PFP:', error);
      throw error;
    }
  }

  async getPlayerPFP(wallet: string): Promise<PFPTraits | null> {
    const validWallet = this.validateWalletAddress(wallet);
    if (!validWallet) {
      return null;
    }

    const pfpTraits = this.getPFPTraits();
    return pfpTraits[validWallet] || null;
  }
}

export const playerService = new PlayerService();

================
File: src/services/questPoolService.ts
================
import { Quest, QuestPool } from '../types/quest';

class QuestPoolService {
  private static instance: QuestPoolService;
  private questPool: QuestPool = {
    daily: [
      {
        id: 'daily-1',
        type: 'daily',
        description: 'Share a meme in the Discord community',
        xpReward: 100,
        isAutomatic: true
      },
      // Add more daily quests to reach 15 total
    ],
    weekly: [
      {
        id: 'weekly-1',
        type: 'weekly',
        description: 'Create a guide for new raiders',
        xpReward: 500,
        isAutomatic: true
      },
      // Add more weekly quests to reach 10 total
    ],
    monthly: [
      {
        id: 'monthly-1',
        type: 'monthly',
        description: 'Complete all weekly quests',
        xpReward: 2000,
        isAutomatic: true
      },
      // Add more monthly quests to reach 5 total
    ]
  };

  private constructor() {
    this.loadQuestPool();
    this.setupAutoRefresh();
  }

  static getInstance(): QuestPoolService {
    if (!QuestPoolService.instance) {
      QuestPoolService.instance = new QuestPoolService();
    }
    return QuestPoolService.instance;
  }

  private loadQuestPool(): void {
    const savedPool = localStorage.getItem('questPool');
    if (savedPool) {
      this.questPool = JSON.parse(savedPool);
    }
  }

  private save(): void {
    localStorage.setItem('questPool', JSON.stringify(this.questPool));
  }

  private setupAutoRefresh(): void {
    const checkAndRefresh = () => {
      const now = new Date();
      const sixAM = new Date(now);
      sixAM.setHours(6, 0, 0, 0);

      // If it's past 6 AM, set for next day
      if (now > sixAM) {
        sixAM.setDate(sixAM.getDate() + 1);
      }

      const timeUntilRefresh = sixAM.getTime() - now.getTime();

      setTimeout(() => {
        this.refreshQuests();
        // Set up next refresh
        setInterval(this.refreshQuests.bind(this), 24 * 60 * 60 * 1000);
      }, timeUntilRefresh);
    };

    checkAndRefresh();
  }

  private refreshQuests(): void {
    const now = new Date();
    const isWeeklyRefresh = now.getDay() === 0; // Sunday
    const isMonthlyRefresh = now.getDate() === 1;

    // Daily refresh
    this.deployDailyQuests();

    // Weekly refresh (Sundays)
    if (isWeeklyRefresh) {
      this.deployWeeklyQuests();
    }

    // Monthly refresh (1st of month)
    if (isMonthlyRefresh) {
      this.deployMonthlyQuests();
    }

    this.save();
  }

  private deployDailyQuests(): void {
    const now = new Date();
    const expires = new Date(now);
    expires.setDate(expires.getDate() + 1);
    expires.setHours(6, 0, 0, 0);

    this.questPool.daily.forEach(quest => {
      if (quest.isAutomatic) {
        quest.dateAvailable = now.getTime();
        quest.dateExpires = expires.getTime();
        quest.status = 'available';
        quest.completedBy = [];
      }
    });
  }

  private deployWeeklyQuests(): void {
    const now = new Date();
    const expires = new Date(now);
    expires.setDate(expires.getDate() + 7);
    expires.setHours(6, 0, 0, 0);

    this.questPool.weekly.forEach(quest => {
      if (quest.isAutomatic) {
        quest.dateAvailable = now.getTime();
        quest.dateExpires = expires.getTime();
        quest.status = 'available';
        quest.completedBy = [];
      }
    });
  }

  private deployMonthlyQuests(): void {
    const now = new Date();
    const expires = new Date(now);
    expires.setMonth(expires.getMonth() + 1);
    expires.setDate(1);
    expires.setHours(6, 0, 0, 0);

    this.questPool.monthly.forEach(quest => {
      if (quest.isAutomatic) {
        quest.dateAvailable = now.getTime();
        quest.dateExpires = expires.getTime();
        quest.status = 'available';
        quest.completedBy = [];
      }
    });
  }

  getActiveQuests(type: 'daily' | 'weekly' | 'monthly'): Quest[] {
    return this.questPool[type].filter(quest => 
      quest.status === 'available' && 
      quest.dateExpires > Date.now()
    );
  }

  updateQuest(type: 'daily' | 'weekly' | 'monthly', questId: string, updates: Partial<Quest>): boolean {
    const questIndex = this.questPool[type].findIndex(q => q.id === questId);
    if (questIndex === -1) return false;

    this.questPool[type][questIndex] = {
      ...this.questPool[type][questIndex],
      ...updates
    };

    this.save();
    return true;
  }
}

export const questPoolService = QuestPoolService.getInstance();

================
File: src/services/questService.ts
================
import { Quest } from '../types/quest';
import { questPoolService } from './questPoolService';
import { playerService } from './playerService';
import { submissionService } from './submissionService';
import { supabase } from './supabaseClient';
import { getUser } from './supabaseAuth';

class QuestService {
  private static instance: QuestService;
  private quests: Map<string, Quest> = new Map();
  private refreshInterval: NodeJS.Timer | null = null;

  private constructor() {
    this.setupQuestRotation();
  }

  static getInstance(): QuestService {
    if (!QuestService.instance) {
      QuestService.instance = new QuestService();
    }
    return QuestService.instance;
  }

  private save(): void {
    localStorage.setItem('quests', JSON.stringify(Object.fromEntries(this.quests)));
  }

  private setupQuestRotation(): void {
    // Check every minute for quest rotation
    this.refreshInterval = setInterval(async () => {
      const now = new Date();
      const cst = new Date(now.toLocaleString('en-US', { timeZone: 'America/Chicago' }));
      
      // Check if it's 6 AM CST
      if (cst.getHours() === 6 && cst.getMinutes() === 0) {
        // Daily rotation
        await this.rotateQuests('daily');

        // Weekly rotation (on Sunday)
        if (cst.getDay() === 0) {
          await this.rotateQuests('weekly');
        }
      }
    }, 60000); // Check every minute
  }

  private async rotateQuests(type: 'daily' | 'weekly' | 'monthly'): Promise<void> {
    try {
      const user = await getUser();
      if (!user) throw new Error('Not authenticated');

      // Get new quests from the quest pool
      const newQuests = await questPoolService.getRandomQuests(type, 3);
      
      // Remove old quests of this type
      const { error: deleteError } = await supabase
        .from('quests')
        .delete()
        .eq('type', type);

      if (deleteError) throw deleteError;

      // Insert new quests
      const { error: insertError } = await supabase
        .from('quests')
        .insert(newQuests.map(quest => ({
          title: quest.title,
          description: quest.description,
          type: quest.type,
          xp_reward: quest.xpReward,
          requirements: quest.requirements,
          is_automatic: quest.isAutomatic,
          date_expires: quest.dateExpires
        })));

      if (insertError) throw insertError;

    } catch (error) {
      console.error(`Failed to rotate ${type} quests:`, error);
    }
  }

  async getQuests(type?: 'daily' | 'weekly' | 'monthly'): Promise<Quest[]> {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) throw new Error('Not authenticated');

      let query = supabase
        .from('quests')
        .select('*');

      if (type) {
        query = query.eq('type', type);
      }

      const { data, error } = await query.order('created_at', { ascending: false });

      if (error) throw error;

      // Update local cache
      const quests = data.map(quest => ({
        id: quest.id,
        title: quest.title,
        description: quest.description,
        type: quest.type,
        xpReward: quest.xp_reward,
        requirements: quest.requirements,
        isAutomatic: quest.is_automatic,
        dateExpires: quest.date_expires,
        dateCreated: new Date(quest.created_at).getTime(),
        status: quest.status,
        completedBy: quest.completed_by || []
      }));

      quests.forEach(quest => this.quests.set(quest.id, quest));
      this.save();

      return quests;
    } catch (error) {
      console.error('Failed to fetch quests:', error);
      throw error;
    }
  }

  async createQuest(questData: Omit<Quest, 'id' | 'dateCreated' | 'status' | 'completedBy'>): Promise<boolean> {
    try {
      const user = await getUser();
      if (!user) throw new Error('Not authenticated');

      const { data, error } = await supabase
        .from('quests')
        .insert([{
          title: questData.title,
          description: questData.description,
          type: questData.type,
          xp_reward: questData.xpReward,
          requirements: questData.requirements,
          is_automatic: questData.isAutomatic,
          date_expires: questData.dateExpires
        }]);

      if (error) throw error;

      if (data && data[0]) {
        const quest: Quest = {
          id: data[0].id,
          title: data[0].title,
          description: data[0].description,
          type: data[0].type,
          xpReward: data[0].xp_reward,
          requirements: data[0].requirements,
          isAutomatic: data[0].is_automatic,
          dateExpires: data[0].date_expires,
          dateCreated: new Date(data[0].created_at).getTime(),
          status: data[0].status,
          completedBy: []
        };

        this.quests.set(quest.id, quest);
        this.save();
      }

      return true;
    } catch (error) {
      console.error('Failed to create quest:', error);
      return false;
    }
  }

  async updateQuest(questId: string, updates: Partial<Quest>): Promise<boolean> {
    try {
      const user = await getUser();
      if (!user) throw new Error('Not authenticated');

      const { error } = await supabase
        .from('quests')
        .update({
          title: updates.title,
          description: updates.description,
          type: updates.type,
          xp_reward: updates.xpReward,
          requirements: updates.requirements,
          is_automatic: updates.isAutomatic,
          date_expires: updates.dateExpires,
          status: updates.status
        })
        .eq('id', questId);

      if (error) throw error;

      const quest = this.quests.get(questId);
      if (quest) {
        this.quests.set(questId, { ...quest, ...updates });
        this.save();
      }

      return true;
    } catch (error) {
      console.error('Failed to update quest:', error);
      return false;
    }
  }

  async deleteQuest(questId: string): Promise<boolean> {
    try {
      const user = await getUser();
      if (!user) throw new Error('Not authenticated');

      const { error } = await supabase
        .from('quests')
        .delete()
        .eq('id', questId);

      if (error) throw error;

      this.quests.delete(questId);
      this.save();
      return true;
    } catch (error) {
      console.error('Failed to delete quest:', error);
      return false;
    }
  }

  async submitQuestProof(
    questId: string,
    wallet: string,
    submission: { url: string; screenshot?: File }
  ): Promise<boolean> {
    const quest = this.quests.get(questId);
    if (!quest || quest.completedBy?.includes(wallet)) {
      return false;
    }

    try {
      // Convert screenshot to data URL if provided
      let screenshotData: string | undefined;
      if (submission.screenshot) {
        screenshotData = await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result as string);
          reader.readAsDataURL(submission.screenshot);
        });
      }

      // Add submission record
      submissionService.addSubmission({
        questId,
        questType: 'quest',
        wallet,
        url: submission.url,
        screenshot: screenshotData
      });

      // Update quest completion status
      quest.completedBy = [...(quest.completedBy || []), wallet];
      quest.proof = [
        ...(quest.proof || []),
        {
          wallet,
          url: submission.url,
          dateSubmitted: Date.now()
        }
      ];

      // Award XP to the player
      playerService.addExperience(wallet, quest.xpReward);

      this.quests.set(questId, quest);
      this.save();
      return true;
    } catch (error) {
      console.error('Failed to submit quest proof:', error);
      return false;
    }
  }

  isQuestCompleted(questId: string, wallet: string): boolean {
    const quest = this.quests.get(questId);
    return quest?.completedBy?.includes(wallet) || false;
  }
}

export const questService = QuestService.getInstance();

================
File: src/services/raidService.ts
================
import { RaidState, RaidBoss, RaidParticipant, RaidReward, QuestSubmission } from '../types/raid';
import { supabase } from '../lib/supabase';
import { playerService } from './playerService';

class RaidService {
  private static instance: RaidService;

  private constructor() {}

  static getInstance(): RaidService {
    if (!RaidService.instance) {
      RaidService.instance = new RaidService();
    }
    return RaidService.instance;
  }

  private calculateHealth(defense: number): number {
    return 1000 + (defense * 10);
  }

  async createRaid(boss: RaidBoss): Promise<string | null> {
    try {
      const maxHealth = this.calculateHealth(boss.defense);
      
      const { data, error } = await supabase
        .from('raids')
        .insert([
          {
            boss_name: boss.name,
            boss_health: maxHealth,
            boss_max_health: maxHealth,
            boss_defense: boss.defense,
            state: 'active',
            start_time: new Date().toISOString()
          }
        ])
        .select()
        .single();

      if (error) {
        console.error('Error creating raid:', error);
        return null;
      }

      // Create initial quest submissions
      const questPromises = boss.quests.map(quest =>
        supabase
          .from('quest_submissions')
          .insert([
            {
              raid_id: data.id,
              quest_type: quest.type,
              verified: false
            }
          ])
      );

      await Promise.all(questPromises);

      return data.id;
    } catch (error) {
      console.error('Error in createRaid:', error);
      return null;
    }
  }

  async getRaid(raidId: string): Promise<RaidState | null> {
    try {
      const { data: raid, error: raidError } = await supabase
        .from('raids')
        .select('*')
        .eq('id', raidId)
        .single();

      if (raidError) {
        console.error('Error fetching raid:', raidError);
        return null;
      }

      const { data: participants, error: participantsError } = await supabase
        .from('raid_participants')
        .select('*')
        .eq('raid_id', raidId);

      if (participantsError) {
        console.error('Error fetching participants:', participantsError);
        return null;
      }

      const { data: quests, error: questsError } = await supabase
        .from('quest_submissions')
        .select('*')
        .eq('raid_id', raidId);

      if (questsError) {
        console.error('Error fetching quests:', questsError);
        return null;
      }

      return {
        id: raid.id,
        state: raid.state,
        startTime: new Date(raid.start_time).getTime(),
        endTime: raid.end_time ? new Date(raid.end_time).getTime() : null,
        boss: {
          name: raid.boss_name,
          health: raid.boss_health,
          maxHealth: raid.boss_max_health,
          defense: raid.boss_defense,
          quests: this.groupQuestsByType(quests)
        },
        participants: participants.map(p => ({
          playerId: p.player_id,
          joinTime: new Date(p.join_time).getTime(),
          contribution: p.contribution
        }))
      };
    } catch (error) {
      console.error('Error in getRaid:', error);
      return null;
    }
  }

  async joinRaid(raidId: string, playerId: string): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('raid_participants')
        .insert([
          {
            raid_id: raidId,
            player_id: playerId,
            join_time: new Date().toISOString(),
            contribution: 0
          }
        ]);

      if (error) {
        console.error('Error joining raid:', error);
        return false;
      }

      return true;
    } catch (error) {
      console.error('Error in joinRaid:', error);
      return false;
    }
  }

  async submitQuest(raidId: string, playerId: string, questType: string): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('quest_submissions')
        .insert([
          {
            raid_id: raidId,
            player_id: playerId,
            quest_type: questType,
            submission_time: new Date().toISOString(),
            verified: true
          }
        ]);

      if (error) {
        console.error('Error submitting quest:', error);
        return false;
      }

      // Update raid health
      await this.updateRaidHealth(raidId);
      
      return true;
    } catch (error) {
      console.error('Error in submitQuest:', error);
      return false;
    }
  }

  private async updateRaidHealth(raidId: string): Promise<void> {
    try {
      const raid = await this.getRaid(raidId);
      if (!raid) return;

      const totalQuestsRequired = raid.boss.quests.length * 10;
      const totalCompletions = raid.boss.quests.reduce(
        (sum, quest) => sum + quest.completedBy.length,
        0
      );
      const completionPercentage = totalCompletions / totalQuestsRequired;
      const newHealth = raid.boss.maxHealth * (1 - completionPercentage);

      const { error } = await supabase
        .from('raids')
        .update({ boss_health: newHealth })
        .eq('id', raidId);

      if (error) {
        console.error('Error updating raid health:', error);
      }
    } catch (error) {
      console.error('Error in updateRaidHealth:', error);
    }
  }

  async getCompletedRaids(): Promise<RaidState[]> {
    try {
      const { data, error } = await supabase
        .from('raids')
        .select(`
          *,
          participants:raid_participants(*)
        `)
        .eq('state', 'completed')
        .order('end_time', { ascending: false })
        .limit(10);

      if (error) {
        console.error('Error fetching completed raids:', error);
        return [];
      }

      return data.map(raid => ({
        id: raid.id,
        bossName: raid.boss_name,
        bossHealth: raid.boss_health,
        bossMaxHealth: raid.boss_max_health,
        bossDefense: raid.boss_defense,
        state: raid.state,
        startTime: new Date(raid.start_time).getTime(),
        endTime: raid.end_time ? new Date(raid.end_time).getTime() : undefined,
        participants: raid.participants.map((p: any) => ({
          playerId: p.player_id,
          damage: p.damage,
          joinTime: new Date(p.join_time).getTime()
        }))
      }));
    } catch (error) {
      console.error('Error in getCompletedRaids:', error);
      return [];
    }
  }

  async getAllRaids(): Promise<RaidState[]> {
    try {
      const { data, error } = await supabase
        .from('raids')
        .select(`
          *,
          participants:raid_participants(*)
        `)
        .order('start_time', { ascending: false });

      if (error) {
        console.error('Error fetching raids:', error);
        return [];
      }

      return data.map(raid => ({
        id: raid.id,
        bossName: raid.boss_name,
        bossHealth: raid.boss_health,
        bossMaxHealth: raid.boss_max_health,
        bossDefense: raid.boss_defense,
        state: raid.state,
        startTime: new Date(raid.start_time).getTime(),
        endTime: raid.end_time ? new Date(raid.end_time).getTime() : undefined,
        participants: raid.participants.map((p: any) => ({
          playerId: p.player_id,
          damage: p.damage,
          joinTime: new Date(p.join_time).getTime()
        }))
      }));
    } catch (error) {
      console.error('Error in getAllRaids:', error);
      return [];
    }
  }

  private groupQuestsByType(quests: any[]): { type: string; completedBy: string[] }[] {
    const questGroups = new Map<string, string[]>();
    
    quests.forEach(quest => {
      if (!questGroups.has(quest.quest_type)) {
        questGroups.set(quest.quest_type, []);
      }
      if (quest.player_id) {
        questGroups.get(quest.quest_type)?.push(quest.player_id);
      }
    });

    return Array.from(questGroups.entries()).map(([type, completedBy]) => ({
      type,
      completedBy
    }));
  }
}

export const raidService = RaidService.getInstance();

================
File: src/services/relayer.ts
================
import { Transaction, Connection, PublicKey } from '@solana/web3.js';
import { scaleConfig } from '../config/scale';

const RELAYER_ENDPOINTS = [
  `https://rpc.helius.xyz/?api-key=${import.meta.env.VITE_HELIUS_API_KEY}`,
  // Add additional relayer endpoints for load balancing
];

let currentEndpointIndex = 0;
const failedEndpoints = new Set<number>();

const getNextEndpoint = () => {
  // Reset if all endpoints have failed
  if (failedEndpoints.size === RELAYER_ENDPOINTS.length) {
    failedEndpoints.clear();
  }

  // Find next working endpoint
  while (failedEndpoints.has(currentEndpointIndex)) {
    currentEndpointIndex = (currentEndpointIndex + 1) % RELAYER_ENDPOINTS.length;
  }

  return RELAYER_ENDPOINTS[currentEndpointIndex];
};

export const sendTransaction = async (
  transaction: Transaction,
  feePayer?: PublicKey
) => {
  const endpoint = getNextEndpoint();
  
  try {
    const connection = new Connection(endpoint);
    
    // If no fee payer provided, use relayer's
    if (!feePayer) {
      const response = await fetch(`${endpoint}/relayer/feePayer`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' }
      });
      const { publicKey } = await response.json();
      feePayer = new PublicKey(publicKey);
    }

    // Set fee payer and recent blockhash
    transaction.feePayer = feePayer;
    const { blockhash } = await connection.getLatestBlockhash();
    transaction.recentBlockhash = blockhash;

    // Send to relayer
    const serializedTx = transaction.serialize().toString('base64');
    const response = await fetch(`${endpoint}/relayer/submit`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ transaction: serializedTx })
    });

    if (!response.ok) {
      throw new Error(`Relayer error: ${response.statusText}`);
    }

    const { signature } = await response.json();
    
    // Wait for confirmation
    const confirmation = await connection.confirmTransaction(signature);
    if (confirmation.value.err) {
      throw new Error(`Transaction failed: ${confirmation.value.err}`);
    }

    return signature;
  } catch (error) {
    // Mark endpoint as failed
    failedEndpoints.add(currentEndpointIndex);
    currentEndpointIndex = (currentEndpointIndex + 1) % RELAYER_ENDPOINTS.length;

    console.error('Transaction relay failed:', error);
    throw error;
  }
};

================
File: src/services/relayer/compression.ts
================
import * as snappy from 'snappy';
import { encode as encodeBase64, decode as decodeBase64 } from 'base64-arraybuffer';
import { logError } from '../../config/monitoring';

export class CompressionService {
  private static instance: CompressionService;

  private constructor() {}

  static getInstance(): CompressionService {
    if (!CompressionService.instance) {
      CompressionService.instance = new CompressionService();
    }
    return CompressionService.instance;
  }

  async compressData(data: any): Promise<string> {
    try {
      const jsonString = JSON.stringify(data);
      const buffer = Buffer.from(jsonString);
      const compressed = await snappy.compress(buffer);
      return encodeBase64(compressed);
    } catch (error) {
      logError(error as Error, {
        component: 'CompressionService',
        method: 'compressData'
      });
      throw error;
    }
  }

  async decompressData(compressed: string): Promise<any> {
    try {
      const buffer = Buffer.from(decodeBase64(compressed));
      const decompressed = await snappy.uncompress(buffer);
      const jsonString = decompressed.toString();
      return JSON.parse(jsonString);
    } catch (error) {
      logError(error as Error, {
        component: 'CompressionService',
        method: 'decompressData'
      });
      throw error;
    }
  }

  async compressTransaction(transaction: any): Promise<string> {
    try {
      const serialized = transaction.serialize();
      const compressed = await snappy.compress(serialized);
      return encodeBase64(compressed);
    } catch (error) {
      logError(error as Error, {
        component: 'CompressionService',
        method: 'compressTransaction'
      });
      throw error;
    }
  }

  async decompressTransaction(compressed: string): Promise<Buffer> {
    try {
      const buffer = Buffer.from(decodeBase64(compressed));
      return await snappy.uncompress(buffer);
    } catch (error) {
      logError(error as Error, {
        component: 'CompressionService',
        method: 'decompressTransaction'
      });
      throw error;
    }
  }
}

================
File: src/services/relayer/index.ts
================
export * from './TransactionRelayer';
export * from './compression';
export * from './rateLimit';

================
File: src/services/relayer/queue.ts
================
import { Transaction } from '@solana/web3.js';
import { scaleConfig } from '../../config/scale';
import { logError } from '../../config/monitoring';

interface QueuedTransaction {
  id: string;
  transaction: Transaction;
  priority: number;
  timestamp: number;
  retries: number;
}

export class TransactionQueue {
  private static instance: TransactionQueue;
  private queue: QueuedTransaction[];
  private processing: boolean;
  private maxRetries: number;

  private constructor() {
    this.queue = [];
    this.processing = false;
    this.maxRetries = scaleConfig.limits.transaction.maxRetries;
    this.startProcessing();
  }

  static getInstance(): TransactionQueue {
    if (!TransactionQueue.instance) {
      TransactionQueue.instance = new TransactionQueue();
    }
    return TransactionQueue.instance;
  }

  async enqueue(
    transaction: Transaction,
    priority: number = 0
  ): Promise<string> {
    const id = Math.random().toString(36).substring(7);
    
    this.queue.push({
      id,
      transaction,
      priority,
      timestamp: Date.now(),
      retries: 0
    });

    // Sort by priority and timestamp
    this.queue.sort((a, b) => {
      if (a.priority !== b.priority) {
        return b.priority - a.priority;
      }
      return a.timestamp - b.timestamp;
    });

    return id;
  }

  private async startProcessing(): Promise<void> {
    if (this.processing) return;
    this.processing = true;

    while (true) {
      try {
        if (this.queue.length === 0) {
          await new Promise(resolve => setTimeout(resolve, 100));
          continue;
        }

        const item = this.queue[0];
        
        try {
          const relayer = TransactionRelayer.getInstance();
          await relayer.sendTransaction(item.transaction);
          this.queue.shift(); // Remove processed transaction
        } catch (error) {
          if (item.retries < this.maxRetries) {
            item.retries++;
            // Move to end of same priority group
            this.queue.shift();
            this.queue.push(item);
          } else {
            logError(error as Error, {
              component: 'TransactionQueue',
              method: 'processTransaction',
              transactionId: item.id
            });
            this.queue.shift(); // Remove failed transaction
          }
        }
      } catch (error) {
        logError(error as Error, {
          component: 'TransactionQueue',
          method: 'startProcessing'
        });
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
  }

  getQueueLength(): number {
    return this.queue.length;
  }

  getTransactionStatus(id: string): 'queued' | 'processing' | 'not_found' {
    const index = this.queue.findIndex(item => item.id === id);
    if (index === -1) return 'not_found';
    if (index === 0) return 'processing';
    return 'queued';
  }
}

================
File: src/services/relayer/rateLimit.ts
================
import { Cache } from '../../utils/cache';
import { scaleConfig } from '../../config/scale';
import { logError } from '../../config/monitoring';

export class RateLimiter {
  private static instance: RateLimiter;
  private cache: Cache;

  private constructor() {
    this.cache = Cache.getInstance();
  }

  static getInstance(): RateLimiter {
    if (!RateLimiter.instance) {
      RateLimiter.instance = new RateLimiter();
    }
    return RateLimiter.instance;
  }

  async checkLimit(
    key: string,
    limit: number,
    windowMs: number
  ): Promise<boolean> {
    const now = Date.now();
    const windowKey = `ratelimit:${key}:${Math.floor(now / windowMs)}`;
    
    try {
      const current = this.cache.get<number>(windowKey) || 0;
      
      if (current >= limit) {
        return false;
      }
      
      this.cache.set(windowKey, current + 1, windowMs);
      return true;
    } catch (error) {
      logError(error as Error, {
        component: 'RateLimiter',
        method: 'checkLimit',
        key,
        limit,
        windowMs
      });
      return false;
    }
  }

  async resetLimit(key: string): Promise<void> {
    const windowMs = scaleConfig.limits.rateLimit.windowMs;
    const windowKey = `ratelimit:${key}:${Math.floor(Date.now() / windowMs)}`;
    this.cache.delete(windowKey);
  }
}

================
File: src/services/relayer/TransactionRelayer.ts
================
import { Transaction, Connection, PublicKey } from '@solana/web3.js';
import { scaleConfig } from '../../config/scale';
import { logError } from '../../config/monitoring';
import { Cache } from '../../utils/cache';

export class TransactionRelayer {
  private static instance: TransactionRelayer;
  private endpoints: string[];
  private currentEndpoint: number;
  private cache: Cache;
  private failedEndpoints: Set<number>;

  private constructor() {
    this.endpoints = [
      `https://rpc.helius.xyz/?api-key=${import.meta.env.VITE_HELIUS_API_KEY}`,
      // Add additional relayer endpoints for load balancing
    ];
    this.currentEndpoint = 0;
    this.cache = Cache.getInstance();
    this.failedEndpoints = new Set();
  }

  static getInstance(): TransactionRelayer {
    if (!TransactionRelayer.instance) {
      TransactionRelayer.instance = new TransactionRelayer();
    }
    return TransactionRelayer.instance;
  }

  private getNextEndpoint(): string {
    // Reset if all endpoints have failed
    if (this.failedEndpoints.size === this.endpoints.length) {
      this.failedEndpoints.clear();
    }

    // Find next working endpoint
    while (this.failedEndpoints.has(this.currentEndpoint)) {
      this.currentEndpoint = (this.currentEndpoint + 1) % this.endpoints.length;
    }

    return this.endpoints[this.currentEndpoint];
  }

  async sendTransaction(transaction: Transaction, feePayer?: PublicKey): Promise<string> {
    const endpoint = this.getNextEndpoint();
    
    try {
      const connection = new Connection(endpoint);
      
      // If no fee payer provided, use relayer's
      if (!feePayer) {
        const response = await fetch(`${endpoint}/relayer/feePayer`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        const { publicKey } = await response.json();
        feePayer = new PublicKey(publicKey);
      }

      // Set fee payer and recent blockhash
      transaction.feePayer = feePayer;
      const { blockhash } = await connection.getLatestBlockhash();
      transaction.recentBlockhash = blockhash;

      // Send to relayer
      const serializedTx = transaction.serialize().toString('base64');
      const response = await fetch(`${endpoint}/relayer/submit`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ transaction: serializedTx })
      });

      if (!response.ok) {
        throw new Error(`Relayer error: ${response.statusText}`);
      }

      const { signature } = await response.json();
      
      // Wait for confirmation with retry logic
      let retries = 3;
      while (retries > 0) {
        try {
          const confirmation = await connection.confirmTransaction(signature);
          if (confirmation.value.err) {
            throw new Error(`Transaction failed: ${confirmation.value.err}`);
          }
          return signature;
        } catch (error) {
          retries--;
          if (retries === 0) throw error;
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      }

      throw new Error('Transaction confirmation failed after retries');
    } catch (error) {
      // Mark endpoint as failed
      this.failedEndpoints.add(this.currentEndpoint);
      this.currentEndpoint = (this.currentEndpoint + 1) % this.endpoints.length;

      logError(error as Error, {
        component: 'TransactionRelayer',
        method: 'sendTransaction',
        endpoint
      });
      throw error;
    }
  }

  async getTransactionStatus(signature: string): Promise<'success' | 'failed' | 'pending'> {
    const endpoint = this.getNextEndpoint();
    
    try {
      const connection = new Connection(endpoint);
      const status = await connection.getSignatureStatus(signature);
      
      if (!status || !status.value) return 'pending';
      if (status.value.err) return 'failed';
      return 'success';
    } catch (error) {
      logError(error as Error, {
        component: 'TransactionRelayer',
        method: 'getTransactionStatus',
        signature
      });
      return 'pending';
    }
  }
}

================
File: src/services/StateManager.ts
================
import { EventEmitter } from 'events';
import { Cache } from '../utils/cache';
import { scaleConfig } from '../config/scale';

export class StateManager {
  private static instance: StateManager | null = null;
  private emitter: EventEmitter;
  private cache: Cache;
  private syncInterval: number = 1000; // Sync every second
  private lastSync: number = 0;
  private pendingUpdates: Map<string, any> = new Map();

  private constructor() {
    this.emitter = new EventEmitter();
    this.emitter.setMaxListeners(100); // Increase max listeners for scaling
    this.cache = Cache.getInstance();
    this.setupAutoSync();
  }

  static getInstance(): StateManager {
    if (!StateManager.instance) {
      StateManager.instance = new StateManager();
    }
    return StateManager.instance;
  }

  private setupAutoSync() {
    setInterval(() => {
      const now = Date.now();
      if (now - this.lastSync >= this.syncInterval) {
        this.syncState();
        this.lastSync = now;
      }
    }, this.syncInterval);
  }

  private syncState() {
    // Process pending updates in batches
    if (this.pendingUpdates.size > 0) {
      const updates = Array.from(this.pendingUpdates.entries());
      const batchSize = scaleConfig.batch.leaderboardUpdate;
      
      for (let i = 0; i < updates.length; i += batchSize) {
        const batch = updates.slice(i, i + batchSize);
        batch.forEach(([key, value]) => {
          this.cache.set(key, value, scaleConfig.cache.player.profile);
          this.pendingUpdates.delete(key);
        });
      }
    }

    this.emitter.emit('stateSync');
  }

  public subscribe(event: string, callback: (...args: any[]) => void) {
    if (this.emitter.listenerCount(event) < scaleConfig.performance.maxWebSocketConnections) {
      this.emitter.on(event, callback);
      return () => this.emitter.off(event, callback);
    } else {
      console.warn(`Max listeners (${scaleConfig.performance.maxWebSocketConnections}) reached for event: ${event}`);
      return () => {};
    }
  }

  public publish(event: string, data?: any) {
    // Add to pending updates for batch processing
    this.pendingUpdates.set(event, data);
    
    // If we have enough updates, trigger a sync
    if (this.pendingUpdates.size >= scaleConfig.batch.leaderboardUpdate) {
      this.syncState();
    }

    this.lastSync = Date.now();
    localStorage.setItem('lastStateUpdate', Date.now().toString());
  }

  public getLastUpdate(): number {
    return parseInt(localStorage.getItem('lastStateUpdate') || '0');
  }

  public clearCache() {
    this.cache.clear();
    this.pendingUpdates.clear();
    this.lastSync = 0;
  }
}

export const stateManager = StateManager.getInstance();

================
File: src/services/submissionService.ts
================
import { QuestSubmissionRecord, SubmissionPage } from '../types/submission';
import { supabase } from './supabaseClient';

export interface QuestSubmission {
  id?: string;
  wallet: string;
  questId: string;
  proofLink: string;
  status: 'pending' | 'approved' | 'rejected';
  submissionDate: string;
  reviewDate?: string;
  reviewerNotes?: string;
}

class SubmissionService {
  private static instance: SubmissionService;

  private constructor() {}

  static getInstance(): SubmissionService {
    if (!SubmissionService.instance) {
      SubmissionService.instance = new SubmissionService();
    }
    return SubmissionService.instance;
  }

  async addSubmission(submission: Omit<QuestSubmission, 'id' | 'status' | 'submissionDate'>): Promise<boolean> {
    try {
      // Check if user is authenticated
      const session = await supabase.auth.getSession();
      if (!session) {
        console.error('User not authenticated');
        return false;
      }

      const { data, error } = await supabase
        .from('quest_submissions')
        .insert([{
          wallet: submission.wallet,
          quest_id: submission.questId,
          proof_link: submission.proofLink,
          status: 'pending',
          submission_date: new Date().toISOString()
        }])
        .select();

      if (error) {
        console.error('Error saving submission:', error);
        return false;
      }

      return true;
    } catch (error) {
      console.error('Failed to save submission:', error);
      return false;
    }
  }

  async getSubmissionPage(page: number): Promise<SubmissionPage> {
    try {
      const { data, error } = await supabase
        .from('quest_submissions')
        .select('*')
        .range((page - 1) * 10, page * 10 - 1)
        .order('submission_date', { ascending: false });

      if (error) {
        console.error('Error fetching submissions:', error);
        return {
          submissions: [],
          currentPage: page,
          totalPages: 1,
          totalSubmissions: 0
        };
      }

      const totalPages = Math.ceil((await this.getTotalSubmissions()) / 10);

      return {
        submissions: data.map(this.mapDatabaseSubmissionToSubmission),
        currentPage: page,
        totalPages,
        totalSubmissions: await this.getTotalSubmissions()
      };
    } catch (error) {
      console.error('Failed to fetch submissions:', error);
      return {
        submissions: [],
        currentPage: page,
        totalPages: 1,
        totalSubmissions: 0
      };
    }
  }

  async getTotalSubmissions(): Promise<number> {
    try {
      const { count, error } = await supabase
        .from('quest_submissions')
        .count();

      if (error) {
        console.error('Error fetching total submissions:', error);
        return 0;
      }

      return count;
    } catch (error) {
      console.error('Failed to fetch total submissions:', error);
      return 0;
    }
  }

  async deleteSubmission(id: string): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('quest_submissions')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('Error deleting submission:', error);
        return false;
      }

      return true;
    } catch (error) {
      console.error('Failed to delete submission:', error);
      return false;
    }
  }

  private mapDatabaseSubmissionToSubmission(dbSubmission: any): QuestSubmissionRecord {
    return {
      id: dbSubmission.id,
      wallet: dbSubmission.wallet,
      questId: dbSubmission.quest_id,
      proofLink: dbSubmission.proof_link,
      status: dbSubmission.status,
      dateSubmitted: new Date(dbSubmission.submission_date).getTime(),
      reviewDate: dbSubmission.review_date ? new Date(dbSubmission.review_date).getTime() : undefined,
      reviewerNotes: dbSubmission.reviewer_notes
    };
  }
}

export const submissionService = SubmissionService.getInstance();

================
File: src/services/supabaseAuth.ts
================
import { supabase } from './supabaseClient';
import { PublicKey } from '@solana/web3.js';
import bs58 from 'bs58';
import nacl from 'tweetnacl';
import { User } from '@supabase/supabase-js';

function generatePassword(signature: string): string {
  const encoder = new TextEncoder();
  const data = encoder.encode(signature);
  const hash = nacl.hash(data);
  return bs58.encode(hash).slice(0, 32);
}

// Handle rate limit with exponential backoff
async function handleRateLimit(error: any, attempt = 1): Promise<void> {
  const maxAttempts = 3;
  const baseDelay = 2000; // Start with 2 seconds
  const maxDelay = 10000; // Max 10 seconds

  if (attempt > maxAttempts) {
    throw new Error('Maximum retry attempts reached');
  }

  const delay = Math.min(baseDelay * Math.pow(2, attempt - 1), maxDelay);
  console.log(`Rate limited. Waiting ${delay/1000} seconds before retry...`);
  await new Promise(resolve => setTimeout(resolve, delay));
}

export async function signInWithWallet(wallet: string, signature: string, retryCount = 0): Promise<boolean> {
  const MAX_RETRIES = 3;
  const RETRY_DELAY = 1000;

  try {
    console.log('Starting wallet sign in process...', { wallet, retryCount });

    // Check for existing session first
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user) {
      console.log('User already has an active session');
      return true;
    }

    // Verify signature
    try {
      console.log('Verifying Solana wallet signature...');
      const message = `Welcome to Pan Da Pan!\n\nPlease sign this message to verify your wallet ownership.\n\nWallet: ${wallet}`;
      const messageBytes = new TextEncoder().encode(message);
      const signatureBytes = bs58.decode(signature);
      const publicKeyBytes = new PublicKey(wallet).toBytes();

      const verified = nacl.sign.detached.verify(
        messageBytes,
        signatureBytes,
        publicKeyBytes
      );

      if (!verified) {
        throw new Error('Invalid signature');
      }
      console.log('Signature verified successfully');
    } catch (error) {
      console.error('Signature verification failed:', error);
      throw new Error('Signature verification failed');
    }

    const email = `${wallet.toLowerCase()}@pandapan.com`;
    const password = generatePassword(signature);

    // First try to sign up the user
    try {
      console.log('Attempting to create account...');
      const { data: signUpData, error: signUpError } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: { wallet_address: wallet },
          emailRedirectTo: window.location.origin
        }
      });

      if (signUpData.session) {
        console.log('Sign up successful');
        return true;
      }

      // If user exists, try to sign in
      if (signUpError?.message?.includes('User already registered')) {
        console.log('User exists, attempting sign in...');
        const { data: signInData, error: signInError } = await supabase.auth.signInWithPassword({
          email,
          password,
        });

        if (signInData.session) {
          console.log('Sign in successful');
          return true;
        }

        if (signInError) {
          // If we get a rate limit error, wait and retry
          if (signInError.message.toLowerCase().includes('rate limit') && retryCount < MAX_RETRIES) {
            console.log(`Rate limited. Waiting ${RETRY_DELAY * Math.pow(2, retryCount)}ms before retry...`);
            await new Promise(resolve => setTimeout(resolve, RETRY_DELAY * Math.pow(2, retryCount)));
            return signInWithWallet(wallet, signature, retryCount + 1);
          }

          // If we get an email confirmation error, try admin sign in
          if (signInError.message.includes('Email not confirmed')) {
            console.log('Email not confirmed, attempting alternative sign in...');
            try {
              // Try one more time with a delay
              await new Promise(resolve => setTimeout(resolve, 1000));
              const { data: finalData, error: finalError } = await supabase.auth.signInWithPassword({
                email,
                password,
              });

              if (finalData.session) {
                console.log('Alternative sign in successful');
                return true;
              }

              if (finalError) {
                console.error('Alternative sign in failed:', finalError);
                throw finalError;
              }
            } catch (error) {
              console.error('Alternative sign in failed:', error);
              throw error;
            }
          }

          throw signInError;
        }
      }

      // If we get here with a sign up error, throw it
      if (signUpError) {
        throw signUpError;
      }
    } catch (error: any) {
      // Final retry attempt for any error
      if (retryCount < MAX_RETRIES) {
        console.log(`Retrying authentication (attempt ${retryCount + 1}/${MAX_RETRIES})...`);
        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY * Math.pow(2, retryCount)));
        return signInWithWallet(wallet, signature, retryCount + 1);
      }
      throw error;
    }

    return false;
  } catch (error) {
    console.error('Authentication failed:', error);
    throw error;
  }
}

export async function signOut(): Promise<void> {
  try {
    const { error } = await supabase.auth.signOut();
    if (error) {
      console.error('Error signing out:', error);
      throw error;
    }
  } catch (error) {
    console.error('Error signing out:', error);
    throw error;
  }
}

export async function getUser(): Promise<User | null> {
  const { data: { user } } = await supabase.auth.getUser();
  return user;
}

export function onAuthStateChange(callback: (user: User | null) => void) {
  return supabase.auth.onAuthStateChange((_event, session) => {
    callback(session?.user ?? null);
  });
}

================
File: src/services/supabaseClient.ts
================
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true
  }
});

================
File: src/services/supabaseService.ts
================
import { supabase } from '../lib/supabase'
import type { Database } from '../types/database'
import type { Player } from '../types/player'
import type { RaidState, RaidBoss, RaidParticipant, QuestSubmission } from '../types/raid'

export class SupabaseService {
  // Player Methods
  async createPlayer(player: Omit<Player, 'id'>): Promise<Player | null> {
    const { data, error } = await supabase
      .from('players')
      .insert({
        wallet: player.wallet,
        username: player.username,
        handle: player.handle,
        profile_picture: player.profilePicture,
        experience: player.experience,
        date_joined: new Date(player.dateJoined).toISOString(),
        quests_completed: player.questsCompleted,
        raid_bosses_defeated: player.raidBossesDefeated,
        last_quest_completion_time: new Date(player.lastQuestCompletionTime).toISOString(),
        show_wallet: player.showWallet,
        guild: player.guild,
        archetype: player.archetype,
        discord_handle: player.discordHandle
      })
      .select()
      .single()

    if (error) {
      console.error('Error creating player:', error)
      return null
    }

    return this.mapDatabasePlayerToPlayer(data)
  }

  async getPlayer(wallet: string): Promise<Player | null> {
    const { data, error } = await supabase
      .from('players')
      .select()
      .eq('wallet', wallet)
      .single()

    if (error) {
      console.error('Error fetching player:', error)
      return null
    }

    return this.mapDatabasePlayerToPlayer(data)
  }

  async updatePlayer(wallet: string, updates: Partial<Player>): Promise<Player | null> {
    const { data, error } = await supabase
      .from('players')
      .update({
        username: updates.username,
        handle: updates.handle,
        profile_picture: updates.profilePicture,
        experience: updates.experience,
        quests_completed: updates.questsCompleted,
        raid_bosses_defeated: updates.raidBossesDefeated,
        last_quest_completion_time: updates.lastQuestCompletionTime ? new Date(updates.lastQuestCompletionTime).toISOString() : undefined,
        show_wallet: updates.showWallet,
        guild: updates.guild,
        archetype: updates.archetype,
        discord_handle: updates.discordHandle
      })
      .eq('wallet', wallet)
      .select()
      .single()

    if (error) {
      console.error('Error updating player:', error)
      return null
    }

    return this.mapDatabasePlayerToPlayer(data)
  }

  // Raid Methods
  async createRaid(raid: RaidState): Promise<string | null> {
    const { data, error } = await supabase
      .from('raids')
      .insert({
        boss_name: raid.boss.name,
        boss_health: raid.boss.health,
        boss_max_health: raid.boss.maxHealth,
        boss_defense: raid.boss.defense,
        state: raid.state,
        start_time: new Date(raid.startTime).toISOString(),
        end_time: raid.endTime ? new Date(raid.endTime).toISOString() : null
      })
      .select('id')
      .single()

    if (error) {
      console.error('Error creating raid:', error)
      return null
    }

    return data.id
  }

  async getRaid(raidId: string): Promise<RaidState | null> {
    const { data: raidData, error: raidError } = await supabase
      .from('raids')
      .select('*')
      .eq('id', raidId)
      .single()

    if (raidError) {
      console.error('Error fetching raid:', raidError)
      return null
    }

    const { data: participantsData, error: participantsError } = await supabase
      .from('raid_participants')
      .select('*')
      .eq('raid_id', raidId)

    if (participantsError) {
      console.error('Error fetching raid participants:', participantsError)
      return null
    }

    const { data: questsData, error: questsError } = await supabase
      .from('quest_submissions')
      .select('*')
      .eq('raid_id', raidId)

    if (questsError) {
      console.error('Error fetching quest submissions:', questsError)
      return null
    }

    return this.mapDatabaseRaidToRaidState(raidData, participantsData, questsData)
  }

  // Helper methods for data mapping
  private mapDatabasePlayerToPlayer(data: Database['public']['Tables']['players']['Row']): Player {
    return {
      wallet: data.wallet,
      username: data.username,
      handle: data.handle,
      profilePicture: data.profile_picture,
      experience: data.experience,
      dateJoined: new Date(data.date_joined).getTime(),
      questsCompleted: data.quests_completed,
      raidBossesDefeated: data.raid_bosses_defeated,
      lastQuestCompletionTime: new Date(data.last_quest_completion_time).getTime(),
      showWallet: data.show_wallet,
      guild: data.guild,
      archetype: data.archetype,
      discordHandle: data.discord_handle
    }
  }

  private mapDatabaseRaidToRaidState(
    raidData: Database['public']['Tables']['raids']['Row'],
    participantsData: Database['public']['Tables']['raid_participants']['Row'][],
    questsData: Database['public']['Tables']['quest_submissions']['Row'][]
  ): RaidState {
    return {
      id: raidData.id,
      state: raidData.state as RaidState['state'],
      startTime: new Date(raidData.start_time).getTime(),
      endTime: raidData.end_time ? new Date(raidData.end_time).getTime() : null,
      boss: {
        name: raidData.boss_name,
        health: raidData.boss_health,
        maxHealth: raidData.boss_max_health,
        defense: raidData.boss_defense,
        quests: questsData.map(quest => ({
          type: quest.quest_type,
          completedBy: [quest.player_id]
        }))
      },
      participants: participantsData.map(participant => ({
        playerId: participant.player_id,
        joinTime: new Date(participant.join_time).getTime(),
        contribution: participant.contribution
      }))
    }
  }
}

================
File: src/services/twitterService.ts
================
import { TwitterProfile } from '../types/twitter';

class TwitterService {
  private static instance: TwitterService;
  private readonly TWITTER_API_URL = 'https://api.twitter.com/2';
  private readonly CLIENT_ID = 'your_client_id'; // Replace with your Twitter API credentials
  private readonly REDIRECT_URI = `${window.location.origin}/twitter-callback`;

  private constructor() {}

  static getInstance(): TwitterService {
    if (!TwitterService.instance) {
      TwitterService.instance = new TwitterService();
    }
    return TwitterService.instance;
  }

  initiateOAuth(): void {
    const scope = 'tweet.read users.read';
    const state = this.generateRandomState();
    localStorage.setItem('twitter_oauth_state', state);

    const params = new URLSearchParams({
      response_type: 'code',
      client_id: this.CLIENT_ID,
      redirect_uri: this.REDIRECT_URI,
      scope,
      state,
      code_challenge: 'challenge', // In production, generate a proper PKCE challenge
      code_challenge_method: 'plain'
    });

    window.location.href = `https://twitter.com/i/oauth2/authorize?${params.toString()}`;
  }

  async handleCallback(code: string, state: string): Promise<TwitterProfile | null> {
    const savedState = localStorage.getItem('twitter_oauth_state');
    if (!savedState || savedState !== state) {
      throw new Error('Invalid state parameter');
    }

    try {
      // Exchange code for access token
      const tokenResponse = await fetch('https://api.twitter.com/2/oauth2/token', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
          grant_type: 'authorization_code',
          code,
          redirect_uri: this.REDIRECT_URI,
          client_id: this.CLIENT_ID,
          code_verifier: 'challenge', // In production, use the same value used for code_challenge
        }),
      });

      if (!tokenResponse.ok) {
        throw new Error('Failed to exchange code for token');
      }

      const { access_token } = await tokenResponse.json();

      // Get user profile
      const userResponse = await fetch(`${this.TWITTER_API_URL}/users/me`, {
        headers: {
          'Authorization': `Bearer ${access_token}`,
        },
      });

      if (!userResponse.ok) {
        throw new Error('Failed to fetch user profile');
      }

      const userData = await userResponse.json();
      
      return {
        id: userData.data.id,
        username: userData.data.username,
        name: userData.data.name,
        profileImageUrl: userData.data.profile_image_url,
        verified: userData.data.verified,
      };
    } catch (error) {
      console.error('Twitter OAuth error:', error);
      return null;
    } finally {
      localStorage.removeItem('twitter_oauth_state');
    }
  }

  private generateRandomState(): string {
    return Math.random().toString(36).substring(2, 15);
  }
}

export const twitterService = TwitterService.getInstance();

================
File: src/services/userService.ts
================
interface UserStats {
  wallet: string;
  xp: number;
  questsCompleted: number;
  raidsParticipated: number;
  lastQuestCompletionTime: number;
}

class UserService {
  private static instance: UserService;
  private userStats: Map<string, UserStats> = new Map();

  private constructor() {}

  static getInstance(): UserService {
    if (!UserService.instance) {
      UserService.instance = new UserService();
    }
    return UserService.instance;
  }

  getUserStats(wallet: string): UserStats {
    if (!this.userStats.has(wallet)) {
      this.userStats.set(wallet, {
        wallet,
        xp: 0,
        questsCompleted: 0,
        raidsParticipated: 0,
        lastQuestCompletionTime: 0
      });
    }
    return this.userStats.get(wallet)!;
  }

  addXP(wallet: string, amount: number): void {
    const stats = this.getUserStats(wallet);
    stats.xp += amount;
    this.userStats.set(wallet, stats);
  }

  incrementQuestsCompleted(wallet: string): void {
    const stats = this.getUserStats(wallet);
    stats.questsCompleted += 1;
    stats.lastQuestCompletionTime = Date.now();
    this.userStats.set(wallet, stats);
  }

  incrementRaidsParticipated(wallet: string): void {
    const stats = this.getUserStats(wallet);
    stats.raidsParticipated += 1;
    this.userStats.set(wallet, stats);
  }

  getLeaderboard(): UserStats[] {
    return Array.from(this.userStats.values())
      .sort((a, b) => b.xp - a.xp)
      .slice(0, 100);
  }
}

export const userService = UserService.getInstance();

================
File: src/styles/base.css
================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  h1, h2, h3, h4, h5, h6 {
    @apply text-primary-500 dark:text-primary-400 font-bold;
  }

  h1 {
    @apply text-4xl sm:text-5xl lg:text-6xl;
  }

  h2 {
    @apply text-3xl sm:text-4xl lg:text-5xl;
  }

  h3 {
    @apply text-2xl sm:text-3xl lg:text-4xl;
  }

  h4 {
    @apply text-xl sm:text-2xl lg:text-3xl;
  }

  h5 {
    @apply text-lg sm:text-xl lg:text-2xl;
  }

  h6 {
    @apply text-base sm:text-lg lg:text-xl;
  }
}

@layer components {
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 
           rounded-lg font-semibold text-white
           bg-primary-500 hover:bg-primary-600 
           dark:bg-primary-600 dark:hover:bg-primary-700
           transition-colors duration-200
           disabled:opacity-50 disabled:cursor-not-allowed
           focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
           dark:focus:ring-primary-400 dark:focus:ring-offset-background-900;
  }

  .btn-secondary {
    @apply bg-sand-500 hover:bg-sand-600 
           dark:bg-sand-600 dark:hover:bg-sand-700
           focus:ring-sand-500 dark:focus:ring-sand-400;
  }

  .btn-outline {
    @apply border-2 border-primary-500 bg-transparent text-primary-500
           hover:bg-primary-500 hover:text-white
           dark:border-primary-400 dark:text-primary-400
           dark:hover:bg-primary-400 dark:hover:text-background-900;
  }

  .btn-sm {
    @apply px-3 py-1.5 text-sm;
  }

  .btn-lg {
    @apply px-6 py-3 text-lg;
  }
}

================
File: src/styles/wallet.css
================
/* Wallet Connection Styles */
.wallet-connect {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
}

.status-message {
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  transition: all 0.3s ease;
}

.status-message.connecting {
  background-color: #3b82f6;
  color: white;
}

.status-message.authenticating {
  background-color: #6366f1;
  color: white;
}

.status-message.error {
  background-color: #ef4444;
  color: white;
}

.status-message.connected {
  background-color: #10b981;
  color: white;
}

.retry-button {
  padding: 0.5rem 1rem;
  background-color: #4f46e5;
  color: white;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
  font-size: 0.875rem;
  transition: all 0.2s ease;
}

.retry-button:hover {
  background-color: #4338ca;
}

.retry-button:active {
  transform: scale(0.98);
}

/* Wallet Button Override Styles */
.wallet-adapter-button {
  height: 48px !important;
  padding: 0 24px !important;
  font-size: 16px !important;
  font-weight: 500 !important;
  border-radius: 12px !important;
  background-color: #4f46e5 !important;
  color: white !important;
  border: none !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
}

.wallet-adapter-button:not([disabled]):hover {
  background-color: #4338ca !important;
}

.wallet-adapter-button[disabled] {
  background-color: #6b7280 !important;
  cursor: not-allowed !important;
}

.wallet-adapter-button-trigger {
  background-color: #4f46e5 !important;
}

/* Wallet Modal Override Styles */
.wallet-adapter-modal-wrapper {
  background-color: #1f2937 !important;
}

.wallet-adapter-modal-button-close {
  background-color: #374151 !important;
}

.wallet-adapter-modal-list-more {
  color: #9ca3af !important;
}

.wallet-adapter-modal-list {
  margin: 0 0 4px !important;
}

.wallet-adapter-modal-list li:not(:first-of-type) {
  margin-top: 4px !important;
}

================
File: src/types/brand.ts
================
export interface BrandConfig {
  name: string;
  domain: string;
  title: string;
  description: string;

  social: {
    twitter: string;
    discord: string;
    github: string;
  };

  colors: {
    primary: {
      pink: string;
      coral: string;
      brown: string;
      blue: string;
      gold: string;
    };
    accent: {
      yellow: string;
      orange: string;
      teal: string;
      purple: string;
    };
    theme: {
      light: {
        background: string;
        card: string;
        text: {
          primary: string;
          secondary: string;
          muted: string;
        };
      };
      dark: {
        background: string;
        card: string;
        text: {
          primary: string;
          secondary: string;
          muted: string;
        };
      };
    };
  };

  fonts: {
    primary: string;
    display: string;
  };

  collection: {
    address: string;
    name: string;
  };

  admin: {
    wallet: string;
  };

  assets: {
    logo: string;
    favicon: string;
    defaultPfp: string;
    loadingScreen: string;
    music: string;
  };

  effects: {
    glassBlur: 'sm' | 'md' | 'lg' | 'xl';
    animationDuration: number;
    hoverScale: number;
  };

  rpc: {
    defaultEndpoint: string;
    defaultApiKey: string;
  };
}

================
File: src/types/database.ts
================
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export interface Database {
  public: {
    Tables: {
      players: {
        Row: {
          id: string
          wallet: string
          username: string | null
          handle: string | null
          profile_picture: string | null
          experience: number
          date_joined: string
          quests_completed: number
          raid_bosses_defeated: number
          last_quest_completion_time: string
          show_wallet: boolean
          guild: string | null
          archetype: string | null
          discord_handle: string | null
          created_at: string
          updated_at: string
        }
        Insert: Omit<Database['public']['Tables']['players']['Row'], 'id' | 'created_at' | 'updated_at'>
        Update: Partial<Database['public']['Tables']['players']['Insert']>
      }
      raids: {
        Row: {
          id: string
          boss_name: string
          boss_health: number
          boss_max_health: number
          boss_defense: number
          state: string
          start_time: string
          end_time: string | null
          created_at: string
          updated_at: string
        }
        Insert: Omit<Database['public']['Tables']['raids']['Row'], 'id' | 'created_at' | 'updated_at'>
        Update: Partial<Database['public']['Tables']['raids']['Insert']>
      }
      raid_participants: {
        Row: {
          id: string
          raid_id: string
          player_id: string
          join_time: string
          contribution: number
          created_at: string
          updated_at: string
        }
        Insert: Omit<Database['public']['Tables']['raid_participants']['Row'], 'id' | 'created_at' | 'updated_at'>
        Update: Partial<Database['public']['Tables']['raid_participants']['Insert']>
      }
      quest_submissions: {
        Row: {
          id: string
          raid_id: string
          player_id: string
          quest_type: string
          submission_time: string
          verified: boolean
          created_at: string
          updated_at: string
        }
        Insert: Omit<Database['public']['Tables']['quest_submissions']['Row'], 'id' | 'created_at' | 'updated_at'>
        Update: Partial<Database['public']['Tables']['quest_submissions']['Insert']>
      }
    }
  }
}

================
File: src/types/guild.ts
================
import { GuildArchetype } from './player';

export interface GuildBank {
  address: string;
  balance: number;
  weeklyReward: number;
  lastRewardDate: number;
}

export interface Guild {
  id: string;
  name: string;
  description: string;
  imageUrl?: string;
  members: string[];
  leaders: string[];
  totalXp: number;
  dateCreated: number;
  archetype: GuildArchetype;
  isCore: boolean;
  isDeleted?: boolean;
  bank?: GuildBank;
  questLimits?: {
    daily: number;
    weekly: number;
    monthly: number;
  };
  membershipRequests?: string[];
}

export interface GuildStats {
  id: string;
  name: string;
  description: string;
  imageUrl?: string;
  memberCount: number;
  totalXp: number;
  dailyXp: number;
  weeklyXp: number;
  monthlyXp: number;
  bankBalance?: number;
}

export interface GuildMember {
  wallet: string;
  username: string | null;
  profilePicture: string | null;
  experience: number;
  joinDate: number;
  isLeader: boolean;
}

export const CORE_GUILDS: Guild[] = [
  {
    id: 'aureus-coven',
    name: 'The Aureus Coven',
    description: 'Masters of financial wisdom and strategic wealth building.',
    imageUrl: '/assets/guilds/aureus-coven.jpg',
    archetype: 'Finance',
    isCore: true,
    leaders: [],
    members: [],
    totalXp: 0,
    dateCreated: Date.now(),
    questLimits: {
      daily: 5,
      weekly: 3,
      monthly: 1
    }
  },
  {
    id: 'emberseekers',
    name: 'The Emberseekers',
    description: 'Daring explorers guided by ancient flames.',
    imageUrl: '/assets/guilds/emberseekers.jpg',
    archetype: 'Adventurer',
    isCore: true,
    leaders: [],
    members: [],
    totalXp: 0,
    dateCreated: Date.now(),
    questLimits: {
      daily: 5,
      weekly: 3,
      monthly: 1
    }
  },
  {
    id: 'solacebound',
    name: 'The Solacebound',
    description: 'Guardians of peace and community welfare.',
    imageUrl: '/assets/guilds/solacebound.jpg',
    archetype: 'Philanthropist',
    isCore: true,
    leaders: [],
    members: [],
    totalXp: 0,
    dateCreated: Date.now(),
    questLimits: {
      daily: 5,
      weekly: 3,
      monthly: 1
    }
  },
  {
    id: 'revelkin',
    name: 'The Revelkin',
    description: 'Celebrants of joy and festive spirit.',
    imageUrl: '/assets/guilds/revelkin.jpg',
    archetype: 'PartyAnimal',
    isCore: true,
    leaders: [],
    members: [],
    totalXp: 0,
    dateCreated: Date.now(),
    questLimits: {
      daily: 5,
      weekly: 3,
      monthly: 1
    }
  }
];

export const DEFAULT_COMMUNITY_GUILDS: Guild[] = [
  {
    id: 'community-guild-1',
    name: 'Bamboo Brigade',
    description: 'Elite warriors who protect the sacred bamboo forests and train in ancient panda martial arts',
    imageUrl: '/assets/pandas/raidpanda.PNG',
    members: [],
    leaders: [],
    totalXp: 0,
    dateCreated: Date.now(),
    archetype: 'Adventurer',
    isCore: false
  },
  {
    id: 'community-guild-2',
    name: 'Mystic Moonwalkers',
    description: 'Spiritual pandas who harness the power of moonlight and ancient wisdom',
    imageUrl: '/assets/pandas/tiltedpanda.PNG',
    members: [],
    leaders: [],
    totalXp: 0,
    dateCreated: Date.now(),
    archetype: 'Philanthropist',
    isCore: false
  },
  {
    id: 'community-guild-3',
    name: 'Crypto Cubs',
    description: 'Tech-savvy pandas revolutionizing the bamboo economy through blockchain innovation',
    imageUrl: '/assets/pandas/happypanda.PNG',
    members: [],
    leaders: [],
    totalXp: 0,
    dateCreated: Date.now(),
    archetype: 'Finance',
    isCore: false
  },
  {
    id: 'community-guild-4',
    name: 'Party Pandas',
    description: 'The most energetic pandas around, known for their legendary bamboo festivals',
    imageUrl: '/assets/pandas/chillingpanda.PNG',
    members: [],
    leaders: [],
    totalXp: 0,
    dateCreated: Date.now(),
    archetype: 'PartyAnimal',
    isCore: false
  }
];

================
File: src/types/index.ts
================
// Export all types
export * from './brand';
export * from './guild';
export * from './nft';
export * from './player';
export * from './quest';
export * from './raid';
export * from './submission';
export * from './twitter';

================
File: src/types/nft.ts
================
export interface NFTMetadata {
  name: string;
  symbol: string;
  description: string;
  image: string;
  mint: string;
  attributes: Array<{
    trait_type: string;
    value: string;
  }>;
  properties: {
    files: Array<{
      uri: string;
      type: string;
    }>;
  };
}

================
File: src/types/player.ts
================
export interface Player {
  wallet: string;
  username?: string;
  experience: number;
  level?: number;
  rank?: number;
  last_signed_message?: string;
  last_signature?: string;
  last_nonce?: string;
  updated_at?: string;
  created_at?: string;
  questsCompleted: number;
  raidBossesDefeated: number;
  totalRaidsParticipated: number;
  archetype?: string;
  guild?: string;
  dateJoined: string;
  lastLogin: string;
  profile_picture?: string;
  discordHandle?: string;
  achievements?: string[];
}

================
File: src/types/quest.ts
================
export interface Quest {
  id: string;
  type: 'daily' | 'weekly' | 'monthly' | 'raid-boss';
  description: string;
  xpReward: number;
  dateCreated: number;
  dateAvailable: number;
  dateExpires: number;
  status: 'available' | 'completed' | 'expired';
  completedBy?: string[];
  isAutomatic?: boolean;
  proof?: {
    wallet: string;
    screenshot?: string;
    url: string;
    dateSubmitted: number;
  }[];
  imageUrl?: string;
  questUrl?: string;
  isRaidBoss?: boolean;
}

export interface QuestSubmission {
  screenshot?: File;
  url: string;
}

================
File: src/types/raid.ts
================
interface RaidQuest {
  id: string;
  description: string;
  xpReward: number;
  completedBy: string[]; // Wallet addresses
}

export interface RaidBoss {
  id: string;
  name: string;
  level: number;
  health: number;
  maxHealth: number;
  defense: number;
  imageUrl: string;
  twitterHandle: string;
  description: string;
  quests: RaidQuest[];
  rewards: {
    xp: number;
    bonusXp: number;
  };
}

export interface RaidParticipant {
  wallet: string;
  nftId: string;
  questsCompleted: number;
  lastQuestCompletionTime: number;
}

export interface RaidState {
  id: string;
  boss: RaidBoss;
  participants: RaidParticipant[];
  startTime: number;
  endTime: number;
  status: 'preparing' | 'active' | 'completed' | 'failed';
  questCompletions: number;
}

export interface RaidReward {
  wallet: string;
  xp: number;
  bonusXp?: number;
  rank: number;
}

export interface QuestSubmission {
  screenshot?: File;
  url: string;
}

================
File: src/types/submission.ts
================
export interface QuestSubmissionRecord {
  id: string;
  questId: string;
  questType: 'quest' | 'raid';
  raidId?: string;
  wallet: string;
  url: string;
  screenshot?: string;
  dateSubmitted: number;
}

export interface SubmissionPage {
  submissions: QuestSubmissionRecord[];
  currentPage: number;
  totalPages: number;
  totalSubmissions: number;
}

================
File: src/types/supabase.ts
================
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  public: {
    Tables: {
      guilds: {
        Row: {
          created_at: string | null
          description: string | null
          experience: number | null
          id: string
          leader_id: string | null
          level: number | null
          max_members: number | null
          members_count: number | null
          name: string
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          description?: string | null
          experience?: number | null
          id?: string
          leader_id?: string | null
          level?: number | null
          max_members?: number | null
          members_count?: number | null
          name: string
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          description?: string | null
          experience?: number | null
          id?: string
          leader_id?: string | null
          level?: number | null
          max_members?: number | null
          members_count?: number | null
          name?: string
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "guilds_leader_id_fkey"
            columns: ["leader_id"]
            isOneToOne: false
            referencedRelation: "players"
            referencedColumns: ["id"]
          },
        ]
      }
      players: {
        Row: {
          archetype: string | null
          created_at: string | null
          date_joined: string | null
          discord_handle: string | null
          experience: number | null
          guild_id: string | null
          id: string
          last_nonce: string | null
          last_quest_completion_time: string | null
          last_signature: string | null
          last_signed_message: string | null
          level: number | null
          quests_completed: number | null
          raid_bosses_defeated: number | null
          show_wallet: boolean | null
          status: Database["public"]["Enums"]["user_status"] | null
          updated_at: string | null
          username: string | null
          wallet: string
        }
        Insert: {
          archetype?: string | null
          created_at?: string | null
          date_joined?: string | null
          discord_handle?: string | null
          experience?: number | null
          guild_id?: string | null
          id?: string
          last_nonce?: string | null
          last_quest_completion_time?: string | null
          last_signature?: string | null
          last_signed_message?: string | null
          level?: number | null
          quests_completed?: number | null
          raid_bosses_defeated?: number | null
          show_wallet?: boolean | null
          status?: Database["public"]["Enums"]["user_status"] | null
          updated_at?: string | null
          username?: string | null
          wallet: string
        }
        Update: {
          archetype?: string | null
          created_at?: string | null
          date_joined?: string | null
          discord_handle?: string | null
          experience?: number | null
          guild_id?: string | null
          id?: string
          last_nonce?: string | null
          last_quest_completion_time?: string | null
          last_signature?: string | null
          last_signed_message?: string | null
          level?: number | null
          quests_completed?: number | null
          raid_bosses_defeated?: number | null
          show_wallet?: boolean | null
          status?: Database["public"]["Enums"]["user_status"] | null
          updated_at?: string | null
          username?: string | null
          wallet?: string
        }
        Relationships: [
          {
            foreignKeyName: "fk_guild"
            columns: ["guild_id"]
            isOneToOne: false
            referencedRelation: "guilds"
            referencedColumns: ["id"]
          },
        ]
      }
      profiles: {
        Row: {
          created_at: string
          id: string
          last_nonce: string | null
          last_signature: string | null
          last_signed_message: string | null
          updated_at: string
          wallet_address: string
        }
        Insert: {
          created_at?: string
          id: string
          last_nonce?: string | null
          last_signature?: string | null
          last_signed_message?: string | null
          updated_at?: string
          wallet_address: string
        }
        Update: {
          created_at?: string
          id?: string
          last_nonce?: string | null
          last_signature?: string | null
          last_signed_message?: string | null
          updated_at?: string
          wallet_address?: string
        }
        Relationships: []
      }
      quest_submissions: {
        Row: {
          created_at: string | null
          id: string
          player_id: string | null
          proof_url: string | null
          quest_id: string | null
          screenshot_url: string | null
          status: string | null
          updated_at: string | null
          verified: boolean | null
          verified_at: string | null
        }
        Insert: {
          created_at?: string | null
          id?: string
          player_id?: string | null
          proof_url?: string | null
          quest_id?: string | null
          screenshot_url?: string | null
          status?: string | null
          updated_at?: string | null
          verified?: boolean | null
          verified_at?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          player_id?: string | null
          proof_url?: string | null
          quest_id?: string | null
          screenshot_url?: string | null
          status?: string | null
          updated_at?: string | null
          verified?: boolean | null
          verified_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "quest_submissions_player_id_fkey"
            columns: ["player_id"]
            isOneToOne: false
            referencedRelation: "players"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "quest_submissions_quest_id_fkey"
            columns: ["quest_id"]
            isOneToOne: false
            referencedRelation: "quests"
            referencedColumns: ["id"]
          },
        ]
      }
      quests: {
        Row: {
          completed_by: string[] | null
          created_at: string | null
          date_available: string | null
          date_expires: string | null
          description: string
          id: string
          image_url: string | null
          is_automatic: boolean | null
          is_raid_boss: boolean | null
          quest_url: string | null
          requirements: Json | null
          status: Database["public"]["Enums"]["quest_status"] | null
          title: string
          type: Database["public"]["Enums"]["quest_type"]
          updated_at: string | null
          xp_reward: number
        }
        Insert: {
          completed_by?: string[] | null
          created_at?: string | null
          date_available?: string | null
          date_expires?: string | null
          description: string
          id?: string
          image_url?: string | null
          is_automatic?: boolean | null
          is_raid_boss?: boolean | null
          quest_url?: string | null
          requirements?: Json | null
          status?: Database["public"]["Enums"]["quest_status"] | null
          title: string
          type: Database["public"]["Enums"]["quest_type"]
          updated_at?: string | null
          xp_reward: number
        }
        Update: {
          completed_by?: string[] | null
          created_at?: string | null
          date_available?: string | null
          date_expires?: string | null
          description?: string
          id?: string
          image_url?: string | null
          is_automatic?: boolean | null
          is_raid_boss?: boolean | null
          quest_url?: string | null
          requirements?: Json | null
          status?: Database["public"]["Enums"]["quest_status"] | null
          title?: string
          type?: Database["public"]["Enums"]["quest_type"]
          updated_at?: string | null
          xp_reward?: number
        }
        Relationships: []
      }
      raid_participants: {
        Row: {
          created_at: string | null
          damage_dealt: number | null
          id: string
          joined_at: string | null
          player_id: string | null
          raid_id: string | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          damage_dealt?: number | null
          id?: string
          joined_at?: string | null
          player_id?: string | null
          raid_id?: string | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          damage_dealt?: number | null
          id?: string
          joined_at?: string | null
          player_id?: string | null
          raid_id?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "raid_participants_player_id_fkey"
            columns: ["player_id"]
            isOneToOne: false
            referencedRelation: "players"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "raid_participants_raid_id_fkey"
            columns: ["raid_id"]
            isOneToOne: false
            referencedRelation: "raids"
            referencedColumns: ["id"]
          },
        ]
      }
      raids: {
        Row: {
          created_at: string | null
          current_health: number
          description: string
          difficulty: number
          end_time: string | null
          id: string
          name: string
          start_time: string | null
          status: string | null
          total_health: number
          updated_at: string | null
          xp_reward: number
        }
        Insert: {
          created_at?: string | null
          current_health: number
          description: string
          difficulty: number
          end_time?: string | null
          id?: string
          name: string
          start_time?: string | null
          status?: string | null
          total_health: number
          updated_at?: string | null
          xp_reward: number
        }
        Update: {
          created_at?: string | null
          current_health?: number
          description?: string
          difficulty?: number
          end_time?: string | null
          id?: string
          name?: string
          start_time?: string | null
          status?: string | null
          total_health?: number
          updated_at?: string | null
          xp_reward?: number
        }
        Relationships: []
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      complete_quest: {
        Args: {
          p_quest_id: string
          p_player_id: string
        }
        Returns: boolean
      }
      verify_wallet_signature: {
        Args: {
          wallet_address: string
          message: string
          signature: string
        }
        Returns: boolean
      }
    }
    Enums: {
      quest_status: "available" | "completed" | "expired"
      quest_type: "daily" | "weekly" | "monthly" | "raid-boss"
      user_status: "active" | "inactive" | "banned"
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type PublicSchema = Database[Extract<keyof Database, "public">]

export type Tables<
  PublicTableNameOrOptions extends
    | keyof (PublicSchema["Tables"] & PublicSchema["Views"])
    | { schema: keyof Database },
  TableName extends PublicTableNameOrOptions extends { schema: keyof Database }
    ? keyof (Database[PublicTableNameOrOptions["schema"]]["Tables"] &
        Database[PublicTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = PublicTableNameOrOptions extends { schema: keyof Database }
  ? (Database[PublicTableNameOrOptions["schema"]]["Tables"] &
      Database[PublicTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : PublicTableNameOrOptions extends keyof (PublicSchema["Tables"] &
        PublicSchema["Views"])
    ? (PublicSchema["Tables"] &
        PublicSchema["Views"])[PublicTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  PublicTableNameOrOptions extends
    | keyof PublicSchema["Tables"]
    | { schema: keyof Database },
  TableName extends PublicTableNameOrOptions extends { schema: keyof Database }
    ? keyof Database[PublicTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = PublicTableNameOrOptions extends { schema: keyof Database }
  ? Database[PublicTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : PublicTableNameOrOptions extends keyof PublicSchema["Tables"]
    ? PublicSchema["Tables"][PublicTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  PublicTableNameOrOptions extends
    | keyof PublicSchema["Tables"]
    | { schema: keyof Database },
  TableName extends PublicTableNameOrOptions extends { schema: keyof Database }
    ? keyof Database[PublicTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = PublicTableNameOrOptions extends { schema: keyof Database }
  ? Database[PublicTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : PublicTableNameOrOptions extends keyof PublicSchema["Tables"]
    ? PublicSchema["Tables"][PublicTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  PublicEnumNameOrOptions extends
    | keyof PublicSchema["Enums"]
    | { schema: keyof Database },
  EnumName extends PublicEnumNameOrOptions extends { schema: keyof Database }
    ? keyof Database[PublicEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = PublicEnumNameOrOptions extends { schema: keyof Database }
  ? Database[PublicEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : PublicEnumNameOrOptions extends keyof PublicSchema["Enums"]
    ? PublicSchema["Enums"][PublicEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof PublicSchema["CompositeTypes"]
    | { schema: keyof Database },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof Database
  }
    ? keyof Database[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends { schema: keyof Database }
  ? Database[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof PublicSchema["CompositeTypes"]
    ? PublicSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

================
File: src/types/twitter.ts
================
export interface TwitterProfile {
  id: string;
  username: string;
  name: string;
  profileImageUrl: string;
  verified: boolean;
}

================
File: src/utils/address.ts
================
/**
 * Shortens a blockchain address to a more readable format
 * @param address The full address to shorten
 * @param startLength Number of characters to keep at the start (default: 4)
 * @param endLength Number of characters to keep at the end (default: 4)
 * @returns The shortened address with ellipsis
 */
export const shortenAddress = (
  address: string,
  startLength: number = 4,
  endLength: number = 4
): string => {
  if (!address) return '';
  if (address.length <= startLength + endLength) return address;
  
  const start = address.slice(0, startLength);
  const end = address.slice(-endLength);
  
  return `${start}...${end}`;
};

================
File: src/utils/api.ts
================
import axios from 'axios';
import { NFTMetadata } from '../types/nft';
import { Cache } from './cache';

// Load RPC settings from localStorage or use default
const getRPCSettings = () => {
  const customRpcUrl = localStorage.getItem('custom_rpc_url');
  const customApiKey = localStorage.getItem('custom_api_key');
  
  if (customRpcUrl && customApiKey) {
    return {
      url: customRpcUrl,
      apiKey: customApiKey
    };
  }
  
  return {
    url: 'https://mainnet.helius-rpc.com',
    apiKey: '294dd1b6-c58f-4fd1-bebf-2b17a910915a'
  };
};

const COLLECTION_ADDRESS = 'Hcudg3n6ggbc5kMo2ZtVbXKJb7oXhNCQxJsY42ZMiPpp';
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes cache duration

const cache = Cache.getInstance();

const getRpcUrl = () => {
  const settings = getRPCSettings();
  return `${settings.url}/?api-key=${settings.apiKey}`;
};

export async function fetchCollectionNFTs(): Promise<NFTMetadata[]> {
  const cacheKey = 'collection_nfts';
  const cachedData = cache.get<NFTMetadata[]>(cacheKey);
  
  if (cachedData) {
    return cachedData;
  }

  try {
    const response = await axios.post(getRpcUrl(), {
      jsonrpc: '2.0',
      id: 'my-id',
      method: 'getAssetsByGroup',
      params: {
        groupKey: 'collection',
        groupValue: COLLECTION_ADDRESS,
        page: 1,
        limit: 50, // Reduced limit to minimize data transfer
        sortBy: {
          sortBy: 'created',
          sortDirection: 'desc'
        }
      },
    });

    if (response.data.error) {
      throw new Error(response.data.error.message);
    }

    const nfts = parseNFTResponse(response.data.result.items);
    cache.set(cacheKey, nfts, CACHE_DURATION);
    return nfts;
  } catch (error) {
    console.error('Error fetching collection NFTs:', error);
    return [];
  }
}

export async function fetchWalletNFTs(walletAddress: string): Promise<NFTMetadata[]> {
  const cacheKey = `wallet_nfts_${walletAddress}`;
  const cachedData = cache.get<NFTMetadata[]>(cacheKey);
  
  if (cachedData) {
    return cachedData;
  }

  try {
    const response = await axios.post(getRpcUrl(), {
      jsonrpc: '2.0',
      id: 'my-id',
      method: 'getAssetsByOwner',
      params: {
        ownerAddress: walletAddress,
        page: 1,
        limit: 25, // Reduced limit for wallet NFTs
        displayOptions: {
          showCollectionMetadata: true
        }
      },
    });

    if (response.data.error) {
      throw new Error(response.data.error.message);
    }

    const collectionNFTs = response.data.result.items.filter(
      (item: any) => item.grouping.find((g: any) => 
        g.group_key === 'collection' && 
        g.group_value === COLLECTION_ADDRESS
      )
    );

    const nfts = parseNFTResponse(collectionNFTs);
    cache.set(cacheKey, nfts, CACHE_DURATION);
    return nfts;
  } catch (error) {
    console.error('Error fetching wallet NFTs:', error);
    return [];
  }
}

function parseNFTResponse(items: any[]): NFTMetadata[] {
  return items.map((asset: any) => ({
    name: asset.content.metadata.name || 'Unnamed NFT',
    symbol: asset.content.metadata.symbol || '',
    description: asset.content.metadata.description || '',
    image: asset.content.files[0]?.uri || '',
    mint: asset.id,
    attributes: asset.content.metadata.attributes || [],
    properties: {
      files: (asset.content.files || []).map((file: any) => ({
        uri: file.uri || '',
        type: file.type || '',
      })),
    },
  }));
}

================
File: src/utils/cache.ts
================
export class Cache {
  private static instance: Cache;
  private storage: Map<string, any>;
  private maxSize: number;
  private useCompression: boolean;

  private constructor() {
    this.storage = new Map();
    this.maxSize = 100 * 1024 * 1024; // Default 100MB
    this.useCompression = false;
  }

  static getInstance(): Cache {
    if (!Cache.instance) {
      Cache.instance = new Cache();
    }
    return Cache.instance;
  }

  setMaxSize(bytes: number): void {
    this.maxSize = bytes;
  }

  enableCompression(enabled: boolean): void {
    this.useCompression = enabled;
  }

  set(key: string, value: any, duration: number): void {
    const item = {
      value,
      timestamp: Date.now(),
      expiry: duration
    };

    if (this.useCompression && typeof value === 'string') {
      item.value = this.compress(value);
    }

    this.storage.set(key, item);
    this.enforceMaxSize();
  }

  get<T>(key: string): T | null {
    const item = this.storage.get(key);
    if (!item) return null;

    if (Date.now() - item.timestamp > item.expiry) {
      this.storage.delete(key);
      return null;
    }

    if (this.useCompression && typeof item.value === 'string') {
      return this.decompress(item.value) as T;
    }

    return item.value as T;
  }

  clear(): void {
    this.storage.clear();
  }

  private enforceMaxSize(): void {
    if (this.getSize() > this.maxSize) {
      const entries = Array.from(this.storage.entries());
      entries.sort((a, b) => a[1].timestamp - b[1].timestamp);
      
      while (this.getSize() > this.maxSize && entries.length) {
        const [key] = entries.shift()!;
        this.storage.delete(key);
      }
    }
  }

  private getSize(): number {
    let size = 0;
    for (const [key, value] of this.storage) {
      size += key.length * 2; // UTF-16 characters
      size += this.getObjectSize(value);
    }
    return size;
  }

  private getObjectSize(obj: any): number {
    const str = JSON.stringify(obj);
    return str.length * 2; // UTF-16 characters
  }

  private compress(str: string): string {
    // Simple RLE compression for demo
    let compressed = '';
    let count = 1;
    let current = str[0];

    for (let i = 1; i <= str.length; i++) {
      if (str[i] === current) {
        count++;
      } else {
        compressed += count + current;
        current = str[i];
        count = 1;
      }
    }

    return compressed;
  }

  private decompress(str: string): string {
    // Simple RLE decompression
    let decompressed = '';
    let count = '';

    for (let i = 0; i < str.length; i++) {
      if (!isNaN(parseInt(str[i]))) {
        count += str[i];
      } else {
        decompressed += str[i].repeat(parseInt(count));
        count = '';
      }
    }

    return decompressed;
  }
}

================
File: src/utils/cn.ts
================
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(...inputs));
}

================
File: src/utils/env.ts
================
// Utility to check environment variables
export const checkEnvVariables = () => {
  const envVars = {
    SUPABASE_URL: import.meta.env.VITE_SUPABASE_URL?.trim(),
    SUPABASE_KEY: import.meta.env.VITE_SUPABASE_ANON_KEY?.trim(),
    SOLANA_RPC: import.meta.env.VITE_SOLANA_RPC_URL?.trim(),
    SOLANA_NETWORK: import.meta.env.VITE_SOLANA_NETWORK?.trim(),
    HELIUS_API_KEY: import.meta.env.VITE_HELIUS_API_KEY?.trim()
  };

  // Validate Supabase configuration
  if (!envVars.SUPABASE_URL || !envVars.SUPABASE_URL.startsWith('https://')) {
    console.error('Invalid SUPABASE_URL:', envVars.SUPABASE_URL);
    throw new Error('Invalid SUPABASE_URL format');
  }

  if (!envVars.SUPABASE_KEY || !envVars.SUPABASE_KEY.includes('eyJ')) {
    console.error('Invalid SUPABASE_KEY format');
    throw new Error('Invalid SUPABASE_KEY format');
  }

  // Validate Solana configuration
  if (!envVars.SOLANA_RPC || !envVars.SOLANA_RPC.startsWith('https://')) {
    console.error('Invalid SOLANA_RPC:', envVars.SOLANA_RPC);
    throw new Error('Invalid SOLANA_RPC format');
  }

  if (!envVars.SOLANA_NETWORK || !['mainnet-beta', 'testnet', 'devnet'].includes(envVars.SOLANA_NETWORK)) {
    console.error('Invalid SOLANA_NETWORK:', envVars.SOLANA_NETWORK);
    throw new Error('Invalid SOLANA_NETWORK format');
  }

  // Log environment status in development
  if (import.meta.env.DEV) {
    console.log('Environment Variables Status:', {
      SUPABASE_URL: envVars.SUPABASE_URL ? 'configured' : 'missing',
      SUPABASE_KEY: envVars.SUPABASE_KEY ? 'configured' : 'missing',
      SOLANA_RPC: envVars.SOLANA_RPC ? 'configured' : 'missing',
      SOLANA_NETWORK: envVars.SOLANA_NETWORK || 'missing',
      HELIUS_API_KEY: envVars.HELIUS_API_KEY ? 'configured' : 'missing'
    });
  }

  return envVars;
};

================
File: src/utils/errorBoundary.ts
================
import { Component, ErrorInfo, ReactNode } from 'react';
import { logError } from '../config/monitoring';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false,
    error: null
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    logError(error, {
      componentStack: errorInfo.componentStack,
      timestamp: Date.now()
    });
  }

  public render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="min-h-screen flex items-center justify-center bg-gradient-radial from-primary-main/5 via-primary-main/10 to-transparent">
          <div className="gradient-box p-8 max-w-md mx-auto text-center">
            <h2 className="text-2xl font-bold text-text-light-primary dark:text-white mb-4">
              Something went wrong
            </h2>
            <p className="text-text-light-secondary dark:text-text-dark-secondary mb-6">
              We apologize for the inconvenience. Please try refreshing the page.
            </p>
            <button
              onClick={() => window.location.reload()}
              className="px-6 py-2 bg-primary-main hover:bg-primary-main/90 text-white rounded-lg transition-colors shadow-glow"
            >
              Refresh Page
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

================
File: src/utils/imageCompression.ts
================
import imageCompression from 'browser-image-compression';

interface CompressionOptions {
  maxSizeMB: number;
  maxWidthOrHeight: number;
  useWebWorker?: boolean;
  fileType?: string;
}

export async function compressImage(
  dataUrl: string,
  options: CompressionOptions
): Promise<string> {
  try {
    // Convert data URL to File object
    const response = await fetch(dataUrl);
    const blob = await response.blob();
    const file = new File([blob], 'image.png', { type: 'image/png' });

    // Compress the image
    const compressedFile = await imageCompression(file, {
      maxSizeMB: options.maxSizeMB,
      maxWidthOrHeight: options.maxWidthOrHeight,
      useWebWorker: options.useWebWorker ?? true,
      fileType: options.fileType ?? 'image/png'
    });

    // Convert compressed file back to data URL
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result as string);
      reader.onerror = reject;
      reader.readAsDataURL(compressedFile);
    });
  } catch (error) {
    console.error('Image compression failed:', error);
    // Return original image if compression fails
    return dataUrl;
  }
}

================
File: src/utils/imageCompressor.ts
================
export async function compressImage(file: File): Promise<string> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        if (!ctx) {
          reject(new Error('Failed to get canvas context'));
          return;
        }

        // Calculate new dimensions (max 800px width/height)
        const maxSize = 800;
        let width = img.width;
        let height = img.height;

        if (width > height) {
          if (width > maxSize) {
            height = Math.round(height * maxSize / width);
            width = maxSize;
          }
        } else {
          if (height > maxSize) {
            width = Math.round(width * maxSize / height);
            height = maxSize;
          }
        }

        canvas.width = width;
        canvas.height = height;

        // Apply smoothing
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';

        // Draw resized image
        ctx.drawImage(img, 0, 0, width, height);

        // Convert to compressed JPEG
        const compressedImage = canvas.toDataURL('image/jpeg', 0.8);
        resolve(compressedImage);
      };
      img.onerror = () => reject(new Error('Failed to load image'));
      img.src = e.target?.result as string;
    };
    reader.onerror = () => reject(new Error('Failed to read file'));
    reader.readAsDataURL(file);
  });
}

================
File: src/utils/imageProcessor.ts
================
export async function processProfileImage(file: File): Promise<string> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        // Create canvas for resizing
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        if (!ctx) {
          reject(new Error('Failed to get canvas context'));
          return;
        }

        // Set dimensions (resize to 128x128 for profile pictures)
        const maxSize = 128;
        let width = img.width;
        let height = img.height;

        // Calculate new dimensions maintaining aspect ratio
        if (width > height) {
          if (width > maxSize) {
            height = Math.round(height * maxSize / width);
            width = maxSize;
          }
        } else {
          if (height > maxSize) {
            width = Math.round(width * maxSize / height);
            height = maxSize;
          }
        }

        // Set canvas size to final dimensions
        canvas.width = width;
        canvas.height = height;

        // Apply smoothing
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';

        // Draw resized image
        ctx.drawImage(img, 0, 0, width, height);

        // Convert to highly compressed JPEG
        const compressedImage = canvas.toDataURL('image/jpeg', 0.6);
        resolve(compressedImage);
      };
      img.onerror = () => reject(new Error('Failed to load image'));
      img.src = e.target?.result as string;
    };
    reader.onerror = () => reject(new Error('Failed to read file'));
    reader.readAsDataURL(file);
  });
}

================
File: src/utils/index.ts
================
// Export all utilities
export * from './cache';
export * from './imageProcessor';
export * from './imageCompressor';
export * from './levelCalculator';

================
File: src/utils/levelCalculator.ts
================
// Level calculation utility
export const calculateLevel = (xp: number): { level: number; currentLevelXp: number; nextLevelXp: number; progress: number } => {
  // Base XP required for level 2 is 200
  const BASE_XP = 200;
  // XP scaling factor (exponential growth)
  const SCALING_FACTOR = 1.8;
  
  let level = 1;
  let totalXpRequired = 0;
  let nextLevelXp = BASE_XP;

  // Calculate level based on XP
  while (xp >= totalXpRequired + nextLevelXp) {
    totalXpRequired += nextLevelXp;
    level++;
    nextLevelXp = Math.floor(BASE_XP * Math.pow(SCALING_FACTOR, level - 1));
  }

  // Calculate XP progress in current level
  const currentLevelXp = xp - totalXpRequired;
  const progress = (currentLevelXp / nextLevelXp) * 100;

  return {
    level,
    currentLevelXp,
    nextLevelXp,
    progress
  };
};

================
File: src/utils/performance.ts
================
import { scaleConfig } from '../config/scale';
import { logError } from '../config/monitoring';

export class PerformanceMonitor {
  private static instance: PerformanceMonitor;
  private metrics: Map<string, number[]>;
  private thresholds: Map<string, number>;

  private constructor() {
    this.metrics = new Map();
    this.thresholds = new Map();
    this.setupDefaultThresholds();
  }

  static getInstance(): PerformanceMonitor {
    if (!PerformanceMonitor.instance) {
      PerformanceMonitor.instance = new PerformanceMonitor();
    }
    return PerformanceMonitor.instance;
  }

  private setupDefaultThresholds() {
    this.thresholds.set('rpc', 1000); // 1 second
    this.thresholds.set('db', 500);   // 500ms
    this.thresholds.set('render', 16); // 16ms (60fps)
  }

  trackOperation(category: string, name: string, duration: number) {
    if (!this.metrics.has(category)) {
      this.metrics.set(category, []);
    }

    const metrics = this.metrics.get(category)!;
    metrics.push(duration);

    // Keep only last 100 measurements
    if (metrics.length > 100) {
      metrics.shift();
    }

    // Check if duration exceeds threshold
    const threshold = this.thresholds.get(category);
    if (threshold && duration > threshold) {
      logError(new Error(`Performance threshold exceeded: ${category} - ${name}`), {
        category,
        name,
        duration,
        threshold
      });
    }
  }

  getAverageMetric(category: string): number {
    const metrics = this.metrics.get(category);
    if (!metrics || metrics.length === 0) return 0;

    const sum = metrics.reduce((a, b) => a + b, 0);
    return sum / metrics.length;
  }

  clearMetrics() {
    this.metrics.clear();
  }

  setThreshold(category: string, threshold: number) {
    this.thresholds.set(category, threshold);
  }
}

================
File: src/vite-env.d.ts
================
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_FIREBASE_API_KEY: string
  readonly VITE_FIREBASE_AUTH_DOMAIN: string
  readonly VITE_FIREBASE_PROJECT_ID: string
  readonly VITE_FIREBASE_STORAGE_BUCKET: string
  readonly VITE_FIREBASE_MESSAGING_SENDER_ID: string
  readonly VITE_FIREBASE_APP_ID: string
  readonly VITE_FIREBASE_MEASUREMENT_ID: string
  readonly VITE_SOLANA_RPC_URL: string
  readonly VITE_SOLANA_NETWORK: string
  readonly VITE_HELIUS_API_KEY: string
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}

================
File: supabase/.gitignore
================
# Supabase
.branches
.temp
.env

================
File: supabase/functions/get-nonce/index.ts
================
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders })
  }

  try {
    const { wallet } = await req.json()
    if (!wallet) {
      throw new Error('Missing wallet address')
    }

    // Generate a random nonce
    const nonce = crypto.randomUUID()

    // Store the nonce in Supabase (you'll need to create this table)
    const supabaseClient = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
    )

    const { error } = await supabaseClient
      .from('wallet_nonces')
      .upsert({ 
        wallet,
        nonce,
        created_at: new Date().toISOString()
      })

    if (error) throw error

    return new Response(
      JSON.stringify({ nonce }),
      {
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        status: 200,
      }
    )
  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      {
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        status: 400,
      }
    )
  }
})

================
File: supabase/migrations/20240000000001_base_schema.sql
================
-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- Create players table
create table if not exists players (
  id uuid primary key default uuid_generate_v4(),
  wallet_address text unique not null,
  username text,
  xp integer default 0,
  level integer default 1,
  created_at timestamp with time zone default now(),
  updated_at timestamp with time zone default now()
);

-- Create quests table
create table if not exists quests (
  id uuid primary key default uuid_generate_v4(),
  title text not null,
  description text,
  type text not null check (type in ('daily', 'weekly', 'monthly')),
  xp_reward integer not null default 0,
  is_raid_boss boolean default false,
  completed_by text[] default '{}',
  pending_submissions text[] default '{}',
  created_at timestamp with time zone default now(),
  updated_at timestamp with time zone default now()
);

-- Add RLS policies
alter table players enable row level security;
alter table quests enable row level security;

-- Players policies
create policy "Players can view all players"
  on players for select
  to authenticated
  using (true);

create policy "Players can update their own profile"
  on players for update
  using (wallet_address = auth.jwt() ->> 'sub');

create policy "Players can insert their own profile"
  on players for insert
  with check (wallet_address = auth.jwt() ->> 'sub');

-- Quests policies
create policy "Anyone can view quests"
  on quests for select
  using (true);

create policy "Admins can insert quests"
  on quests for insert
  with check (admin_only());

create policy "Admins can update quests"
  on quests for update
  using (admin_only());

create policy "Admins can delete quests"
  on quests for delete
  using (admin_only());

================
File: supabase/migrations/20240000000002_submission_review.sql
================
-- Create the review_submission function
create or replace function review_submission(
  submission_id uuid,
  new_status text,
  review_notes text default null
) returns void
language plpgsql
security definer
as $$
declare
  v_quest_id uuid;
  v_wallet_address text;
  v_xp_reward int;
begin
  -- Get submission details
  select quest_id, wallet_address, xp_reward
  into v_quest_id, v_wallet_address, v_xp_reward
  from submissions
  where id = submission_id;

  -- Update submission status
  update submissions
  set 
    status = new_status,
    notes = review_notes,
    reviewed_at = now()
  where id = submission_id;

  -- If approved, update quest completion and award XP
  if new_status = 'approved' then
    -- Add wallet to completed_by array if not already present
    update quests
    set completed_by = array_append(completed_by, v_wallet_address)
    where id = v_quest_id
    and not (v_wallet_address = any(completed_by));

    -- Award XP to player
    update players
    set xp = xp + v_xp_reward
    where wallet_address = v_wallet_address;
  end if;
end;
$$;

================
File: supabase/migrations/20240000000003_create_submissions.sql
================
-- Create submissions table
create table if not exists submissions (
  id uuid primary key default uuid_generate_v4(),
  quest_id uuid references quests(id) on delete cascade,
  wallet_address text not null,
  proof_url text not null,
  status text not null default 'pending' check (status in ('pending', 'approved', 'rejected')),
  notes text,
  submitted_at timestamp with time zone default now(),
  reviewed_at timestamp with time zone,
  quest_type text not null,
  xp_reward integer not null,
  is_raid_boss boolean not null default false,
  created_at timestamp with time zone default now(),
  updated_at timestamp with time zone default now()
);

-- Add RLS policies
alter table submissions enable row level security;

-- Allow anyone to view their own submissions
create policy "Users can view their own submissions"
  on submissions for select
  using (wallet_address = auth.jwt() ->> 'sub');

-- Allow users to create submissions
create policy "Users can create submissions"
  on submissions for insert
  with check (wallet_address = auth.jwt() ->> 'sub');

-- Allow admins to view and update all submissions
create policy "Admins can view all submissions"
  on submissions for select
  using (admin_only());

create policy "Admins can update submissions"
  on submissions for update
  using (admin_only());

-- Add pending_submissions array to quests if not exists
do $$ 
begin
  if not exists (
    select 1 from information_schema.columns 
    where table_name = 'quests' 
    and column_name = 'pending_submissions'
  ) then
    alter table quests 
    add column pending_submissions text[] default '{}';
  end if;
end $$;

================
File: supabase/migrations/20240000000004_add_admin_role.sql
================
-- Add is_admin column to players table
alter table players
add column if not exists is_admin boolean default false;

-- Set initial admin (replace with your wallet address)
update players
set is_admin = true
where wallet_address = 'YOUR_ADMIN_WALLET_ADDRESS';

-- Create admin_only() function for RLS policies
create or replace function admin_only()
returns boolean
language plpgsql
security definer
as $$
begin
  return exists (
    select 1 from players
    where wallet_address = auth.jwt() ->> 'sub'
    and is_admin = true
  );
end;
$$;

================
File: tailwind.config.cjs
================
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#fff7ed',
          100: '#ffedd5',
          200: '#fed7aa',
          300: '#fdba74',
          400: '#fb923c',
          500: '#f97316',
          600: '#ea580c',
          700: '#c2410c',
          800: '#9a3412',
          900: '#7c2d12',
          950: '#431407',
        },
        sand: {
          50: '#f5f4ef',
          100: '#e0dbc6',
          200: '#d6d1b8',
          300: '#ccc6aa',
          400: '#c2bc9c',
          500: '#b8b28e',
          600: '#aea880',
          700: '#a49e72',
          800: '#9a9464',
          900: '#908a56',
          950: '#868048',
        },
        background: {
          50: '#f5f4ef',
          100: '#e0dbc6',
          200: '#d6d1b8',
          300: '#ccc6aa',
          400: '#c2bc9c',
          500: '#b8b28e',
          600: '#aea880',
          700: '#a49e72',
          800: '#1e293b',
          900: '#0f172a',
          950: '#020617',
        },
      },
      fontFamily: {
        sans: ['Inter var', 'sans-serif'],
        display: ['Cal Sans', 'Inter var', 'sans-serif'],
        sans: ['Inter', 'system-ui'],
      },
      animation: {
        'float': 'float 6s ease-in-out infinite',
        'float-delayed': 'float 6s ease-in-out 3s infinite',
        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'pulse-slower': 'pulse 8s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'bounce-slow': 'bounce 3s infinite',
        'container-glow': 'container-glow 4s ease-in-out infinite',
        'slowBounce': 'slowBounce 2s ease-in-out infinite',
        'grain': 'grain 8s steps(10) infinite',
        'glow': 'glow 2s ease-in-out infinite alternate',
      },
      keyframes: {
        float: {
          '0%, 100%': { transform: 'translateY(0) scale(1)' },
          '50%': { transform: 'translateY(-20px) scale(1.05)' },
        },
        'container-glow': {
          '0%, 100%': {
            boxShadow: '0 0 15px -3px rgba(249, 115, 22, 0.3)',
            borderColor: 'rgba(249, 115, 22, 0.2)',
          },
          '50%': {
            boxShadow: '0 0 30px -3px rgba(249, 115, 22, 0.4)',
            borderColor: 'rgba(249, 115, 22, 0.4)',
          },
        },
        slowBounce: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(15%)' },
        },
        grain: {
          '0%, 100%': { transform: 'translate(0, 0)' },
          '10%': { transform: 'translate(-5%, -10%)' },
          '20%': { transform: 'translate(-15%, 5%)' },
          '30%': { transform: 'translate(7%, -25%)' },
          '40%': { transform: 'translate(-5%, 25%)' },
          '50%': { transform: 'translate(-15%, 10%)' },
          '60%': { transform: 'translate(15%, 0%)' },
          '70%': { transform: 'translate(0%, 15%)' },
          '80%': { transform: 'translate(3%, 35%)' },
          '90%': { transform: 'translate(-10%, 10%)' },
        },
        glow: {
          '0%': { boxShadow: '0 0 20px rgba(249, 115, 22, 0.3)' },
          '100%': { boxShadow: '0 0 40px rgba(249, 115, 22, 0.6)' },
        },
      },
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
        'gradient-conic': 'conic-gradient(var(--tw-gradient-stops))',
        'gradient-shine': 'linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%, rgba(255,255,255,0.1))',
      },
      boxShadow: {
        'glow': '0 0 50px -12px rgb(249 115 22 / 0.25)',
        'glow-lg': '0 0 100px -12px rgb(249 115 22 / 0.25)',
        'glow-sm': '0 0 15px -3px rgba(249, 115, 22, 0.3)',
        'glow-xl': '0 0 70px -15px rgba(249, 115, 22, 0.6)',
      },
      backdropBlur: {
        xs: '2px',
      },
    },
  },
  plugins: [
    require('tailwind-scrollbar')({ nocompatible: true }),
    require('tailwindcss-animate'),
  ],
}

================
File: tailwind.config.mjs
================
import scrollbar from 'tailwind-scrollbar';
import animate from 'tailwindcss-animate';

export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
        title: ['Archivo Black', 'sans-serif'],
        body: ['Inter', 'system-ui', 'sans-serif'],
      },
      colors: {
        primary: {
          dark: '#1a1a1a',
          main: '#f7931a',
          light: '#ffa940',
        },
        background: {
          // Light theme - sandy, warm colors
          light: '#FAF1E4',     // Light sand base
          lighter: '#FFF8ED',   // Lighter sand
          'light-accent': '#F5E6D3', // Warm accent
          // Dark theme - deeper, richer
          dark: '#1E1F2B',     // Rich navy
          darker: '#171822',    // Deeper navy
          'dark-accent': '#252632', // Navy accent
          // Sand theme colors
          sand: '#F5E6D3',      // Base sand color
          'sand-light': '#FAF1E4', // Light sand
          'sand-dark': '#E6D5BC',  // Dark sand
          lavender: '#E6E6FA'    // Lavender accent
        },
        text: {
          light: {
            primary: '#2C1810',    // Deep warm brown
            secondary: '#4A3F39',   // Warm gray
            muted: '#6B5D54'       // Muted warm gray
          },
          dark: {
            primary: '#FFFFFF',     // Pure white
            secondary: '#E5E5E5',   // Light gray
            muted: '#A0A0A0'       // Medium gray
          }
        },
        card: {
          light: {
            background: '#FAF1E4',  // Light sand
            hover: '#F5E6D3',      // Medium sand
            border: '#E6D5BC'      // Dark sand
          },
          dark: {
            background: '#252632',  // Lighter navy
            hover: '#2A2B38',      // Even lighter
            border: '#32333F'      // Light border
          }
        },
        accent: {
          sand: {
            light: '#FAF1E4',   // Lightest sand
            DEFAULT: '#F5E6D3', // Medium sand
            dark: '#E6D5BC'     // Darker sand
          },
          warm: {
            light: '#FFB088',   // Light coral
            DEFAULT: '#E8825F', // Coral
            dark: '#D15F36'     // Dark coral
          }
        },
        bitcoin: {
          light: '#f7931a',
          DEFAULT: '#f7931a',
          dark: '#e17f0e',
        },
        neon: {
          orange: '#ff7b00',
          glow: '#ff9933',
        },
        glass: {
          light: 'rgba(255, 255, 255, 0.1)',
          dark: 'rgba(0, 0, 0, 0.2)',
        }
      },
      keyframes: {
        'fade-in': {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        'slide-up': {
          '0%': { transform: 'translateY(20px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        'float-slow': {
          '0%, 100%': { transform: 'translate(0, 0)' },
          '50%': { transform: 'translate(20px, -20px)' },
        },
        'float-medium': {
          '0%, 100%': { transform: 'translate(0, 0)' },
          '50%': { transform: 'translate(-15px, 15px)' },
        },
        'float-fast': {
          '0%, 100%': { transform: 'translate(0, 0)' },
          '50%': { transform: 'translate(10px, -10px)' },
        },
        'shimmer': {
          '0%': { backgroundPosition: '200% 0' },
          '100%': { backgroundPosition: '-200% 0' }
        },
        'gradient-x': {
          '0%, 100%': {
            'background-size': '200% 200%',
            'background-position': 'left center'
          },
          '50%': {
            'background-size': '200% 200%',
            'background-position': 'right center'
          }
        },
        'hologram': {
          '0%, 100%': {
            transform: 'perspective(1000px) rotateX(0deg) rotateY(0deg)',
            filter: 'hue-rotate(0deg)'
          },
          '25%': {
            transform: 'perspective(1000px) rotateX(2deg) rotateY(-2deg)',
            filter: 'hue-rotate(45deg)'
          },
          '50%': {
            transform: 'perspective(1000px) rotateX(-2deg) rotateY(2deg)',
            filter: 'hue-rotate(90deg)'
          },
          '75%': {
            transform: 'perspective(1000px) rotateX(2deg) rotateY(-2deg)',
            filter: 'hue-rotate(45deg)'
          }
        }
      },
      animation: {
        'fade-in': 'fade-in 0.5s ease-out',
        'slide-up': 'slide-up 0.5s ease-out',
        'float-slow': 'float-slow 6s ease-in-out infinite',
        'float-medium': 'float-medium 5s ease-in-out infinite',
        'float-fast': 'float-fast 4s ease-in-out infinite',
        'shimmer': 'shimmer 3s linear infinite',
        'gradient-x': 'gradient-x 3s ease infinite',
        'hologram': 'hologram 3s ease infinite',
        'pulse-glow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite'
      },
      boxShadow: {
        'card': '0 2px 4px rgba(44, 24, 16, 0.05)',
        'card-hover': '0 4px 6px rgba(44, 24, 16, 0.1)',
        'glow': '0 0 20px rgba(232, 130, 95, 0.2)',
        'glow-strong': '0 0 30px rgba(232, 130, 95, 0.3)',
        'neon': '0 0 10px rgba(255, 123, 0, 0.3)',
        'neon-strong': '0 0 20px rgba(255, 123, 0, 0.5)',
        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
        'aero': '0 8px 32px 0 rgba(0, 0, 0, 0.1)'
      }
    },
  },
  plugins: [
    scrollbar({ nocompatible: true }),
    animate,
  ],
};

================
File: tsconfig.app.json
================
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"]
}

================
File: tsconfig.json
================
{
  "files": [],
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.node.json"
    }
  ],
  "compilerOptions": {
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": false,
    "noEmit": true,
    "incremental": true,
    "module": "esnext",
    "esModuleInterop": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve"
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx"
  ],
  "exclude": [
    "node_modules"
  ]
}

================
File: tsconfig.node.json
================
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

================
File: vercel.json
================
{
  "framework": "vite",
  "buildCommand": "vite build",
  "outputDirectory": "dist",
  "routes": [
    {
      "src": "/assets/(.*)",
      "headers": {
        "cache-control": "public, max-age=31536000, immutable"
      }
    },
    {
      "handle": "filesystem"
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}

================
File: vite.config.ts
================
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => {
  // Load env file based on `mode` in the current working directory.
  // Set the third parameter to '' to load all env regardless of the `VITE_` prefix.
  const env = loadEnv(mode, process.cwd(), '');

  return {
    plugins: [react()],
    build: {
      target: 'esnext',
      minify: 'esbuild',
      sourcemap: false,
      rollupOptions: {
        output: {
          manualChunks: {
            'react-vendor': ['react', 'react-dom', 'react-router-dom'],
            'solana-vendor': [
              '@solana/wallet-adapter-base',
              '@solana/wallet-adapter-react',
              '@solana/wallet-adapter-react-ui',
              '@solana/wallet-adapter-wallets',
              '@solana/web3.js'
            ],
            'ui-vendor': [
              'lucide-react',
              'tailwindcss'
            ],
            'crypto-vendor': ['crypto-js']
          }
        },
        external: ['crypto']
      },
      chunkSizeWarningLimit: 1000,
      reportCompressedSize: true
    },
    resolve: {
      alias: {
        'crypto': 'crypto-browserify',
        'stream': 'stream-browserify',
        'assert': 'assert',
        'http': 'stream-http',
        'https': 'https-browserify',
        'os': 'os-browserify',
        'url': 'url'
      }
    },
    server: {
      port: 5173,
      strictPort: true,
      https: false,
      hmr: {
        protocol: 'ws',
        host: 'localhost',
      }
    },
    optimizeDeps: {
      include: ['crypto-js'],
      esbuildOptions: {
        target: 'esnext',
        supported: { 
          bigint: true 
        },
      }
    },
    cacheDir: 'node_modules/.vite',
    worker: {
      format: 'es',
      plugins: []
    },
    publicDir: 'public',
    assetsInclude: ['**/*.mp4'],
    define: {
      // Expose env variables
      'process.env': env
    },
    envPrefix: ['VITE_']
  };
});
